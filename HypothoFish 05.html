<!DOCTYPE html>
<html>
<head>
    <title>DeehypothoFish</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            background: #f0f4f8;
        }

        #experiment-selector {
            display: flex;
            gap: 20px;
            margin: 5px auto;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            width: 800px;
        }

        #experiment-selector select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
            min-width: 200px;
        }

        #variables-pool {
            display: flex;
            gap: 20px;
            margin: 5px auto 10px auto;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            min-height: 50px;
            width: 800px;
            transition: background-color 0.3s;
            flex-wrap: wrap;
        }

        .add-all-button {
            display: block;
            margin: 10px auto;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s, opacity 0.3s;
        }

        .add-all-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .add-all-button:not(:disabled):hover {
            background-color: #45a049;
        }

        #fishbone-container {
            position: relative;
            width: 800px;
            height: 300px;
            margin: 0 auto;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .backbone {
            position: absolute;
            left: 100px;
            width: 600px;
            top: 150px;
            height: 4px;
            background: #333;
        }

        .fish-head {
            position: absolute;
            right: 80px;
            top: 120px;
            width: 100px;
            height: 60px;
            background: #f0f0f0;
            border-radius: 30px 60px 60px 30px;
            border: 2px solid #333;
        }

        .bone {
            position: absolute;
            width: 150px;
            height: 4px;
            background: #666;
            transform-origin: right center;
        }

        .bone1 { right: 600px; top: 150px; transform: rotate(45deg); }
        .bone2 { right: 520px; top: 150px; transform: rotate(-45deg); }
        .bone3 { right: 440px; top: 150px; transform: rotate(45deg); }
        .bone4 { right: 360px; top: 150px; transform: rotate(-45deg); }
        .bone5 { right: 280px; top: 150px; transform: rotate(45deg); }
        .bone6 { right: 200px; top: 150px; transform: rotate(-45deg); }

        .drop-zone {
            position: absolute;
            width: 140px;
            min-height: 40px;
            background: rgba(255,255,255,0.8);
            border: 2px dashed #999;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
        }

        .variable-card {
            width: 140px;
            min-height: 40px;
            padding: 8px 12px;
            background: #e0e0e0;
            border: 1px solid #999;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: move;
            user-select: none;
            position: relative;
            transition: background-color 0.3s;
        }

        .variable-card.iv { background: #fff3d4; }
        .variable-card.dv { background: #d4e6ff; }

        .variable-name {
            font-weight: bold;
            margin-bottom: 4px;
            text-align: center;
            word-wrap: break-word;
            line-height: 1.2;
            width: 100%;
        }

        .variable-unit {
            font-size: 0.8em;
            color: #666;
            text-align: center;
            width: 100%;
        }

        #hypothesis {
            width: 800px;
            margin: 10px auto 0 auto;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }

        .trend-selectors {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }

        .trend-selectors select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
            min-width: 200px;
        }

        .hypothesis-container {
            padding: 15px;
            border-radius: 8px;
        }

        .hypothesis-statement {
            font-size: 1.2em;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .iv-highlight {
            color: #B8860B;
            font-weight: 500;
        }

        .dv-highlight {
            color: #0066cc;
            font-weight: 500;
        }

        .cv-highlight {
            color: #444444;
        }

        .trend-highlight {
            padding: 2px 8px;
            border-radius: 12px;
        }

        .iv-trend-highlight {
            background-color: #FFF8DC;
        }

        .dv-trend-highlight {
            background-color: #E6F3FF;
        }

        .valid-background {
            background-color: #F0FFF0;
        }

        .missing-cvs {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            margin-top: 8px;
        }

        .validity-note {
            font-size: 0.9em;
            color: #28a745;
            margin-top: 8px;
            font-style: italic;
        }

        .error-text {
            color: #dc3545;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div id="experiment-selector">
        <select id="subject-select">
            <option value="">Select Subject</option>
        </select>
        <select id="category-select" disabled>
            <option value="">Select Category</option>
        </select>
        <select id="experiment-select" disabled>
            <option value="">Select Experiment</option>
        </select>
    </div>
    <div id="variables-pool"></div>
    <button id="add-all-cvs" class="add-all-button" disabled style="display: none;">
        Add All Variables as CVs
    </button>
    <div id="fishbone-container">
        <div class="backbone"></div>
        <div class="fish-head"></div>
        <div class="bone bone1"></div>
        <div class="bone bone2"></div>
        <div class="bone bone3"></div>
        <div class="bone bone4"></div>
        <div class="bone bone5"></div>
        <div class="bone bone6"></div>
    </div>
    <div id="hypothesis">
        <div class="trend-selectors">
            <select id="iv-trend-selector">
                <option value="increases">increases</option>
                <option value="decreases">decreases</option>
            </select>
            <select id="dv-trend-selector">
                <option value="no_relationship">select relationship...</option>
                <option value="increases_linearly" selected>increases linearly with</option>
                <option value="decreases_linearly">decreases linearly with</option>
                <option value="increases_square">increases with the square of</option>
                <option value="decreases_square">decreases with the square of</option>
                <option value="increases_root">increases with the square root of</option>
                <option value="decreases_root">decreases with the square root of</option>
                <option value="inverse">varies inversely with</option>
                <option value="inverse_square">varies inversely with the square of</option>
                <option value="exponential_growth">increases exponentially with</option>
                <option value="exponential_decay">decreases exponentially with</option>
                <option value="sinusoidal">varies sinusoidally with</option>
                <option value="bell_curve">shows a bell curve with</option>
                <option value="u_shaped">shows a U-shaped curve with</option>
                <option value="plateau_increase">increases then plateaus with</option>
                <option value="plateau_decrease">decreases then plateaus with</option>
                <option value="threshold">shows a threshold effect with</option>
                <option value="stepwise">changes in steps with</option>
                <option value="no_effect">shows no relationship with</option>
            </select>
        </div>
        <p id="hypothesis-text"></p>
    </div>
    <script>
        let currentExperiment = 'pendulum';
        let currentIV = null;
        let currentDV = null;

        const validExperiments = {
            'pendulum': [
                {
                    iv: 'length',
                    dv: 'period',
                    cvs: ['mass', 'amplitude', 'air_resistance', 'gravity']
                },
                {
                    iv: 'amplitude',
                    dv: 'period',
                    cvs: ['length', 'mass', 'air_resistance', 'gravity']
                },
                {
                    iv: 'mass',
                    dv: 'period',
                    cvs: ['length', 'amplitude', 'air_resistance', 'gravity']
                },
                {
                    iv: 'air_resistance',
                    dv: 'period',
                    cvs: ['length', 'mass', 'amplitude', 'gravity']
                },
                {
                    iv: 'gravity',
                    dv: 'period',
                    cvs: ['length', 'mass', 'amplitude', 'air_resistance']
                }
            ],
            'hookes_law': [
                {
                    iv: 'displacement',
                    dv: 'force',
                    cvs: ['spring_constant', 'initial_length', 'mass', 'temperature']
                },
                {
                    iv: 'spring_constant',
                    dv: 'force',
                    cvs: ['displacement', 'initial_length', 'mass', 'temperature']
                },
                {
                    iv: 'temperature',
                    dv: 'spring_constant',
                    cvs: ['force', 'displacement', 'initial_length', 'mass']
                },
                {
                    iv: 'mass',
                    dv: 'force',
                    cvs: ['spring_constant', 'displacement', 'initial_length', 'temperature']
                },
                {
                    iv: 'spring_constant',
                    dv: 'displacement',
                    cvs: ['force', 'initial_length', 'mass', 'temperature']
                }
            ],
            'reaction_rate': [
                {
                    iv: 'concentration',
                    dv: 'rate',
                    cvs: ['temperature', 'catalyst', 'surface_area', 'pressure']
                },
                {
                    iv: 'temperature',
                    dv: 'rate',
                    cvs: ['concentration', 'catalyst', 'surface_area', 'pressure']
                },
                {
                    iv: 'catalyst',
                    dv: 'rate',
                    cvs: ['concentration', 'temperature', 'surface_area', 'pressure']
                },
                {
                    iv: 'surface_area',
                    dv: 'rate',
                    cvs: ['concentration', 'temperature', 'catalyst', 'pressure']
                },
                {
                    iv: 'pressure',
                    dv: 'rate',
                    cvs: ['concentration', 'temperature', 'catalyst', 'surface_area']
                }
            ],
            'gas_laws': [
                {
                    iv: 'pressure',
                    dv: 'volume',
                    cvs: ['temperature', 'moles', 'density', 'humidity']
                },
                {
                    iv: 'temperature',
                    dv: 'pressure',
                    cvs: ['volume', 'moles', 'density', 'humidity']
                },
                {
                    iv: 'volume',
                    dv: 'pressure',
                    cvs: ['temperature', 'moles', 'density', 'humidity']
                },
                {
                    iv: 'temperature',
                    dv: 'volume',
                    cvs: ['pressure', 'moles', 'density', 'humidity']
                },
                {
                    iv: 'moles',
                    dv: 'pressure',
                    cvs: ['temperature', 'volume', 'density', 'humidity']
                },
                {
                    iv: 'moles',
                    dv: 'volume',
                    cvs: ['temperature', 'pressure', 'density', 'humidity']
                },
                {
                    iv: 'temperature',
                    dv: 'density',
                    cvs: ['pressure', 'volume', 'moles', 'humidity']
                }
            ],
            'photosynthesis': [
                {
                    iv: 'light',
                    dv: 'co2_rate',
                    cvs: ['temperature', 'co2_conc', 'water', 'leaf_area']
                },
                {
                    iv: 'temperature',
                    dv: 'co2_rate',
                    cvs: ['light', 'co2_conc', 'water', 'leaf_area']
                },
                {
                    iv: 'co2_conc',
                    dv: 'co2_rate',
                    cvs: ['light', 'temperature', 'water', 'leaf_area']
                },
                {
                    iv: 'water',
                    dv: 'co2_rate',
                    cvs: ['light', 'temperature', 'co2_conc', 'leaf_area']
                },
                {
                    iv: 'leaf_area',
                    dv: 'co2_rate',
                    cvs: ['light', 'temperature', 'co2_conc', 'water']
                }
            ],
            'plant_growth': [
                {
                    iv: 'water',
                    dv: 'height',
                    cvs: ['fertilizer', 'light_time', 'soil_ph', 'temperature']
                },
                {
                    iv: 'fertilizer',
                    dv: 'height',
                    cvs: ['water', 'light_time', 'soil_ph', 'temperature']
                },
                {
                    iv: 'light_time',
                    dv: 'height',
                    cvs: ['water', 'fertilizer', 'soil_ph', 'temperature']
                },
                {
                    iv: 'soil_ph',
                    dv: 'height',
                    cvs: ['water', 'fertilizer', 'light_time', 'temperature']
                },
                {
                    iv: 'temperature',
                    dv: 'height',
                    cvs: ['water', 'fertilizer', 'light_time', 'soil_ph']
                }
            ],
            'reaction_time': [
                {
                    iv: 'stimulus_intensity',
                    dv: 'response_time',
                    cvs: ['caffeine', 'sleep_hours', 'time_of_day', 'age']
                },
                {
                    iv: 'caffeine',
                    dv: 'response_time',
                    cvs: ['stimulus_intensity', 'sleep_hours', 'time_of_day', 'age']
                },
                {
                    iv: 'sleep_hours',
                    dv: 'response_time',
                    cvs: ['stimulus_intensity', 'caffeine', 'time_of_day', 'age']
                },
                {
                    iv: 'time_of_day',
                    dv: 'response_time',
                    cvs: ['stimulus_intensity', 'caffeine', 'sleep_hours', 'age']
                },
                {
                    iv: 'age',
                    dv: 'response_time',
                    cvs: ['stimulus_intensity', 'caffeine', 'sleep_hours', 'time_of_day']
                }
            ],
            'memory_recall': [
                {
                    iv: 'study_duration',
                    dv: 'recall_accuracy',
                    cvs: ['time_elapsed', 'complexity', 'noise_level', 'sleep_quality']
                },
                {
                    iv: 'time_elapsed',
                    dv: 'recall_accuracy',
                    cvs: ['study_duration', 'complexity', 'noise_level', 'sleep_quality']
                },
                {
                    iv: 'complexity',
                    dv: 'recall_accuracy',
                    cvs: ['study_duration', 'time_elapsed', 'noise_level', 'sleep_quality']
                },
                {
                    iv: 'noise_level',
                    dv: 'recall_accuracy',
                    cvs: ['study_duration', 'time_elapsed', 'complexity', 'sleep_quality']
                },
                {
                    iv: 'sleep_quality',
                    dv: 'recall_accuracy',
                    cvs: ['study_duration', 'time_elapsed', 'complexity', 'noise_level']
                }
            ]
        };
        const experimentData = {
            physics: {
                name: "Physics",
                categories: {
                    mechanics: {
                        name: "Mechanics",
                        subcategories: {
                            motion_forces: {
                                name: "Motion & Forces",
                                experiments: {
                                    pendulum: {
                                        name: "Simple Pendulum",
                                        variables: [
                                            { id: 'period', name: 'Period', unit: 's', canBeDV: true, canBeIV: true },
                                            { id: 'length', name: 'Length', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'mass', name: 'Mass', unit: 'kg', canBeDV: false, canBeIV: true },
                                            { id: 'amplitude', name: 'Initial Amplitude', unit: '°', canBeDV: false, canBeIV: true },
                                            { id: 'gravity', name: 'Gravity', unit: 'm/s²', canBeCV: true, canBeIV: true },
                                            { id: 'air_resistance', name: 'Air Resistance', unit: 'kg/m·s', canBeCV: true, canBeIV: true }
                                        ]
                                    },
                                    free_fall: {
                                        name: "Free Fall",
                                        variables: [
                                            { id: 'drop_height', name: 'Drop Height', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'fall_time', name: 'Fall Time', unit: 's', canBeDV: true, canBeIV: false },
                                            { id: 'mass', name: 'Mass', unit: 'kg', canBeDV: false, canBeIV: true },
                                            { id: 'air_resistance', name: 'Air Resistance', unit: 'coefficient', canBeDV: false, canBeIV: true },
                                            { id: 'initial_velocity', name: 'Initial Velocity', unit: 'm/s', canBeDV: false, canBeIV: true }
                                        ]
                                    },
                                    projectile_motion: {
                                        name: "Projectile Motion",
                                        variables: [
                                            { id: 'launch_angle', name: 'Launch Angle', unit: '°', canBeDV: false, canBeIV: true },
                                            { id: 'initial_velocity', name: 'Initial Velocity', unit: 'm/s', canBeDV: false, canBeIV: true },
                                            { id: 'range', name: 'Range', unit: 'm', canBeDV: true, canBeIV: false },
                                            { id: 'max_height', name: 'Maximum Height', unit: 'm', canBeDV: true, canBeIV: false },
                                            { id: 'flight_time', name: 'Flight Time', unit: 's', canBeDV: true, canBeIV: false },
                                            { id: 'mass', name: 'Mass', unit: 'kg', canBeDV: false, canBeIV: true }
                                        ]
                                    },
                                    friction_incline: {
                                        name: "Friction on Inclined Plane",
                                        variables: [
                                            { id: 'angle', name: 'Angle', unit: '°', canBeDV: false, canBeIV: true },
                                            { id: 'acceleration', name: 'Acceleration', unit: 'm/s²', canBeDV: true, canBeIV: false },
                                            { id: 'mass', name: 'Mass', unit: 'kg', canBeDV: false, canBeIV: true },
                                            { id: 'surface_material', name: 'Surface Material', unit: 'type', canBeDV: false, canBeIV: true },
                                            { id: 'normal_force', name: 'Normal Force', unit: 'N', canBeDV: true, canBeIV: false },
                                            { id: 'friction_coefficient', name: 'Friction Coefficient', unit: 'μ', canBeDV: true, canBeIV: false }
                                        ]
                                    },
                                    centripetal_force: {
                                        name: "Centripetal Force",
                                        variables: [
                                            { id: 'radius', name: 'Radius', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'velocity', name: 'Velocity', unit: 'm/s', canBeDV: false, canBeIV: true },
                                            { id: 'centripetal_force', name: 'Centripetal Force', unit: 'N', canBeDV: true, canBeIV: false },
                                            { id: 'mass', name: 'Mass', unit: 'kg', canBeDV: false, canBeIV: true },
                                            { id: 'period', name: 'Period', unit: 's', canBeDV: true, canBeIV: false },
                                            { id: 'angular_velocity', name: 'Angular Velocity', unit: 'rad/s', canBeDV: true, canBeIV: false }
                                        ]
                                    },
                                    momentum_collision: {
                                        name: "Momentum Conservation",
                                        variables: [
                                            { id: 'mass1', name: 'Mass 1', unit: 'kg', canBeDV: false, canBeIV: true },
                                            { id: 'mass2', name: 'Mass 2', unit: 'kg', canBeDV: false, canBeIV: true },
                                            { id: 'initial_velocity1', name: 'Initial Velocity 1', unit: 'm/s', canBeDV: false, canBeIV: true },
                                            { id: 'final_velocity1', name: 'Final Velocity 1', unit: 'm/s', canBeDV: true, canBeIV: false },
                                            { id: 'final_velocity2', name: 'Final Velocity 2', unit: 'm/s', canBeDV: true, canBeIV: false },
                                            { id: 'collision_type', name: 'Collision Type', unit: 'elastic/inelastic', canBeDV: false, canBeIV: true },
                                            { id: 'kinetic_energy_loss', name: 'KE Loss', unit: '%', canBeDV: true, canBeIV: false }
                                        ]
                                    }
                                }
                            },
                            oscillations_waves: {
                                name: "Oscillations & Waves",
                                experiments: {
                                    mass_spring: {
                                        name: "Mass-Spring SHM",
                                        variables: [
                                            { id: 'mass', name: 'Mass', unit: 'kg', canBeDV: false, canBeIV: true },
                                            { id: 'period', name: 'Period', unit: 's', canBeDV: true, canBeIV: false },
                                            { id: 'amplitude', name: 'Amplitude', unit: 'm', canBeDV: true, canBeIV: true },
                                            { id: 'spring_constant', name: 'Spring Constant', unit: 'N/m', canBeDV: false, canBeIV: true },
                                            { id: 'damping', name: 'Damping', unit: 'kg/s', canBeDV: false, canBeIV: true }
                                        ]
                                    },
                                    resonance_tubes: {
                                        name: "Resonance in Tubes",
                                        variables: [
                                            { id: 'tube_length', name: 'Tube Length', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'resonant_frequency', name: 'Resonant Frequency', unit: 'Hz', canBeDV: true, canBeIV: false },
                                            { id: 'temperature', name: 'Temperature', unit: '°C', canBeDV: false, canBeIV: true },
                                            { id: 'tube_diameter', name: 'Tube Diameter', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'harmonic_number', name: 'Harmonic Number', unit: 'n', canBeDV: false, canBeIV: true },
                                            { id: 'end_correction', name: 'End Correction', unit: 'm', canBeDV: true, canBeIV: false }
                                        ]
                                    }
                                }
                            },
                            fluids: {
                                name: "Fluids",
                                experiments: {
                                    buoyancy: {
                                        name: "Buoyancy",
                                        variables: [
                                            { id: 'object_volume', name: 'Object Volume', unit: 'm³', canBeDV: false, canBeIV: true },
                                            { id: 'buoyant_force', name: 'Buoyant Force', unit: 'N', canBeDV: true, canBeIV: false },
                                            { id: 'fluid_density', name: 'Fluid Density', unit: 'kg/m³', canBeDV: false, canBeIV: true },
                                            { id: 'object_mass', name: 'Object Mass', unit: 'kg', canBeDV: false, canBeIV: true },
                                            { id: 'depth', name: 'Depth', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'object_density', name: 'Object Density', unit: 'kg/m³', canBeDV: false, canBeIV: true }
                                        ]
                                    },
                                    fluid_pressure: {
                                        name: "Pressure in Fluids",
                                        variables: [
                                            { id: 'depth', name: 'Depth', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'pressure', name: 'Pressure', unit: 'Pa', canBeDV: true, canBeIV: false },
                                            { id: 'fluid_density', name: 'Fluid Density', unit: 'kg/m³', canBeDV: false, canBeIV: true },
                                            { id: 'container_shape', name: 'Container Shape', unit: 'type', canBeDV: false, canBeIV: true },
                                            { id: 'temperature', name: 'Temperature', unit: '°C', canBeDV: false, canBeIV: true },
                                            { id: 'atmospheric_pressure', name: 'Atmospheric Pressure', unit: 'Pa', canBeDV: false, canBeIV: true }
                                        ]
                                    }
                                }
                            }
                        }
                    },
                    waves_optics: {
                        name: "Waves & Optics",
                        subcategories: {
                            sound_waves: {
                                name: "Sound & Mechanical Waves",
                                experiments: {
                                    sound_waves: {
                                        name: "Sound Waves",
                                        variables: [
                                            { id: 'frequency', name: 'Frequency', unit: 'Hz', canBeDV: false, canBeIV: true },
                                            { id: 'wavelength', name: 'Wavelength', unit: 'm', canBeDV: true, canBeIV: false },
                                            { id: 'temperature', name: 'Temperature', unit: '°C', canBeDV: false, canBeIV: true },
                                            { id: 'medium', name: 'Medium', unit: 'type', canBeDV: false, canBeIV: true },
                                            { id: 'amplitude', name: 'Amplitude', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'speed', name: 'Wave Speed', unit: 'm/s', canBeDV: true, canBeIV: false },
                                            { id: 'pitch_perception', name: 'Pitch Perception', unit: 'Hz', canBeDV: true, canBeIV: false }
                                        ]
                                    },
                                    wave_interference: {
                                        name: "Wave Interference",
                                        variables: [
                                            { id: 'frequency', name: 'Frequency', unit: 'Hz', canBeDV: false, canBeIV: true },
                                            { id: 'wavelength', name: 'Wavelength', unit: 'm', canBeDV: true, canBeIV: false },
                                            { id: 'slit_separation', name: 'Slit Separation', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'fringe_spacing', name: 'Fringe Spacing', unit: 'm', canBeDV: true, canBeIV: false },
                                            { id: 'water_depth', name: 'Water Depth', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'amplitude', name: 'Amplitude', unit: 'm', canBeDV: false, canBeIV: true }
                                        ]
                                    }
                                }
                            },
                            light_optics: {
                                name: "Light & Optics",
                                experiments: {
                                    refraction: {
                                        name: "Refraction (Snell's Law)",
                                        variables: [
                                            { id: 'incident_angle', name: 'Incident Angle', unit: '°', canBeDV: false, canBeIV: true },
                                            { id: 'refracted_angle', name: 'Refracted Angle', unit: '°', canBeDV: true, canBeIV: false },
                                            { id: 'medium1', name: 'Medium 1', unit: 'type', canBeDV: false, canBeIV: true },
                                            { id: 'medium2', name: 'Medium 2', unit: 'type', canBeDV: false, canBeIV: true },
                                            { id: 'wavelength', name: 'Wavelength', unit: 'nm', canBeDV: false, canBeIV: true },
                                            { id: 'intensity', name: 'Intensity', unit: 'W/m²', canBeDV: false, canBeIV: true }
                                        ]
                                    },
                                    lens_focal: {
                                        name: "Lens Focal Length",
                                        variables: [
                                            { id: 'object_distance', name: 'Object Distance', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'image_distance', name: 'Image Distance', unit: 'm', canBeDV: true, canBeIV: false },
                                            { id: 'focal_length', name: 'Focal Length', unit: 'm', canBeDV: true, canBeIV: false },
                                            { id: 'magnification', name: 'Magnification', unit: 'ratio', canBeDV: true, canBeIV: false },
                                            { id: 'lens_type', name: 'Lens Type', unit: 'converging/diverging', canBeDV: false, canBeIV: true },
                                            { id: 'object_height', name: 'Object Height', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'image_height', name: 'Image Height', unit: 'm', canBeDV: true, canBeIV: false }
                                        ]
                                    }
                                }
                            }
                        }
                    },
                    thermodynamics: {
                        name: "Thermodynamics",
                        subcategories: {
                            heat_transfer: {
                                name: "Heat & Energy Transfer",
                                experiments: {
                                    heat_conduction: {
                                        name: "Heat Conduction",
                                        variables: [
                                            { id: 'temperature_difference', name: 'Temperature Difference', unit: '°C', canBeDV: false, canBeIV: true },
                                            { id: 'heat_flow_rate', name: 'Heat Flow Rate', unit: 'W', canBeDV: true, canBeIV: false },
                                            { id: 'material', name: 'Material', unit: 'type', canBeDV: false, canBeIV: true },
                                            { id: 'thickness', name: 'Thickness', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'area', name: 'Area', unit: 'm²', canBeDV: false, canBeIV: true },
                                            { id: 'time', name: 'Time', unit: 's', canBeDV: false, canBeIV: true }
                                        ]
                                    },
                                    specific_heat: {
                                        name: "Specific Heat Capacity",
                                        variables: [
                                            { id: 'mass', name: 'Mass', unit: 'kg', canBeDV: false, canBeIV: true },
                                            { id: 'temperature_change', name: 'Temperature Change', unit: '°C', canBeDV: true, canBeIV: true },
                                            { id: 'heat_energy', name: 'Heat Energy', unit: 'J', canBeDV: true, canBeIV: true },
                                            { id: 'material', name: 'Material', unit: 'type', canBeDV: false, canBeIV: true },
                                            { id: 'specific_heat', name: 'Specific Heat', unit: 'J/kg·°C', canBeDV: true, canBeIV: false },
                                            { id: 'initial_temp', name: 'Initial Temperature', unit: '°C', canBeDV: false, canBeIV: true }
                                        ]
                                    },
                                    cooling_curve: {
                                        name: "Cooling Curve",
                                        variables: [
                                            { id: 'initial_temperature', name: 'Initial Temperature', unit: '°C', canBeDV: false, canBeIV: true },
                                            { id: 'time', name: 'Time', unit: 's', canBeDV: false, canBeIV: true },
                                            { id: 'final_temperature', name: 'Final Temperature', unit: '°C', canBeDV: true, canBeIV: false },
                                            { id: 'surface_area', name: 'Surface Area', unit: 'm²', canBeDV: false, canBeIV: true },
                                            { id: 'volume', name: 'Volume', unit: 'm³', canBeDV: false, canBeIV: true },
                                            { id: 'ambient_temperature', name: 'Ambient Temperature', unit: '°C', canBeDV: false, canBeIV: true },
                                            { id: 'cooling_rate', name: 'Cooling Rate', unit: '°C/s', canBeDV: true, canBeIV: false }
                                        ]
                                    },
                                    thermal_expansion: {
                                        name: "Thermal Expansion",
                                        variables: [
                                            { id: 'temperature_change', name: 'Temperature Change', unit: '°C', canBeDV: false, canBeIV: true },
                                            { id: 'length_change', name: 'Length Change', unit: 'm', canBeDV: true, canBeIV: false },
                                            { id: 'material', name: 'Material', unit: 'type', canBeDV: false, canBeIV: true },
                                            { id: 'original_length', name: 'Original Length', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'cross_sectional_area', name: 'Cross-sectional Area', unit: 'm²', canBeDV: false, canBeIV: true },
                                            { id: 'expansion_coefficient', name: 'Expansion Coefficient', unit: '1/°C', canBeDV: true, canBeIV: false }
                                        ]
                                    }
                                }
                            }
                        }
                    },
                    electricity_magnetism: {
                        name: "Electricity & Magnetism",
                        subcategories: {
                            circuits: {
                                name: "Circuits & Resistance",
                                experiments: {
                                    ohms_law: {
                                        name: "Ohm's Law",
                                        variables: [
                                            { id: 'voltage', name: 'Voltage', unit: 'V', canBeDV: true, canBeIV: false },
                                            { id: 'current', name: 'Current', unit: 'A', canBeDV: false, canBeIV: true },
                                            { id: 'resistance', name: 'Resistance', unit: 'Ω', canBeDV: true, canBeIV: true },
                                            { id: 'temperature', name: 'Temperature', unit: '°C', canBeDV: false, canBeIV: true },
                                            { id: 'wire_length', name: 'Wire Length', unit: 'm', canBeDV: false, canBeIV: true },
                                            { id: 'wire_diameter', name: 'Wire Diameter', unit: 'mm', canBeDV: false, canBeIV: true }
                                        ]
                                    }
                                }
                            },
                            electromagnetic: {
                                name: "Electromagnetic Phenomena",
                                experiments: {
                                    electromagnetic_induction: {
                                        name: "Electromagnetic Induction",
                                        variables: [
                                            { id: 'coil_turns', name: 'Coil Turns', unit: 'count', canBeDV: false, canBeIV: true },
                                            { id: 'magnet_speed', name: 'Magnet Speed', unit: 'm/s', canBeDV: false, canBeIV: true },
                                            { id: 'induced_voltage', name: 'Induced Voltage', unit: 'V', canBeDV: true, canBeIV: false },
                                            { id: 'magnet_strength', name: 'Magnet Strength', unit: 'T', canBeDV: false, canBeIV: true },
                                            { id: 'coil_area', name: 'Coil Area', unit: 'm²', canBeDV: false, canBeIV: true }
                                        ]
                                    },
                                    photoelectric_effect: {
                                        name: "Photoelectric Effect",
                                        variables: [
                                            { id: 'light_frequency', name: 'Light Frequency', unit: 'Hz', canBeDV: false, canBeIV: true },
                                            { id: 'stopping_voltage', name: 'Stopping Voltage', unit: 'V', canBeDV: true, canBeIV: false },
                                            { id: 'intensity', name: 'Light Intensity', unit: 'W/m²', canBeDV: false, canBeIV: true },
                                            { id: 'current', name: 'Current', unit: 'A', canBeDV: true, canBeIV: false },
                                            { id: 'metal_type', name: 'Metal Type', unit: 'material', canBeDV: false, canBeIV: true },
                                            { id: 'threshold_frequency', name: 'Threshold Frequency', unit: 'Hz', canBeDV: true, canBeIV: false }
                                        ]
                                    }
                                }
                            }
                        }
                    }
                }
            },
            chemistry: {
                name: "Chemistry",
                categories: {
                    chemical_kinetics: {
                        name: "Chemical Kinetics",
                        subcategories: {
                            reaction_dynamics: {
                                name: "Reaction Dynamics",
                                experiments: {
                                    reaction_rate: {
                                        name: "Reaction Rate",
                                        variables: [
                                            { id: 'rate', name: 'Reaction Rate', unit: 'mol/L·s', canBeDV: true, canBeIV: false },
                                            { id: 'concentration', name: 'Concentration', unit: 'mol/L', canBeDV: false, canBeIV: true },
                                            { id: 'temperature', name: 'Temperature', unit: '°C', canBeDV: false, canBeIV: true },
                                            { id: 'catalyst', name: 'Catalyst Amount', unit: 'g', canBeDV: false, canBeIV: true },
                                            { id: 'surface_area', name: 'Surface Area', unit: 'cm²', canBeDV: false, canBeIV: true },
                                            { id: 'pressure', name: 'Pressure', unit: 'kPa', canBeDV: false, canBeIV: true }
                                        ]
                                    }
                                }
                            }
                        }
                    },
                    gas_behavior: {
                        name: "Gas Behavior",
                        subcategories: {
                            gas_properties: {
                                name: "Gas Properties",
                                experiments: {
                                    gas_laws: {
                                        name: "Gas Laws",
                                        variables: [
                                            { id: 'pressure', name: 'Pressure', unit: 'kPa', canBeDV: true, canBeIV: true },
                                            { id: 'volume', name: 'Volume', unit: 'L', canBeDV: true, canBeIV: true },
                                            { id: 'temperature', name: 'Temperature', unit: 'K', canBeDV: true, canBeIV: true },
                                            { id: 'moles', name: 'Number of Moles', unit: 'mol', canBeDV: false, canBeIV: true },
                                            { id: 'density', name: 'Gas Density', unit: 'g/L', canBeDV: true, canBeIV: true },
                                            { id: 'humidity', name: 'Humidity', unit: '%', canBeDV: false, canBeIV: true }
                                        ]
                                    }
                                }
                            }
                        }
                    }
                }
            },
            biology: {
                name: "Biology",
                categories: {
                    plant_physiology: {
                        name: "Plant Physiology",
                        subcategories: {
                            plant_processes: {
                                name: "Plant Processes",
                                experiments: {
                                    photosynthesis: {
                                        name: "Photosynthesis Rate",
                                        variables: [
                                            { id: 'co2_rate', name: 'CO2 Absorption Rate', unit: 'μmol/m²·s', canBeDV: true, canBeIV: false },
                                            { id: 'light', name: 'Light Intensity', unit: 'lux', canBeDV: false, canBeIV: true },
                                            { id: 'temperature', name: 'Temperature', unit: '°C', canBeDV: false, canBeIV: true },
                                            { id: 'co2_conc', name: 'CO2 Concentration', unit: 'ppm', canBeDV: false, canBeIV: true },
                                            { id: 'water', name: 'Water Level', unit: 'mL', canBeDV: false, canBeIV: true },
                                            { id: 'leaf_area', name: 'Leaf Surface Area', unit: 'cm²', canBeDV: false, canBeIV: true }
                                        ]
                                    },
                                    plant_growth: {
                                        name: "Plant Growth Rate",
                                        variables: [
                                            { id: 'height', name: 'Stem Height', unit: 'cm', canBeDV: true, canBeIV: false },
                                            { id: 'water', name: 'Water Amount', unit: 'mL/day', canBeDV: false, canBeIV: true },
                                            { id: 'fertilizer', name: 'Fertilizer Concentration', unit: 'g/L', canBeDV: false, canBeIV: true },
                                            { id: 'light_time', name: 'Light Duration', unit: 'hours', canBeDV: false, canBeIV: true },
                                            { id: 'soil_ph', name: 'Soil pH', unit: 'pH', canBeDV: false, canBeIV: true },
                                            { id: 'temperature', name: 'Temperature', unit: '°C', canBeDV: false, canBeIV: true }
                                        ]
                                    }
                                }
                            }
                        }
                    }
                }
            },
            psychology: {
                name: "Psychology",
                categories: {
                    cognitive_performance: {
                        name: "Cognitive Performance",
                        subcategories: {
                            cognitive_tasks: {
                                name: "Cognitive Tasks",
                                experiments: {
                                    reaction_time: {
                                        name: "Reaction Time",
                                        variables: [
                                            { id: 'response_time', name: 'Response Time', unit: 'ms', canBeDV: true, canBeIV: false },
                                            { id: 'stimulus_intensity', name: 'Stimulus Intensity', unit: 'lux', canBeDV: false, canBeIV: true },
                                            { id: 'caffeine', name: 'Caffeine Level', unit: 'mg', canBeDV: false, canBeIV: true },
                                            { id: 'sleep_hours', name: 'Sleep Duration', unit: 'hours', canBeDV: false, canBeIV: true },
                                            { id: 'time_of_day', name: 'Time of Day', unit: 'hours', canBeDV: false, canBeIV: true },
                                            { id: 'age', name: 'Age', unit: 'years', canBeDV: false, canBeIV: true }
                                        ]
                                    },
                                    memory_recall: {
                                        name: "Memory Recall",
                                        variables: [
                                            { id: 'recall_accuracy', name: 'Recall Accuracy', unit: '%', canBeDV: true, canBeIV: false },
                                            { id: 'study_duration', name: 'Study Duration', unit: 'min', canBeDV: false, canBeIV: true },
                                            { id: 'time_elapsed', name: 'Time Since Learning', unit: 'hours', canBeDV: false, canBeIV: true },
                                            { id: 'complexity', name: 'Information Complexity', unit: 'scale 1-10', canBeDV: false, canBeIV: true },
                                            { id: 'noise_level', name: 'Environmental Noise', unit: 'dB', canBeDV: false, canBeIV: true },
                                            { id: 'sleep_quality', name: 'Sleep Quality', unit: 'scale 1-10', canBeDV: false, canBeIV: true }
                                        ]
                                    }
                                }
                            }
                        }
                    }
                }
            }
        };
        function createVariableCard(variable) {
            const card = document.createElement('div');
            card.className = 'variable-card';
            card.id = variable.id;
            card.draggable = true;
            card.innerHTML = `
                <div class="variable-name">${variable.name}</div>
                <div class="variable-unit">${variable.unit}</div>
            `;
            
            card.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', variable.id);
            });
            
            return card;
        }

        function isValidDV(variableId) {
            const subject = document.getElementById('subject-select').value;
            const category = document.getElementById('category-select').value;
            const experiment = document.getElementById('experiment-select').value;
            if (!subject || !category || !experiment) return false;
            
            const subjectData = experimentData[subject];
            const categoryData = subjectData.categories[category];
            const [subcat, exp] = experiment.split('.');
            const variables = categoryData.subcategories[subcat].experiments[exp].variables;
            
            const variable = variables.find(v => v.id === variableId);
            return variable && variable.canBeDV;
        }

        function calculateDropZonePosition(bone) {
            const rect = bone.getBoundingClientRect();
            const containerRect = bone.parentElement.getBoundingClientRect();
            const boneLength = 150;
            
            const isDownwardBone = bone.className.includes('bone2') || 
                                 bone.className.includes('bone4') || 
                                 bone.className.includes('bone6');
            
            const centerX = rect.right - (boneLength / 2);
            const angleOffset = (boneLength / 2) * Math.sin(45 * Math.PI / 180);
            
            const centerY = rect.top + (isDownwardBone ? angleOffset : angleOffset + 3);
            
            return {
                left: centerX - containerRect.left,
                top: centerY - containerRect.top
            };
        }

        function createDropZones() {
            const bones = document.querySelectorAll('.bone');
            bones.forEach((bone, index) => {
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone';
                dropZone.dataset.position = `bone${index + 1}`;
                
                const position = calculateDropZonePosition(bone);
                dropZone.style.left = `${position.left}px`;
                dropZone.style.top = `${position.top}px`;
                
                bone.parentElement.appendChild(dropZone);
            });

            const headDropZone = document.createElement('div');
            headDropZone.className = 'drop-zone';
            headDropZone.dataset.position = 'head';
            const head = document.querySelector('.fish-head');
            const rect = head.getBoundingClientRect();
            const containerRect = head.parentElement.getBoundingClientRect();
            headDropZone.style.left = `${rect.left - containerRect.left + 50}px`;
            headDropZone.style.top = `${rect.top - containerRect.top + 30}px`;
            head.parentElement.appendChild(headDropZone);
        }

        function setupAddAllButton() {
            const addAllButton = document.getElementById('add-all-cvs');
            
            addAllButton.addEventListener('click', () => {
                const pool = document.getElementById('variables-pool');
                const dropZones = Array.from(document.querySelectorAll('.drop-zone:not([data-position="head"])'));
                const availableCards = Array.from(pool.querySelectorAll('.variable-card'));
                
                dropZones.forEach(zone => {
                    if (zone.children.length > 0) {
                        const card = zone.children[0];
                        if (card.classList.contains('iv')) {
                            currentIV = null;
                        }
                        pool.appendChild(card);
                        card.className = 'variable-card';
                    }
                });
                
                availableCards.forEach((card, index) => {
                    if (index < dropZones.length) {
                        dropZones[index].appendChild(card);
                    }
                });
                
                updateHypothesis();
            });
        }

        function getCurrentCVs() {
            const cvCards = Array.from(document.querySelectorAll('.drop-zone:not([data-position="head"]) .variable-card:not(.iv)'));
            return cvCards.map(card => card.id);
        }

        function setupDropZoneListeners() {
            const dropZones = document.querySelectorAll('.drop-zone');
            const addAllButton = document.getElementById('add-all-cvs');
            
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.style.borderColor = '#4CAF50';
                });

                zone.addEventListener('dragleave', (e) => {
                    zone.style.borderColor = '#999';
                });

                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.style.borderColor = '#999';
                    
                    const variableId = e.dataTransfer.getData('text/plain');
                    const card = document.getElementById(variableId);
                    
                    if (zone.children.length > 0) {
                        const existingCard = zone.children[0];
                        document.getElementById('variables-pool').appendChild(existingCard);
                        existingCard.className = 'variable-card';
                        if (currentIV === existingCard.id) currentIV = null;
                        if (currentDV === existingCard.id) currentDV = null;
                        addAllButton.style.display = 'none';
                        addAllButton.disabled = true;
                    }
                    
                    zone.appendChild(card);
                    
                    if (zone.dataset.position === 'head') {
                        if (isValidDV(variableId)) {
                            currentDV = variableId;
                            card.className = 'variable-card dv';
                            addAllButton.style.display = 'block';
                            addAllButton.disabled = false;
                        } else {
                            currentDV = null;
                            card.className = 'variable-card';
                            addAllButton.style.display = 'none';
                            addAllButton.disabled = true;
                        }
                    } else {
                        if (currentIV === variableId) {
                            currentIV = null;
                        }
                        card.className = 'variable-card';
                    }
                    
                    updateHypothesis();
                });
            });
        }

        function setupVariablesPool() {
            const pool = document.getElementById('variables-pool');
            const addAllButton = document.getElementById('add-all-cvs');
            
            pool.addEventListener('dragover', (e) => {
                e.preventDefault();
                pool.style.backgroundColor = '#f8f9fa';
            });

            pool.addEventListener('dragleave', () => {
                pool.style.backgroundColor = 'white';
            });

            pool.addEventListener('drop', (e) => {
                e.preventDefault();
                pool.style.backgroundColor = 'white';
                
                const variableId = e.dataTransfer.getData('text/plain');
                const card = document.getElementById(variableId);
                
                if (card) {
                    pool.appendChild(card);
                    card.className = 'variable-card';
                    if (currentIV === variableId) currentIV = null;
                    if (currentDV === variableId) {
                        currentDV = null;
                        addAllButton.style.display = 'none';
                        addAllButton.disabled = true;
                    }
                    updateHypothesis();
                }
            });
        }

        function setupVariableSelection() {
            document.addEventListener('click', (e) => {
                if (e.target.closest('.variable-card')) {
                    const card = e.target.closest('.variable-card');
                    if (card.parentElement.className === 'drop-zone' && 
                        card.parentElement.dataset.position !== 'head') {
                        
                        const previousIV = document.querySelector('.variable-card.iv');
                        if (previousIV) {
                            previousIV.className = 'variable-card';
                        }
                        
                        card.className = 'variable-card iv';
                        currentIV = card.id;
                        updateHypothesis();
                    }
                }
            });
        }

        function setupSelectors() {
            const subjectSelect = document.getElementById('subject-select');
            const categorySelect = document.getElementById('category-select');
            const experimentSelect = document.getElementById('experiment-select');
            const addAllButton = document.getElementById('add-all-cvs');

            // Populate subject selector
            Object.keys(experimentData).forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = experimentData[subject].name;
                subjectSelect.appendChild(option);
            });

            // Handle subject selection
            subjectSelect.addEventListener('change', (e) => {
                categorySelect.innerHTML = '<option value="">Select Category</option>';
                categorySelect.disabled = !e.target.value;
                experimentSelect.innerHTML = '<option value="">Select Experiment</option>';
                experimentSelect.disabled = true;
                addAllButton.style.display = 'none';
                addAllButton.disabled = true;

                if (e.target.value) {
                    const categories = experimentData[e.target.value].categories;
                    Object.keys(categories).forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat;
                        option.textContent = categories[cat].name;
                        categorySelect.appendChild(option);
                    });
                }
            });

            // Handle category selection
            categorySelect.addEventListener('change', (e) => {
                experimentSelect.innerHTML = '<option value="">Select Experiment</option>';
                experimentSelect.disabled = !e.target.value;
                addAllButton.style.display = 'none';
                addAllButton.disabled = true;

                if (e.target.value) {
                    const subject = subjectSelect.value;
                    const subcategories = experimentData[subject].categories[e.target.value].subcategories;
                    
                    Object.keys(subcategories).forEach(subcat => {
                        const subcategory = subcategories[subcat];
                        const optgroup = document.createElement('optgroup');
                        optgroup.label = subcategory.name;
                        
                        Object.keys(subcategory.experiments).forEach(exp => {
                            const option = document.createElement('option');
                            option.value = `${subcat}.${exp}`;
                            option.textContent = subcategory.experiments[exp].name;
                            optgroup.appendChild(option);
                        });
                        
                        experimentSelect.appendChild(optgroup);
                    });
                }
            });

            // Handle experiment selection
            experimentSelect.addEventListener('change', (e) => {
                if (e.target.value) {
                    currentExperiment = e.target.value;
                    const subject = subjectSelect.value;
                    const category = categorySelect.value;
                    const [subcat, exp] = e.target.value.split('.');
                    const experiment = experimentData[subject].categories[category].subcategories[subcat].experiments[exp];
                    loadExperimentVariables(experiment.variables);
                }
            });
        }

        function loadExperimentVariables(variables) {
            const pool = document.getElementById('variables-pool');
            const addAllButton = document.getElementById('add-all-cvs');
            pool.innerHTML = '';
            variables.forEach(variable => {
                pool.appendChild(createVariableCard(variable));
            });
            
            document.querySelectorAll('.drop-zone').forEach(zone => {
                if (zone.children.length > 0) {
                    zone.innerHTML = '';
                }
            });
            
            currentIV = null;
            currentDV = null;
            addAllButton.style.display = 'none';
            addAllButton.disabled = true;
            updateHypothesis();
        }

        function updateHypothesis() {
            const hypothesisText = document.getElementById('hypothesis-text');
            const ivTrendSelector = document.getElementById('iv-trend-selector');
            const dvTrendSelector = document.getElementById('dv-trend-selector');
            
            const trendDescriptions = {
                'increases_linearly': 'increases linearly with',
                'decreases_linearly': 'decreases linearly with',
                'increases_square': 'increases with the square of',
                'decreases_square': 'decreases with the square of',
                'increases_root': 'increases with the square root of',
                'decreases_root': 'decreases with the square root of',
                'inverse': 'varies inversely with',
                'inverse_square': 'varies inversely with the square of',
                'exponential_growth': 'increases exponentially with',
                'exponential_decay': 'decreases exponentially with',
                'sinusoidal': 'varies sinusoidally with',
                'bell_curve': 'shows a bell curve with',
                'u_shaped': 'shows a U-shaped curve with',
                'plateau_increase': 'increases then plateaus with',
                'plateau_decrease': 'decreases then plateaus with',
                'threshold': 'shows a threshold effect with',
                'stepwise': 'changes in steps with',
                'no_effect': 'shows no relationship with'
            };

            const defaultText = 'Drag variables to the bones and head, then click a variable on a bone to set it as IV.';
            const invalidDVText = 'The variable in the fish head cannot be used as a dependent variable for this experiment.';
            
            if (currentDV && isValidDV(currentDV) && currentIV) {
                const dvCard = document.querySelector('.variable-card.dv');
                const ivCard = document.querySelector('.variable-card.iv');
                
                const dvName = dvCard.querySelector('.variable-name').textContent;
                const ivName = ivCard.querySelector('.variable-name').textContent;
                
                const currentCVs = getCurrentCVs();
                const hasMinimumCVs = currentCVs.length >= 2;
                
                if (hasMinimumCVs) {
                    let hypothesisHtml = `
                        <div class="hypothesis-container valid-background">
                            <div class="hypothesis-statement">
                                As <span class="iv-highlight">${ivName}</span> 
                                <span class="trend-highlight iv-trend-highlight">${ivTrendSelector.value}</span>, 
                                <span class="dv-highlight">${dvName}</span> 
                                <span class="trend-highlight dv-trend-highlight">${trendDescriptions[dvTrendSelector.value]}</span>
                                <span class="iv-highlight">${ivName}</span> 
                                when <span class="cv-highlight">all other variables are held constant</span>
                            </div>
                            <div class="validity-note">
                                You have ${currentCVs.length} control variables. A valid hypothesis does not indicate it is correct. Go test it!
                            </div>
                        </div>`;
                    hypothesisText.innerHTML = hypothesisHtml;
                } else {
                    hypothesisText.innerHTML = `
                        <div class="hypothesis-container">
                            <div class="hypothesis-text">
                                Add at least 2 control variables to generate a hypothesis.
                                Current count: ${currentCVs.length}
                            </div>
                        </div>`;
                }
            } else if (document.querySelector('.drop-zone[data-position="head"] .variable-card') && !isValidDV(currentDV)) {
                hypothesisText.innerHTML = `<div class="hypothesis-container"><span class="hypothesis-text error-text">${invalidDVText}</span></div>`;
            } else {
                hypothesisText.innerHTML = `<div class="hypothesis-container"><span class="hypothesis-text">${defaultText}</span></div>`;
            }
        }

        window.onload = function() {
            setupSelectors();
            createDropZones();
            setupDropZoneListeners();
            setupVariableSelection();
            setupVariablesPool();
            setupAddAllButton();
            
            document.getElementById('iv-trend-selector').addEventListener('change', updateHypothesis);
            document.getElementById('dv-trend-selector').addEventListener('change', updateHypothesis);
            
            document.getElementById('iv-trend-selector').value = 'increases';
            document.getElementById('dv-trend-selector').value = 'increases_linearly';
        };
    </script>
</body>
</html>