<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Global Names Memorial - Speaking Every Name</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
    :root {
        --primary-bg: #1a1a1a;
        --secondary-bg: #363636;
        --glass-bg: rgba(255, 255, 255, 0.1);
        --text-primary: #ffffff;
        --text-secondary: #cccccc;
        --accent: #4a90e2;
        --sacred: #ffd700;
        --taboo: #ff6b6b;
        --transition: #9b59b6;
        --cultural: #2ecc71;
    }

    * {
        box-sizing: border-box;
    }

    html {
        background: var(--primary-bg);
        min-height: 100%;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", "Noto Sans Arabic", "Noto Sans Hebrew", "Noto Sans Ethiopic", "Noto Sans Tifinagh", sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, var(--primary-bg) 0%, var(--secondary-bg) 100%);
        background-attachment: fixed;
        color: var(--text-primary);
        padding: 1rem;
        position: relative;
        overflow-x: hidden;
    }

    .container {
        background: var(--glass-bg);
        padding: 2rem;
        border-radius: 1.5rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        text-align: center;
        width: min(95vw, 800px);
        max-width: 800px;
        margin: auto;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    h1 {
        margin: 0 0 0.5rem 0;
        font-size: clamp(1.8rem, 6vw, 2.5rem);
        text-transform: uppercase;
        letter-spacing: 3px;
        color: var(--text-primary);
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    .subtitle {
        font-size: clamp(0.9rem, 3vw, 1.1rem);
        color: var(--text-secondary);
        margin-bottom: 2rem;
        font-style: italic;
    }

    /* Name Display Section */
    .name-display-section {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 1rem;
        padding: 2rem;
        margin-bottom: 1.5rem;
        min-height: 200px;
        position: relative;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .name-main {
        font-size: clamp(1.8rem, 7vw, 2.5rem);
        margin: 0.5rem 0;
        line-height: 1.4;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.3s ease;
        word-wrap: break-word;
        padding: 0.5rem;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", "Noto Sans Arabic", "Noto Sans Hebrew", "Noto Sans Ethiopic", "Noto Sans Tifinagh", "Arial Unicode MS", sans-serif;
    }

    .name-main:hover {
        transform: scale(1.02);
        text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    }

    .name-components {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        justify-content: center;
        margin: 1rem 0;
    }

    .component {
        background: rgba(255, 255, 255, 0.1);
        padding: 0.3rem 0.8rem;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .component-label {
        color: var(--text-secondary);
        font-size: 0.8rem;
        margin-right: 0.3rem;
    }

    /* Cultural Context */
    .cultural-context {
        background: rgba(74, 144, 226, 0.1);
        border-radius: 0.8rem;
        padding: 1rem;
        margin: 1rem 0;
        border: 1px solid rgba(74, 144, 226, 0.3);
    }

    .culture-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 0.8rem;
        text-align: left;
    }

    .info-item {
        font-size: 0.9rem;
    }

    .info-label {
        color: var(--accent);
        font-weight: bold;
    }

    /* Special Indicators */
    .special-indicators {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
        margin: 1rem 0;
        flex-wrap: wrap;
    }

    .indicator {
        padding: 0.3rem 0.8rem;
        border-radius: 2rem;
        font-size: 0.85rem;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }

    .indicator-sacred {
        background: var(--sacred);
        color: var(--primary-bg);
    }

    .indicator-taboo {
        background: var(--taboo);
        color: white;
    }

    .indicator-transition {
        background: var(--transition);
        color: white;
    }

    .indicator-cultural {
        background: var(--cultural);
        color: white;
    }

    .indicator-mononym {
        background: #3498db;
        color: white;
    }

    /* Voice Status */
    .voice-status {
        color: var(--text-secondary);
        margin: 1rem 0;
        font-size: 0.9rem;
        font-style: italic;
        min-height: 1.5em;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .sign-language-note {
        background: rgba(255, 255, 255, 0.1);
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        margin: 0.5rem 0;
    }

    /* Controls */
    .controls {
        display: grid;
        gap: 1rem;
        margin-top: 2rem;
    }

    .control-row {
        display: flex;
        gap: 0.8rem;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
    }

    .control-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(255, 255, 255, 0.1);
        padding: 0.6rem 1rem;
        border-radius: 1rem;
        min-width: 160px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    button {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 0.5rem;
        cursor: pointer;
        padding: 0.8rem 1.5rem;
        font-size: 1rem;
        transition: all 0.3s ease;
        min-width: 100px;
    }

    button:hover:not(:disabled) {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    button:active:not(:disabled) {
        transform: translateY(0);
    }

    button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    button.primary {
        background: var(--accent);
        border-color: var(--accent);
    }

    button.primary:hover:not(:disabled) {
        background: #5ba0f2;
    }

    /* Toggle Switches */
    .switch {
        position: relative;
        display: inline-block;
        width: 52px;
        height: 26px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(255, 255, 255, 0.2);
        transition: .4s;
        border-radius: 26px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: var(--accent);
    }

    input:checked + .slider:before {
        transform: translateX(26px);
    }

    /* Stats Display */
    .stats {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-top: 1.5rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 0.5rem;
    }

    /* Modal for Information */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
    }

    .modal-content {
        background: var(--secondary-bg);
        margin: 5% auto;
        padding: 2rem;
        border-radius: 1rem;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        color: var(--text-primary);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    }

    .close {
        color: var(--text-secondary);
        float: right;
        font-size: 2rem;
        font-weight: bold;
        cursor: pointer;
        line-height: 1;
    }

    .close:hover {
        color: var(--text-primary);
    }

    /* Info Button */
    #infoButton {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: transparent;
        border: none;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        color: rgba(255, 255, 255, 0.7);
        z-index: 100;
        padding: 0;
    }

    #infoButton:hover {
        color: var(--text-primary);
        transform: scale(1.1);
    }

    /* Acknowledgment Style */
    .acknowledgment {
        font-size: 1.1rem;
        line-height: 1.8;
        color: var(--text-primary);
        padding: 2rem;
        text-align: center;
        font-style: italic;
        background: rgba(255, 215, 0, 0.1);
        border-radius: 1rem;
        border: 1px solid rgba(255, 215, 0, 0.3);
    }

    /* Responsive Design */
    @media (max-width: 600px) {
        .container {
            padding: 1.5rem;
        }
        
        .name-display-section {
            padding: 1.5rem;
        }
        
        .control-group {
            min-width: 140px;
        }
        
        .culture-info {
            grid-template-columns: 1fr;
        }
    }

    /* Animations */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .fade-in {
        animation: fadeIn 0.5s ease-out;
    }

    /* Special script displays */
    .script-display {
        font-size: 1.2rem;
        margin: 0.5rem 0;
        opacity: 0.8;
    }

    .rtl {
        direction: rtl;
    }

    .click-notation {
        font-family: "Noto Sans", "DejaVu Sans", sans-serif;
        font-size: 1.3rem;
    }

    /* Loading indicator */
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--accent);
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }
</style>

</head>
<body>
    <button id="infoButton" title="About this work">?</button>
    
    <div class="container">
        <h1>Resurrective Necropolis</h1>
        
        <div class="name-display-section">
            <div id="nameDisplay" class="name-main fade-in"></div>
            <div id="scriptDisplay" class="script-display"></div>
            <div id="nameComponents" class="name-components"></div>
            <div id="specialIndicators" class="special-indicators"></div>
            <div id="culturalContext" class="cultural-context"></div>
            <div id="voiceStatus" class="voice-status"></div>
            <div id="signLanguageNote" class="sign-language-note" style="display: none;"></div>
        </div>
        
        <div class="controls">
            <div class="control-row">
                <button id="initVoiceButton" class="primary">Initialize Voice System</button>
                <button id="toggleButton">Pause</button>
                <button id="speakButton">Speak Name</button>
            </div>
            
            <div class="control-row">
                <div class="control-group">
                    <span>Slow</span>
                    <label class="switch">
                        <input type="checkbox" id="speedToggle">
                        <span class="slider"></span>
                    </label>
                    <span>Fast</span>
                </div>
                
                <div class="control-group">
                    <span>Random</span>
                    <label class="switch">
                        <input type="checkbox" id="weightedToggle">
                        <span class="slider"></span>
                    </label>
                    <span>Weighted</span>
                </div>
                
                <div class="control-group">
                    <span>Basic</span>
                    <label class="switch">
                        <input type="checkbox" id="detailToggle" checked>
                        <span class="slider"></span>
                    </label>
                    <span>Detailed</span>
                </div>
            </div>
        </div>
        
        <div id="statsDisplay" class="stats"></div>
    </div>
    
    <!-- Information Modal -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>About This Memorial</h2>
            <div class="acknowledgment">
                This work recognizes the profound diversity of human naming across all cultures. 
                It acknowledges that names carry deep meaning—they can be sacred, earned through 
                life experiences, changed to reflect identity, or held in silence to honor the dead. 
                Some names are visual, some are whistled, some contain sounds unique to specific 
                languages. Every name represents a life, a story, a connection to family and culture.
                <br><br>
                By speaking these names—or respectfully acknowledging when they cannot be spoken—we 
                honor the universal human practice of remembering through naming.
            </div>
        </div>
    </div>

    <script>
// Comprehensive name database with full cultural sensitivity
const comprehensiveNamesDatabase = {
    // System metadata
    metadata: {
        version: "2.0",
        totalFamilies: 14,
        supportsGenderDiversity: true,
        handlesTaboos: true,
        supportsSacredNames: true
    },

    // Enhanced gender system
    genderSystem: {
        binary: ["male", "female"],
        nonBinary: ["neutral", "fluid", "agender"],
        culturalSpecific: {
            hijra: { cultures: ["South Asian"], symbol: "⚧" },
            twoSpirit: { cultures: ["Native American"], symbol: "🏳️‍⚧️" },
            faAfafine: { cultures: ["Samoan"], symbol: "🌺" },
            mahu: { cultures: ["Hawaiian", "Tahitian"], symbol: "🌊" },
            sistergirl: { cultures: ["Aboriginal Australian"], symbol: "👭" },
            xGender: { cultures: ["Japanese"], symbol: "X" }
        }
    },

    // Indo-European with enhanced structure
    indoEuropean: {
        metadata: {
            family: "Indo-European",
            populationPercentage: 46,
            writingSystems: ["Latin", "Cyrillic", "Devanagari", "Greek", "Armenian"],
            nameOrder: "given_first",
            hasPatronymics: true,
            hasGenderMarkers: true,
            voicePreferences: ["en-US", "ru-RU", "hi-IN", "es-ES", "fr-FR", "de-DE"]
        },
        
        nameComponents: {
            given: {
                male: ["Alexander", "Mohammad", "Raj", "José", "Ivan", "Pierre", "Sean", "Wolfgang", 
                       "Dimitri", "Carlos", "Giovanni", "Arjun", "Patrick", "Stefan", "Andreas",
                       "Miguel", "Nikolai", "François", "Vikram", "Roberto", "Alexei", "Krishna",
                       "Diego", "Sergei", "Heinrich", "Aditya", "Brendan", "Matteo", "Pavel",
                       "Santiago", "Vladimir", "Jacques", "Rahul", "Marco", "Andrei", "Sanjay"],
                female: ["Sophia", "Fatima", "Priya", "María", "Svetlana", "Marie", "Siobhán", "Elena",
                         "Anastasia", "Isabella", "Francesca", "Deepika", "Aoife", "Katerina", "Natalia",
                         "Carmen", "Tatiana", "Amélie", "Ananya", "Giulia", "Olga", "Lakshmi",
                         "Alejandra", "Irina", "Brigitte", "Kavya", "Mairead", "Chiara", "Ekaterina",
                         "Gabriela", "Marina", "Céline", "Pooja", "Lucia", "Oksana", "Radha"],
                neutral: ["Alex", "River", "Phoenix", "Sky", "Sage", "Quinn", "Rowan", "Ash",
                         "Morgan", "Jordan", "Casey", "Taylor", "Jamie", "Robin", "Avery",
                         "Blake", "Cameron", "Drew", "Emery", "Finley", "Harper", "Indigo"]
            },
            family: {
                common: ["Smith", "Patel", "García", "Ivanov", "O'Brien", "Müller", "Rossi",
                        "Singh", "Kumar", "Fernández", "Petrov", "Murphy", "Schmidt", "Bianchi",
                        "Jones", "Shah", "López", "Volkov", "Kelly", "Wagner", "Romano",
                        "Williams", "Desai", "Rodríguez", "Smirnov", "Fitzgerald", "Weber", "Conti"],
                compound: ["García-López", "Fernández-Alonso", "Meyer-Schmidt", "Müller-Thurgau",
                          "Sánchez-Vicario", "Pérez-Reverte", "Fischer-Dieskau", "Mendelssohn-Bartholdy"],
                noble: ["de la Cruz", "von Habsburg", "zu Guttenberg", "di Medici", "de Montmorency",
                       "von Bismarck", "della Rovere", "de Bourbon", "von Hohenzollern", "d'Este"]
            },
            patronymic: {
                russian: { 
                    male: ["Ivanovich", "Petrovich", "Alexandrovich", "Mikhailovich", "Sergeevich"],
                    female: ["Ivanovna", "Petrovna", "Alexandrovna", "Mikhailovna", "Sergeevna"]
                },
                icelandic: { male: ["son"], female: ["dóttir"] }
            }
        },
        
        specialRules: {
            russianPatronymic: (fatherName, gender) => {
                return gender === "female" ? `${fatherName}ovna` : `${fatherName}ovich`;
            },
            irishParticles: {
                male: { "Ó": "grandson of", "Mac": "son of", "Mag": "son of" },
                female: { "Ní": "daughter of", "Nic": "daughter of", "Mhic": "daughter of" }
            },
            spanishCompound: true
        }
    },

    // Sino-Tibetan with tonal information
    sinoTibetan: {
        metadata: {
            family: "Sino-Tibetan",
            populationPercentage: 20,
            writingSystems: ["Chinese Characters", "Tibetan", "Burmese"],
            nameOrder: "family_first",
            tonal: true,
            voicePreferences: ["zh-CN", "zh-TW", "bo-CN", "my-MM"]
        },
        
        nameComponents: {
            family: {
                single: ["王", "李", "张", "刘", "陈", "杨", "黄", "赵", "吴", "周",
                        "徐", "孙", "马", "朱", "胡", "郭", "何", "高", "林", "罗"],
                compound: ["欧阳", "司徒", "上官", "诸葛", "皇甫", "尉迟", "公孙", "慕容", "司马", "独孤"],
                romanized: ["Wang", "Li", "Zhang", "Liu", "Chen", "Yang", "Huang", "Zhao", "Wu", "Zhou",
                           "Xu", "Sun", "Ma", "Zhu", "Hu", "Guo", "He", "Gao", "Lin", "Luo"]
            },
            given: {
                male: ["明", "强", "伟", "军", "勇", "杰", "涛", "鹏", "飞", "龙",
                       "浩", "宇", "轩", "博", "文", "志", "建", "国", "华", "平"],
                female: ["芳", "娜", "敏", "静", "丽", "强", "洁", "梅", "玲", "霞",
                         "英", "慧", "燕", "红", "玉", "兰", "凤", "春", "琴", "珍"],
                neutral: ["晨", "雨", "风", "云", "星", "月", "川", "海", "天", "思"],
                meanings: {
                    "明": "bright", "强": "strong", "芳": "fragrant", "晨": "morning",
                    "雨": "rain", "龙": "dragon", "凤": "phoenix", "海": "ocean"
                }
            },
            generation: ["世", "永", "承", "宗", "维", "学", "文", "德", "仁", "义"],
            tibetan: {
                given: ["Tenzin", "Lobsang", "Karma", "Dorje", "Pema", "Tsering", "Norbu", "Jampa", "Sonam", "Dawa"],
                meaning: {
                    "Tenzin": "holder of teachings", "Karma": "action", "Pema": "lotus",
                    "Dorje": "thunderbolt", "Norbu": "jewel", "Dawa": "moon"
                }
            },
            burmese: {
                names: ["Aung", "Thant", "Thein", "Win", "Hla", "Mya", "Khin", "San", "Tin", "Zaw"],
                titles: ["U", "Daw", "Ko", "Ma", "Maung", "Nan", "Naw", "Sao", "Saw"]
            }
        },
        
        specialFeatures: {
            tones: { "王": 2, "李": 3, "张": 1, "刘": 2, "陈": 2 },
            generationPoems: true,
            tibetanReligious: ["Tenzin", "Lobsang", "Karma", "Dorje"],
            burmeseMononyms: ["Thant", "Thein", "Win"],
            noFamilyName: ["Tibetan", "Burmese"]
        }
    },

    // Austronesian with mononym support
    austronesian: {
        metadata: {
            family: "Austronesian",
            populationPercentage: 5,
            writingSystems: ["Latin", "Arabic", "Baybayin", "Javanese"],
            nameOrder: "given_first",
            hasMononyms: true,
            voicePreferences: ["id-ID", "ms-MY", "fil-PH", "haw-US", "mg-MG"]
        },
        
        nameComponents: {
            mononyms: ["Sukarno", "Suharto", "Fatmawati", "Megawati", "Prabowo", "Jokowi", 
                      "Soekarnoputri", "Habibie", "Wahid", "Yudhoyono"],
            given: {
                male: ["Bambang", "Agus", "Rizki", "Ahmad", "José", "Kai", "Keoni", "Dimas", "Eko",
                       "Fernando", "Gabriel", "Hendra", "Irfan", "Juan", "Kaleo", "Luis", "Muhammad",
                       "Niko", "Oscar", "Pedro", "Rama", "Santos", "Taufik", "Umar", "Vicente",
                       "Wijaya", "Xavier", "Yusuf", "Zain", "Andi", "Budi", "Carlo", "David"],
                female: ["Siti", "Dewi", "Putri", "Ayu", "Maria", "Leilani", "Nalani", "Ana", "Bunga",
                         "Citra", "Dian", "Eka", "Fitri", "Gita", "Hana", "Indah", "Jasmine", "Kartini",
                         "Lestari", "Maya", "Nani", "Olivia", "Prita", "Ratna", "Sarah", "Tara",
                         "Uma", "Vina", "Wati", "Xenia", "Yanti", "Zahra", "Amelia", "Bella"],
                neutral: ["Budi", "Surya", "Kaimana", "Nalu", "Cahaya", "Bayu", "Tirta", "Adi"]
            },
            family: {
                indonesian: ["Wijaya", "Santoso", "Kusuma", "Hidayat", "Pranoto", "Wibowo", "Hartono",
                            "Suryadi", "Gunawan", "Setiawan", "Nugroho", "Saputra", "Hermawan"],
                filipino: ["Santos", "Reyes", "Cruz", "Garcia", "Aquino", "Ramos", "Mendoza", "Torres",
                          "Flores", "Rivera", "Gonzales", "Lopez", "Martinez", "Rodriguez", "Hernandez",
                          "de la Cruz", "del Rosario", "de los Santos", "de Castro", "de Guzman"],
                hawaiian: ["Kamaka", "Kalua", "Kealoha", "Mahoe", "Nakamura", "Tanaka", "Akamu", "Kahale",
                          "Kekoa", "Palani", "Kawai", "Makoa", "Nalei", "Pukui", "Wong"],
                malay: ["Abdullah", "Ibrahim", "Hassan", "Ahmad", "Mohamed", "Ali", "Ismail", "Omar",
                       "Othman", "Rahman", "Yusof", "Hamid", "Aziz", "Shah", "bin Osman"],
                malagasy: ["Rakoto", "Rabe", "Randria", "Razaf", "Andria", "Rajoeli", "Ratsim", "Ravelo"]
            },
            particles: {
                malay: { "bin": "son of", "binti": "daughter of", "a/l": "son of", "a/p": "daughter of" },
                filipino: { "de": "of", "dela": "of the", "san": "saint", "sta": "saint (f)" }
            }
        },
        
        specialFeatures: {
            teknonyms: { "Pak": "father of", "Bu": "mother of", "Bapak": "father", "Ibu": "mother" },
            hawaiianDiacriticals: ["ʻ", "ā", "ē", "ī", "ō", "ū"],
            sacredNames: true,
            javaneseNobility: ["Raden", "Raden Mas", "Raden Ajeng", "Gusti", "Kanjeng"],
            filipinoNicknames: ["Bong", "Bing", "Boy", "Baby", "Jun", "Nene", "Toto", "Girlie"]
        }
    },

    // Afroasiatic with RTL scripts
    afroasiatic: {
        metadata: {
            family: "Afroasiatic",
            populationPercentage: 5,
            writingSystems: ["Arabic", "Hebrew", "Ethiopic", "Tifinagh"],
            nameOrder: "given_first",
            rtl: ["Arabic", "Hebrew"],
            voicePreferences: ["ar-SA", "he-IL", "am-ET", "ha-NG"]
        },
        
        nameComponents: {
            arabic: {
                ism: ["محمد", "أحمد", "علي", "فاطمة", "عائشة", "زينب", "عبدالله", "حسن", "حسين", "عمر",
                      "خالد", "يوسف", "إبراهيم", "مريم", "خديجة", "سارة", "نور", "ليلى", "ياسمين", "سلمى"],
                nasab: { "ibn": "son of", "bint": "daughter of", "bin": "son of", "bent": "daughter of" },
                nisbah: ["المصري", "الدمشقي", "القرشي", "المغربي", "البغدادي", "الأندلسي", "التونسي", 
                        "الحجازي", "النجدي", "الشامي"],
                kunya: { "Abu": "father of", "Umm": "mother of", "Aba": "father of", "Om": "mother of" },
                laqab: ["الرشيد", "الحكيم", "النور", "الأمين", "الصادق", "العادل", "الكريم", "الشجاع"]
            },
            hebrew: {
                given: {
                    male: ["משה", "דוד", "יוסף", "אברהם", "יצחק", "יעקב", "שמואל", "אליהו", "שלמה", "בנימין",
                           "אהרן", "יהושע", "דניאל", "נתן", "אורי", "עמית", "איתן", "נועם", "אריאל", "יונתן"],
                    female: ["שרה", "רבקה", "רחל", "לאה", "מרים", "אסתר", "רות", "נעמי", "חנה", "דבורה",
                            "תמר", "יעל", "אביגיל", "מיכל", "שירה", "נועה", "איה", "טל", "ליאור", "עדי"],
                    romanized: {
                        male: ["Moshe", "David", "Yosef", "Avraham", "Yitzchak", "Yaakov", "Shmuel", "Eliyahu"],
                        female: ["Sarah", "Rivka", "Rachel", "Leah", "Miriam", "Esther", "Ruth", "Naomi"]
                    }
                },
                family: ["כהן", "לוי", "ישראלי", "מזרחי", "אשכנזי", "ספרדי", "פרידמן", "רוזנברג", "גולדברג", "שפירא"],
                familyRomanized: ["Cohen", "Levi", "Israeli", "Mizrachi", "Ashkenazi", "Sefardi", "Friedman", "Rosenberg"],
                particles: { "בן": "son of", "בת": "daughter of", "בר": "son of (Aramaic)" }
            },
            ethiopic: {
                given: ["ሃይለ", "ተስፋዬ", "አለምነሽ", "ሰላም", "ብርሃኔ", "መሰረት", "ትግስት", "ሰብለ", "ዘውዲቱ", "አስቴር"],
                romanized: ["Haile", "Tesfaye", "Alemnesh", "Selam", "Berhane", "Meseret", "Tigist", "Seble"],
                patronymic: true,
                meaning: {
                    "ሃይለ": "power", "ሰላም": "peace", "ብርሃኔ": "my light", "ትግስት": "patience"
                }
            },
            berber: {
                names: ["ⴰⵎⴰⵣⵉⵖ", "ⵜⴰⵎⴰⵣⵉⵖⵜ", "ⵉⴷⵉⵔ", "ⵜⵉⵏⵀⵉⵏⴰⵏ", "ⴰⵢⵓⵔ", "ⵜⴰⴼⵓⴽⵜ"],
                romanized: ["Amazigh", "Tamazight", "Idir", "Tinhinan", "Ayur", "Tafukt"],
                meaning: {
                    "Amazigh": "free man", "Tamazight": "free woman", "Ayur": "moon", "Tafukt": "sun"
                }
            }
        },
        
        specialFeatures: {
            arabicHonorifics: ["السيد", "الشيخ", "الحاج", "الأستاذ", "الدكتور"],
            hebrewSacredNames: { restricted: true, substitute: "HaShem", "השם": "The Name" },
            ethiopicCalendar: true,
            cohenLeviteStatus: ["Cohen", "Levi"],
            multiComponentNames: true
        }
    },

    // Niger-Congo with click consonants
    nigerCongo: {
        metadata: {
            family: "Niger-Congo",
            populationPercentage: 6,
            writingSystems: ["Latin", "Arabic", "N'Ko", "Adlam"],
            nameOrder: "given_first",
            hasClickConsonants: ["Xhosa", "Zulu"],
            tonal: ["Yoruba", "Igbo"],
            voicePreferences: ["yo-NG", "sw-KE", "zu-ZA", "xh-ZA", "ha-NG"]
        },
        
        nameComponents: {
            given: {
                male: ["Oluwasegun", "Kwame", "Thabo", "Chidi", "Jelani", "Kofi", "Amadi", "Babatunde",
                       "Chukwudi", "Dingane", "Emeka", "Folarin", "Gbenga", "Hakeem", "Ifeanyi", "Jabari",
                       "Kelechi", "Lekan", "Mandla", "Nkosana", "Obi", "Sekou", "Tunde", "Uzoma",
                       "Vuyo", "Wole", "Xolani", "Yemi", "Zuberi", "Adebayo", "Bamidele", "Chinua"],
                female: ["Adaeze", "Nomusa", "Aisha", "Chimamanda", "Lupita", "Wangari", "Amara", "Busayo",
                         "Chiamaka", "Dikeledi", "Ebele", "Funke", "Grace", "Halima", "Ifeoma", "Jumoke",
                         "Kadi", "Lerato", "Makena", "Nneka", "Oluwakemi", "Precious", "Queen", "Ramla",
                         "Sade", "Thandiwe", "Uzoma", "Velile", "Wanjiru", "Xoliswa", "Yewande", "Zainab"],
                dayNames: {
                    akan: {
                        male: ["Kwasi", "Kwadwo", "Kwabena", "Kwaku", "Yaw", "Kofi", "Kwame"],
                        female: ["Akosua", "Adwoa", "Abenaa", "Akua", "Yaa", "Afia", "Ama"],
                        day: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
                    }
                }
            },
            family: ["Mandela", "Okonkwo", "Dlamini", "Kenyatta", "Nyong'o", "Soyinka", "Achebe", "Adichie",
                    "Asante", "Banda", "Diallo", "Ekwensi", "Fadipe", "Gbadamosi", "Hassan", "Ibrahim",
                    "Jalloh", "Kamara", "Lumumba", "Mensah", "Nkrumah", "Okafor", "Sankara", "Toure",
                    "Umaru", "Van Wyk", "Wamwere", "Xaba", "Yeboah", "Zuma", "Abiodun", "Bello"],
            clan: ["Zulu", "Ndebele", "Xhosa", "Shona", "Kikuyu", "Luo", "Yoruba", "Igbo", "Hausa",
                  "Akan", "Swahili", "Tswana", "Sotho", "Venda", "Tsonga", "Mandinka", "Fulani"],
            praise: {
                zulu: ["Shaka kaSenzangakhona", "Bayede", "Ndabezitha", "Siyabonga", "Ngonyama"],
                significance: "Earned through deeds",
                examples: ["The one who thunders", "Protector of the people", "Lion of the village"]
            }
        },
        
        specialFeatures: {
            clicks: { 
                dental: "ǀ", 
                lateral: "ǁ", 
                alveolar: "ǃ",
                examples: ["ǃXobile", "Nǃxau", "ǁGasa", "ǀGcina", "Qǃhàce"]
            },
            tones: {
                yoruba: { high: "́", mid: "̄", low: "̀" },
                igbo: { high: "́", low: "̀", downstep: "̄" }
            },
            initiationNames: true,
            prefixes: {
                "Olu": "God/Chief of", "Chi": "God/Spirit", "Nk": "Mother of"
            }
        }
    },

    // Native American with ceremonial names
    nativeAmerican: {
        metadata: {
            family: "Native American Languages",
            populationPercentage: 0.5,
            writingSystems: ["Latin", "Cherokee Syllabary", "Canadian Syllabics"],
            nameOrder: "varies",
            hasCeremonialNames: true,
            voicePreferences: ["nv", "chr", "oj", "lkt", "iu"]
        },
        
        nameComponents: {
            lakota: {
                childhood: ["Slow", "Little Star", "Morning Light", "Swift Water", "Quiet Thunder"],
                earned: ["Sitting Bull", "Crazy Horse", "Red Cloud", "Black Elk", "Rain in the Face",
                        "Touch the Clouds", "Gall", "Spotted Tail", "American Horse", "Iron Shell"],
                native: ["Tȟatȟáŋka Íyotake", "Tȟašúŋke Witkó", "Maȟpíya Lúta", "Heȟáka Sápa", "Íštá Tȟó",
                        "Maȟpíya Ičáȟtagya", "Phizí", "Siŋté Glešká", "Wašíčuŋ Tȟašúŋke", "Tȟokéča"],
                meanings: {
                    "Tȟatȟáŋka Íyotake": "buffalo who sits down",
                    "Tȟašúŋke Witkó": "his horse is crazy",
                    "Maȟpíya Lúta": "red cloud",
                    "Heȟáka Sápa": "black elk"
                }
            },
            cherokee: {
                syllabary: ["ᏩᎴᎳ", "ᎠᏣᎳᏂ", "ᎠᏰᎵ", "ᏣᎳᎩ", "ᎤᏕᎦ", "ᎡᎶᏆ", "ᎤᏬᏗᎨ", "ᎦᏚᎲ"],
                english: ["Sequoyah", "Nancy Ward", "John Ross", "Stand Watie", "Wilma Mankiller",
                         "Will Rogers", "Sam Houston", "Joseph Brandt"],
                clan: ["Wolf", "Deer", "Bird", "Paint", "Blue", "Long Hair", "Wild Potato"]
            },
            ojibwe: {
                names: ["Ozaawindib", "Binesikwe", "Makoons", "Zhiishiib", "Animkii", "Misko",
                       "Nokomis", "Waaseyaaban", "Giizhig", "Zhaawan"],
                meanings: {
                    "Ozaawindib": "yellow head",
                    "Binesikwe": "thunderbird woman",
                    "Makoons": "little bear",
                    "Zhiishiib": "duck",
                    "Animkii": "thunderbird",
                    "Nokomis": "grandmother"
                }
            },
            navajo: {
                names: ["Naalnish", "Ashkii", "At'ééd", "Bá", "Tł'iish", "Ma'ii", "Shash", "Dibé"],
                meaning: {
                    "Ashkii": "boy", "At'ééd": "girl", "Ma'ii": "coyote", "Shash": "bear"
                }
            },
            general: {
                english: ["Winona", "Tecumseh", "Sacagawea", "Pocahontas", "Geronimo", "Cochise",
                         "Hiawatha", "Squanto", "Black Hawk", "Pontiac", "Metacomet", "Seattle"],
                meanings: {
                    "Winona": "first-born daughter",
                    "Tecumseh": "shooting star",
                    "Sacagawea": "bird woman",
                    "Pocahontas": "playful one"
                }
            },
            inuit: {
                names: ["Nanook", "Sedna", "Tulugaq", "Siku", "Qimmiq", "Aput", "Pania", "Yuka"],
                meanings: {
                    "Nanook": "polar bear", "Sedna": "goddess of the sea", "Siku": "ice", "Aput": "snow"
                }
            }
        },
        
        specialFeatures: {
            visionQuests: true,
            seasonalChanges: true,
            directionNames: ["North Wind", "East Star", "South Mountain", "West River"],
            twoSpirit: {
                recognition: "traditional",
                examples: ["We'wha", "Osh-Tisch", "Barcheeampe", "Finds Them and Kills Them"]
            },
            tabooNames: "Some names not spoken after death",
            animalSpirits: ["Eagle", "Bear", "Wolf", "Turtle", "Raven", "Salmon", "Buffalo"],
            ceremonialTitles: ["Keeper of the Sacred Bundle", "Pipe Carrier", "Medicine Person"]
        }
    },

    // Australian Aboriginal with complex taboos
    australianAboriginal: {
        metadata: {
            family: "Australian Aboriginal",
            populationPercentage: 0.01,
            writingSystems: ["Latin"],
            nameOrder: "complex_kinship",
            hasDeathTaboos: true,
            hasSacredNames: true,
            voicePreferences: []
        },
        
        nameComponents: {
            public: {
                male: ["David", "Albert", "Mandawuy", "Galarrwuy", "Noel", "Vincent", "Charlie", "Eddie",
                       "William", "Jack", "Tommy", "Jimmy", "Michael", "Patrick", "Stephen", "Robert"],
                female: ["Evonne", "Cathy", "Nova", "Marcia", "Sally", "Ruby", "Pearl", "Faith",
                        "Joyce", "Margaret", "Dorothy", "Gladys", "Linda", "Christine", "Jessica", "Deborah"],
                surnames: ["Gulpilil", "Namatjira", "Freeman", "Yunupingu", "Peris", "Langford", "Morgan",
                          "Burnum", "Unaipon", "Cooper", "Mabo", "Lingiari", "Perkins", "O'Donoghue",
                          "Dodson", "Pearson", "Williams", "Johnson", "Smith", "Davis"]
            },
            skinNames: {
                groups: ["Nangala", "Napurrula", "Nakamarra", "Napanangka", "Napangardi", "Nungarrayi",
                        "Nampijinpa", "Napaljarri", "Jupurrula", "Jakamarra", "Jampijinpa", "Jangala",
                        "Jungarrayi", "Japanangka", "Japangardi", "Japaljarri"],
                determines: "marriage and ceremony roles",
                male: ["Jupurrula", "Jakamarra", "Jampijinpa", "Jangala", "Jungarrayi", "Japanangka"],
                female: ["Napurrula", "Nakamarra", "Nampijinpa", "Nangala", "Nungarrayi", "Napanangka"]
            },
            traditional: {
                status: "sacred/private",
                display: "[ceremonial name]",
                examples: ["[name not spoken]", "[traditional name]", "[sacred knowledge]", "[ceremonial only]"]
            },
            totem: {
                animals: ["Kangaroo", "Emu", "Eagle", "Crow", "Goanna", "Snake", "Dingo", "Echidna"],
                plants: ["Eucalyptus", "Wattle", "Grass Tree", "Banksia"],
                elements: ["Lightning", "Rain", "Fire", "Wind"]
            }
        },
        
        specialFeatures: {
            deathTaboo: {
                active: true,
                substitute: "Kuminjay",
                alternatives: ["Kwementyaye", "Kunmanara", "name not mentioned"],
                duration: "months to years",
                scope: "name and similar sounds"
            },
            sacredNames: {
                storage: "never displayed publicly",
                context: "ceremony only",
                placeholder: "[cannot be spoken]"
            },
            sistergirl: {
                recognition: "cultural",
                meaning: "trans woman in Aboriginal context"
            },
            brotherboy: {
                recognition: "cultural",
                meaning: "trans man in Aboriginal context"
            },
            kinshipTerms: {
                "Nginda": "mother's brother",
                "Kamuru": "father's sister",
                "Kapali": "elder brother"
            },
            regions: ["Yolngu", "Arrernte", "Pitjantjatjara", "Warlpiri", "Tiwi", "Kulin", "Noongar"]
        }
    },

    // Khoisan with click notation
    khoisan: {
        metadata: {
            family: "Khoisan",
            populationPercentage: 0.01,
            writingSystems: ["Latin with clicks"],
            nameOrder: "given_first",
            hasClickConsonants: true,
            voicePreferences: []
        },
        
        nameComponents: {
            names: {
                withClicks: ["ǃXabbu", "Nǃxau", "ǀKaece", "Gǁkao", "ǂKxʼaoǁʼae", "ʘani", "ǃAiǃae",
                            "ǁHõab", "ǀGui", "Nǃaisa", "ǂKhomani", "ǃXõ", "ǁAu", "ǀKx'au",
                            "ǃGubi", "ǁNabace", "ǂAice", "ʘKhwe", "ǃNanni", "ǁXaus"],
                colonialNames: ["Jantje", "Jan", "Johannes", "Piet", "Klaas", "Willem", "Hendrik",
                               "Anna", "Maria", "Sarah", "Elizabeth", "Katrina", "Sofie"],
                hadza: ["Kaunda", "Mwambapa", "Gonga", "Saitoti", "Ndogomi", "Bakiri", "Mariamu", 
                       "Tsikaegua", "Onwas", "Kampala"], // No clicks in Hadza
                sandawe: ["Kimambo", "Mtoro", "Kijuu", "Saidi", "Hamisi", "Rajabu", "Bi Hawa"]
            },
            meanings: {
                "ǃXabbu": "dream/story",
                "Nǃxau": "short face",
                "ǀKaece": "far water",
                "ʘani": "mouth/speak"
            }
        },
        
        specialFeatures: {
            clicks: {
                types: {
                    "ǀ": "dental click",
                    "ǁ": "lateral click", 
                    "ǃ": "alveolar click",
                    "ǂ": "palatal click",
                    "ʘ": "bilabial click"
                },
                frequency: "Up to 60% of words",
                pronunciation: "Cannot be approximated in most languages",
                clusters: ["ǃx", "ǁh", "ǀg", "ǂkh", "ʘq"],
                examples: {
                    "ǃxóõ": "person (with nasalization)",
                    "ǁhûi": "to sing",
                    "ǀgui": "water"
                }
            },
            languages: ["Ju|'hoan", "!Xun", "Khoekhoe", "Sandawe", "Hadza", "!Xóõ", "Nǀuu"],
            colonialImpact: "Many traditional names replaced",
            revitalization: "Growing use of click names"
        }
    },

    // Sign Languages - visual names
    signLanguages: {
        metadata: {
            family: "Sign Languages",
            populationPercentage: 0.1,
            writingSystems: ["SignWriting", "Video", "Description", "Stokoe Notation"],
            nameOrder: "given_first",
            isVisual: true,
            voicePreferences: null // Cannot be spoken
        },
        
        nameComponents: {
            nameTypes: {
                arbitrary: "Abstract sign with no meaning connection",
                descriptive: "Based on characteristic (glasses, curly hair)",
                initialized: "First letter + location/movement",
                borrowed: "From another sign language",
                compound: "Combination of two signs"
            },
            examples: {
                descriptive: ["GLASSES-FACE", "CURLY-HAIR", "DIMPLE-CHEEK", "TALL-HEAD", "BEARD-CHIN",
                             "SMILE-BRIGHT", "PONYTAIL-SWING", "FRECKLES-NOSE", "EARRING-SHAKE", "MUSTACHE-TWIRL",
                             "BRAIDS-SIDE", "HAT-TIP", "SCARF-NECK", "BLUE-EYES", "STRONG-ARM"],
                initialized: ["J-TEMPLE", "M-CHIN", "K-SHOULDER", "L-HEART", "S-FOREHEAD", "D-CHEEK",
                             "R-SIDE", "T-CHEST", "B-HEAD", "N-NOSE", "P-EAR", "C-NECK", "A-HAND"],
                fingerspelled: ["#JOHN", "#MARIA", "#ALEX", "#EMMA", "#OMAR", "#LILY", "#NOAH", "#ZARA"],
                compound: ["BOOK+SMART", "MUSIC+HEART", "DANCE+SMOOTH", "TECH+WIZARD", "NATURE+LOVE",
                          "COFFEE+ALWAYS", "LAUGH+LOUD", "THINK+DEEP", "RUN+FAST", "PAINT+COLOR"],
                cultural: {
                    ASL: ["OBAMA-HORIZON", "EINSTEIN-WILD-HAIR", "MLK-MARCH"],
                    BSL: ["THATCHER-IRON", "SHAKESPEARE-QUILL"],
                    Auslan: ["CROCODILE-DUNDEE", "KANGAROO-JUMP"],
                    LSF: ["NAPOLEON-HAT", "EIFFEL-POINT"]
                }
            },
            deafCommunity: {
                leaders: ["I-KING-JORDAN", "MARLEE-MATLIN", "NYLE-DIMARCO", "HABEN-GIRMA"],
                activists: ["GALLAUDET", "CLERC", "VEDITZ", "STOKOE"],
                artists: ["CHUCK-BAIRD", "BETTY-MILLER", "DOUGLAS-TILDEN"]
            }
        },
        
        specialFeatures: {
            earned: "Name signs given by Deaf community",
            visual: {
                display: "Text description or video",
                spoken: "Describe sign formation",
                notation: ["Handshape", "Location", "Movement", "Palm Orientation", "Non-manual markers"]
            },
            evolution: "Names can change over lifetime",
            regional: "Same person may have different names in different sign languages",
            deafBlind: {
                tactile: ["TAP-TAP-SHOULDER", "SQUEEZE-PATTERN", "DRAW-LETTER-PALM"],
                protactile: "Full language adaptation for DeafBlind"
            },
            videoRelayService: "VRS names for interpreters",
            coda: "Children of Deaf Adults often have signs from birth"
        }
    },

    // Dravidian family
    dravidian: {
        metadata: {
            family: "Dravidian",
            populationPercentage: 3,
            writingSystems: ["Tamil", "Telugu", "Kannada", "Malayalam"],
            nameOrder: "given_first",
            hasInitials: true,
            voicePreferences: ["ta-IN", "te-IN", "kn-IN", "ml-IN"]
        },
        
        nameComponents: {
            given: {
                male: ["Rajesh", "Kumar", "Vijay", "Ravi", "Anand", "Karthik", "Suresh", "Ganesh",
                       "Murugan", "Senthil", "Arun", "Bala", "Chandran", "Durai", "Elango", "Gokul",
                       "Hari", "Ilango", "Jagan", "Kamal", "Lakshman", "Mani", "Nandakumar", "Pandian"],
                female: ["Priya", "Lakshmi", "Kavitha", "Deepa", "Anitha", "Saranya", "Revathi", "Padma",
                         "Meera", "Radha", "Shanthi", "Uma", "Vidya", "Yamuna", "Ambika", "Bhavani",
                         "Chitra", "Durga", "Ezhil", "Gayathri", "Hema", "Indira", "Janaki", "Kala"],
                neutral: ["Akasha", "Surya", "Chandra", "Tharun", "Nilam", "Madhuram", "Selvam", "Inbam"]
            },
            family: ["Reddy", "Naidu", "Iyer", "Nair", "Pillai", "Menon", "Raju", "Rao", "Krishnan",
                    "Subramanian", "Natarajan", "Raghavan", "Srinivasan", "Venkatesan", "Chandrasekaran",
                    "Ramachandran", "Balasubramanian", "Venkataraman", "Gopalakrishnan", "Ranganathan"],
            initials: {
                format: "father's name as initial",
                examples: ["K. Rajesh", "S. Priya", "M. Kumar", "R. Lakshmi", "T. Vijay",
                          "P. Anitha", "N. Suresh", "V. Kavitha", "A. Ganesh", "G. Deepa"]
            },
            caste: {
                brahmin: ["Iyer", "Iyengar", "Sharma", "Sastri", "Dikshitar"],
                sensitivity: "high - often omitted in modern usage"
            },
            titles: {
                respectful: ["Thiru", "Thirumathi", "Selvi", "Sri", "Srimathi"],
                professional: ["Dr.", "Er.", "Adv.", "Prof."]
            }
        },
        
        specialFeatures: {
            casteMarkers: { sensitivity: "high", usage: "declining" },
            hijra: { 
                recognition: "traditional third gender",
                names: ["Revathi", "Kalki", "Laxmi", "Kamini", "Bharathi", "Vijayalakshmi"]
            },
            singleInitial: "Some use only one initial (e.g., 'K. Anand')",
            villageName: "Sometimes included as identifier",
            maternalUncle: "Special relationship in naming"
        }
    },

    // Japanese
    japanese: {
        metadata: {
            family: "Japonic",
            populationPercentage: 1.6,
            writingSystems: ["Kanji", "Hiragana", "Katakana", "Romaji"],
            nameOrder: "family_first",
            multipleReadings: true,
            voicePreferences: ["ja-JP"]
        },
        
        nameComponents: {
            family: {
                kanji: ["山田", "佐藤", "鈴木", "高橋", "田中", "渡辺", "伊藤", "山本", "中村", "小林",
                       "加藤", "吉田", "山口", "松本", "井上", "木村", "清水", "山崎", "森", "阿部"],
                romaji: ["Yamada", "Sato", "Suzuki", "Takahashi", "Tanaka", "Watanabe", "Ito", "Yamamoto",
                        "Nakamura", "Kobayashi", "Kato", "Yoshida", "Yamaguchi", "Matsumoto", "Inoue",
                        "Kimura", "Shimizu", "Yamazaki", "Mori", "Abe"]
            },
            given: {
                male: {
                    kanji: ["太郎", "健", "大輔", "翔", "蓮", "陽太", "樹", "大翔", "颯太", "悠斗",
                           "翔太", "拓海", "海斗", "陸", "光", "晴", "慶", "誠", "隼人", "涼"],
                    romaji: ["Taro", "Ken/Takeshi", "Daisuke", "Sho", "Ren", "Yota", "Itsuki", "Hiroto",
                            "Sota", "Yuto", "Shota", "Takumi", "Kaito", "Riku", "Hikaru", "Haru"]
                },
                female: {
                    kanji: ["花子", "美咲", "さくら", "愛", "舞", "楓", "葵", "結衣", "陽菜", "凛",
                           "美月", "心愛", "結菜", "莉子", "芽衣", "杏", "美優", "咲良", "琴音", "彩"],
                    romaji: ["Hanako", "Misaki", "Sakura", "Ai", "Mai", "Kaede", "Aoi", "Yui", "Hina",
                            "Rin", "Mitsuki", "Kokoa", "Yuina", "Riko", "Mei", "An", "Miyu", "Sara"]
                },
                neutral: {
                    kanji: ["光", "空", "楓", "蒼", "遥", "晴", "響", "涼", "望", "凪"],
                    romaji: ["Hikaru", "Sora", "Kaede", "Aoi", "Haruka", "Haru", "Hibiki", "Ryo", "Nozomi", "Nagi"]
                }
            },
            historical: {
                male: ["義経", "信長", "秀吉", "家康", "龍馬", "西郷", "新選組"],
                female: ["紫式部", "清少納言", "北条政子", "細川ガラシャ", "篤姫"],
                era_names: ["明治", "大正", "昭和", "平成", "令和"]
            }
        },
        
        specialFeatures: {
            multipleReadings: { 
                "健": ["Ken", "Takeshi", "Yasushi", "Tsuyoshi"],
                "光": ["Hikaru", "Hikari", "Ko", "Mitsu", "Akira"],
                "愛": ["Ai", "Mana", "Megumi", "Itoshi"]
            },
            xGender: { 
                term: "Xジェンダー", 
                recognition: "emerging",
                pronouns: ["彼ら", "その人", "あの人"]
            },
            professionalNames: {
                sumo: ["Hakuho", "Asashoryu", "Takanohana"],
                kabuki: ["Ichikawa", "Nakamura", "Onoe"],
                geisha: ["Sayuri", "Mineko", "Kiharu"]
            },
            adoptionForBusiness: "Common to adopt heir for family business",
            imperialNames: "No family name for imperial family"
        }
    },

    // Korean
    korean: {
        metadata: {
            family: "Koreanic",
            populationPercentage: 1,
            writingSystems: ["Hangul", "Hanja"],
            nameOrder: "family_first",
            limitedFamilyNames: true,
            voicePreferences: ["ko-KR"]
        },
        
        nameComponents: {
            family: {
                hangul: ["김", "이", "박", "최", "정", "강", "조", "윤", "장", "임",
                        "한", "오", "서", "신", "권", "황", "안", "송", "류", "전"],
                romanized: ["Kim", "Lee/Yi", "Park", "Choi", "Jung", "Kang", "Jo", "Yoon", "Jang", "Lim",
                           "Han", "Oh", "Seo", "Shin", "Kwon", "Hwang", "Ahn", "Song", "Ryu", "Jeon"],
                twoSyllable: ["남궁", "선우", "독고", "사공", "황보", "제갈", "동방", "서문"],
                twoSyllableRomanized: ["Namgung", "Sunwoo", "Dokgo", "Sagong", "Hwangbo", "Jegal"]
            },
            given: {
                male: ["민준", "서준", "지호", "준서", "현우", "준혁", "지훈", "민성", "준영", "시우",
                      "유준", "정우", "승현", "승민", "시윤", "준호", "지환", "승준", "현준", "민규"],
                female: ["서연", "지우", "서윤", "하은", "지유", "수빈", "소율", "지아", "하윤", "서아",
                        "민서", "예은", "소윤", "지안", "서영", "예린", "수아", "다은", "채원", "은서"],
                neutral: ["선", "민", "현", "진", "서", "유", "하", "별", "솔", "강"],
                hanja: {
                    "민준": "敏俊", "서연": "瑞妍", "지호": "志浩", "하은": "夏恩"
                }
            },
            generation: ["재", "현", "성", "영", "정", "용", "태", "기", "동", "경"],
            meanings: {
                "민": "clever/people", "준": "talented", "서": "auspicious", "연": "beautiful",
                "지": "wisdom", "호": "great", "하": "summer", "은": "grace"
            }
        },
        
        specialFeatures: {
            dollimja: "shared generational character",
            limitedSurnames: "~250 surnames for 50M people",
            marriedNames: "Women traditionally keep maiden names",
            hanja: "Chinese characters for meaning",
            nicknames: ["oppa", "unnie", "hyung", "noona"],
            professionalNames: {
                entertainment: ["stage names common", "single names (IU, Rain)"],
                traditional: ["pen names for scholars"]
            }
        }
    },

    // Turkic
    turkic: {
        metadata: {
            family: "Turkic",
            populationPercentage: 2.5,
            writingSystems: ["Latin", "Cyrillic", "Arabic"],
            nameOrder: "given_first",
            voicePreferences: ["tr-TR", "kk-KZ", "uz-UZ", "az-AZ", "tk-TM"]
        },
        
        nameComponents: {
            given: {
                male: ["Mehmet", "Ahmet", "Mustafa", "Ali", "Hasan", "Oğuz", "Kaan", "Efe", "Murat",
                       "Kemal", "Orhan", "Selim", "Tarık", "Volkan", "Berk", "Alp", "Barış", "Cem",
                       "Deniz", "Ertuğrul", "Fatih", "Gökhan", "Halil", "İbrahim", "Kerem", "Levent",
                       "Mete", "Necati", "Okan", "Polat", "Rıza", "Serkan", "Tolga", "Umut", "Yavuz"],
                female: ["Ayşe", "Fatma", "Emine", "Zeynep", "Hatice", "Elif", "Merve", "Büşra", "Esra",
                         "Nur", "Gül", "Yasemin", "Özge", "Derya", "Hülya", "Sevgi", "Aslı", "Burcu",
                         "Canan", "Dilara", "Ebru", "Filiz", "Gözde", "İpek", "Jale", "Kübra", "Leyla",
                         "Melis", "Nihan", "Özlem", "Pınar", "Rana", "Seda", "Tuba", "Vildan", "Yıldız"],
                neutral: ["Deniz", "Evren", "Özgür", "Duru", "Mutlu", "Umay", "Berrin", "Can"]
            },
            family: ["Yılmaz", "Kaya", "Özdemir", "Çelik", "Şahin", "Yıldırım", "Özkan", "Arslan",
                    "Doğan", "Kılıç", "Aslan", "Çetin", "Kara", "Koç", "Kurt", "Özkan", "Aydın",
                    "Peker", "Şen", "Özden", "Ateş", "Başaran", "Korkmaz", "Güneş", "Özer", "Taş",
                    "Yalçın", "Şimşek", "Erdoğan", "Öztürk", "Sarı", "Uçar", "Yavuz", "Güler", "Avcı"],
            kazakh: {
                given: ["Nursultan", "Qasym", "Dimash", "Erlan", "Baurzhan", "Asel", "Aigul", "Madina"],
                family: ["Nazarbayev", "Tokayev", "Suleimenov", "Iskakov", "Mukhamedov"]
            },
            uzbek: {
                given: ["Rustam", "Timur", "Jamshid", "Dilshod", "Gulnara", "Shahrizoda", "Malika"],
                family: ["Karimov", "Rashidov", "Alimov", "Tashkentov"]
            },
            azerbaijani: {
                given: ["Eldar", "Farid", "Kamran", "Leyla", "Günel", "Səbinə"],
                family: ["Aliyev", "Hasanov", "Mammadov", "Huseynov"]
            }
        },
        
        specialFeatures: {
            specialChars: ["ı", "ğ", "ü", "ö", "ş", "ç", "ə", "ñ"],
            patronyms: { 
                suffix: ["oğlu", "kızı", "qızı", "uly", "kyzy"],
                meaning: "son/daughter of"
            },
            titles: {
                "Bey": "Mr.", "Hanım": "Mrs./Ms.", "Paşa": "General", "Ağa": "Master"
            },
            meanings: {
                nature: ["Deniz (sea)", "Yıldız (star)", "Gül (rose)", "Ay (moon)"],
                virtues: ["Barış (peace)", "Umut (hope)", "Mutlu (happy)", "Özgür (free)"]
            }
        }
    },

    // Austroasiatic
    austroasiatic: {
        metadata: {
            family: "Austroasiatic",
            populationPercentage: 1.5,
            writingSystems: ["Latin", "Khmer", "Thai"],
            nameOrder: "family_first",
            voicePreferences: ["vi-VN", "km-KH"]
        },
        
        nameComponents: {
            vietnamese: {
                family: ["Nguyễn", "Trần", "Lê", "Phạm", "Hoàng", "Huỳnh", "Phan", "Vũ", "Võ", "Đặng",
                        "Bùi", "Đỗ", "Hồ", "Ngô", "Dương", "Lý", "Đinh", "Lưu", "Mai", "Trương"],
                middle: ["Văn", "Thị", "Đức", "Anh", "Minh", "Quốc", "Hữu", "Thanh", "Xuân", "Hồng"],
                given: {
                    male: ["Nam", "Hùng", "Dũng", "Mạnh", "Tuấn", "Quang", "Vinh", "Long", "Phong", "Hải"],
                    female: ["Hương", "Lan", "Linh", "Trang", "Hoa", "Mai", "Anh", "Thu", "Hằng", "Nga"],
                    neutral: ["Minh", "An", "Phúc", "Bình", "Khang", "Thiện", "Lộc", "Tâm"]
                }
            },
            khmer: {
                given: ["Sokha", "Dara", "Vanna", "Sophea", "Rithy", "Samnang", "Bopha", "Kunthea",
                       "Piseth", "Ratha", "Sothea", "Visal", "Thida", "Mony", "Srey", "Phalla"],
                family: ["Sok", "Chan", "Phan", "Keo", "Chea", "Heng", "Kim", "Ouk", "Sam", "Sar",
                        "Touch", "Ung", "Vong", "Yim", "Pen", "Ros", "Sin", "Tan", "Yin", "Long"]
            },
            mon: {
                names: ["Ong", "Nai", "Mi", "Pan", "Smin", "Hnin", "Myat"],
                titles: ["Min", "Saw", "Shin", "Daw"]
            },
            santali: {
                given: ["Hopna", "Durga", "Sido", "Kanhu", "Chand", "Bhairab", "Phulo", "Joba"],
                clan: ["Hansda", "Kisku", "Marandi", "Murmu", "Hembram", "Soren", "Tudu", "Baskey"]
            }
        },
        
        specialFeatures: {
            tones: { vietnamese: 6, khmer: "non-tonal" },
            diacritics: ["ă", "â", "ê", "ô", "ơ", "ư", "đ", "̀", "́", "̃", "̉", "̣"],
            orderingRules: {
                vietnamese: "Family + Middle + Given",
                khmer: "Family + Given (sometimes reversed)"
            },
            meanings: {
                nature: ["Hoa (flower)", "Mai (apricot)", "Lan (orchid)", "Thu (autumn)"],
                virtues: ["Minh (bright)", "An (peace)", "Phúc (fortune)", "Lộc (prosperity)"]
            },
            royalNames: {
                khmer: ["Norodom", "Sisowath", "Sihanouk", "Sihamoni"]
            }
        }
    },

    // Tai-Kadai
    taiKadai: {
        metadata: {
            family: "Tai-Kadai",
            populationPercentage: 1.2,
            writingSystems: ["Thai", "Lao", "Latin"],
            nameOrder: "given_first",
            voicePreferences: ["th-TH", "lo-LA"]
        },
        
        nameComponents: {
            thai: {
                given: {
                    male: ["สมชาย", "สมศักดิ์", "ประยุทธ์", "วิชัย", "ประเสริฐ", "ณรงค์", "ชัยวัฒน์", "อนุชา",
                           "พงษ์ศักดิ์", "สุรพล", "เกียรติศักดิ์", "วีระ", "ธนากร", "ภูมิพล", "อดุลย์"],
                    female: ["สมหญิง", "มาลี", "สุดา", "พรทิพย์", "วิไลวรรณ", "จันทร์เพ็ญ", "รัตนา", "ศิริพร",
                            "นภาพร", "ปาริชาติ", "ดวงใจ", "สายใจ", "กาญจนา", "บุษบา", "อรพรรณ"],
                    nicknames: ["น้อย", "ใหญ่", "แดง", "ขาว", "อ้วน", "ผอม", "เล็ก", "โต", "มด", "ปลา",
                               "หนู", "ปู", "กบ", "นก", "ต้น", "ฝน", "ฟ้า", "ดาว"]
                },
                family: ["ศรีสุข", "แสงทอง", "วงศ์สว่าง", "ทองดี", "สุขสันต์", "จันทร์โอชา", "พิทักษ์พงศ์",
                        "โชติช่วง", "รัตนสิทธิ์", "วัฒนานุกูล", "ประเสริฐศิลป์", "เจริญสุข", "มงคลกุล"],
                royalNames: ["จุฬาลงกรณ์", "วชิราวุธ", "ประชาธิปก", "อานันทมหิดล", "ภูมิพลอดุลยเดช", "วชิราลงกรณ"],
                titles: ["นาย", "นาง", "นางสาว", "คุณ", "ท่าน", "ดร.", "ศ.", "พล.อ.", "พล.ต.", "ม.ร.ว."]
            },
            lao: {
                given: {
                    male: ["ສົມສັກ", "ບຸນທັນ", "ຄຳຫຼ້າ", "ພູທອນ", "ສີສະຫວັດ", "ວິໄລ", "ບຸນຍັງ", "ທອງສີ"],
                    female: ["ແກ້ວ", "ຄຳ", "ເພັດ", "ມະນີ", "ດາວ", "ຈັນ", "ສີດາ", "ນ້ອຍ"]
                },
                family: ["ພົມວິຫານ", "ສີປະເສີດ", "ວົງແສນເມືອງ", "ຈັນທະບູລີ", "ພູມສະຫວັນ", "ສຸວັນນະໄຊ"]
            },
            shan: {
                names: ["Sao", "Khun", "Nang", "Sai", "Mai", "Kham", "Ying", "Lu"],
                titles: ["Sawbwa", "Myoza", "Ngwegunhmu"]
            }
        },
        
        specialFeatures: {
            longNames: "Formal names can be very long (10+ syllables)",
            nicknames: "Daily use names often unrelated to formal name",
            tones: { thai: 5, lao: 6 },
            sanskritInfluence: "Many names from Sanskrit/Pali",
            royalLanguage: "Special vocabulary for royalty",
            generationalNicknames: "Nicknames by birth order (e.g., น้อย = youngest)",
            animalNicknames: "Common to use animal names as nicknames"
        }
    }
};

// Application state
let appState = {
    isRunning: true,
    isFast: false,
    isWeighted: false,
    showDetails: true,
    isVoiceInitialized: false,
    currentName: null,
    synth: window.speechSynthesis,
    voices: [],
    intervalId: null,
    SLOW_SPEED: 10000,
    FAST_SPEED: 5000
};

// Voice system initialization
async function initializeVoiceSystem() {
    const status = document.getElementById('voiceStatus');
    status.innerHTML = '<span class="loading"></span> Initializing voice system...';
    
    try {
        // Check browser support
        if (!('speechSynthesis' in window)) {
            throw new Error('Speech synthesis not supported in this browser');
        }
        
        // Load voices
        appState.voices = await loadVoices();
        
        if (appState.voices.length === 0) {
            throw new Error('No voices available');
        }
        
        // Test voice
        await testVoice();
        
        appState.isVoiceInitialized = true;
        status.innerHTML = '✓ Voice system ready';
        document.getElementById('initVoiceButton').style.display = 'none';
        
        // Start the memorial
        startInterval();
        
    } catch (error) {
        console.error('Voice initialization failed:', error);
        status.innerHTML = `⚠️ ${error.message}. Names will display without audio.`;
        document.getElementById('initVoiceButton').textContent = 'Retry Voice';
        
        // Start without voice
        startInterval();
    }
}

function loadVoices() {
    return new Promise((resolve) => {
        const loadVoiceList = () => {
            const voices = appState.synth.getVoices();
            if (voices.length > 0) {
                // List of novelty voices to exclude
                const EXCLUDED_VOICES = [
                    'trinoids', 'zarvox', 'albert', 'whisper', 'bahh', 'boing', 
                    'bubbles', 'deranged', 'hysterical', 'cellos', 'pipe organ', 
                    'organ', 'good news', 'bad news', 'bells', 'jester', 'princess', 
                    'superstar', 'junior', 'wobble'
                ];
                
                // Log excluded voices for debugging
                const excludedVoicesList = voices.filter(voice => {
                    const voiceNameLower = voice.name.toLowerCase();
                    return EXCLUDED_VOICES.some(excluded => voiceNameLower.includes(excluded));
                });
                
                if (excludedVoicesList.length > 0) {
                    console.log('Excluding novelty voices:', excludedVoicesList.map(v => v.name));
                }
                
                resolve(voices);
            }
        };
        
        loadVoiceList();
        if (appState.synth.onvoiceschanged !== undefined) {
            appState.synth.onvoiceschanged = loadVoiceList;
        }
        
        // Timeout fallback
        setTimeout(() => resolve(appState.synth.getVoices()), 1000);
    });
}

function testVoice() {
    return new Promise((resolve) => {
        const utterance = new SpeechSynthesisUtterance('Voice initialized');
        utterance.volume = 0.1;
        utterance.onend = () => resolve();
        utterance.onerror = () => resolve();
        appState.synth.speak(utterance);
        
        // Timeout fallback
        setTimeout(resolve, 2000);
    });
}

// Name generation
function generateName() {
    const family = selectFamily();
    const gender = selectGender(family);
    const components = buildNameComponents(family, gender);
    
    return {
        family: family,
        gender: gender,
        components: components,
        display: formatNameForDisplay(components, family),
        spoken: formatNameForSpeech(components, family),
        metadata: gatherMetadata(components, family, gender)
    };
}

function selectFamily() {
    const families = Object.keys(comprehensiveNamesDatabase).filter(
        key => key !== 'metadata' && key !== 'genderSystem'
    );
    
    if (!appState.isWeighted) {
        return families[Math.floor(Math.random() * families.length)];
    }
    
    // Weighted selection
    const weights = families.map(f => 
        comprehensiveNamesDatabase[f].metadata.populationPercentage || 1
    );
    const total = weights.reduce((a, b) => a + b, 0);
    let random = Math.random() * total;
    
    for (let i = 0; i < families.length; i++) {
        random -= weights[i];
        if (random <= 0) return families[i];
    }
    
    return families[0];
}

function selectGender(family) {
    const familyData = comprehensiveNamesDatabase[family];
    const genderSystem = comprehensiveNamesDatabase.genderSystem;
    
    // Check for cultural specific genders
    const culturalGenders = Object.entries(genderSystem.culturalSpecific)
        .filter(([_, info]) => info.cultures.some(c => 
            familyData.metadata.family.includes(c) ||
            family.toLowerCase().includes(c.toLowerCase())
        ))
        .map(([gender, _]) => gender);
    
    const allGenders = [
        ...genderSystem.binary,
        ...genderSystem.nonBinary,
        ...culturalGenders
    ];
    
    return allGenders[Math.floor(Math.random() * allGenders.length)];
}

function buildNameComponents(family, gender) {
    const familyData = comprehensiveNamesDatabase[family];
    const components = {};
    
    // Handle special cases
    if (familyData.specialFeatures?.deathTaboo?.active && Math.random() < 0.1) {
        return {
            isTaboo: true,
            substitute: familyData.specialFeatures.deathTaboo.substitute,
            originalType: 'ancestral'
        };
    }
    
    if (familyData.specialFeatures?.sacredNames && Math.random() < 0.05) {
        return {
            isSacred: true,
            display: familyData.nameComponents.traditional?.display || '[ceremonial name]'
        };
    }
    
    // Build normal name components
    const nameOrder = familyData.metadata.nameOrder;
    
    // Handle Sign Languages special case
    if (family === 'signLanguages') {
        components.isVisual = true;
        const types = Object.keys(familyData.nameComponents.examples);
        const type = randomChoice(types);
        components.signType = type;
        components.signDescription = randomChoice(familyData.nameComponents.examples[type]);
        
        // Add a fingerspelled name for context
        if (type === 'fingerspelled' && familyData.nameComponents.examples.fingerspelled) {
            components.given = components.signDescription.replace('#', '');
        }
        
        return components;
    }
    
    // Handle Native American special structure
    if (family === 'nativeAmerican') {
        const tribes = ['lakota', 'cherokee', 'ojibwe', 'navajo', 'general', 'inuit'];
        const tribe = randomChoice(tribes);
        const tribeData = familyData.nameComponents[tribe];
        
        if (tribe === 'lakota') {
            const nameType = Math.random() < 0.5 ? 'earned' : 'childhood';
            components.given = randomChoice(tribeData[nameType]);
            if (tribeData.native && Math.random() < 0.5) {
                const nativeIndex = Math.floor(Math.random() * tribeData.native.length);
                components.native = tribeData.native[nativeIndex];
                components.nativeMeaning = tribeData.meanings[components.native] || '';
            }
        } else if (tribe === 'cherokee') {
            components.given = randomChoice(tribeData.english);
            components.clan = randomChoice(tribeData.clan);
        } else if (tribe === 'ojibwe' || tribe === 'navajo') {
            const nameIndex = Math.floor(Math.random() * tribeData.names.length);
            components.given = tribeData.names[nameIndex];
            if (tribeData.meanings && tribeData.meanings[components.given]) {
                components.meaning = tribeData.meanings[components.given];
            }
        } else if (tribe === 'general') {
            const nameIndex = Math.floor(Math.random() * tribeData.english.length);
            components.given = tribeData.english[nameIndex];
            if (tribeData.meanings && tribeData.meanings[components.given]) {
                components.meaning = tribeData.meanings[components.given];
            }
        } else if (tribe === 'inuit') {
            const nameIndex = Math.floor(Math.random() * tribeData.names.length);
            components.given = tribeData.names[nameIndex];
            if (tribeData.meanings && tribeData.meanings[components.given]) {
                components.meaning = tribeData.meanings[components.given];
            }
        }
        
        components.tribe = tribe.charAt(0).toUpperCase() + tribe.slice(1);
        return components;
    }
    
    // Handle Australian Aboriginal special structure
    if (family === 'australianAboriginal') {
        // Check for active death taboo
        if (Math.random() < 0.1) {
            return {
                isTaboo: true,
                substitute: randomChoice(familyData.specialFeatures.deathTaboo.alternatives),
                originalType: 'ancestral'
            };
        }
        
        // Regular name generation
        const nameType = Math.random();
        if (nameType < 0.7) {
            // Public names
            const genderKey = gender === 'female' ? 'female' : 'male';
            components.given = randomChoice(familyData.nameComponents.public[genderKey]);
            components.family = randomChoice(familyData.nameComponents.public.surnames);
        } else {
            // Skin names
            const genderKey = gender === 'female' ? 'female' : 'male';
            if (familyData.nameComponents.skinNames[genderKey]) {
                components.skinName = randomChoice(familyData.nameComponents.skinNames[genderKey]);
                components.isSkinName = true;
            } else {
                components.skinName = randomChoice(familyData.nameComponents.skinNames.groups);
                components.isSkinName = true;
            }
        }
        
        return components;
    }
    
    // Handle Khoisan special structure
    if (family === 'khoisan') {
        const nameTypes = Object.keys(familyData.nameComponents.names);
        const type = randomChoice(nameTypes);
        const names = familyData.nameComponents.names[type];
        
        if (Array.isArray(names) && names.length > 0) {
            components.given = randomChoice(names);
            components.nameType = type;
            
            // Add meaning if available
            if (familyData.nameComponents.meanings && familyData.nameComponents.meanings[components.given]) {
                components.meaning = familyData.nameComponents.meanings[components.given];
            }
        }
        
        return components;
    }
    
    // Handle Sino-Tibetan special cases
    if (family === 'sinoTibetan') {
        const subtype = Math.random();
        
        if (subtype < 0.7) {
            // Standard Chinese names
            components.family = randomChoice(familyData.nameComponents.family.single);
            const genderKey = gender === 'female' ? 'female' : 'male';
            components.given = randomChoice(familyData.nameComponents.given[genderKey] || 
                                           familyData.nameComponents.given.neutral);
            
            // Add romanization
            const familyIndex = familyData.nameComponents.family.single.indexOf(components.family);
            if (familyData.nameComponents.family.romanized[familyIndex]) {
                components.familyRomanized = familyData.nameComponents.family.romanized[familyIndex];
            }
        } else if (subtype < 0.85) {
            // Tibetan names
            components.given = randomChoice(familyData.nameComponents.tibetan.given);
            components.meaning = familyData.nameComponents.tibetan.meaning[components.given] || '';
            components.isTibetan = true;
        } else {
            // Burmese names
            components.given = randomChoice(familyData.nameComponents.burmese.names);
            if (Math.random() < 0.5) {
                components.title = randomChoice(familyData.nameComponents.burmese.titles);
            }
            components.isBurmese = true;
        }
        
        return components;
    }
    
    // Handle Austroasiatic special structure
    if (family === 'austroasiatic') {
        const subtype = Math.random();
        
        if (subtype < 0.6) {
            // Vietnamese
            const viet = familyData.nameComponents.vietnamese;
            components.family = randomChoice(viet.family);
            components.middle = randomChoice(viet.middle);
            const genderKey = gender === 'female' ? 'female' : 'male';
            components.given = randomChoice(viet.given[genderKey] || viet.given.neutral);
        } else if (subtype < 0.85) {
            // Khmer
            const khmer = familyData.nameComponents.khmer;
            components.given = randomChoice(khmer.given);
            components.family = randomChoice(khmer.family);
        } else if (subtype < 0.95) {
            // Mon
            const mon = familyData.nameComponents.mon;
            components.given = randomChoice(mon.names);
            if (Math.random() < 0.5) {
                components.title = randomChoice(mon.titles);
            }
        } else {
            // Santali
            const santali = familyData.nameComponents.santali;
            components.given = randomChoice(santali.given);
            components.clan = randomChoice(santali.clan);
        }
        
        return components;
    }
    
    // Handle Tai-Kadai special structure
    if (family === 'taiKadai') {
        const subtype = Math.random();
        
        if (subtype < 0.7) {
            // Thai
            const thai = familyData.nameComponents.thai;
            const genderKey = gender === 'female' ? 'female' : 'male';
            components.given = randomChoice(thai.given[genderKey]);
            components.family = randomChoice(thai.family);
            
            // Add nickname
            if (Math.random() < 0.5) {
                components.nickname = randomChoice(thai.given.nicknames);
            }
        } else if (subtype < 0.9) {
            // Lao
            const lao = familyData.nameComponents.lao;
            const genderKey = gender === 'female' ? 'female' : 'male';
            components.given = randomChoice(lao.given[genderKey]);
            components.family = randomChoice(lao.family);
            components.isLao = true;
        } else {
            // Shan
            const shan = familyData.nameComponents.shan;
            components.given = randomChoice(shan.names);
            if (Math.random() < 0.3) {
                components.title = randomChoice(shan.titles);
            }
            components.isShan = true;
        }
        
        return components;
    }
    
    // Handle Afroasiatic special structure
    if (family === 'afroasiatic') {
        const subFamily = randomChoice(['arabic', 'hebrew', 'ethiopic', 'berber']);
        const subData = familyData.nameComponents[subFamily];
        
        if (subFamily === 'arabic') {
            components.given = randomChoice(subData.ism);
            components.nisbah = Math.random() < 0.3 ? randomChoice(subData.nisbah) : null;
            components.showNativeScript = true;
            components.rtl = true;
        } else if (subFamily === 'hebrew') {
            const genderKey = gender === 'female' ? 'female' : 'male';
            components.given = randomChoice(subData.given[genderKey]);
            components.romanized = randomChoice(subData.given.romanized[genderKey]);
            components.family = randomChoice(subData.family);
            components.familyRomanized = randomChoice(subData.familyRomanized);
            components.showNativeScript = true;
            components.rtl = true;
        } else if (subFamily === 'ethiopic') {
            const index = Math.floor(Math.random() * subData.given.length);
            components.given = subData.given[index];
            components.romanized = subData.romanized[index];
            components.showNativeScript = true;
        } else if (subFamily === 'berber') {
            const index = Math.floor(Math.random() * subData.names.length);
            components.given = subData.names[index];
            components.romanized = subData.romanized[index];
            components.showNativeScript = true;
        }
        
        return components;
    }
    
    // Standard structure handling for remaining families
    let givenNames = [];
    let familyNames = [];
    
    if (familyData.nameComponents.given) {
        const genderMap = {
            'male': 'male',
            'female': 'female',
            'neutral': 'neutral',
            'fluid': 'neutral',
            'agender': 'neutral',
            'hijra': 'neutral',
            'twoSpirit': 'neutral',
            'faAfafine': 'female',
            'mahu': 'neutral',
            'sistergirl': 'female',
            'xGender': 'neutral'
        };
        
        const genderKey = genderMap[gender] || 'neutral';
        givenNames = familyData.nameComponents.given[genderKey] || 
                    familyData.nameComponents.given.neutral ||
                    [...(familyData.nameComponents.given.male || []), 
                     ...(familyData.nameComponents.given.female || [])];
    }
    
    // Handle mononyms
    if (familyData.nameComponents.mononyms && Math.random() < 0.3) {
        components.mononym = randomChoice(familyData.nameComponents.mononyms);
        components.isMononym = true;
        return components;
    }
    
    // Regular names
    if (givenNames && givenNames.length > 0) {
        components.given = randomChoice(givenNames);
    } else {
        // No names found for this configuration
        components.noNameAvailable = true;
        components.reason = `No ${gender} names available in ${familyData.metadata.family} database`;
    }
    
    // Family names
    if (familyData.nameComponents.family) {
        if (typeof familyData.nameComponents.family === 'object' && !Array.isArray(familyData.nameComponents.family)) {
            // Handle structured family names
            const allFamilyNames = [
                ...(familyData.nameComponents.family.common || []),
                ...(familyData.nameComponents.family.compound || []),
                ...(familyData.nameComponents.family.noble || []),
                ...(familyData.nameComponents.family.single || []),
                ...(familyData.nameComponents.family.romanized || [])
            ];
            if (allFamilyNames.length > 0) {
                components.family = randomChoice(allFamilyNames);
            }
        } else if (Array.isArray(familyData.nameComponents.family)) {
            components.family = randomChoice(familyData.nameComponents.family);
        }
    }
    
    // Add special components based on culture
    addCulturalComponents(components, family, gender, familyData);
    
    return components;
}

function addCulturalComponents(components, family, gender, familyData) {
    // Patronymics
    if (familyData.metadata.hasPatronymics && Math.random() < 0.5) {
        if (family === 'indoEuropean' && components.given) {
            const patronymics = familyData.nameComponents.patronymic;
            if (patronymics?.russian) {
                components.patronymic = randomChoice(
                    gender === 'female' ? patronymics.russian.female : patronymics.russian.male
                );
            }
        }
    }
    
    // Particles
    if (familyData.nameComponents.particles && Math.random() < 0.3) {
        const particles = familyData.nameComponents.particles;
        const particleTypes = Object.keys(particles);
        if (particleTypes.length > 0) {
            const particleType = randomChoice(particleTypes);
            const particle = randomChoice(Object.keys(particles[particleType]));
            components.particle = particle;
            components.particleMeaning = particles[particleType][particle];
        }
    }
    
    // Special naming features
    if (family === 'nativeAmerican' && Math.random() < 0.5) {
        components.english = components.given;
        const nativeOptions = familyData.nameComponents.lakota?.native || 
                            familyData.nameComponents.ojibwe?.names || [];
        if (nativeOptions.length > 0) {
            components.native = randomChoice(nativeOptions);
            components.given = components.english + ' / ' + components.native;
        }
    }
    
    if (family === 'signLanguages') {
        components.isVisual = true;
        const types = Object.keys(familyData.nameComponents.examples);
        const type = randomChoice(types);
        components.signType = type;
        components.signDescription = randomChoice(familyData.nameComponents.examples[type]);
    }
}

function formatNameForDisplay(components, family) {
    const familyData = comprehensiveNamesDatabase[family];
    
    // Handle special display cases
    if (components.noNameAvailable) {
        return `[${components.reason}]`;
    }
    
    if (components.isTaboo) {
        return components.substitute || 'Kuminjay';
    }
    
    if (components.isSacred) {
        return components.display;
    }
    
    if (components.isMononym) {
        return components.mononym;
    }
    
    if (components.isVisual) {
        return `[Sign: ${components.signDescription}]`;
    }
    
    // Handle special family structures
    if (family === 'australianAboriginal' && components.isSkinName) {
        return `${components.skinName} (skin name)`;
    }
    
    if (family === 'khoisan') {
        let display = components.given;
        if (components.meaning) {
            display += ` ("${components.meaning}")`;
        }
        if (components.nameType === 'colonialNames') {
            display += ' (colonial name)';
        }
        return display;
    }
    
    if (family === 'nativeAmerican') {
        let display = components.given;
        if (components.native) {
            display = `${components.given} / ${components.native}`;
            if (components.nativeMeaning) {
                display += ` ("${components.nativeMeaning}")`;
            }
        } else if (components.meaning) {
            display += ` ("${components.meaning}")`;
        }
        if (components.clan) {
            display += ` - ${components.clan} clan`;
        }
        return display;
    }
    
    if (family === 'sinoTibetan') {
        if (components.isTibetan) {
            let display = components.given;
            if (components.meaning) {
                display += ` ("${components.meaning}")`;
            }
            return display;
        }
        if (components.isBurmese) {
            return components.title ? `${components.title} ${components.given}` : components.given;
        }
        // Chinese names
        if (components.familyRomanized) {
            return `${components.family} ${components.given} (${components.familyRomanized} ${components.given})`;
        }
    }
    
    if (family === 'austroasiatic') {
        if (components.middle) {
            // Vietnamese
            return `${components.family} ${components.middle} ${components.given}`;
        }
        if (components.title) {
            // Mon
            return `${components.title} ${components.given}`;
        }
        if (components.clan) {
            // Santali
            return `${components.given} ${components.clan}`;
        }
    }
    
    if (family === 'taiKadai') {
        let display = '';
        if (components.title) {
            display += components.title + ' ';
        }
        display += components.given;
        if (components.family) {
            display += ' ' + components.family;
        }
        if (components.nickname) {
            display += ` (nicknamed "${components.nickname}")`;
        }
        return display;
    }
    
    // Handle native scripts with romanization
    if (components.showNativeScript && components.romanized) {
        const nativeParts = [];
        const romanParts = [];
        
        if (family === 'afroasiatic') {
            if (components.rtl) {
                // For RTL scripts (Arabic, Hebrew)
                if (components.given) nativeParts.push(components.given);
                if (components.family) nativeParts.push(components.family);
                if (components.nisbah) nativeParts.push(components.nisbah);
                
                if (components.romanized) romanParts.push(components.romanized);
                if (components.familyRomanized) romanParts.push(components.familyRomanized);
            } else {
                // For other scripts (Ethiopic, Berber)
                return `${components.given} (${components.romanized})`;
            }
        }
        
        const nativeDisplay = nativeParts.join(' ');
        const romanDisplay = romanParts.join(' ');
        
        if (romanDisplay) {
            return `${nativeDisplay} (${romanDisplay})`;
        }
        return nativeDisplay;
    }
    
    // Standard format based on name order
    const parts = [];
    const order = familyData.metadata.nameOrder;
    
    if (order === 'family_first') {
        if (components.family) parts.push(components.family);
        if (components.given) parts.push(components.given);
    } else {
        if (components.given) parts.push(components.given);
        if (components.patronymic) parts.push(components.patronymic);
        if (components.particle) parts.push(components.particle);
        if (components.family) parts.push(components.family);
    }
    
    return parts.join(' ') || '[Name cannot be displayed]';
}

function formatNameForSpeech(components, family) {
    if (components.noNameAvailable) {
        return "This culture's naming system is not yet fully documented";
    }
    
    if (components.isTaboo) {
        return "Name cannot be spoken due to cultural taboo";
    }
    
    if (components.isSacred) {
        return "Sacred name - spoken only in ceremony";
    }
    
    if (components.isVisual) {
        return `Visual sign language name: ${components.signDescription}`;
    }
    
    // For other special cases, provide appropriate speech
    if (family === 'khoisan' && components.given) {
        const clickConsonants = ['ǀ', 'ǁ', 'ǃ', 'ǂ', 'ʘ'];
        if (clickConsonants.some(click => components.given.includes(click))) {
            return "Name contains click consonants that cannot be approximated in most languages";
        }
    }
    
    // Default to display format but remove special notations
    let spoken = formatNameForDisplay(components, family);
    spoken = spoken.replace(/\[.*?\]/g, ''); // Remove bracketed content
    spoken = spoken.replace(/\(.*?\)/g, ''); // Remove parenthetical content
    
    return spoken.trim() || "Name";
}

function gatherMetadata(components, family, gender) {
    const familyData = comprehensiveNamesDatabase[family];
    const metadata = {
        languageFamily: familyData.metadata.family,
        writingSystems: familyData.metadata.writingSystems,
        gender: gender,
        culturalNotes: []
    };
    
    // Add relevant cultural notes
    if (components.isMononym) {
        metadata.culturalNotes.push("Mononym (single name)");
    }
    
    if (components.patronymic) {
        metadata.culturalNotes.push("Includes patronymic");
    }
    
    if (components.particle) {
        metadata.culturalNotes.push(`"${components.particle}" means "${components.particleMeaning}"`);
    }
    
    if (familyData.metadata.hasClickConsonants) {
        metadata.culturalNotes.push("Contains click consonants");
    }
    
    if (familyData.metadata.tonal) {
        metadata.culturalNotes.push("Tonal language");
    }
    
    if (familyData.metadata.rtl?.length > 0) {
        metadata.culturalNotes.push("Written right-to-left");
    }
    
    // Gender-specific notes
    const genderInfo = comprehensiveNamesDatabase.genderSystem.culturalSpecific[gender];
    if (genderInfo) {
        metadata.culturalNotes.push(`${gender}: ${genderInfo.cultures.join(', ')} cultural identity`);
    }
    
    return metadata;
}

// Display functions
function displayName(nameData) {
    const nameDisplay = document.getElementById('nameDisplay');
    const scriptDisplay = document.getElementById('scriptDisplay');
    const componentsDisplay = document.getElementById('nameComponents');
    const indicatorsDisplay = document.getElementById('specialIndicators');
    const contextDisplay = document.getElementById('culturalContext');
    const voiceStatus = document.getElementById('voiceStatus');
    const signNote = document.getElementById('signLanguageNote');
    
    // Reset displays
    nameDisplay.className = 'name-main fade-in';
    scriptDisplay.textContent = '';
    componentsDisplay.innerHTML = '';
    indicatorsDisplay.innerHTML = '';
    contextDisplay.innerHTML = '';
    signNote.style.display = 'none';
    
    // Main name display
    nameDisplay.textContent = nameData.display;
    
    // Handle special scripts
    if (nameData.metadata.writingSystems.includes('Arabic') || 
        nameData.metadata.writingSystems.includes('Hebrew')) {
        nameDisplay.classList.add('rtl');
    }
    
    // Show components if detailed view
    if (appState.showDetails && !nameData.components.isTaboo && !nameData.components.isSacred) {
        displayComponents(nameData.components, componentsDisplay);
    }
    
    // Special indicators
    displayIndicators(nameData, indicatorsDisplay);
    
    // Cultural context
    if (appState.showDetails) {
        displayCulturalContext(nameData, contextDisplay);
    }
    
    // Handle sign language note
    if (nameData.components.isVisual) {
        signNote.style.display = 'block';
        signNote.innerHTML = `
            <strong>Sign Language Name:</strong> This name exists in visual/spatial form. 
            ${nameData.components.signDescription}
        `;
        voiceStatus.textContent = 'Visual name - cannot be spoken';
    }
    
    // Store current name
    appState.currentName = nameData;
}

function displayComponents(components, container) {
    Object.entries(components).forEach(([key, value]) => {
        if (key === 'isMononym' || key === 'isTaboo' || key === 'isSacred' || 
            key === 'isVisual' || key === 'signType' || key === 'signDescription') {
            return;
        }
        
        const div = document.createElement('div');
        div.className = 'component';
        
        const label = document.createElement('span');
        label.className = 'component-label';
        label.textContent = formatComponentLabel(key) + ':';
        
        const text = document.createElement('span');
        text.textContent = value;
        
        div.appendChild(label);
        div.appendChild(text);
        container.appendChild(div);
    });
}

function displayIndicators(nameData, container) {
    const indicators = [];
    
    if (nameData.components.isTaboo) {
        indicators.push({ class: 'indicator-taboo', text: '⚠️ Death Taboo Active' });
    }
    
    if (nameData.components.isSacred) {
        indicators.push({ class: 'indicator-sacred', text: '🙏 Sacred Name' });
    }
    
    if (nameData.components.isMononym) {
        indicators.push({ class: 'indicator-mononym', text: '◉ Mononym' });
    }
    
    if (nameData.gender !== 'male' && nameData.gender !== 'female') {
        const genderInfo = comprehensiveNamesDatabase.genderSystem.culturalSpecific[nameData.gender];
        const symbol = genderInfo?.symbol || '⚧';
        indicators.push({ 
            class: 'indicator-cultural', 
            text: `${symbol} ${formatGender(nameData.gender)}` 
        });
    }
    
    if (nameData.components.isVisual) {
        indicators.push({ class: 'indicator-cultural', text: '👋 Sign Language' });
    }
    
    indicators.forEach(indicator => {
        const span = document.createElement('span');
        span.className = `indicator ${indicator.class}`;
        span.textContent = indicator.text;
        container.appendChild(span);
    });
}

function displayCulturalContext(nameData, container) {
    const info = document.createElement('div');
    info.className = 'culture-info';
    
    // Language family
    addInfoItem(info, 'Language Family', nameData.metadata.languageFamily);
    
    // Writing systems
    addInfoItem(info, 'Writing System', nameData.metadata.writingSystems.join(', '));
    
    // Gender
    addInfoItem(info, 'Gender', formatGender(nameData.gender));
    
    // Cultural notes
    if (nameData.metadata.culturalNotes.length > 0) {
        addInfoItem(info, 'Cultural Notes', nameData.metadata.culturalNotes.join('; '));
    }
    
    container.appendChild(info);
}

function addInfoItem(container, label, value) {
    const div = document.createElement('div');
    div.className = 'info-item';
    div.innerHTML = `<span class="info-label">${label}:</span> ${value}`;
    container.appendChild(div);
}

// Speech functions
function speakName(nameData) {
    if (!appState.isVoiceInitialized || !nameData || nameData.components.isVisual) {
        return;
    }
    
    if (nameData.components.isTaboo) {
        updateVoiceStatus('Observing speech taboo');
        return;
    }
    
    if (nameData.components.isSacred) {
        updateVoiceStatus('Sacred name - spoken privately only');
        return;
    }
    
    try {
        appState.synth.cancel();
        
        const utterance = new SpeechSynthesisUtterance(nameData.spoken);
        const voice = selectVoice(nameData);
        
        if (voice) {
            utterance.voice = voice;
            updateVoiceStatus(`Speaking with ${voice.name}`);
        }
        
        // Adjust speech parameters based on gender
        utterance.rate = 0.9;
        utterance.pitch = getPitchForGender(nameData.gender);
        utterance.volume = 1.0;
        
        appState.synth.speak(utterance);
        
    } catch (error) {
        console.error('Speech error:', error);
        updateVoiceStatus('Speech error occurred');
    }
}

function selectVoice(nameData) {
    const familyData = comprehensiveNamesDatabase[nameData.family];
    const preferredVoices = familyData.metadata.voicePreferences || [];
    
    if (!appState.voices || appState.voices.length === 0) {
        return null;
    }
    
    // List of novelty voices to exclude
    const EXCLUDED_VOICES = [
        'trinoids', 'zarvox', 'albert', 'whisper', 'bahh', 'boing', 
        'bubbles', 'deranged', 'hysterical', 'cellos', 'pipe organ', 
        'organ', 'good news', 'bad news', 'bells', 'jester', 'princess', 
        'superstar', 'junior', 'wobble'
    ];
    
    // Filter out excluded voices
    const availableVoices = appState.voices.filter(voice => {
        const voiceNameLower = voice.name.toLowerCase();
        return !EXCLUDED_VOICES.some(excluded => voiceNameLower.includes(excluded));
    });
    
    if (availableVoices.length === 0) {
        return null;
    }
    
    // Try to match preferred language/locale
    for (const pref of preferredVoices) {
        const voice = availableVoices.find(v => v.lang === pref || v.lang.startsWith(pref));
        if (voice) return voice;
    }
    
    // Fallback to any non-excluded voice
    return availableVoices.find(v => v.default) || availableVoices[0];
}

function getPitchForGender(gender) {
    const pitchMap = {
        'female': 1.2,
        'male': 0.9,
        'neutral': 1.0,
        'fluid': 1.0,
        'agender': 1.0,
        'hijra': 1.1,
        'twoSpirit': 1.0,
        'faAfafine': 1.15,
        'mahu': 1.1,
        'sistergirl': 1.2,
        'xGender': 1.0
    };
    
    return pitchMap[gender] || 1.0;
}

function updateVoiceStatus(message) {
    const status = document.getElementById('voiceStatus');
    status.textContent = message;
}

// Utility functions
function randomChoice(array) {
    if (!array || array.length === 0) return '';
    return array[Math.floor(Math.random() * array.length)];
}

function formatComponentLabel(key) {
    const labelMap = {
        'given': 'Given name',
        'family': 'Family name',
        'patronymic': 'Patronymic',
        'particle': 'Particle',
        'mononym': 'Single name',
        'native': 'Native form',
        'english': 'English form'
    };
    
    return labelMap[key] || key.charAt(0).toUpperCase() + key.slice(1);
}

function formatGender(gender) {
    const genderMap = {
        'male': 'Male',
        'female': 'Female',
        'neutral': 'Gender neutral',
        'fluid': 'Gender fluid',
        'agender': 'Agender',
        'hijra': 'Hijra (South Asian third gender)',
        'twoSpirit': 'Two-Spirit (Native American)',
        'faAfafine': 'Fa\'afafine (Samoan third gender)',
        'mahu': 'Māhū (Hawaiian/Tahitian)',
        'sistergirl': 'Sistergirl (Aboriginal Australian)',
        'xGender': 'X-gender (Japanese non-binary)'
    };
    
    return genderMap[gender] || gender;
}

// Interval management
function startInterval() {
    generateAndDisplay();
    
    if (appState.intervalId) {
        clearInterval(appState.intervalId);
    }
    
    const speed = appState.isFast ? appState.FAST_SPEED : appState.SLOW_SPEED;
    appState.intervalId = setInterval(() => {
        if (appState.isRunning) {
            generateAndDisplay();
        }
    }, speed);
}

function generateAndDisplay() {
    const nameData = generateName();
    displayName(nameData);
    
    if (appState.isRunning && appState.isVoiceInitialized) {
        speakName(nameData);
    }
    
    updateStats(nameData);
}

function updateStats(nameData) {
    const stats = document.getElementById('statsDisplay');
    const familyData = comprehensiveNamesDatabase[nameData.family];
    
    const parts = [];
    
    if (appState.isWeighted) {
        parts.push(`Population weighting active (${familyData.metadata.family}: ${familyData.metadata.populationPercentage}%)`);
    } else {
        parts.push('Random selection (equal probability)');
    }
    
    const totalNames = Object.keys(comprehensiveNamesDatabase)
        .filter(k => k !== 'metadata' && k !== 'genderSystem')
        .reduce((total, family) => {
            const fData = comprehensiveNamesDatabase[family];
            let count = 0;
            
            if (fData.nameComponents.given) {
                Object.values(fData.nameComponents.given).forEach(list => {
                    if (Array.isArray(list)) count += list.length;
                });
            }
            
            if (fData.nameComponents.mononyms) {
                count += fData.nameComponents.mononyms.length;
            }
            
            return total + count;
        }, 0);
    
    parts.push(`Drawing from ${totalNames}+ names across ${comprehensiveNamesDatabase.metadata.totalFamilies} language families`);
    
    stats.innerHTML = parts.join(' • ');
}

// Event handlers
document.getElementById('initVoiceButton').addEventListener('click', initializeVoiceSystem);

document.getElementById('toggleButton').addEventListener('click', () => {
    appState.isRunning = !appState.isRunning;
    document.getElementById('toggleButton').textContent = appState.isRunning ? 'Pause' : 'Resume';
    
    if (appState.isRunning) {
        generateAndDisplay();
    } else {
        appState.synth.cancel();
    }
});

document.getElementById('speedToggle').addEventListener('change', (e) => {
    appState.isFast = e.target.checked;
    startInterval();
});

document.getElementById('weightedToggle').addEventListener('change', (e) => {
    appState.isWeighted = e.target.checked;
    updateStats(appState.currentName);
});

document.getElementById('detailToggle').addEventListener('change', (e) => {
    appState.showDetails = e.target.checked;
    if (appState.currentName) {
        displayName(appState.currentName);
    }
});

document.getElementById('speakButton').addEventListener('click', () => {
    if (appState.currentName) {
        speakName(appState.currentName);
    }
});

// Name click handler for image search
document.getElementById('nameDisplay').addEventListener('click', (e) => {
    const name = e.target.textContent;
    if (name && !name.includes('[') && !name.includes('Name withheld')) {
        window.focus();
        setTimeout(() => {
            const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(name)}&tbm=isch`;
            window.open(searchUrl, '_blank', 'noopener,noreferrer');
            window.focus();
        }, 0);
    }
});

// Info modal handlers
document.getElementById('infoButton').addEventListener('click', () => {
    document.getElementById('infoModal').style.display = 'block';
});

document.querySelector('.close').addEventListener('click', () => {
    document.getElementById('infoModal').style.display = 'none';
});

window.addEventListener('click', (e) => {
    const modal = document.getElementById('infoModal');
    if (e.target === modal) {
        modal.style.display = 'none';
    }
});

// Initialize on load
window.addEventListener('DOMContentLoaded', () => {
    // Display initial state
    updateStats({ family: 'indoEuropean' });
    
    // Generate first name without speaking
    generateAndDisplay();
    
    // Update voice status
    updateVoiceStatus('Click "Initialize Voice System" to enable speech');
});

// Handle visibility change to pause/resume
document.addEventListener('visibilitychange', () => {
    if (document.hidden && appState.isRunning) {
        appState.synth.cancel();
    }
});

// Error handling
window.addEventListener('error', (e) => {
    console.error('Application error:', e.error);
});

// Prevent speech on page unload
window.addEventListener('beforeunload', () => {
    if (appState.synth) {
        appState.synth.cancel();
    }
});
    </script>
</body>
</html>