<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particle Zoo Constructor Kit</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #333;
            text-align: center;
            font-size: 24px;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .mode-btn {
            padding: 10px 20px;
            border: none;
            background: #4a5568;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .mode-btn:hover {
            background: #2d3748;
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: #764ba2;
            box-shadow: 0 4px 10px rgba(118, 75, 162, 0.3);
        }

        .main-container {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .particle-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            width: 250px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .particle-panel h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #764ba2;
            padding-bottom: 10px;
        }

        .particle-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .particle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            transition: all 0.3s;
            font-weight: bold;
            color: white;
            font-size: 12px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            position: relative;
            user-select: none;
        }

        .particle:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .particle.dragging {
            cursor: grabbing;
            opacity: 0.5;
        }

        .particle-drag-clone {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            transform: translate(-50%, -50%);
        }

        /* Particle Colors */
        .quark-up { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .quark-down { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .quark-charm { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .quark-strange { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .quark-top { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
        .quark-bottom { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        
        .electron { background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%); }
        .neutrino { background: linear-gradient(135deg, #d9afd9 0%, #97d9e1 100%); }
        .photon { background: linear-gradient(135deg, #fff59d 0%, #fff9c4 100%); color: #333 !important; }
        .gluon { background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%); }
        
        .proton { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }
        .neutron { background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%); }
        
        .hydrogen { background: #ffffff; color: #333 !important; border: 2px solid #ccc; }
        .helium { background: #d4f1f9; color: #333 !important; border: 2px solid #a0d8ef; }
        .carbon { background: #2c3e50; }
        .nitrogen { background: #3498db; }
        .oxygen { background: #e74c3c; }
        .sodium { background: #f39c12; }
        .chlorine { background: #27ae60; }

        .workspace {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            position: relative;
            min-height: 500px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .workspace h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .construction-area {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }

        .construction-area.drag-over {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .constructed-particle {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .bond-line {
            position: absolute;
            background: #666;
            height: 2px;
            transform-origin: left center;
            z-index: 1;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            width: 250px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .info-panel h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-text {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .rules-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }

        .rule {
            background: #f0f0f0;
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 8px;
            font-size: 13px;
            color: #555;
        }

        .success-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #4caf50;
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: successPulse 0.5s ease;
        }

        @keyframes successPulse {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .clear-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .clear-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .charge-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #333;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔬 Particle Zoo Constructor Kit</h1>
        <div class="mode-selector">
            <button class="mode-btn active" data-mode="quarks">Quarks → Hadrons</button>
            <button class="mode-btn" data-mode="atoms">Hadrons → Atoms</button>
            <button class="mode-btn" data-mode="molecules">Atoms → Molecules</button>
        </div>
    </div>

    <div class="main-container">
        <div class="particle-panel">
            <h2 id="particle-title">Elementary Particles</h2>
            <div id="particles-list"></div>
        </div>

        <div class="workspace">
            <h2 id="workspace-title">Build Hadrons</h2>
            <button class="clear-btn" onclick="clearWorkspace()">Clear All</button>
            <div class="construction-area" id="construction-area"></div>
        </div>

        <div class="info-panel">
            <h3>Instructions</h3>
            <div class="info-text" id="info-text">
                Drag and drop quarks to build protons and neutrons!
            </div>
            <div class="rules-section">
                <h3>Current Rules</h3>
                <div id="rules-list"></div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'quarks';
        let draggedParticle = null;
        let constructedParticles = [];
        let particleIdCounter = 0;

        const particleData = {
            quarks: {
                title: 'Elementary Particles',
                particles: [
                    { name: 'Up', type: 'quark-up', charge: 2/3, symbol: 'u' },
                    { name: 'Down', type: 'quark-down', charge: -1/3, symbol: 'd' },
                    { name: 'Electron', type: 'electron', charge: -1, symbol: 'e⁻' },
                    { name: 'Neutrino', type: 'neutrino', charge: 0, symbol: 'ν' },
                    { name: 'Photon', type: 'photon', charge: 0, symbol: 'γ' },
                    { name: 'Gluon', type: 'gluon', charge: 0, symbol: 'g' }
                ],
                workspaceTitle: 'Build Hadrons',
                info: 'Drag and drop quarks to build protons (uud) and neutrons (udd)! Gluons hold quarks together.',
                rules: [
                    'Proton = 2 Up quarks + 1 Down quark',
                    'Neutron = 1 Up quark + 2 Down quarks',
                    'Three quarks make a baryon',
                    'Gluons mediate strong force'
                ]
            },
            atoms: {
                title: 'Hadrons & Leptons',
                particles: [
                    { name: 'Proton', type: 'proton', charge: 1, symbol: 'p⁺' },
                    { name: 'Neutron', type: 'neutron', charge: 0, symbol: 'n' },
                    { name: 'Electron', type: 'electron', charge: -1, symbol: 'e⁻' }
                ],
                workspaceTitle: 'Build Atoms',
                info: 'Combine protons, neutrons, and electrons to create atoms! Match protons with electrons for neutral atoms.',
                rules: [
                    'Hydrogen = 1 proton + 1 electron',
                    'Helium = 2 protons + 2 neutrons + 2 electrons',
                    'Carbon = 6 protons + 6 neutrons + 6 electrons',
                    'Protons determine element type',
                    'Electrons balance charge'
                ]
            },
            molecules: {
                title: 'Atoms',
                particles: [
                    { name: 'Hydrogen', type: 'hydrogen', symbol: 'H', valence: 1 },
                    { name: 'Carbon', type: 'carbon', symbol: 'C', valence: 4 },
                    { name: 'Nitrogen', type: 'nitrogen', symbol: 'N', valence: 3 },
                    { name: 'Oxygen', type: 'oxygen', symbol: 'O', valence: 2 },
                    { name: 'Sodium', type: 'sodium', symbol: 'Na', valence: 1 },
                    { name: 'Chlorine', type: 'chlorine', symbol: 'Cl', valence: 1 }
                ],
                workspaceTitle: 'Build Molecules',
                info: 'Connect atoms to form molecules! Atoms will bond based on their valence electrons.',
                rules: [
                    'Water = H₂O (2 Hydrogen + 1 Oxygen)',
                    'Methane = CH₄ (1 Carbon + 4 Hydrogen)',
                    'Ammonia = NH₃ (1 Nitrogen + 3 Hydrogen)',
                    'Salt = NaCl (1 Sodium + 1 Chlorine)',
                    'Carbon Dioxide = CO₂ (1 Carbon + 2 Oxygen)'
                ]
            }
        };

        function initializeMode(mode) {
            currentMode = mode;
            const data = particleData[mode];
            
            // Update UI
            document.getElementById('particle-title').textContent = data.title;
            document.getElementById('workspace-title').textContent = data.workspaceTitle;
            document.getElementById('info-text').textContent = data.info;
            
            // Update mode buttons
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });
            
            // Clear workspace
            clearWorkspace();
            
            // Render particles
            renderParticles(data.particles);
            
            // Render rules
            renderRules(data.rules);
        }

        function renderParticles(particles) {
            const container = document.getElementById('particles-list');
            container.innerHTML = '';
            
            const particleContainer = document.createElement('div');
            particleContainer.className = 'particle-container';
            
            particles.forEach(particle => {
                const particleEl = document.createElement('div');
                particleEl.className = `particle ${particle.type}`;
                particleEl.draggable = true;
                particleEl.innerHTML = `
                    ${particle.symbol}
                    ${particle.charge !== undefined && particle.charge !== 0 ? 
                        `<span class="charge-indicator">${particle.charge > 0 ? '+' : '-'}</span>` : ''}
                `;
                particleEl.dataset.particleType = particle.type;
                particleEl.dataset.particleName = particle.name;
                particleEl.dataset.particleSymbol = particle.symbol;
                if (particle.charge !== undefined) particleEl.dataset.charge = particle.charge;
                if (particle.valence !== undefined) particleEl.dataset.valence = particle.valence;
                
                particleEl.addEventListener('dragstart', handleDragStart);
                particleEl.addEventListener('dragend', handleDragEnd);
                
                particleContainer.appendChild(particleEl);
            });
            
            container.appendChild(particleContainer);
        }

        function renderRules(rules) {
            const rulesContainer = document.getElementById('rules-list');
            rulesContainer.innerHTML = '';
            
            rules.forEach(rule => {
                const ruleEl = document.createElement('div');
                ruleEl.className = 'rule';
                ruleEl.textContent = rule;
                rulesContainer.appendChild(ruleEl);
            });
        }

        function handleDragStart(e) {
            draggedParticle = {
                type: e.target.dataset.particleType,
                name: e.target.dataset.particleName,
                symbol: e.target.dataset.particleSymbol,
                charge: parseFloat(e.target.dataset.charge) || 0,
                valence: parseInt(e.target.dataset.valence) || 0
            };
            e.target.classList.add('dragging');
            
            // Create visual feedback
            const clone = e.target.cloneNode(true);
            clone.className = `particle ${draggedParticle.type} particle-drag-clone`;
            clone.id = 'drag-clone';
            document.body.appendChild(clone);
            
            // Update clone position on mouse move
            const updateClonePosition = (event) => {
                clone.style.left = event.clientX + 'px';
                clone.style.top = event.clientY + 'px';
            };
            
            document.addEventListener('mousemove', updateClonePosition);
            e.target.dataset.mouseMoveHandler = updateClonePosition;
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            
            // Remove clone
            const clone = document.getElementById('drag-clone');
            if (clone) clone.remove();
            
            // Remove mouse move handler
            const handler = e.target.dataset.mouseMoveHandler;
            if (handler) {
                document.removeEventListener('mousemove', handler);
                delete e.target.dataset.mouseMoveHandler;
            }
            
            draggedParticle = null;
        }

        // Construction area handlers
        const constructionArea = document.getElementById('construction-area');
        
        constructionArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            constructionArea.classList.add('drag-over');
        });
        
        constructionArea.addEventListener('dragleave', () => {
            constructionArea.classList.remove('drag-over');
        });
        
        constructionArea.addEventListener('drop', (e) => {
            e.preventDefault();
            constructionArea.classList.remove('drag-over');
            
            if (draggedParticle) {
                const rect = constructionArea.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                addParticleToWorkspace(draggedParticle, x, y);
                checkCombinations();
            }
        });

        function addParticleToWorkspace(particle, x, y) {
            const particleEl = document.createElement('div');
            particleEl.className = `constructed-particle particle ${particle.type}`;
            particleEl.style.left = (x - 30) + 'px';
            particleEl.style.top = (y - 30) + 'px';
            particleEl.innerHTML = `
                ${particle.symbol}
                ${particle.charge !== undefined && particle.charge !== 0 ? 
                    `<span class="charge-indicator">${particle.charge > 0 ? '+' : '-'}</span>` : ''}
            `;
            particleEl.dataset.particleId = particleIdCounter++;
            particleEl.dataset.particleType = particle.type;
            particleEl.dataset.particleName = particle.name;
            particleEl.dataset.charge = particle.charge || 0;
            
            constructionArea.appendChild(particleEl);
            
            constructedParticles.push({
                id: particleEl.dataset.particleId,
                element: particleEl,
                ...particle,
                x: x,
                y: y
            });
            
            // Make it draggable within workspace
            makeWorkspaceParticleDraggable(particleEl);
        }

        function makeWorkspaceParticleDraggable(element) {
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            element.addEventListener('mousedown', dragStart);

            function dragStart(e) {
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;

                if (e.target === element || element.contains(e.target)) {
                    isDragging = true;
                    element.style.zIndex = 1000;
                }
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                element.style.zIndex = '';
                
                // Update particle position in array
                const particle = constructedParticles.find(p => p.id === element.dataset.particleId);
                if (particle) {
                    const rect = constructionArea.getBoundingClientRect();
                    particle.x = parseInt(element.style.left) + 30;
                    particle.y = parseInt(element.style.top) + 30;
                }
                
                checkCombinations();
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    xOffset = currentX;
                    yOffset = currentY;

                    element.style.left = currentX + 'px';
                    element.style.top = currentY + 'px';
                }
            }

            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
        }

        function checkCombinations() {
            if (currentMode === 'quarks') {
                checkQuarkCombinations();
            } else if (currentMode === 'atoms') {
                checkAtomCombinations();
            } else if (currentMode === 'molecules') {
                checkMoleculeCombinations();
            }
        }

        function checkQuarkCombinations() {
            const quarks = constructedParticles.filter(p => p.type.includes('quark'));
            
            // Check for proton (uud)
            const upQuarks = quarks.filter(q => q.type === 'quark-up');
            const downQuarks = quarks.filter(q => q.type === 'quark-down');
            
            if (upQuarks.length >= 2 && downQuarks.length >= 1) {
                // Check if they're close enough
                if (areParticlesClose([upQuarks[0], upQuarks[1], downQuarks[0]])) {
                    createCompoundParticle([upQuarks[0], upQuarks[1], downQuarks[0]], 'Proton Created!', 'proton');
                }
            }
            
            // Check for neutron (udd)
            if (upQuarks.length >= 1 && downQuarks.length >= 2) {
                if (areParticlesClose([upQuarks[0], downQuarks[0], downQuarks[1]])) {
                    createCompoundParticle([upQuarks[0], downQuarks[0], downQuarks[1]], 'Neutron Created!', 'neutron');
                }
            }
        }

        function checkAtomCombinations() {
            const protons = constructedParticles.filter(p => p.type === 'proton');
            const neutrons = constructedParticles.filter(p => p.type === 'neutron');
            const electrons = constructedParticles.filter(p => p.type === 'electron');
            
            // Check for Hydrogen (1p, 1e)
            if (protons.length >= 1 && electrons.length >= 1) {
                if (areParticlesClose([protons[0], electrons[0]])) {
                    createCompoundParticle([protons[0], electrons[0]], 'Hydrogen Atom Created!', 'hydrogen');
                }
            }
            
            // Check for Helium (2p, 2n, 2e)
            if (protons.length >= 2 && neutrons.length >= 2 && electrons.length >= 2) {
                const particles = [protons[0], protons[1], neutrons[0], neutrons[1], electrons[0], electrons[1]];
                if (areParticlesClose(particles)) {
                    createCompoundParticle(particles, 'Helium Atom Created!', 'helium');
                }
            }
        }

        function checkMoleculeCombinations() {
            const atoms = constructedParticles;
            
            // Check for water (H2O)
            const hydrogens = atoms.filter(a => a.type === 'hydrogen');
            const oxygens = atoms.filter(a => a.type === 'oxygen');
            
            if (hydrogens.length >= 2 && oxygens.length >= 1) {
                if (areParticlesClose([hydrogens[0], hydrogens[1], oxygens[0]])) {
                    createMolecule([hydrogens[0], hydrogens[1], oxygens[0]], 'Water (H₂O) Created!');
                }
            }
            
            // Check for methane (CH4)
            const carbons = atoms.filter(a => a.type === 'carbon');
            if (carbons.length >= 1 && hydrogens.length >= 4) {
                const particles = [carbons[0], hydrogens[0], hydrogens[1], hydrogens[2], hydrogens[3]];
                if (areParticlesClose(particles)) {
                    createMolecule(particles, 'Methane (CH₄) Created!');
                }
            }
            
            // Check for salt (NaCl)
            const sodiums = atoms.filter(a => a.type === 'sodium');
            const chlorines = atoms.filter(a => a.type === 'chlorine');
            
            if (sodiums.length >= 1 && chlorines.length >= 1) {
                if (areParticlesClose([sodiums[0], chlorines[0]])) {
                    createMolecule([sodiums[0], chlorines[0]], 'Salt (NaCl) Created!');
                }
            }
        }

        function areParticlesClose(particles, maxDistance = 150) {
            if (particles.length < 2) return false;
            
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const dist = distance(particles[i], particles[j]);
                    if (dist > maxDistance) return false;
                }
            }
            return true;
        }

        function distance(p1, p2) {
            return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
        }

        function createCompoundParticle(particles, message, newType) {
            // Calculate center position
            const centerX = particles.reduce((sum, p) => sum + p.x, 0) / particles.length;
            const centerY = particles.reduce((sum, p) => sum + p.y, 0) / particles.length;
            
            // Remove constituent particles
            particles.forEach(p => {
                p.element.remove();
                const index = constructedParticles.findIndex(cp => cp.id === p.id);
                if (index > -1) constructedParticles.splice(index, 1);
            });
            
            // Show success message
            showSuccessMessage(message);
            
            // Create new compound particle
            setTimeout(() => {
                const compound = particleData.atoms.particles.find(p => p.type === newType) ||
                                particleData.molecules.particles.find(p => p.type === newType);
                if (compound) {
                    addParticleToWorkspace(compound, centerX, centerY);
                }
            }, 500);
        }

        function createMolecule(atoms, message) {
            // Draw bonds between atoms
            for (let i = 0; i < atoms.length - 1; i++) {
                drawBond(atoms[i], atoms[i + 1]);
            }
            
            showSuccessMessage(message);
        }

        function drawBond(atom1, atom2) {
            const bond = document.createElement('div');
            bond.className = 'bond-line';
            
            const dx = atom2.x - atom1.x;
            const dy = atom2.y - atom1.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            bond.style.width = length + 'px';
            bond.style.left = atom1.x + 'px';
            bond.style.top = atom1.y + 'px';
            bond.style.transform = `rotate(${angle}deg)`;
            
            constructionArea.appendChild(bond);
        }

        function showSuccessMessage(message) {
            const msgEl = document.createElement('div');
            msgEl.className = 'success-message';
            msgEl.textContent = message;
            document.body.appendChild(msgEl);
            
            setTimeout(() => {
                msgEl.remove();
            }, 2000);
        }

        function clearWorkspace() {
            constructionArea.innerHTML = '';
            constructedParticles = [];
            particleIdCounter = 0;
        }

        // Initialize mode buttons
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                initializeMode(btn.dataset.mode);
            });
        });

        // Initialize with quarks mode
        initializeMode('quarks');
    </script>
</body>
</html>