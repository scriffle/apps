<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SI Unit Visualizer</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #f5f7fa;
            padding: 20px;
            color: #2d3748;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #1a202c;
        }

        .help-button {
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3182ce;
            color: white;
            border: none;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .help-button:hover {
            background: #2c5282;
            transform: scale(1.1);
        }

        .help-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 600px;
            z-index: 1000;
            max-height: 80vh;
            overflow-y: auto;
        }

        .help-dialog.show {
            display: block;
        }

        .help-dialog h2 {
            margin-bottom: 20px;
            color: #1a202c;
        }

        .help-dialog h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .help-dialog p, .help-dialog li {
            line-height: 1.6;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .help-dialog ul {
            margin-left: 20px;
        }

        .close-help {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #718096;
        }

        .close-help:hover {
            color: #2d3748;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .overlay.show {
            display: block;
        }

        .playground {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .playground h3 {
            margin-bottom: 15px;
            color: #2d3748;
        }

        .unit-palette {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .canvas {
            min-height: 300px;
            background: #f8fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .canvas.drag-over {
            background: #e6fffa;
            border-color: #38a169;
        }

        .unit-block {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
            margin: 2px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            cursor: move;
            user-select: none;
        }

        .unit-block:hover {
            transform: scale(1.1);
        }

        .unit-block.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .unit-block.canceling {
            animation: cancelOut 0.6s ease-out forwards;
        }

        @keyframes cancelOut {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.3) rotate(180deg);
                opacity: 0.8;
                background-color: #e53e3e !important;
            }
            100% {
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }

        .unit-block.one {
            background-color: #718096;
            font-size: 14px;
        }

        /* Unit colors */
        .kg { background-color: #e53e3e; }
        .m { background-color: #3182ce; }
        .s { background-color: #38a169; }
        .A { background-color: #d69e2e; }
        .K { background-color: #319795; }
        .mol { background-color: #805ad5; }
        .cd { background-color: #ed8936; }

        /* Lighter shades for underlapping units */
        .unit-block.kg.underlap { background-color: #fc8181; }
        .unit-block.m.underlap { background-color: #63b3ed; }
        .unit-block.s.underlap { background-color: #68d391; }
        .unit-block.A.underlap { background-color: #f6ad55; }
        .unit-block.K.underlap { background-color: #4fd1c5; }
        .unit-block.mol.underlap { background-color: #b794f4; }
        .unit-block.cd.underlap { background-color: #fbd38d; }

        .compound-unit {
            position: relative;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            background: white;
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .unit-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 10px;
        }

        .numerator {
            display: flex;
            align-items: flex-start;
            gap: 4px;
            min-height: 36px;
            position: relative;
        }

        .denominator {
            display: flex;
            align-items: flex-start;
            gap: 4px;
            padding-top: 6px;
            border-top: 2px solid #4a5568;
            min-width: 100%;
            min-height: 36px;
            position: relative;
        }

        .unit-slot {
            position: relative;
            width: 36px;
            min-height: 36px;
            margin: 0 2px;
        }

        .unit-slot .unit-block {
            position: absolute;
            margin: 0;
        }

        .drop-zone {
            position: absolute;
            border: 2px dashed transparent;
            border-radius: 4px;
            pointer-events: none;
            transition: all 0.2s;
        }

        .drop-zone.active {
            border-color: #38a169;
            background: rgba(56, 161, 105, 0.1);
        }

        .drop-zone.multiply {
            background: rgba(49, 130, 206, 0.1);
            border-color: #3182ce;
        }

        .drop-zone.divide {
            background: rgba(229, 62, 62, 0.1);
            border-color: #e53e3e;
        }

        .drop-zone.exponent {
            background: rgba(128, 90, 213, 0.1);
            border-color: #805ad5;
        }

        .formula {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #2d3748;
            font-weight: 600;
            text-align: center;
        }

        .instructions {
            color: #718096;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .clear-button {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-left: 10px;
            transition: background 0.2s;
        }

        .clear-button:hover {
            background: #c53030;
        }

        .legend {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .legend h3 {
            margin-bottom: 15px;
            color: #2d3748;
        }

        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-block {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .legend-text {
            font-size: 14px;
            color: #4a5568;
        }

        .keyboard-hint {
            font-size: 12px;
            color: #a0aec0;
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="help-button" onclick="toggleHelp()">?</button>
        <h1>SI Unit Visualizer</h1>
        
        <div class="overlay" id="overlay" onclick="toggleHelp()"></div>
        <div class="help-dialog" id="help-dialog">
            <button class="close-help" onclick="toggleHelp()">×</button>
            <h2>SI Unit Visualizer Help</h2>
            
            <h3>Purpose</h3>
            <p>This interactive tool helps you understand how SI units combine to form compound units like Newton (kg·m·s⁻²) or Joule (kg·m²·s⁻²).</p>
            
            <h3>Mouse/Touch Controls</h3>
            <ul>
                <li><strong>Drag from palette:</strong> Add new units to the compound</li>
                <li><strong>Side-by-side drop:</strong> Multiply units (blue zone)</li>
                <li><strong>Below line drop:</strong> Divide by unit (red zone)</li>
                <li><strong>Overlap same unit:</strong> Create exponents (purple zone)</li>
                <li><strong>Drag from compound:</strong> Reposition units</li>
                <li><strong>Drag outside:</strong> Remove unit completely</li>
            </ul>
            
            <h3>Keyboard Shortcuts</h3>
            <ul>
                <li><strong>Number keys (1-7):</strong> Add base units to numerator</li>
                <li><strong>Shift + Number:</strong> Add base units to denominator</li>
                <li><strong>Letter keys:</strong>
                    <ul>
                        <li>g → kg (mass)</li>
                        <li>m → m (length)</li>
                        <li>s → s (time)</li>
                        <li>a → A (current)</li>
                        <li>k → K (temperature)</li>
                        <li>o → mol (amount)</li>
                        <li>c → cd (luminous intensity)</li>
                    </ul>
                </li>
                <li><strong>Shift + Letter:</strong> Add to denominator</li>
            </ul>
            
            <h3>Features</h3>
            <ul>
                <li>Visual stacking shows exponents (m² appears as two m blocks)</li>
                <li>Auto-cancellation when same unit appears above and below</li>
                <li>Real-time formula updates</li>
                <li>Drag units between positions</li>
                <li>Use "1" for dimensionless units like Hz (1/s)</li>
            </ul>
        </div>
        
        <div class="playground">
            <h3>Unit Playground</h3>
            <div class="instructions">
                • Drag units to different positions to multiply (side by side), divide (below line), or exponentiate (overlapping)<br>
                • Drag units out of the compound to remove them<br>
                • Use "1" for dimensionless numerators like Hz (1/s)
            </div>
            <div class="unit-palette">
                <div class="unit-block one" draggable="true" data-unit="1" data-source="palette">1</div>
                <div class="unit-block kg" draggable="true" data-unit="kg" data-source="palette">kg</div>
                <div class="unit-block m" draggable="true" data-unit="m" data-source="palette">m</div>
                <div class="unit-block s" draggable="true" data-unit="s" data-source="palette">s</div>
                <div class="unit-block A" draggable="true" data-unit="A" data-source="palette">A</div>
                <div class="unit-block K" draggable="true" data-unit="K" data-source="palette">K</div>
                <div class="unit-block mol" draggable="true" data-unit="mol" data-source="palette">mol</div>
                <div class="unit-block cd" draggable="true" data-unit="cd" data-source="palette">cd</div>
                <button class="clear-button" onclick="clearCanvas()">Clear</button>
            </div>
            <div class="canvas" id="canvas">
                <div class="compound-unit" id="compound-unit">
                    <div class="unit-visual">
                        <div class="numerator" id="numerator"></div>
                        <div class="denominator" id="denominator"></div>
                    </div>
                    <div class="formula" id="formula">1</div>
                </div>
            </div>
            <div class="keyboard-hint">Press ? for keyboard shortcuts</div>
        </div>

        <div class="legend">
            <h3>SI Base Units</h3>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-block one"></div>
                    <span class="legend-text">1 - unity (dimensionless)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-block kg"></div>
                    <span class="legend-text">kg - kilogram (mass)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-block m"></div>
                    <span class="legend-text">m - metre (length)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-block s"></div>
                    <span class="legend-text">s - second (time)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-block A"></div>
                    <span class="legend-text">A - ampere (current)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-block K"></div>
                    <span class="legend-text">K - kelvin (temperature)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-block mol"></div>
                    <span class="legend-text">mol - mole (amount)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-block cd"></div>
                    <span class="legend-text">cd - candela (luminous intensity)</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let draggedElement = null;
        let draggedUnit = null;
        let draggedFrom = null;
        let dropZone = null;
        let unitStructure = {
            numerator: {},
            denominator: {}
        };

        // Unit mappings
        const numberToUnit = ['1', 'kg', 'm', 's', 'A', 'K', 'mol', 'cd'];
        const letterToUnit = {
            'g': 'kg',
            'm': 'm',
            's': 's',
            'a': 'A',
            'k': 'K',
            'o': 'mol',
            'c': 'cd'
        };

        // Get DOM elements
        const canvas = document.getElementById('canvas');
        const compoundUnit = document.getElementById('compound-unit');
        const numerator = document.getElementById('numerator');
        const denominator = document.getElementById('denominator');

        // Initialize display
        updateDisplay();

        // Setup event listeners
        canvas.addEventListener('dragover', handleDragOver);
        canvas.addEventListener('drop', handleDrop);
        canvas.addEventListener('dragleave', handleDragLeave);

        // Keyboard event listener
        document.addEventListener('keydown', handleKeyPress);

        // Unified drag handlers
        function setupDragHandlers(element) {
            element.addEventListener('dragstart', handleDragStart);
            element.addEventListener('dragend', handleDragEnd);
        }

        // Setup palette units
        document.querySelectorAll('.unit-palette .unit-block').forEach(unit => {
            setupDragHandlers(unit);
        });

        function handleKeyPress(e) {
            // Ignore if typing in an input field
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            let unit = null;
            let toDenominator = e.shiftKey;
            
            // Number keys 1-8
            if (e.key >= '1' && e.key <= '8') {
                const index = parseInt(e.key) - 1;
                if (index < numberToUnit.length) {
                    unit = numberToUnit[index];
                }
            }
            // Letter keys
            else if (letterToUnit[e.key.toLowerCase()]) {
                unit = letterToUnit[e.key.toLowerCase()];
            }
            // Help dialog
            else if (e.key === '?') {
                toggleHelp();
                return;
            }
            
            if (unit) {
                e.preventDefault();
                if (toDenominator) {
                    if (!unitStructure.denominator[unit]) {
                        unitStructure.denominator[unit] = 0;
                    }
                    unitStructure.denominator[unit]++;
                } else {
                    if (!unitStructure.numerator[unit]) {
                        unitStructure.numerator[unit] = 0;
                    }
                    unitStructure.numerator[unit]++;
                }
                updateDisplay();
                checkForCancellation();
            }
        }

        function handleDragStart(e) {
            if (!e.target.draggable) {
                e.preventDefault();
                return;
            }
            
            draggedElement = e.target;
            draggedUnit = e.target.dataset.unit;
            
            const dragImage = e.target.cloneNode(true);
            dragImage.style.position = 'absolute';
            dragImage.style.top = '-1000px';
            document.body.appendChild(dragImage);
            e.dataTransfer.setDragImage(dragImage, 16, 16);
            setTimeout(() => document.body.removeChild(dragImage), 0);
            
            if (e.target.dataset.source === 'palette') {
                draggedFrom = 'palette';
            } else if (e.target.closest('#numerator')) {
                draggedFrom = 'numerator';
                unitStructure.numerator[draggedUnit]--;
                if (unitStructure.numerator[draggedUnit] <= 0) {
                    delete unitStructure.numerator[draggedUnit];
                }
                setTimeout(() => updateDisplay(), 0);
            } else if (e.target.closest('#denominator')) {
                draggedFrom = 'denominator';
                unitStructure.denominator[draggedUnit]--;
                if (unitStructure.denominator[draggedUnit] <= 0) {
                    delete unitStructure.denominator[draggedUnit];
                }
                setTimeout(() => updateDisplay(), 0);
            }
            
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', draggedUnit);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            if (dropZone) {
                dropZone.remove();
                dropZone = null;
            }
            draggedElement = null;
            draggedUnit = null;
            draggedFrom = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            const dropInfo = calculateDropZone(e);
            
            if (dropZone) {
                dropZone.remove();
            }
            
            if (dropInfo) {
                dropZone = document.createElement('div');
                dropZone.className = 'drop-zone active ' + dropInfo.type;
                dropZone.style.left = dropInfo.left + 'px';
                dropZone.style.top = dropInfo.top + 'px';
                dropZone.style.width = '40px';
                dropZone.style.height = '40px';
                compoundUnit.appendChild(dropZone);
            }
        }

        function calculateDropZone(e) {
            const rect = compoundUnit.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const numRect = numerator.getBoundingClientRect();
            const denomRect = denominator.getBoundingClientRect();
            
            if (e.clientX < rect.left || e.clientX > rect.right || 
                e.clientY < rect.top || e.clientY > rect.bottom) {
                return null;
            }
            
            let dropInfo = {};
            
            if (e.clientY < denomRect.top - 10) {
                dropInfo.location = 'numerator';
                
                const existingUnits = numerator.querySelectorAll('.unit-slot');
                let foundOverlap = false;
                
                existingUnits.forEach(slot => {
                    const slotRect = slot.getBoundingClientRect();
                    if (e.clientX >= slotRect.left - 10 && e.clientX <= slotRect.right + 10) {
                        const topUnit = slot.querySelector('.unit-block:last-child');
                        if (topUnit && topUnit.dataset.unit === draggedUnit) {
                            dropInfo.type = 'exponent';
                            dropInfo.left = slotRect.left - rect.left;
                            dropInfo.top = slotRect.top - rect.top + 6;
                            dropInfo.targetUnit = topUnit.dataset.unit;
                            foundOverlap = true;
                        }
                    }
                });
                
                if (!foundOverlap) {
                    dropInfo.type = 'multiply';
                    dropInfo.left = x - 20;
                    dropInfo.top = numRect.top - rect.top;
                }
            } else {
                dropInfo.location = 'denominator';
                
                const existingUnits = denominator.querySelectorAll('.unit-slot');
                let foundOverlap = false;
                
                existingUnits.forEach(slot => {
                    const slotRect = slot.getBoundingClientRect();
                    if (e.clientX >= slotRect.left - 10 && e.clientX <= slotRect.right + 10) {
                        const topUnit = slot.querySelector('.unit-block:last-child');
                        if (topUnit && topUnit.dataset.unit === draggedUnit) {
                            dropInfo.type = 'exponent';
                            dropInfo.left = slotRect.left - rect.left;
                            dropInfo.top = slotRect.top - rect.top + 6;
                            dropInfo.targetUnit = topUnit.dataset.unit;
                            foundOverlap = true;
                        }
                    }
                });
                
                if (!foundOverlap) {
                    dropInfo.type = 'divide';
                    dropInfo.left = x - 20;
                    dropInfo.top = denomRect.top - rect.top;
                }
            }
            
            return dropInfo;
        }

        function handleDragLeave(e) {
            if (e.target === canvas) {
                if (dropZone) {
                    dropZone.remove();
                    dropZone = null;
                }
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            
            const dropInfo = calculateDropZone(e);
            
            if (dropInfo) {
                if (dropInfo.location === 'numerator') {
                    if (!unitStructure.numerator[draggedUnit]) {
                        unitStructure.numerator[draggedUnit] = 0;
                    }
                    unitStructure.numerator[draggedUnit]++;
                } else if (dropInfo.location === 'denominator') {
                    if (!unitStructure.denominator[draggedUnit]) {
                        unitStructure.denominator[draggedUnit] = 0;
                    }
                    unitStructure.denominator[draggedUnit]++;
                }
            }
            
            if (dropZone) {
                dropZone.remove();
                dropZone = null;
            }
            
            updateDisplay();
            checkForCancellation();
        }

        function checkForCancellation() {
            const commonUnits = [];
            
            Object.keys(unitStructure.numerator).forEach(unit => {
                if (unitStructure.denominator[unit]) {
                    commonUnits.push(unit);
                }
            });
            
            if (commonUnits.length > 0) {
                // Animate cancellation
                setTimeout(() => {
                    commonUnits.forEach(unit => {
                        // Find and animate the visual blocks
                        const numBlocks = numerator.querySelectorAll(`.unit-block[data-unit="${unit}"]`);
                        const denomBlocks = denominator.querySelectorAll(`.unit-block[data-unit="${unit}"]`);
                        
                        if (numBlocks.length > 0 && denomBlocks.length > 0) {
                            // Get the top blocks (first in our case)
                            const numBlock = numBlocks[0];
                            const denomBlock = denomBlocks[0];
                            
                            // Add canceling animation
                            numBlock.classList.add('canceling');
                            denomBlock.classList.add('canceling');
                            
                            // After animation, update structure
                            setTimeout(() => {
                                unitStructure.numerator[unit]--;
                                unitStructure.denominator[unit]--;
                                
                                if (unitStructure.numerator[unit] <= 0) {
                                    delete unitStructure.numerator[unit];
                                }
                                if (unitStructure.denominator[unit] <= 0) {
                                    delete unitStructure.denominator[unit];
                                }
                                
                                updateDisplay();
                            }, 600);
                        }
                    });
                }, 100);
            }
        }

        function updateDisplay() {
            numerator.innerHTML = '';
            denominator.innerHTML = '';
            
            if (Object.keys(unitStructure.numerator).length === 0) {
                const oneSlot = document.createElement('div');
                oneSlot.className = 'unit-slot';
                const oneBlock = document.createElement('div');
                oneBlock.className = 'unit-block one';
                oneBlock.textContent = '1';
                oneBlock.style.position = 'static';
                oneSlot.appendChild(oneBlock);
                numerator.appendChild(oneSlot);
            } else {
                Object.entries(unitStructure.numerator).forEach(([unit, count]) => {
                    const slot = createUnitSlot(unit, count);
                    numerator.appendChild(slot);
                });
            }
            
            Object.entries(unitStructure.denominator).forEach(([unit, count]) => {
                const slot = createUnitSlot(unit, count);
                denominator.appendChild(slot);
            });
            
            updateFormula();
            
            const hasExponents = Object.values(unitStructure.numerator).some(count => count > 1);
            if (hasExponents) {
                numerator.style.minHeight = '46px';
            } else {
                numerator.style.minHeight = '36px';
            }
        }

        function createUnitSlot(unit, count) {
            const slot = document.createElement('div');
            slot.className = 'unit-slot';
            
            for (let i = 0; i < count; i++) {
                const block = document.createElement('div');
                block.className = `unit-block ${unit} ${i > 0 ? 'underlap' : ''}`;
                block.textContent = unit;
                block.style.top = (i * 6) + 'px';
                block.style.left = (i * 6) + 'px';
                block.style.zIndex = count - i;
                block.dataset.unit = unit;
                
                if (i === 0) {
                    block.draggable = true;
                    setupDragHandlers(block);
                } else {
                    block.draggable = false;
                    block.style.pointerEvents = 'none';
                }
                
                slot.appendChild(block);
            }
            
            return slot;
        }

        function updateFormula() {
            const formula = document.getElementById('formula');
            let numeratorStr = '';
            let denominatorStr = '';
            
            if (Object.keys(unitStructure.numerator).length === 0) {
                numeratorStr = '1';
            } else {
                Object.entries(unitStructure.numerator).forEach(([unit, count]) => {
                    if (numeratorStr) numeratorStr += '·';
                    numeratorStr += unit;
                    if (count > 1) {
                        numeratorStr += getSuperscript(count);
                    }
                });
            }
            
            Object.entries(unitStructure.denominator).forEach(([unit, count]) => {
                if (denominatorStr) denominatorStr += '·';
                denominatorStr += unit;
                if (count > 1) {
                    denominatorStr += getSuperscript(count);
                }
            });
            
            if (denominatorStr) {
                const denomParts = denominatorStr.split('·').map(part => {
                    const match = part.match(/^(\w+)(.*)/);
                    const unit = match[1];
                    const exp = match[2] || '¹';
                    return unit + '⁻' + exp;
                });
                formula.textContent = numeratorStr + '·' + denomParts.join('·');
            } else {
                formula.textContent = numeratorStr;
            }
        }

        function getSuperscript(n) {
            const superscripts = {
                '1': '¹', '2': '²', '3': '³', '4': '⁴', '5': '⁵',
                '6': '⁶', '7': '⁷', '8': '⁸', '9': '⁹', '0': '⁰'
            };
            return String(n).split('').map(d => superscripts[d]).join('');
        }

        function clearCanvas() {
            unitStructure = {
                numerator: {},
                denominator: {}
            };
            updateDisplay();
        }

        function toggleHelp() {
            const helpDialog = document.getElementById('help-dialog');
            const overlay = document.getElementById('overlay');
            
            helpDialog.classList.toggle('show');
            overlay.classList.toggle('show');
        }
    </script>
</body>
</html>