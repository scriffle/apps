<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Covalent Reaction Simulation</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    /* Top panel with menu and controls */
    #top-panel {
      background: #eee;
      padding: 4px;
      border-bottom: 2px solid #ccc;
    }
    #element-menu {
      display: flex;
      flex-wrap: wrap;
      gap: 3px; /* tighter spacing */
      justify-content: center;
      margin-bottom: 4px;
    }
    .element {
      min-width: 40px; /* narrower */
      padding: 5px;    /* less padding */
      text-align: center;
      font-size: 12px; /* smaller font */
      border: 1px solid #aaa;
      border-radius: 4px;
      background: #f9f9f9;
      cursor: pointer;
    }
    .element:hover {
      background: #ddd;
    }
    #controls {
      text-align: center;
      margin-bottom: 4px;
    }
    #controls button {
      margin: 0 2px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
    }
    /* Reaction info display */
    #reaction-info {
      text-align: center;
      font-size: 12px;
      padding: 4px;
      font-weight: bold;
      min-height: 22px; /* ensures a little space even if empty */
    }
    /* Simulation area */
    #simulation {
      position: relative;
      background: #fafafa;
      height: calc(100vh - 150px);
      overflow: hidden;
      border-top: 1px solid #ccc;
    }
    /* Molecule particle styling */
    .molecule {
      position: absolute;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
      color: #000;
      user-select: none;
      border: 1px solid #888;
    }
  </style>
</head>
<body>
  <div id="top-panel">
    <div id="element-menu">
      <!-- Buttons for 50 covalent compounds will be inserted here by JS -->
    </div>
    <div id="controls">
      <button onclick="removeMolecules()">Remove Molecules</button>
      <button onclick="bondNow()">Bond Now</button>
    </div>
    <div id="reaction-info">
      <em>Select a compound to spawn its reactants.</em>
    </div>
  </div>

  <div id="simulation"></div>

  <script>
    /************************************************************************
     * 1) DEFINE 50 COVALENT COMPOUNDS (name, formula, composition, etc.)
     ************************************************************************/
    const covalentCompounds = [
      {
        name: "Water",
        formula: "H₂O",
        composition: "2H₂ + O₂ → 2H₂O",
        decomposition: "2H₂O → 2H₂ + O₂"
      },
      {
        name: "Carbon Dioxide",
        formula: "CO₂",
        composition: "C + O₂ → CO₂",
        decomposition: "CO₂ → C + O₂"
      },
      {
        name: "Carbon Monoxide",
        formula: "CO",
        composition: "2C + O₂ → 2CO",
        decomposition: "2CO → 2C + O₂"
      },
      {
        name: "Methane",
        formula: "CH₄",
        composition: "C + 2H₂ → CH₄",
        decomposition: "CH₄ → C + 2H₂"
      },
      {
        name: "Ethane",
        formula: "C₂H₆",
        composition: "2C + 3H₂ → C₂H₆",
        decomposition: "C₂H₆ → 2C + 3H₂"
      },
      {
        name: "Propane",
        formula: "C₃H₈",
        composition: "3C + 4H₂ → C₃H₈",
        decomposition: "C₃H₈ → 3C + 4H₂"
      },
      {
        name: "Butane",
        formula: "C₄H₁₀",
        composition: "4C + 5H₂ → C₄H₁₀",
        decomposition: "C₄H₁₀ → 4C + 5H₂"
      },
      {
        name: "Ethylene",
        formula: "C₂H₄",
        composition: "2C + 2H₂ → C₂H₄",
        decomposition: "C₂H₄ → 2C + 2H₂"
      },
      {
        name: "Acetylene",
        formula: "C₂H₂",
        composition: "2C + H₂ → C₂H₂",
        decomposition: "C₂H₂ → 2C + H₂"
      },
      {
        name: "Benzene",
        formula: "C₆H₆",
        composition: "6C + 3H₂ → C₆H₆",
        decomposition: "C₆H₆ → 6C + 3H₂"
      },
      {
        name: "Toluene",
        formula: "C₇H₈",
        composition: "7C + 4H₂ → C₇H₈",
        decomposition: "C₇H₈ → 7C + 4H₂"
      },
      {
        name: "Phenol",
        formula: "C₆H₅OH",
        composition: "12C + 6H₂ + O₂ → 2C₆H₅OH",
        decomposition: "2C₆H₅OH → 12C + 6H₂ + O₂"
      },
      {
        name: "Ethanol",
        formula: "C₂H₅OH",
        composition: "4C + 6H₂ + O₂ → 2C₂H₅OH",
        decomposition: "2C₂H₅OH → 4C + 6H₂ + O₂"
      },
      {
        name: "Methanol",
        formula: "CH₃OH",
        composition: "2C + 4H₂ + O₂ → 2CH₃OH",
        decomposition: "2CH₃OH → 2C + 4H₂ + O₂"
      },
      {
        name: "Formaldehyde",
        formula: "CH₂O",
        composition: "2C + 2H₂ + O₂ → 2CH₂O",
        decomposition: "2CH₂O → 2C + 2H₂ + O₂"
      },
      {
        name: "Acetaldehyde",
        formula: "C₂H₄O",
        composition: "4C + 4H₂ + O₂ → 2C₂H₄O",
        decomposition: "2C₂H₄O → 4C + 4H₂ + O₂"
      },
      {
        name: "Acetone",
        formula: "C₃H₆O",
        composition: "6C + 6H₂ + O₂ → 2C₃H₆O",
        decomposition: "2C₃H₆O → 6C + 6H₂ + O₂"
      },
      {
        name: "Ethyl Acetate",
        formula: "C₄H₈O₂",
        composition: "4C + 4H₂ + O₂ → C₄H₈O₂",
        decomposition: "C₄H₈O₂ → 4C + 4H₂ + O₂"
      },
      {
        name: "Acetic Acid",
        formula: "C₂H₄O₂",
        composition: "2C + 2H₂ + O₂ → C₂H₄O₂",
        decomposition: "C₂H₄O₂ → 2C + 2H₂ + O₂"
      },
      {
        name: "Formic Acid",
        formula: "CH₂O₂",
        composition: "C + H₂ + O₂ → CH₂O₂",
        decomposition: "CH₂O₂ → C + H₂ + O₂"
      },
      {
        name: "Sulfuric Acid",
        formula: "H₂SO₄",
        composition: "S + H₂ + 2O₂ → H₂SO₄",
        decomposition: "H₂SO₄ → S + H₂ + 2O₂"
      },
      {
        name: "Nitric Acid",
        formula: "HNO₃",
        composition: "N₂ + H₂ + 3O₂ → 2HNO₃",
        decomposition: "2HNO₃ → N₂ + H₂ + 3O₂"
      },
      {
        name: "Hydrogen Chloride",
        formula: "HCl",
        composition: "H₂ + Cl₂ → 2HCl",
        decomposition: "2HCl → H₂ + Cl₂"
      },
      {
        name: "Phosphoric Acid",
        formula: "H₃PO₄",
        composition: "2P + 3H₂ + 4O₂ → 2H₃PO₄",
        decomposition: "2H₃PO₄ → 2P + 3H₂ + 4O₂"
      },
      {
        name: "Ammonia",
        formula: "NH₃",
        composition: "N₂ + 3H₂ → 2NH₃",
        decomposition: "2NH₃ → N₂ + 3H₂"
      },
      {
        name: "Urea",
        formula: "CH₄N₂O",
        composition: "2C + 4H₂ + 2N₂ + O₂ → 2CH₄N₂O",
        decomposition: "2CH₄N₂O → 2C + 4H₂ + 2N₂ + O₂"
      },
      {
        name: "Glucose",
        formula: "C₆H₁₂O₆",
        composition: "6C + 6H₂ + 3O₂ → C₆H₁₂O₆",
        decomposition: "C₆H₁₂O₆ → 6C + 6H₂ + 3O₂"
      },
      {
        name: "Sucrose",
        formula: "C₁₂H₂₂O₁₁",
        composition: "24C + 22H₂ + 11O₂ → 2C₁₂H₂₂O₁₁",
        decomposition: "2C₁₂H₂₂O₁₁ → 24C + 22H₂ + 11O₂"
      },
      {
        name: "Fructose",
        formula: "C₆H₁₂O₆",
        composition: "6C + 6H₂ + 3O₂ → C₆H₁₂O₆",
        decomposition: "C₆H₁₂O₆ → 6C + 6H₂ + 3O₂"
      },
      {
        name: "Glycerol",
        formula: "C₃H₈O₃",
        composition: "6C + 8H₂ + 3O₂ → 2C₃H₈O₃",
        decomposition: "2C₃H₈O₃ → 6C + 8H₂ + 3O₂"
      },
      {
        name: "Lactic Acid",
        formula: "C₃H₆O₃",
        composition: "6C + 6H₂ + 3O₂ → 2C₃H₆O₃",
        decomposition: "2C₃H₆O₃ → 6C + 6H₂ + 3O₂"
      },
      {
        name: "Citric Acid",
        formula: "C₆H₈O₇",
        composition: "12C + 8H₂ + 7O₂ → 2C₆H₈O₇",
        decomposition: "2C₆H₈O₇ → 12C + 8H₂ + 7O₂"
      },
      {
        name: "Stearic Acid",
        formula: "C₁₈H₃₆O₂",
        composition: "18C + 18H₂ + O₂ → C₁₈H₃₆O₂",
        decomposition: "C₁₈H₃₆O₂ → 18C + 18H₂ + O₂"
      },
      {
        name: "Aspirin",
        formula: "C₉H₈O₄",
        composition: "9C + 4H₂ + 2O₂ → C₉H₈O₄",
        decomposition: "C₉H₈O₄ → 9C + 4H₂ + 2O₂"
      },
      {
        name: "Carbon Tetrachloride",
        formula: "CCl₄",
        composition: "C + 2Cl₂ → CCl₄",
        decomposition: "CCl₄ → C + 2Cl₂"
      },
      {
        name: "Chloroform",
        formula: "CHCl₃",
        composition: "2C + H₂ + 3Cl₂ → 2CHCl₃",
        decomposition: "2CHCl₃ → 2C + H₂ + 3Cl₂"
      },
      {
        name: "Dichloromethane",
        formula: "CH₂Cl₂",
        composition: "C + H₂ + Cl₂ → CH₂Cl₂",
        decomposition: "CH₂Cl₂ → C + H₂ + Cl₂"
      },
      {
        name: "Tetrachloroethene",
        formula: "C₂Cl₄",
        composition: "2C + 2Cl₂ → C₂Cl₄",
        decomposition: "C₂Cl₄ → 2C + 2Cl₂"
      },
      {
        name: "Hydrofluoric Acid",
        formula: "HF",
        composition: "H₂ + F₂ → 2HF",
        decomposition: "2HF → H₂ + F₂"
      },
      {
        name: "Hydrogen Peroxide",
        formula: "H₂O₂",
        composition: "2H₂ + 2O₂ → 2H₂O₂",
        decomposition: "2H₂O₂ → 2H₂ + 2O₂"
      },
      {
        name: "Carbon Disulfide",
        formula: "CS₂",
        composition: "C + 2S → CS₂",
        decomposition: "CS₂ → C + 2S"
      },
      {
        name: "Carbonyl Sulfide",
        formula: "COS",
        composition: "2C + O₂ + 2S → 2COS",
        decomposition: "2COS → 2C + O₂ + 2S"
      },
      {
        name: "Carbonic Acid",
        formula: "H₂CO₃",
        composition: "2C + 2H₂ + 3O₂ → 2H₂CO₃",
        decomposition: "2H₂CO₃ → 2C + 2H₂ + 3O₂"
      },
      {
        name: "Phosphine",
        formula: "PH₃",
        composition: "2P + 3H₂ → 2PH₃",
        decomposition: "2PH₃ → 2P + 3H₂"
      },
      {
        name: "Hydrogen Sulfide",
        formula: "H₂S",
        composition: "H₂ + S → H₂S",
        decomposition: "H₂S → H₂ + S"
      },
      {
        name: "Sulfur Dioxide",
        formula: "SO₂",
        composition: "S + O₂ → SO₂",
        decomposition: "SO₂ → S + O₂"
      },
      {
        name: "Sulfur Trioxide",
        formula: "SO₃",
        composition: "2S + 3O₂ → 2SO₃",
        decomposition: "2SO₃ → 2S + 3O₂"
      },
      {
        name: "Nitrous Oxide",
        formula: "N₂O",
        composition: "2N₂ + O₂ → 2N₂O",
        decomposition: "2N₂O → 2N₂ + O₂"
      },
      {
        name: "Nitrogen Dioxide",
        formula: "NO₂",
        composition: "N₂ + 2O₂ → 2NO₂",
        decomposition: "2NO₂ → N₂ + 2O₂"
      },
      {
        name: "Sulfur Hexafluoride",
        formula: "SF₆",
        composition: "S + 3F₂ → SF₆",
        decomposition: "SF₆ → S + 3F₂"
      }
    ];

    /************************************************************************
     * 2) DEFINE BASIC ELEMENTAL "BUILDING BLOCKS" WE WILL SPAWN
     *    (like H2, O2, N2, C, S, Cl2, F2, P, etc.)
     *    This is not exhaustive, but covers what's needed to spawn reactants
     ************************************************************************/
    const elementData = {
      "H2":  { name: "Hydrogen",    color: "#f8f8f8", mass: 2,  radius: 16 },
      "O2":  { name: "Oxygen",      color: "#ffb3b3", mass: 32, radius: 16 },
      "N2":  { name: "Nitrogen",    color: "#add8e6", mass: 28, radius: 16 },
      "Cl2": { name: "Chlorine",    color: "#d3ffd3", mass: 70, radius: 16 },
      "F2":  { name: "Fluorine",    color: "#e0ffff", mass: 38, radius: 16 },
      "C":   { name: "Carbon",      color: "#cccccc", mass: 12, radius: 16 },
      "S":   { name: "Sulfur",      color: "#ffffcc", mass: 32, radius: 16 },
      "P":   { name: "Phosphorus",  color: "#ffccee", mass: 31, radius: 16 },
      // ... etc. Add more if you like. This suffices for the 50 compositions.
    };

    /************************************************************************
     * 3) CREATE THE BUTTONS & CLICK HANDLERS
     ************************************************************************/
    const elementMenuDiv = document.getElementById("element-menu");
    const infoDiv = document.getElementById("reaction-info");
    const simulationArea = document.getElementById("simulation");

    // Generate a button for each covalent compound (50 total)
    function initCompoundButtons() {
      covalentCompounds.forEach((cmp) => {
        const btn = document.createElement("div");
        btn.className = "element";
        // More compact label
        btn.innerHTML = `<strong>${cmp.formula}</strong><br><small>${cmp.name}</small>`;
        btn.onclick = () => spawnReactants(cmp);
        elementMenuDiv.appendChild(btn);
      });
    }

    // On compound button click:
    // 1) Display info,
    // 2) Parse composition & spawn those reactants in the simulation area.
    function spawnReactants(compound) {
      // Show composition / decomposition
      infoDiv.innerHTML = `
        <div style="margin-bottom:3px;">
          <strong>${compound.name} (${compound.formula})</strong>
        </div>
        <div>Composition: ${compound.composition}</div>
      `;

      // Parse the left side of the reaction, e.g. "2H₂ + O₂" from "2H₂ + O₂ → 2H₂O"
      const arrowIndex = compound.composition.indexOf("→");
      if (arrowIndex < 0) return; // sanity check
      const leftSide = compound.composition.substring(0, arrowIndex).trim();
      
      const reactantsArray = parseReactants(leftSide); // e.g. [ { formula:'H2', count:2 }, { formula:'O2', count:1 } ]
      // For each reactant, spawn `count` molecules in the simulation
      reactantsArray.forEach(r => {
        for (let i=0; i<r.count; i++){
          addMolecule(r.formula);
        }
      });
    }

    /************************************************************************
     * 4) PARSE COMPOSITION REACTANTS (E.G. "2H₂ + O₂") -> ARR OF {formula, count}
     ************************************************************************/
    function parseReactants(str) {
      // Example input: "2H₂ + O₂"
      // 1) Split by "+" => ["2H₂", "O₂"]
      // 2) For each piece, parse out the leading integer (count) if present
      // 3) Convert e.g. "H₂" => "H2"
      const parts = str.split("+").map(p => p.trim()).filter(Boolean);
      const reactants = [];

      // Some quick replacements for subscripts => normal digits
      // We'll do these repeatedly to handle e.g. H₂ => H2, Cl₂ => Cl2, etc.
      function normalizeFormula(formula) {
        return formula
          .replace(/₀/g, "0")
          .replace(/₁/g, "1")
          .replace(/₂/g, "2")
          .replace(/₃/g, "3")
          .replace(/₄/g, "4")
          .replace(/₅/g, "5")
          .replace(/₆/g, "6")
          .replace(/₇/g, "7")
          .replace(/₈/g, "8")
          .replace(/₉/g, "9");
      }

      parts.forEach(p => {
        // Strip leading coefficient
        // E.g. "2H₂" => count=2, remainder="H₂"
        // or "O₂" => count=1, remainder="O₂"
        let match = p.match(/^(\d+)([A-Za-z0-9₀-₉]+)/);
        let count = 1;
        let formulaPart = p;
        if (match) {
          count = parseInt(match[1],10);
          formulaPart = match[2];
        } else {
          // Another possibility: no digit, just something like "C" or "O₂"
          // We might also see something like "10C" => match above would handle that
          // If no match, see if it starts with a letter
          match = p.match(/^([A-Za-z0-9₀-₉]+)/);
          if (match) {
            formulaPart = match[1];
          }
        }
        formulaPart = normalizeFormula(formulaPart);
        reactants.push({ formula: formulaPart, count });
      });
      return reactants;
    }

    /************************************************************************
     * 5) SIMULATION LOGIC
     ************************************************************************/
    // We'll store all molecules in this array
    let molecules = [];

    // Reaction mapping (pairwise only).
    // Add more if you want more collisions to produce products.
    const reactionMapping = {
      "H2+O2":  { product: "H2O", name: "Water", activationEnergy: 0.15, reactionEnergy: -1.0 },
      "H2+Cl2": { product: "HCl", name: "Hydrogen Chloride", activationEnergy: 0.12, reactionEnergy: -0.8 },
      "N2+H2":  { product: "NH3", name: "Ammonia", activationEnergy: 0.20, reactionEnergy: -1.2 },
      "Cl2+F2": { product: "ClF", name: "Chlorine Monofluoride", activationEnergy: 0.18, reactionEnergy: -0.9 }
    };

    // Add a molecule (by formula) to the simulation area
    function addMolecule(formula) {
      // Look up element data
      const data = elementData[formula];
      if (!data) {
        console.warn("No element data defined for:", formula);
        return;
      }
      const mol = {
        formula: formula,
        name: data.name,
        mass: data.mass,
        color: data.color,
        radius: data.radius,
        x: Math.random() * (simulationArea.clientWidth - data.radius*2),
        y: Math.random() * (simulationArea.clientHeight - data.radius*2),
        vx: (Math.random() - 0.5) * 2,
        vy: (Math.random() - 0.5) * 2
      };
      const div = document.createElement("div");
      div.className = "molecule";
      div.style.backgroundColor = mol.color;
      div.style.left = mol.x + "px";
      div.style.top = mol.y + "px";
      div.innerHTML = mol.formula;
      simulationArea.appendChild(div);
      mol.elem = div;
      molecules.push(mol);
    }

    // Simple physics update
    function updateSimulation() {
      molecules.forEach(mol => {
        // Gravity-like effect
        mol.x += mol.vx;
        mol.y += mol.vy + 0.05;
        // Boundary collisions
        if (mol.x < 0) {
          mol.x = 0; mol.vx *= -1;
        }
        if (mol.x + mol.radius*2 > simulationArea.clientWidth) {
          mol.x = simulationArea.clientWidth - mol.radius*2;
          mol.vx *= -1;
        }
        if (mol.y < 0) {
          mol.y = 0; mol.vy *= -1;
        }
        if (mol.y + mol.radius*2 > simulationArea.clientHeight) {
          mol.y = simulationArea.clientHeight - mol.radius*2;
          mol.vy *= -1;
        }
        // Update DOM
        mol.elem.style.left = mol.x + "px";
        mol.elem.style.top = mol.y + "px";
      });
      checkCollisions();
      requestAnimationFrame(updateSimulation);
    }

    // Check for collisions (pairwise)
    function checkCollisions() {
      for (let i = 0; i < molecules.length; i++) {
        for (let j = i + 1; j < molecules.length; j++) {
          const molA = molecules[i];
          const molB = molecules[j];
          const dx = (molA.x + molA.radius) - (molB.x + molB.radius);
          const dy = (molA.y + molA.radius) - (molB.y + molB.radius);
          const dist = Math.sqrt(dx*dx + dy*dy);
          if (dist < molA.radius + molB.radius) {
            attemptReaction(molA, molB);
          }
        }
      }
    }

    // Attempt a reaction if one is defined
    function attemptReaction(molA, molB) {
      const formulas = [molA.formula, molB.formula].sort();
      const key = formulas.join("+");
      if (reactionMapping[key]) {
        const rxn = reactionMapping[key];
        const totalKE = kineticEnergy(molA) + kineticEnergy(molB);
        if (totalKE < rxn.activationEnergy) {
          formCompound(molA, molB, rxn);
          return;
        }
      }
      // Otherwise, just bounce off each other
      bounce(molA, molB);
    }

    function kineticEnergy(mol) {
      // For simplicity, treat mass ~ 1
      return 0.5 * (mol.vx*mol.vx + mol.vy*mol.vy);
    }

    function bounce(molA, molB) {
      const tmpVx = molA.vx; const tmpVy = molA.vy;
      molA.vx = molB.vx;     molA.vy = molB.vy;
      molB.vx = tmpVx;       molB.vy = tmpVy;
    }

    function formCompound(molA, molB, rxn) {
      // Remove the reactants
      simulationArea.removeChild(molA.elem);
      simulationArea.removeChild(molB.elem);
      molecules = molecules.filter(m => m !== molA && m !== molB);

      // Create the product
      const product = {
        formula: rxn.product,
        name: rxn.name,
        mass: (molA.mass + molB.mass)*0.9,
        color: blendColors(molA.color, molB.color),
        radius: 20,
        x: (molA.x + molB.x)/2,
        y: (molA.y + molB.y)/2,
        vx: (molA.vx + molB.vx)/2,
        vy: (molA.vy + molB.vy)/2
      };
      const div = document.createElement("div");
      div.className = "molecule";
      div.style.backgroundColor = product.color;
      div.style.left = product.x + "px";
      div.style.top = product.y + "px";
      div.innerHTML = product.formula;
      simulationArea.appendChild(div);
      product.elem = div;
      molecules.push(product);

      console.log(`Formed ${rxn.name} (${rxn.product})`);
    }

    // Blend two hex colors (simple average)
    function blendColors(c1, c2) {
      function hexToRgb(hex) {
        hex = hex.replace("#","");
        return {
          r: parseInt(hex.substring(0,2),16),
          g: parseInt(hex.substring(2,4),16),
          b: parseInt(hex.substring(4,6),16)
        };
      }
      function rgbToHex(r, g, b) {
        return "#" + [r,g,b].map(x => {
          const h = x.toString(16);
          return (h.length===1 ? "0"+h : h);
        }).join("");
      }
      const rgb1 = hexToRgb(c1), rgb2 = hexToRgb(c2);
      const r = Math.round((rgb1.r + rgb2.r)/2);
      const g = Math.round((rgb1.g + rgb2.g)/2);
      const b = Math.round((rgb1.b + rgb2.b)/2);
      return rgbToHex(r,g,b);
    }

    /************************************************************************
     * 6) CONTROL BUTTONS
     ************************************************************************/
    function removeMolecules() {
      molecules.forEach(m => simulationArea.removeChild(m.elem));
      molecules = [];
    }

    // Force a reaction attempt among all
    function bondNow() {
      for (let i=0; i<molecules.length; i++){
        for (let j=i+1; j<molecules.length; j++){
          attemptReaction(molecules[i], molecules[j]);
        }
      }
    }

    /************************************************************************
     * 7) INIT
     ************************************************************************/
    // Build the 50 compound buttons
    initCompoundButtons();

    // Start the simulation loop
    updateSimulation();

  </script>
</body>
</html>
