<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photoelectric Effect Prediction Worksheet</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
            text-align: center;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 30px;
        }
        h3 {
            color: #666;
            margin-top: 20px;
        }
        .info-box {
            background-color: #f0f8ff;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        th {
            background-color: #4CAF50;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        input[type="text"] {
            width: 90%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        select {
            width: 90%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            background-color: white;
        }
        .color-red { background-color: #ffcccc; }
        .color-orange { background-color: #ffe0cc; }
        .color-yellow { background-color: #ffffcc; }
        .color-green { background-color: #ccffcc; }
        .color-blue { background-color: #ccccff; }
        .question-box {
            background-color: #fff9e6;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 20px 0;
        }
        .answer-space {
            width: 100%;
            min-height: 60px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            margin-top: 10px;
        }
        .data-table {
            max-width: 600px;
            margin: 20px auto;
        }
        .graph-container {
            width: 100%;
            max-width: 800px;
            margin: 30px auto;
            background-color: white;
            border: 2px solid #333;
            padding: 20px;
            position: relative;
        }
        #photoelectricChart {
            max-height: 400px;
        }
        
        /* Slide-in tab panel styles */
        .slide-panel {
            position: fixed;
            top: 100px;
            right: -300px;
            width: 300px;
            background-color: #f0f0f0;
            box-shadow: -2px 0 8px rgba(0,0,0,0.3);
            transition: right 0.3s ease;
            z-index: 1000;
            border-radius: 8px 0 0 8px;
            border: 1px solid #ccc;
        }
        
        .slide-panel.open {
            right: 0;
        }
        
        .panel-tab {
            display: none;
        }
        
        .panel-content {
            padding: 20px;
        }
        
        .mode-button, .show-model-button, .clear-button {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .mode-button.active {
            background-color: #4CAF50;
            color: white;
        }
        
        .mode-button:not(.active) {
            background-color: #ddd;
            color: #333;
        }
        
        .mode-button:hover:not(:disabled) {
            opacity: 0.8;
        }
        
        .mode-button:disabled, .show-model-button:disabled {
            background-color: #ccc !important;
            color: #666 !important;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .feedback-correct {
            background-color: #d4edda !important;
            border: 2px solid #28a745 !important;
        }
        .feedback-incorrect {
            background-color: #f8d7da !important;
            border: 2px solid #dc3545 !important;
        }
        .feedback-close {
            background-color: #fff3cd !important;
            border: 2px solid #ffc107 !important;
        }
        .model-answer {
            display: none;
            font-size: 12px;
            color: #0066cc;
            margin-top: 5px;
            padding: 8px;
            background-color: #e7f3ff;
            border-radius: 4px;
        }
        .feedback-mode .model-answer {
            display: block;
        }
        .clear-button {
            background-color: #ff4444;
            color: white;
        }
        .clear-button:hover {
            background-color: #cc0000;
        }
        
        /* Fixed clear button at bottom right */
        .fixed-clear-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #ff4444;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            z-index: 999;
            transition: all 0.3s;
        }
        
        .fixed-clear-button:hover {
            background-color: #cc0000;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }
        
        .fixed-clear-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .show-model-button {
            background-color: #007bff;
            color: white;
        }
        .show-model-button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        
        .timer-display {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #ff6b6b;
            margin: 10px 0;
            padding: 10px;
            background-color: #fff5f5;
            border-radius: 4px;
            border: 1px solid #ffcccc;
        }
        
        .timer-display.ready {
            color: #4CAF50;
            background-color: #f0fff4;
            border-color: #b8e6b8;
        }
        
        @media print {
            body {
                max-width: 100%;
            }
            .info-box {
                break-inside: avoid;
            }
            table {
                break-inside: avoid;
            }
            .slide-panel {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Floating Control Button - Always Visible -->
    <button class="floating-control-btn" onclick="togglePanel()" style="
        position: fixed;
        top: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 24px;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        z-index: 1001;
        transition: all 0.3s;
    " onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">☰</button>

    <div class="slide-panel" id="controlPanel">
        <div class="panel-content">
            <h4 style="margin-top: 0;">Mode Selection</h4>
            <div class="timer-display" id="timerDisplay">
                Feedback available in: <span id="timeRemaining">5:00</span>
            </div>
            <button class="show-model-button" id="modelDataBtn" onclick="showModelData()" disabled>Show Model Data</button>
        </div>
    </div>

    <button class="fixed-clear-button" onclick="clearAllData()">Clear All Data</button>

    <h1>Photoelectric Effect Prediction Worksheet</h1>
    
    <div class="info-box">
        <p><strong>Name:</strong> <input type="text" id="student-name" style="width: 300px; display: inline-block;" placeholder="Enter your name" data-persist="true"> 
           <strong>Class:</strong> <input type="text" id="student-class" style="width: 150px; display: inline-block;" placeholder="Enter class" data-persist="true"> 
           <strong>Date:</strong> <input type="text" id="student-date" style="width: 150px; display: inline-block;" placeholder="Enter date" data-persist="true"></p>
        <p><strong>Instructions:</strong> Before conducting the photoelectric effect experiment, predict the stop voltage and photocurrent for each combination of light color and intensity. Consider how the frequency of light and intensity affect these measurements.</p>
    </div>

    <h2>Pre-Lab Questions</h2>
    <div class="question-box">
        <p><strong>1. What is the relationship between light color and frequency? Rank the colors from lowest to highest frequency:</strong></p>
        <textarea class="answer-space" id="q1" data-persist="true" data-model="Red, Orange, Yellow, Green, Blue (ROYGB - frequency increases from red to blue)"></textarea>
        <div class="model-answer">Model Answer: Red, Orange, Yellow, Green, Blue (ROYGB - frequency increases from red to blue)</div>
    </div>
    
    <div class="question-box">
        <p><strong>2. How do you expect the stop voltage to change as you go from red light to blue light? Explain why:</strong></p>
        <textarea class="answer-space" id="q2" data-persist="true" data-model="Stop voltage should increase from red to blue because higher frequency light has more energy per photon (E = hf), requiring a larger negative voltage to stop the photoelectrons."></textarea>
        <div class="model-answer">Model Answer: Stop voltage should increase from red to blue because higher frequency light has more energy per photon (E = hf), requiring a larger negative voltage to stop the photoelectrons.</div>
    </div>
    
    <div class="question-box">
        <p><strong>3. What effect should changing the intensity have on (a) the stop voltage and (b) the photocurrent? Explain:</strong></p>
        <textarea class="answer-space" id="q3" data-persist="true" data-model="(a) Stop voltage: No effect - determined by frequency only. (b) Photocurrent: Increases with intensity - more photons means more electrons ejected."></textarea>
        <div class="model-answer">Model Answer: (a) Stop voltage: No effect - determined by frequency only. (b) Photocurrent: Increases with intensity - more photons means more electrons ejected.</div>
    </div>

    <h2>Prediction Tables</h2>
    
    <h3>Table 1: Stop Voltage Predictions (V)</h3>
    <p style="color: #666; font-style: italic;">Expected range: 0.1V to 1.5V (higher frequency light typically produces higher stop voltage)</p>
    <table id="voltage-predictions">
        <tr>
            <th>Light Color</th>
            <th>Low Intensity</th>
            <th>Medium Intensity</th>
            <th>High Intensity</th>
        </tr>
        <tr>
            <td class="color-red"><strong>Red</strong></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.3"></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.3"></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.3"></td>
        </tr>
        <tr>
            <td class="color-orange"><strong>Orange</strong></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.5"></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.5"></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.5"></td>
        </tr>
        <tr>
            <td class="color-yellow"><strong>Yellow</strong></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.6"></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.6"></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.6"></td>
        </tr>
        <tr>
            <td class="color-green"><strong>Green</strong></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.9"></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.9"></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="0.9"></td>
        </tr>
        <tr>
            <td class="color-blue"><strong>Blue</strong></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="1.3"></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="1.3"></td>
            <td><input type="text" placeholder="Predict V" data-persist="true" data-model="1.3"></td>
        </tr>
    </table>
    <div class="model-answer">Model Note: Stop voltage should be the same for all intensities of the same color, as it depends only on frequency, not intensity.</div>

    <h3>Table 2: Photocurrent Predictions</h3>
    <table id="current-predictions">
        <tr>
            <th>Intensity Level</th>
            <th class="color-red">Red</th>
            <th class="color-orange">Orange</th>
            <th class="color-yellow">Yellow</th>
            <th class="color-green">Green</th>
            <th class="color-blue">Blue</th>
        </tr>
        <tr>
            <td><strong>Low</strong></td>
            <td>
                <select data-persist="true" data-model="low">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="low">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="low">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="low">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="low">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
        </tr>
        <tr>
            <td><strong>Medium</strong></td>
            <td>
                <select data-persist="true" data-model="medium">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="medium">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="medium">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="medium">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="medium">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
        </tr>
        <tr>
            <td><strong>High</strong></td>
            <td>
                <select data-persist="true" data-model="high">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="high">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="high">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="high">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
            <td>
                <select data-persist="true" data-model="high">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </td>
        </tr>
    </table>
    <div class="model-answer">Model Note: Photocurrent increases proportionally with intensity (more photons = more electrons). Each row should have the same current level across all colors.</div>

    <h2>Experimental Data</h2>
    
    <h3>Table 3: Actual Measured Values</h3>
    <table class="data-table">
        <tr>
            <th>Light Color</th>
            <th>Wavelength λ (nm)</th>
            <th>Frequency f (×10¹⁴ Hz)</th>
            <th>Stop Voltage V<sub>stop</sub> (V)</th>
        </tr>
        <tr>
            <td class="color-red"><strong>Red</strong></td>
            <td>660</td>
            <td>4.55</td>
            <td><input type="text" id="vstop-red" placeholder="Enter V" data-persist="true" data-model="0.31" onchange="updateGraph()"></td>
        </tr>
        <tr>
            <td class="color-orange"><strong>Orange</strong></td>
            <td>605</td>
            <td>4.96</td>
            <td><input type="text" id="vstop-orange" placeholder="Enter V" data-persist="true" data-model="0.48" onchange="updateGraph()"></td>
        </tr>
        <tr>
            <td class="color-yellow"><strong>Yellow</strong></td>
            <td>590</td>
            <td>5.08</td>
            <td><input type="text" id="vstop-yellow" placeholder="Enter V" data-persist="true" data-model="0.53" onchange="updateGraph()"></td>
        </tr>
        <tr>
            <td class="color-green"><strong>Green</strong></td>
            <td>525</td>
            <td>5.71</td>
            <td><input type="text" id="vstop-green" placeholder="Enter V" data-persist="true" data-model="0.89" onchange="updateGraph()"></td>
        </tr>
        <tr>
            <td class="color-blue"><strong>Blue</strong></td>
            <td>470</td>
            <td>6.38</td>
            <td><input type="text" id="vstop-blue" placeholder="Enter V" data-persist="true" data-model="1.27" onchange="updateGraph()"></td>
        </tr>
    </table>
    <div class="model-answer">Model Note: These values correspond to a sodium photocathode with work function ~1.82 eV. The linear relationship demonstrates E = hf - Φ.</div>

    <h2>Graph: Frequency vs. Stop Voltage</h2>
    <div class="graph-container">
        <canvas id="photoelectricChart"></canvas>
        <p style="margin-top: 20px;"><strong>Instructions:</strong> The graph updates automatically as you enter stop voltage values. The line of best fit is calculated and extended to show the y-intercept, which represents -Φ/e.</p>
        
        <div class="info-box" style="margin-top: 20px;">
            <p><strong>From your graph, determine:</strong></p>
            <p>Y-intercept = <input type="text" id="y-intercept" style="width: 100px; display: inline-block;" placeholder="Value" data-persist="true" data-model="-1.82"> V</p>
            <p>Work function Φ = <input type="text" id="work-function" style="width: 100px; display: inline-block;" placeholder="Value" data-persist="true" data-model="1.82"> eV</p>
            <p>Threshold frequency f₀ = <input type="text" id="threshold-freq" style="width: 100px; display: inline-block;" placeholder="Value" data-persist="true" data-model="4.4"> × 10¹⁴ Hz</p>
            <p>Slope of line = <input type="text" id="slope" style="width: 100px; display: inline-block;" placeholder="Value" data-persist="true" data-model="4.14"> × 10⁻¹⁵ V·s</p>
            <p style="margin-top: 10px;"><em>Note: The slope should equal h/e = 4.14 × 10⁻¹⁵ V·s, where h is Planck's constant and e is the elementary charge.</em></p>
        </div>
        <div class="model-answer">
            Model Calculation:
            <br>• Y-intercept = -1.82 V (from graph extrapolation)
            <br>• Work function Φ = 1.82 eV (since Φ = -e × y-intercept)
            <br>• Threshold frequency f₀ = 4.4 × 10¹⁴ Hz (x-intercept where V_stop = 0)
            <br>• Slope = 4.14 × 10⁻¹⁵ V·s (this equals h/e, confirming Einstein's equation)
        </div>
    </div>

    <script>
        // Initialize persistence system
        let currentMode = 'entry';
        let photoelectricChart = null;
        let startTime = null;
        let timerInterval = null;
        let keysPressed = {};
        
        // Load saved data on page load
        window.addEventListener('load', function() {
            loadAllData();
            attachEventListeners();
            initializeGraph();
            updateGraph();
            initializeTimer();
            setupSecretKeys();
        });

        function setupSecretKeys() {
            // Track key presses for Q+W+E secret combination
            window.addEventListener('keydown', function(e) {
                keysPressed[e.key.toLowerCase()] = true;
                
                // Check if Q, W, and E are all pressed
                if (keysPressed['q'] && keysPressed['w'] && keysPressed['e']) {
                    // Immediately enable model data
                    document.getElementById('modelDataBtn').disabled = false;
                    
                    const timerDisplay = document.getElementById('timerDisplay');
                    timerDisplay.innerHTML = '<span style="color: #4CAF50;">✓ Secret Access Granted!</span>';
                    timerDisplay.classList.add('ready');
                    
                    // Clear the timer
                    if (timerInterval) {
                        clearInterval(timerInterval);
                    }
                    
                    // Optional: Auto-show model data
                    setTimeout(() => {
                        showModelData();
                        setMode('feedback');
                    }, 500);
                }
            });
            
            window.addEventListener('keyup', function(e) {
                keysPressed[e.key.toLowerCase()] = false;
            });
        }

        function togglePanel() {
            const panel = document.getElementById('controlPanel');
            panel.classList.toggle('open');
        }

        function initializeTimer() {
            // Check if timer has already been started
            const savedStartTime = localStorage.getItem('photoelectric_timer_start');
            const timerActive = localStorage.getItem('photoelectric_timer_active');
            
            if (savedStartTime && timerActive === 'true') {
                startTime = parseInt(savedStartTime);
            } else {
                // Timer not started yet - don't start until user begins entering data
                startTime = null;
            }
            
            if (startTime) {
                updateTimer();
                timerInterval = setInterval(updateTimer, 1000);
            } else {
                // Show timer as not started
                const timerDisplay = document.getElementById('timerDisplay');
                timerDisplay.innerHTML = 'Timer will start when you begin entering data';
                timerDisplay.classList.remove('ready');
            }
        }
        
        function startTimerIfNeeded() {
            if (!startTime) {
                startTime = Date.now();
                localStorage.setItem('photoelectric_timer_start', startTime);
                localStorage.setItem('photoelectric_timer_active', 'true');
                updateTimer();
                timerInterval = setInterval(updateTimer, 1000);
            }
        }

        function updateTimer() {
            const now = Date.now();
            const elapsed = now - startTime;
            const fiveMinutes = 5 * 60 * 1000; // 5 minutes in milliseconds
            const remaining = Math.max(0, fiveMinutes - elapsed);
            
            const minutes = Math.floor(remaining / 60000);
            const seconds = Math.floor((remaining % 60000) / 1000);
            
            const timerDisplay = document.getElementById('timerDisplay');
            const timeRemaining = document.getElementById('timeRemaining');
            
            if (remaining > 0) {
                timerDisplay.innerHTML = `Model answers available in: <span id="timeRemaining">${minutes}:${seconds.toString().padStart(2, '0')}</span>`;
                timerDisplay.classList.remove('ready');
                document.getElementById('modelDataBtn').disabled = true;
            } else {
                timerDisplay.innerHTML = '<span style="color: #4CAF50;">✓ Model Answers Available!</span>';
                timerDisplay.classList.add('ready');
                document.getElementById('modelDataBtn').disabled = false;
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
            }
        }

        function attachEventListeners() {
            // Attach change event listeners to all inputs and textareas with data-persist
            const persistElements = document.querySelectorAll('[data-persist="true"]');
            persistElements.forEach(element => {
                element.addEventListener('input', function() {
                    saveData(this);
                    startTimerIfNeeded(); // Start timer on first input
                });
                element.addEventListener('change', function() {
                    saveData(this);
                    startTimerIfNeeded(); // Start timer on first input
                });
            });
        }

        function saveData(element) {
            const key = element.id || generateKey(element);
            const value = element.value;
            localStorage.setItem(`photoelectric_${key}`, value);
        }

        function loadAllData() {
            const persistElements = document.querySelectorAll('[data-persist="true"]');
            persistElements.forEach(element => {
                const key = element.id || generateKey(element);
                const savedValue = localStorage.getItem(`photoelectric_${key}`);
                if (savedValue !== null) {
                    element.value = savedValue;
                }
            });
        }

        function generateKey(element) {
            // Generate a unique key based on element position
            const parent = element.closest('tr');
            const table = element.closest('table');
            if (parent && table) {
                const rowIndex = Array.from(table.querySelectorAll('tr')).indexOf(parent);
                const cellIndex = Array.from(parent.querySelectorAll('input, textarea, select')).indexOf(element);
                return `${table.id}_r${rowIndex}_c${cellIndex}`;
            }
            return `element_${Math.random().toString(36).substr(2, 9)}`;
        }

        function setMode(mode) {
            currentMode = mode;
            
            if (mode === 'feedback') {
                document.body.classList.add('feedback-mode');
                applyFeedback();
            } else {
                document.body.classList.remove('feedback-mode');
                clearFeedback();
            }
        }

        function applyFeedback() {
            const inputs = document.querySelectorAll('[data-model]');
            inputs.forEach(input => {
                const userValue = input.value.trim();
                const modelValue = input.getAttribute('data-model');
                
                if (userValue === '') {
                    input.classList.remove('feedback-correct', 'feedback-incorrect', 'feedback-close');
                    return;
                }

                // For text answers (questions)
                if (input.tagName === 'TEXTAREA') {
                    // Simple check - could be enhanced with more sophisticated comparison
                    if (userValue.toLowerCase().includes('frequency') || userValue.toLowerCase().includes('energy')) {
                        input.classList.add('feedback-close');
                    } else {
                        input.classList.add('feedback-incorrect');
                    }
                } else if (input.tagName === 'SELECT') {
                    // For dropdown selections
                    if (userValue === modelValue) {
                        input.classList.add('feedback-correct');
                    } else {
                        input.classList.add('feedback-incorrect');
                    }
                } else {
                    // For numerical values
                    const userNum = parseFloat(userValue);
                    const modelNum = parseFloat(modelValue);
                    
                    if (!isNaN(userNum) && !isNaN(modelNum)) {
                        const percentDiff = Math.abs((userNum - modelNum) / modelNum) * 100;
                        
                        if (percentDiff < 5) {
                            input.classList.add('feedback-correct');
                        } else if (percentDiff < 20) {
                            input.classList.add('feedback-close');
                        } else {
                            input.classList.add('feedback-incorrect');
                        }
                    }
                }
            });
        }

        function clearFeedback() {
            const inputs = document.querySelectorAll('[data-model]');
            inputs.forEach(input => {
                input.classList.remove('feedback-correct', 'feedback-incorrect', 'feedback-close');
            });
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This will also reset the timer.')) {
                // Clear localStorage
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.startsWith('photoelectric_')) {
                        localStorage.removeItem(key);
                    }
                });
                
                // Clear all input fields
                const inputs = document.querySelectorAll('[data-persist="true"]');
                inputs.forEach(input => {
                    input.value = '';
                });
                
                // Clear feedback
                clearFeedback();
                
                // Reset timer
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                startTime = null;
                initializeTimer();
                
                // Update graph
                updateGraph();
                
                // Reset mode to entry
                setMode('entry');
            }
        }

        function showModelData() {
            const inputs = document.querySelectorAll('[data-model]');
            inputs.forEach(input => {
                const modelValue = input.getAttribute('data-model');
                if (modelValue) {
                    input.value = modelValue;
                    saveData(input);
                }
            });
            updateGraph();
        }

        function initializeGraph() {
            const ctx = document.getElementById('photoelectricChart').getContext('2d');
            photoelectricChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Experimental Data',
                        data: [],
                        backgroundColor: 'rgba(255, 99, 132, 1)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        pointRadius: 8,
                        pointHoverRadius: 10
                    }, {
                        label: 'Best Fit Line',
                        data: [],
                        type: 'line',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Frequency f (×10¹⁴ Hz)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            min: 0,
                            max: 8,
                            ticks: {
                                stepSize: 1
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Stop Voltage V_stop (V)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            min: -2.5,
                            max: 2,
                            ticks: {
                                stepSize: 0.5
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `(${context.parsed.x.toFixed(2)}, ${context.parsed.y.toFixed(2)})`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateGraph() {
            const frequencies = [4.55, 4.96, 5.08, 5.71, 6.38];
            const colors = ['red', 'orange', 'yellow', 'green', 'blue'];
            const dataPoints = [];
            
            colors.forEach((color, index) => {
                const vstopInput = document.getElementById(`vstop-${color}`);
                if (vstopInput && vstopInput.value) {
                    const vstop = parseFloat(vstopInput.value);
                    if (!isNaN(vstop)) {
                        dataPoints.push({
                            x: frequencies[index],
                            y: vstop
                        });
                    }
                }
            });
            
            // Update experimental data
            photoelectricChart.data.datasets[0].data = dataPoints;
            
            // Calculate best fit line if we have at least 2 points
            if (dataPoints.length >= 2) {
                const { slope, intercept } = calculateLinearRegression(dataPoints);
                
                // Create line data extending to show y-intercept
                const lineData = [
                    { x: 0, y: intercept },
                    { x: 8, y: slope * 8 + intercept }
                ];
                
                photoelectricChart.data.datasets[1].data = lineData;
                
                // Update calculated values
                document.getElementById('y-intercept').value = intercept.toFixed(2);
                document.getElementById('work-function').value = Math.abs(intercept).toFixed(2);
                document.getElementById('threshold-freq').value = (-intercept / slope).toFixed(1);
                document.getElementById('slope').value = (slope * 10).toFixed(2); // Convert to 10^-15 V·s
                
                // Save these calculated values
                saveData(document.getElementById('y-intercept'));
                saveData(document.getElementById('work-function'));
                saveData(document.getElementById('threshold-freq'));
                saveData(document.getElementById('slope'));
            } else {
                photoelectricChart.data.datasets[1].data = [];
            }
            
            photoelectricChart.update();
        }

        function calculateLinearRegression(points) {
            const n = points.length;
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;
            
            points.forEach(point => {
                sumX += point.x;
                sumY += point.y;
                sumXY += point.x * point.y;
                sumX2 += point.x * point.x;
            });
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            return { slope, intercept };
        }
    </script>
</body>
</html>