<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pauli's Acceleration Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            max-width: 900px;
            width: 90%;
            min-height: 600px;
            position: relative;
        }
        
        h1 {
            text-align: center;
            color: #764ba2;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .pauli {
            font-size: 3em;
            animation: pulse 2s ease-in-out infinite;
            display: inline-block;
            user-select: none;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .navigation {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .nav-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .nav-btn.active {
            background: #764ba2;
            transform: scale(1.05);
        }
        
        .panel {
            display: none;
            animation: fadeIn 0.5s ease;
            min-height: 450px;
            position: relative;
        }
        
        .panel.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .instructions {
            background: rgba(102, 126, 234, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.1em;
            color: #555;
            border: 2px solid rgba(102, 126, 234, 0.3);
        }
        
        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        /* Acceleration Sandbox Styles */
        .slider-container {
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .slider-label {
            font-weight: bold;
            margin-bottom: 10px;
            color: #667eea;
        }
        
        input[type="range"] {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .sandbox-area {
            position: relative;
            height: 250px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 15px;
            border: 2px dashed rgba(102, 126, 234, 0.3);
            overflow: hidden;
            margin-top: 20px;
        }
        
        .moving-pauli {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3em;
            transition: none;
        }
        
        .meters {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .meter {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .meter-label {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .meter-value {
            font-size: 2em;
            color: #764ba2;
            font-weight: bold;
        }
        
        
        /* Equation Builder Styles */
        .equation-area {
            margin: 20px 0;
            min-height: 200px;
        }
        
        .formula-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .formula-btn {
            padding: 10px 20px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }
        
        .formula-btn:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }
        
        .formula-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .variable-bank {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        
        .variable {
            padding: 15px 25px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: bold;
            color: #764ba2;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .variable:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .variable.used {
            opacity: 0;
            pointer-events: none;
        }
        
        .equation-builder {
            background: rgba(102, 126, 234, 0.05);
            padding: 30px;
            border-radius: 15px;
            border: 3px dashed rgba(102, 126, 234, 0.3);
            min-height: 80px;
            font-size: 1.8em;
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: monospace;
        }
        
        /* Acceleration Race Styles */
        .race-setup {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .racer-config {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .racer-name {
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.2em;
        }
        
        .config-slider {
            margin: 10px 0;
        }
        
        .config-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .race-track-multi {
            position: relative;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 15px;
            margin: 20px 0;
            padding: 20px 0;
            overflow: visible;
        }
        
        .race-lane {
            position: relative;
            height: 60px;
            margin: 10px 20px;
            background: linear-gradient(to right, #eee 0%, #eee 95%, #ff4444 95%, #ff4444 100%);
            border-radius: 30px;
            overflow: visible;
        }
        
        .racing-pauli {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2em;
        }
        
        .lane-label {
            position: absolute;
            left: -60px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
            color: #764ba2;
        }
        
        /* Feedback */
        .feedback {
            background: rgba(46, 204, 113, 0.1);
            border: 2px solid rgba(46, 204, 113, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            font-size: 1.1em;
            color: #27ae60;
            display: none;
        }
        
        .feedback.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
            text-decoration: underline;
            text-decoration-style: dotted;
            cursor: help;
            color: #667eea;
        }
        
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            white-space: nowrap;
            z-index: 1000;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .tooltip:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #333;
            margin-bottom: -1px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pauli's Acceleration Adventure <span class="pauli">üëÄ</span></h1>
        
        <nav class="navigation">
            <button class="nav-btn active" onclick="showPanel('sandbox', this)">üèéÔ∏è Acceleration Sandbox</button>
            <button class="nav-btn" onclick="showPanel('equations', this)">üîß Equation Builder</button>
            <button class="nav-btn" onclick="showPanel('race', this)">üèÅ Acceleration Race</button>
        </nav>
        
        <!-- Panel 1: Acceleration Sandbox -->
        <div class="panel active" id="sandboxPanel">
            <div class="instructions">
                üèéÔ∏è Adjust the sliders to see how <span class="tooltip" data-tooltip="Rate of change of velocity">acceleration</span> affects Pauli's <span class="tooltip" data-tooltip="Speed with direction">velocity</span> over time.
            </div>
            
            <div class="slider-container">
                <div class="slider-label">Initial Velocity: <span id="initialVelValue">0</span> m/s</div>
                <input type="range" id="initialVelSlider" min="-20" max="20" value="0" step="1">
            </div>
            
            <div class="slider-container">
                <div class="slider-label">Acceleration: <span id="accelValue">0</span> m/s¬≤</div>
                <input type="range" id="accelSlider" min="-10" max="10" value="0" step="0.5">
            </div>
            
            <div style="text-align: center;">
                <button onclick="startSandbox()">Start Movement</button>
                <button onclick="resetSandbox()">Reset</button>
                <button onclick="randomizeSandbox()">Randomize</button>
            </div>
            
            <div class="sandbox-area">
                <div class="moving-pauli" id="sandboxPauli">üëÄ</div>
            </div>
            
            <div class="meters">
                <div class="meter">
                    <div class="meter-label">Current Velocity</div>
                    <div class="meter-value" id="velocityMeter">0 m/s</div>
                </div>
                <div class="meter">
                    <div class="meter-label">Acceleration</div>
                    <div class="meter-value" id="accelerationMeter">0 m/s¬≤</div>
                </div>
            </div>
        </div>
        
        <!-- Panel 2: Equation Builder -->
        <div class="panel" id="equationsPanel">
            <div class="instructions">
                üîß Build acceleration equations by dragging variables. Practice rearranging formulas.
            </div>
            
            <div class="formula-options">
                <button class="formula-btn" onclick="selectFormula('a', this)">Build: a</button>
                <button class="formula-btn" onclick="selectFormula('v', this)">Build: v</button>
                <button class="formula-btn" onclick="selectFormula('u', this)">Build: u</button>
                <button class="formula-btn" onclick="selectFormula('t', this)">Build: t</button>
            </div>
            
            <div class="equation-builder" id="equationBuilder">
                <span id="buildPrompt">Select a formula to build</span>
            </div>
            
            <div class="variable-bank" id="variableBank">
                <!-- Variables will be added dynamically -->
            </div>
            
            <div style="text-align: center;">
                <button onclick="checkEquation()">Check Equation</button>
                <button onclick="clearEquation()">Clear</button>
                <button onclick="showHint()">Hint</button>
            </div>
            
            <div class="feedback" id="equationFeedback"></div>
        </div>
        
        <!-- Panel 3: Acceleration Race -->
        <div class="panel" id="racePanel">
            <div class="instructions">
                üèÅ Set different starting <span class="tooltip" data-tooltip="Speed with direction">velocities</span> and <span class="tooltip" data-tooltip="Rate of change of velocity">accelerations</span> for each Pauli. See how acceleration vs initial velocity affects the race.
            </div>
            
            <div style="text-align: center; margin: 20px 0; font-size: 1.2em;">
                <strong>Race Distance: 100 meters</strong>
            </div>
            
            <div class="race-setup">
                <div class="racer-config">
                    <div class="racer-name">Pauli 1 üî¥</div>
                    <div class="config-slider">
                        <div class="config-label">Starting Velocity: <span id="p1VelValue">0</span> m/s</div>
                        <input type="range" id="p1VelSlider" min="-20" max="20" value="0" step="1">
                    </div>
                    <div class="config-slider">
                        <div class="config-label">Acceleration: <span id="p1AccelValue">5</span> m/s¬≤</div>
                        <input type="range" id="p1AccelSlider" min="0" max="15" value="5" step="0.5">
                    </div>
                </div>
                
                <div class="racer-config">
                    <div class="racer-name">Pauli 2 üîµ</div>
                    <div class="config-slider">
                        <div class="config-label">Starting Velocity: <span id="p2VelValue">10</span> m/s</div>
                        <input type="range" id="p2VelSlider" min="-20" max="20" value="10" step="1">
                    </div>
                    <div class="config-slider">
                        <div class="config-label">Acceleration: <span id="p2AccelValue">2</span> m/s¬≤</div>
                        <input type="range" id="p2AccelSlider" min="0" max="15" value="2" step="0.5">
                    </div>
                </div>
                
                <div class="racer-config">
                    <div class="racer-name">Pauli 3 üü¢</div>
                    <div class="config-slider">
                        <div class="config-label">Starting Velocity: <span id="p3VelValue">5</span> m/s</div>
                        <input type="range" id="p3VelSlider" min="-20" max="20" value="5" step="1">
                    </div>
                    <div class="config-slider">
                        <div class="config-label">Acceleration: <span id="p3AccelValue">8</span> m/s¬≤</div>
                        <input type="range" id="p3AccelSlider" min="0" max="15" value="8" step="0.5">
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 20px 0; background: rgba(102, 126, 234, 0.1); padding: 15px; border-radius: 10px;">
                <div style="font-weight: bold; margin-bottom: 10px;">Predict the winner:</div>
                <label style="margin: 0 10px;">
                    <input type="radio" name="prediction" value="1"> Pauli 1 üî¥
                </label>
                <label style="margin: 0 10px;">
                    <input type="radio" name="prediction" value="2"> Pauli 2 üîµ
                </label>
                <label style="margin: 0 10px;">
                    <input type="radio" name="prediction" value="3"> Pauli 3 üü¢
                </label>
            </div>
            
            <div style="text-align: center;">
                <button onclick="startRace()">Start Race</button>
                <button onclick="resetRace()">Reset Race</button>
                <button onclick="randomizeRace()">Randomize</button>
            </div>
            
            <div class="race-track-multi">
                <div class="race-lane">
                    <div class="lane-label">P1</div>
                    <div class="racing-pauli" id="racer1" style="color: red;">üëÄ</div>
                </div>
                <div class="race-lane">
                    <div class="lane-label">P2</div>
                    <div class="racing-pauli" id="racer2" style="color: blue;">üëÄ</div>
                </div>
                <div class="race-lane">
                    <div class="lane-label">P3</div>
                    <div class="racing-pauli" id="racer3" style="color: green;">üëÄ</div>
                </div>
            </div>
            
            <div class="feedback" id="raceFeedback"></div>
            <div id="raceResults" style="text-align: center; margin-top: 20px; font-size: 1.2em; font-weight: bold;"></div>
        </div>
    </div>
    
    <script>
        // Global variables
        let currentPanel = 'sandbox';
        let sandboxAnimation = null;
        let raceAnimation = null;
        let selectedFormula = null;
        let currentEquation = [];
        
        // Panel switching
        function showPanel(panel, button) {
            // Stop any running animations
            if (sandboxAnimation) {
                cancelAnimationFrame(sandboxAnimation);
                sandboxAnimation = null;
            }
            if (raceAnimation) {
                cancelAnimationFrame(raceAnimation);
                raceAnimation = null;
            }
            
            // Hide all panels
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            // Show selected panel
            document.getElementById(panel + 'Panel').classList.add('active');
            
            // Activate the button that was clicked
            if (button) {
                button.classList.add('active');
            }
            
            currentPanel = panel;
        }
        
        // Acceleration Sandbox Functions
        const sandboxPauli = document.getElementById('sandboxPauli');
        const velocityMeter = document.getElementById('velocityMeter');
        const accelerationMeter = document.getElementById('accelerationMeter');
        const initialVelSlider = document.getElementById('initialVelSlider');
        const accelSlider = document.getElementById('accelSlider');
        
        initialVelSlider.addEventListener('input', (e) => {
            document.getElementById('initialVelValue').textContent = e.target.value;
        });
        
        accelSlider.addEventListener('input', (e) => {
            document.getElementById('accelValue').textContent = e.target.value;
            accelerationMeter.textContent = e.target.value + ' m/s¬≤';
        });
        
        function startSandbox() {
            if (sandboxAnimation) return;
            
            // Reset any previous animation states
            sandboxPauli.style.transition = 'none';
            sandboxPauli.style.opacity = '1';
            
            const initialVel = parseFloat(initialVelSlider.value);
            const acceleration = parseFloat(accelSlider.value);
            const sandboxArea = document.querySelector('.sandbox-area');
            const areaWidth = sandboxArea.clientWidth;
            const centerX = areaWidth / 2 - 30; // Center minus half Pauli width
            
            let startTime = null;
            let animationPhase = 'moving'; // 'moving', 'waiting', 'returning'
            
            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = (timestamp - startTime) / 1000; // seconds
                
                if (animationPhase === 'moving' && elapsed < 10) {
                    // Calculate physics
                    const velocity = initialVel + acceleration * elapsed;
                    const distance = initialVel * elapsed + 0.5 * acceleration * elapsed * elapsed;
                    
                    // Convert to pixels (10 pixels per meter)
                    let pixelPosition = centerX + distance * 10;
                    
                    // Handle wrapping
                    while (pixelPosition > areaWidth) {
                        pixelPosition -= areaWidth;
                    }
                    while (pixelPosition < -60) {
                        pixelPosition += areaWidth;
                    }
                    
                    // Update position and velocity display
                    sandboxPauli.style.left = pixelPosition + 'px';
                    velocityMeter.textContent = velocity.toFixed(1) + ' m/s';
                    
                    sandboxAnimation = requestAnimationFrame(animate);
                    
                } else if (animationPhase === 'moving' && elapsed >= 10) {
                    // Switch to waiting phase
                    animationPhase = 'waiting';
                    sandboxAnimation = requestAnimationFrame(animate);
                    
                } else if (animationPhase === 'waiting' && elapsed < 12) {
                    // Just wait
                    sandboxAnimation = requestAnimationFrame(animate);
                    
                } else if (animationPhase === 'waiting' && elapsed >= 12) {
                    // Start return animation
                    animationPhase = 'returning';
                    sandboxPauli.style.transition = 'left 1s ease, opacity 0.3s ease';
                    sandboxPauli.style.opacity = '0.25';
                    sandboxPauli.style.left = centerX + 'px';
                    
                    // Clean up after return animation
                    setTimeout(() => {
                        sandboxPauli.style.transition = 'none';
                        sandboxPauli.style.opacity = '1';
                        sandboxAnimation = null;
                    }, 1000);
                }
            }
            
            sandboxAnimation = requestAnimationFrame(animate);
        }
        
        function resetSandbox() {
            if (sandboxAnimation) {
                cancelAnimationFrame(sandboxAnimation);
                sandboxAnimation = null;
            }
            
            const sandboxArea = document.querySelector('.sandbox-area');
            const centerX = sandboxArea.clientWidth / 2 - 30;
            
            sandboxPauli.style.transition = 'none';
            sandboxPauli.style.opacity = '1';
            sandboxPauli.style.left = centerX + 'px';
            velocityMeter.textContent = '0 m/s';
        }
        
        function randomizeSandbox() {
            const randomVel = Math.floor(Math.random() * 41) - 20;
            const randomAccel = ((Math.random() * 20) - 10).toFixed(1);
            
            initialVelSlider.value = randomVel;
            accelSlider.value = randomAccel;
            document.getElementById('initialVelValue').textContent = randomVel;
            document.getElementById('accelValue').textContent = randomAccel;
            accelerationMeter.textContent = randomAccel + ' m/s¬≤';
        }
        
        // Equation Builder Functions
        const equations = {
            'a': { 
                correct: ['(v-u)√∑t'],
                hint: 'Acceleration equals change in velocity divided by time'
            },
            'v': { 
                correct: ['u+a√ót', 'u+(a√ót)', 'a√ót+u', '(a√ót)+u'],
                hint: 'Final velocity equals initial velocity plus acceleration times time'
            },
            'u': { 
                correct: ['v-a√ót', 'v-(a√ót)'],
                hint: 'Initial velocity equals final velocity minus acceleration times time'
            },
            't': { 
                correct: ['(v-u)√∑a'],
                hint: 'Time equals change in velocity divided by acceleration'
            }
        };
        
        function selectFormula(formula, button) {
            // Clear previous selections
            document.querySelectorAll('.formula-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Mark this button as selected
            if (button) {
                button.classList.add('selected');
            }
            
            // Set the selected formula
            selectedFormula = formula;
            currentEquation = [];
            
            // Clear and setup variable bank
            setupVariableBank();
            
            // Update the equation builder display
            const builder = document.getElementById('equationBuilder');
            builder.textContent = formula + ' = ';
        }
        
        function setupVariableBank() {
            const bank = document.getElementById('variableBank');
            bank.innerHTML = '';
            
            const variables = ['a', 'v', 'u', 't', '+', '-', '√ó', '√∑', '(', ')'];
            
            variables.forEach(variable => {
                const varElement = document.createElement('div');
                varElement.className = 'variable';
                varElement.textContent = variable;
                varElement.setAttribute('data-var', variable);
                varElement.onclick = () => addToEquation(variable, varElement);
                bank.appendChild(varElement);
            });
        }
        
        function addToEquation(variable, element) {
            if (!selectedFormula) {
                showFeedback('equationFeedback', 'Pauli says: Choose a formula type first üëÄ', false);
                return;
            }
            
            currentEquation.push(variable);
            element.classList.add('used');
            updateEquationDisplay();
        }
        
        function updateEquationDisplay() {
            const builder = document.getElementById('equationBuilder');
            builder.textContent = selectedFormula + ' = ' + currentEquation.join('');
        }
        
        function checkEquation() {
            if (!selectedFormula || currentEquation.length === 0) {
                showFeedback('equationFeedback', 'Pauli says: Build your equation first üëÄ', false);
                return;
            }
            
            // Join the equation array into a string for comparison
            const userEquation = currentEquation.join('');
            const possibleCorrect = equations[selectedFormula].correct;
            
            // Debug: Show what we're comparing
            console.log('User equation:', userEquation);
            console.log('Possible correct:', possibleCorrect);
            
            // Check if user's equation matches any correct form
            const isCorrect = possibleCorrect.includes(userEquation);
            
            if (isCorrect) {
                showFeedback('equationFeedback', 'Perfect. Pauli loves your equation building skills üëÄ', true);
            } else {
                showFeedback('equationFeedback', 'Pauli says: Not quite right. Try again üëÄ', false);
            }
        }
        
        function clearEquation() {
            currentEquation = [];
            const builder = document.getElementById('equationBuilder');
            
            if (selectedFormula) {
                builder.textContent = selectedFormula + ' = ';
            } else {
                builder.innerHTML = '<span id="buildPrompt">Select a formula to build</span>';
            }
            
            // Show all variables again
            document.querySelectorAll('.variable').forEach(v => {
                v.classList.remove('used');
            });
        }
        
        function showHint() {
            if (!selectedFormula) {
                showFeedback('equationFeedback', 'Pauli says: Select a formula first üëÄ', false);
                return;
            }
            showFeedback('equationFeedback', 'Hint: ' + equations[selectedFormula].hint + ' üëÄ', true);
        }
        
        // Acceleration Race Functions
        const p1VelSlider = document.getElementById('p1VelSlider');
        const p1AccelSlider = document.getElementById('p1AccelSlider');
        const p2VelSlider = document.getElementById('p2VelSlider');
        const p2AccelSlider = document.getElementById('p2AccelSlider');
        const p3VelSlider = document.getElementById('p3VelSlider');
        const p3AccelSlider = document.getElementById('p3AccelSlider');
        
        // Add event listeners for sliders
        p1VelSlider.addEventListener('input', (e) => {
            document.getElementById('p1VelValue').textContent = e.target.value;
        });
        p1AccelSlider.addEventListener('input', (e) => {
            document.getElementById('p1AccelValue').textContent = e.target.value;
        });
        p2VelSlider.addEventListener('input', (e) => {
            document.getElementById('p2VelValue').textContent = e.target.value;
        });
        p2AccelSlider.addEventListener('input', (e) => {
            document.getElementById('p2AccelValue').textContent = e.target.value;
        });
        p3VelSlider.addEventListener('input', (e) => {
            document.getElementById('p3VelValue').textContent = e.target.value;
        });
        p3AccelSlider.addEventListener('input', (e) => {
            document.getElementById('p3AccelValue').textContent = e.target.value;
        });
        
        function randomizeRace() {
            // Random velocities between -20 and 20
            const v1 = Math.floor(Math.random() * 41) - 20;
            const v2 = Math.floor(Math.random() * 41) - 20;
            const v3 = Math.floor(Math.random() * 41) - 20;
            
            // Random accelerations between 0 and 15
            const a1 = (Math.random() * 15).toFixed(1);
            const a2 = (Math.random() * 15).toFixed(1);
            const a3 = (Math.random() * 15).toFixed(1);
            
            // Update sliders and displays
            p1VelSlider.value = v1;
            p1AccelSlider.value = a1;
            p2VelSlider.value = v2;
            p2AccelSlider.value = a2;
            p3VelSlider.value = v3;
            p3AccelSlider.value = a3;
            
            document.getElementById('p1VelValue').textContent = v1;
            document.getElementById('p1AccelValue').textContent = a1;
            document.getElementById('p2VelValue').textContent = v2;
            document.getElementById('p2AccelValue').textContent = a2;
            document.getElementById('p3VelValue').textContent = v3;
            document.getElementById('p3AccelValue').textContent = a3;
            
            // Clear prediction
            const predictionRadios = document.getElementsByName('prediction');
            predictionRadios.forEach(radio => radio.checked = false);
        }
        
        function startRace() {
            if (raceAnimation) return;
            
            // Get user prediction
            const predictionRadios = document.getElementsByName('prediction');
            let userPrediction = null;
            for (const radio of predictionRadios) {
                if (radio.checked) {
                    userPrediction = parseInt(radio.value);
                    break;
                }
            }
            
            const racers = [
                {
                    element: document.getElementById('racer1'),
                    initialVel: parseFloat(p1VelSlider.value),
                    acceleration: parseFloat(p1AccelSlider.value),
                    name: 'Pauli 1 üî¥',
                    color: 'red',
                    finished: false,
                    finishTime: null,
                    number: 1
                },
                {
                    element: document.getElementById('racer2'),
                    initialVel: parseFloat(p2VelSlider.value),
                    acceleration: parseFloat(p2AccelSlider.value),
                    name: 'Pauli 2 üîµ',
                    color: 'blue',
                    finished: false,
                    finishTime: null,
                    number: 2
                },
                {
                    element: document.getElementById('racer3'),
                    initialVel: parseFloat(p3VelSlider.value),
                    acceleration: parseFloat(p3AccelSlider.value),
                    name: 'Pauli 3 üü¢',
                    color: 'green',
                    finished: false,
                    finishTime: null,
                    number: 3
                }
            ];
            
            const lane = document.querySelector('.race-lane');
            const trackWidth = lane.clientWidth - 60;
            const raceDistance = 100; // 100 meters
            const pixelsPerMeter = trackWidth / raceDistance;
            const finishLine = trackWidth - 20; // Near the right edge
            let startTime = performance.now();
            let finishOrder = [];
            
            // Clear previous results
            document.getElementById('raceResults').innerHTML = '';
            
            function animate(currentTime) {
                const elapsed = (currentTime - startTime) / 1000;
                let allFinished = true;
                
                racers.forEach(racer => {
                    if (!racer.finished) {
                        // Calculate position in meters: s = ut + 0.5at¬≤
                        const distanceMeters = racer.initialVel * elapsed + 0.5 * racer.acceleration * elapsed * elapsed;
                        const position = 20 + (distanceMeters * pixelsPerMeter);
                        
                        // Allow negative positions (off screen to left)
                        racer.element.style.left = position + 'px';
                        
                        // Check if crossed finish line (100 meters)
                        if (distanceMeters >= raceDistance && !racer.finished) {
                            racer.finished = true;
                            racer.finishTime = elapsed;
                            finishOrder.push(racer);
                            
                            // Display place as they finish
                            const place = finishOrder.length;
                            const placeText = place === 1 ? '1st' : place === 2 ? '2nd' : '3rd';
                            const resultsDiv = document.getElementById('raceResults');
                            resultsDiv.innerHTML += `<div style="color: ${racer.color};">${placeText} Place: ${racer.name} (${racer.finishTime.toFixed(2)}s)</div>`;
                        } else if (!racer.finished) {
                            allFinished = false;
                        }
                    }
                });
                
                // Continue if not all finished and reasonable time
                if (!allFinished && elapsed < 20) {
                    raceAnimation = requestAnimationFrame(animate);
                } else {
                    raceAnimation = null;
                    
                    // Show final message
                    if (finishOrder.length > 0) {
                        let message = `Race complete. ${finishOrder[0].name} wins with v‚ÇÄ=${finishOrder[0].initialVel} m/s, a=${finishOrder[0].acceleration} m/s¬≤ üëÄ`;
                        
                        // Check prediction
                        if (userPrediction !== null) {
                            if (userPrediction === finishOrder[0].number) {
                                message += ` Your prediction was correct.`;
                            } else {
                                message += ` Your prediction was incorrect.`;
                            }
                        }
                        
                        showFeedback('raceFeedback', message, true);
                    } else {
                        showFeedback('raceFeedback', 
                            'Race timed out. Try different values üëÄ', 
                            false);
                    }
                }
            }
            
            raceAnimation = requestAnimationFrame(animate);
        }
        
        function resetRace() {
            if (raceAnimation) {
                cancelAnimationFrame(raceAnimation);
                raceAnimation = null;
            }
            document.getElementById('racer1').style.left = '20px';
            document.getElementById('racer2').style.left = '20px';
            document.getElementById('racer3').style.left = '20px';
            document.getElementById('raceFeedback').classList.remove('show');
            document.getElementById('raceResults').innerHTML = '';
            
            // Clear prediction
            const predictionRadios = document.getElementsByName('prediction');
            predictionRadios.forEach(radio => radio.checked = false);
        }
        
        // Utility function for feedback
        function showFeedback(elementId, message, success) {
            const feedback = document.getElementById(elementId);
            feedback.textContent = message;
            feedback.style.background = success ? 'rgba(46, 204, 113, 0.1)' : 'rgba(231, 76, 60, 0.1)';
            feedback.style.borderColor = success ? 'rgba(46, 204, 113, 0.3)' : 'rgba(231, 76, 60, 0.3)';
            feedback.style.color = success ? '#27ae60' : '#e74c3c';
            feedback.classList.add('show');
            
            setTimeout(() => {
                feedback.classList.remove('show');
            }, 5000);
        }
        
        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            // Center Pauli in sandbox
            const sandboxArea = document.querySelector('.sandbox-area');
            if (sandboxArea) {
                const centerX = sandboxArea.clientWidth / 2 - 30;
                const sandboxPauli = document.getElementById('sandboxPauli');
                if (sandboxPauli) {
                    sandboxPauli.style.left = centerX + 'px';
                    sandboxPauli.style.opacity = '1';
                    sandboxPauli.style.transition = 'none';
                }
            }
        });
    </script>
</body>
</html>