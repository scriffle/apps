<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bonding Simulation (Ionic & Covalent)</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    /* Container holds the top panel and simulation area */
    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    /* Top panel: contains mode toggle, element menu, and control buttons */
    #top-panel {
      background: #eee;
      overflow: auto;
      border-bottom: 2px solid #ccc;
      padding: 5px;
    }
    /* Mode selector radio buttons */
    #mode-selector {
      text-align: center;
      margin-bottom: 5px;
    }
    /* Element menu container */
    #element-menu {
      display: flex;
      justify-content: center;
      margin-bottom: 5px;
    }
    .group {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      max-width: 45%;
      margin: 0 10px;
    }
    .element {
      width: 60px;
      padding: 8px;
      text-align: center;
      font-size: 14px;
      cursor: pointer;
      border: 1px solid #ccc;
      border-radius: 5px;
      background: #f0f0f0;
    }
    .element:hover { background: #ddd; }
    /* Control buttons styling */
    #controls {
      text-align: center;
      margin-bottom: 5px;
    }
    #controls button {
      margin: 0 5px;
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
    }
    /* Draggable resize handle */
    #resize-handle {
      height: 10px;
      background: #ccc;
      cursor: ns-resize;
    }
    /* Simulation area */
    #simulation {
      position: relative;
      flex: 1;
      background: #f9f9f9;
      overflow: hidden;
    }
    /* Canvas overlay for covalent bond lines */
    #bond-canvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }
    /* Styling for ions, compounds, and covalent atoms */
    .ion, .compound, .atom {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      text-align: center;
      user-select: none;
    }
    .ion {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    .compound {
      min-width: 50px;
      padding: 5px;
      border: 2px solid #004085;
      border-radius: 10px;
      cursor: pointer;
    }
    .atom {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    /* Example element colors */
    .Li { background: #d7eaff; }
    .Na { background: #ffc0cb; }
    .K  { background: #e4f1ff; }
    .F  { background: #e0ffff; }
    .Cl { background: #d3ffd3; }
    .H  { background: #f0f0f0; }
    .O  { background: #ffcccb; }
    .C  { background: #d8bfd8; }
    .N  { background: #add8e6; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Top Panel -->
    <div id="top-panel">
      <div id="mode-selector">
        <label>
          <input type="radio" name="bondMode" value="ionic" checked onchange="switchMode()"> Ionic
        </label>
        <label>
          <input type="radio" name="bondMode" value="covalent" onchange="switchMode()"> Covalent
        </label>
      </div>
      <div id="element-menu"></div>
      <div id="controls">
        <button onclick="removeIons()">Remove Ions/Atoms</button>
        <button onclick="removeCompounds()">Remove Compounds/Bonds</button>
        <button onclick="bondNow()">Bond Now</button>
      </div>
    </div>
    <!-- Resize Handle -->
    <div id="resize-handle"></div>
    <!-- Simulation Area -->
    <div id="simulation">
      <canvas id="bond-canvas"></canvas>
    </div>
  </div>

  <script>
    /* Global variables */
    let currentMode = "ionic"; // "ionic" or "covalent"
    const simulationArea = document.getElementById('simulation');
    const elementMenu = document.getElementById('element-menu');
    const bondCanvas = document.getElementById("bond-canvas");
    const ctx = bondCanvas.getContext("2d");

    // Resize canvas to match simulation area
    function resizeCanvas() {
      bondCanvas.width = simulationArea.clientWidth;
      bondCanvas.height = simulationArea.clientHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    /* ----- MODE SWITCHING ----- */
    function switchMode() {
      currentMode = document.querySelector('input[name="bondMode"]:checked').value;
      // Clear simulation area and element menu:
      simulationArea.innerHTML = "";
      simulationArea.appendChild(bondCanvas); // reattach canvas overlay
      elementMenu.innerHTML = "";
      // Clear global covalent arrays if needed:
      covalentAtoms = [];
      covalentBonds = [];
      ctx.clearRect(0, 0, bondCanvas.width, bondCanvas.height);
      if (currentMode === "ionic") {
        initIonicMenu();
      } else {
        initCovalentMenu();
        updateCovalentSimulation();
      }
    }

    /* ----- IONIC SIMULATION (Simplified) ----- */
    const ionicElements = [
      { symbol: 'Li', name: 'Lithium', charge: 1, class: 'Li' },
      { symbol: 'Na', name: 'Sodium', charge: 1, class: 'Na' },
      { symbol: 'K',  name: 'Potassium', charge: 1, class: 'K' },
      { symbol: 'F',  name: 'Fluorine', charge: -1, class: 'F' },
      { symbol: 'Cl', name: 'Chlorine', charge: -1, class: 'Cl' }
      // Add more as neededâ€¦
    ];
    function initIonicMenu() {
      // Split into positive and negative groups:
      const cations = ionicElements.filter(e => e.charge > 0);
      const anions = ionicElements.filter(e => e.charge < 0);
      const container = document.createElement("div");
      container.style.display = "flex";
      container.style.justifyContent = "space-around";
      const catDiv = document.createElement("div");
      catDiv.classList.add("group");
      cations.forEach(e => {
        const btn = document.createElement("div");
        btn.className = "element " + e.class;
        btn.innerHTML = `<strong>${e.symbol}</strong><br>${e.charge > 0 ? '+' : '-'}`;
        btn.onclick = () => addIonic(e);
        catDiv.appendChild(btn);
      });
      const anDiv = document.createElement("div");
      anDiv.classList.add("group");
      anions.forEach(e => {
        const btn = document.createElement("div");
        btn.className = "element " + e.class;
        btn.innerHTML = `<strong>${e.symbol}</strong><br>${e.charge > 0 ? '+' : '-'}`;
        btn.onclick = () => addIonic(e);
        anDiv.appendChild(btn);
      });
      container.appendChild(catDiv);
      container.appendChild(anDiv);
      elementMenu.appendChild(container);
    }
    function addIonic(element) {
      // Add 10 copies of the ionic element to the simulation area.
      for (let i = 0; i < 10; i++) {
        const ion = document.createElement("div");
        ion.className = "ion " + element.class;
        ion.dataset.charge = element.charge;
        ion.dataset.symbol = element.symbol;
        ion.dataset.name = element.name;
        ion.innerHTML = `${element.symbol}<br>${element.charge > 0 ? '+' : '-'}`;
        ion.style.top = Math.random() * simulationArea.clientHeight + "px";
        ion.style.left = Math.random() * simulationArea.clientWidth + "px";
        simulationArea.appendChild(ion);
        animateParticle(ion);
      }
    }

    /* ----- COVALENT SIMULATION ----- */
    // Atom class for covalent simulation.
    class Atom {
      constructor(symbol, name, valence, cssClass) {
        this.symbol = symbol;
        this.name = name;
        this.valence = valence;
        this.bonds = [];  // stores bonded atoms
        this.cssClass = cssClass;
        // Create DOM element:
        this.elem = document.createElement("div");
        this.elem.className = "atom " + cssClass;
        this.elem.innerHTML = symbol;
        // Random initial position:
        this.x = Math.random() * simulationArea.clientWidth;
        this.y = Math.random() * simulationArea.clientHeight;
        this.vx = (Math.random() - 0.5) * 2;
        this.vy = (Math.random() - 0.5) * 2;
        this.elem.style.left = this.x + "px";
        this.elem.style.top = this.y + "px";
        simulationArea.appendChild(this.elem);
      }
      canBond() {
        return this.bonds.length < this.valence;
      }
      updatePosition() {
        this.x += this.vx;
        this.y += this.vy + 0.05; // gravity
        // Bounce off edges:
        if (this.x < 0 || this.x + 40 > simulationArea.clientWidth) {
          this.vx *= -1;
        }
        if (this.y < 0 || this.y + 40 > simulationArea.clientHeight) {
          this.vy *= -1;
        }
        this.elem.style.left = this.x + "px";
        this.elem.style.top = this.y + "px";
      }
    }
    // Global arrays for covalent atoms and bonds.
    let covalentAtoms = [];
    let covalentBonds = [];
    // Predefined covalent elements (example set)
    const covalentElements = [
      { symbol: "H", name: "Hydrogen", valence: 1, cssClass: "H" },
      { symbol: "O", name: "Oxygen", valence: 2, cssClass: "O" },
      { symbol: "C", name: "Carbon", valence: 4, cssClass: "C" },
      { symbol: "N", name: "Nitrogen", valence: 3, cssClass: "N" }
      // Extend as needed.
    ];
    function initCovalentMenu() {
      // Display covalent elements in the menu.
      const container = document.createElement("div");
      container.style.display = "flex";
      container.style.justifyContent = "center";
      covalentElements.forEach(e => {
        const btn = document.createElement("div");
        btn.className = "element " + e.cssClass;
        btn.innerHTML = `<strong>${e.symbol}</strong>`;
        btn.onclick = () => addCovalentAtom(e);
        container.appendChild(btn);
      });
      elementMenu.appendChild(container);
    }
    function addCovalentAtom(element) {
      const atom = new Atom(element.symbol, element.name, element.valence, element.cssClass);
      covalentAtoms.push(atom);
    }
    // Check and form bonds if atoms are close and can bond.
    function checkCovalentBonding() {
      for (let i = 0; i < covalentAtoms.length; i++) {
        for (let j = i + 1; j < covalentAtoms.length; j++) {
          const a = covalentAtoms[i], b = covalentAtoms[j];
          const dx = a.x - b.x, dy = a.y - b.y;
          const rawDistance = Math.sqrt(dx * dx + dy * dy);
          const distance = Math.max(rawDistance, 1); // avoid division by zero
          if (distance < 50 && a.canBond() && b.canBond()) {
            if (!a.bonds.includes(b)) {
              a.bonds.push(b);
              b.bonds.push(a);
              covalentBonds.push({ a, b });
            }
          }
        }
      }
    }
    // Exponential bond force constants
    const equilibriumDistance = 40; // ideal distance between atoms (in pixels)
    const k = 0.005; // stiffness factor
    const maxForce = 0.05; // maximum force cap

    // Update covalent simulation: apply bond forces, update positions, and draw bonds.
    function updateCovalentSimulation() {
      // Apply exponential bond tension forces to each bond.
      covalentBonds.forEach(bond => {
        const a = bond.a, b = bond.b;
        const dx = a.x - b.x;
        const dy = a.y - b.y;
        const rawDistance = Math.sqrt(dx * dx + dy * dy);
        const distance = Math.max(rawDistance, 1); // avoid division by 0
        // Calculate force magnitude with an exponential function and cap it.
        let rawForce = -k * (Math.exp(Math.min(distance - equilibriumDistance, 10)) - 1);
        const forceMagnitude = Math.max(Math.min(rawForce, maxForce), -maxForce);
        const fx = forceMagnitude * (dx / distance);
        const fy = forceMagnitude * (dy / distance);
        a.vx += fx;
        a.vy += fy;
        b.vx -= fx;
        b.vy -= fy;
      });
      // Update positions for all atoms.
      covalentAtoms.forEach(atom => {
        atom.updatePosition();
      });
      // Check for new bonds and redraw bond lines.
      checkCovalentBonding();
      drawCovalentBonds();
      requestAnimationFrame(updateCovalentSimulation);
    }
    // Draw covalent bonds on the canvas.
    function drawCovalentBonds() {
      ctx.clearRect(0, 0, bondCanvas.width, bondCanvas.height);
      ctx.lineWidth = 2;
      covalentBonds.forEach(bond => {
        ctx.beginPath();
        ctx.moveTo(bond.a.x + 20, bond.a.y + 20);
        ctx.lineTo(bond.b.x + 20, bond.b.y + 20);
        ctx.strokeStyle = "#000000";
        ctx.stroke();
      });
    }

    /* ----- COMMON FUNCTIONS FOR BOTH SIMULATIONS ----- */
    // Simple particle animation for ionic mode.
    function animateParticle(particle) {
      let posX = parseFloat(particle.style.left);
      let posY = parseFloat(particle.style.top);
      let velX = (Math.random() - 0.5) * 2;
      let velY = (Math.random() - 0.5) * 2;
      const width = particle.offsetWidth;
      const height = particle.offsetHeight;
      function move() {
        posX += velX;
        posY += velY + 0.05;
        if (posX < 0) { posX = 0; velX *= -1; }
        if (posX + width > simulationArea.clientWidth) { posX = simulationArea.clientWidth - width; velX *= -1; }
        if (posY < 0) { posY = 0; velY *= -1; }
        if (posY + height > simulationArea.clientHeight) { posY = simulationArea.clientHeight - height; velY *= -1; }
        particle.style.left = posX + "px";
        particle.style.top = posY + "px";
        requestAnimationFrame(move);
      }
      move();
    }
    // Control buttons for removal and bonding.
    function removeIons() {
      if (currentMode === "ionic") {
        const ions = document.querySelectorAll(".ion");
        ions.forEach(ion => simulationArea.removeChild(ion));
      } else {
        covalentAtoms.forEach(atom => simulationArea.removeChild(atom.elem));
        covalentAtoms = [];
        covalentBonds = [];
        ctx.clearRect(0, 0, bondCanvas.width, bondCanvas.height);
      }
    }
    function removeCompounds() {
      if (currentMode === "ionic") {
        const comps = document.querySelectorAll(".compound");
        comps.forEach(c => simulationArea.removeChild(c));
      } else {
        covalentBonds = [];
        ctx.clearRect(0, 0, bondCanvas.width, bondCanvas.height);
      }
    }
    function bondNow() {
      if (currentMode === "ionic") {
        // Implement bonding for ionic mode if desired.
      } else {
        checkCovalentBonding();
      }
    }

    /* ----- RESIZE HANDLE FUNCTIONALITY ----- */
    const resizeHandle = document.getElementById("resize-handle");
    const topPanel = document.getElementById("top-panel");
    let isResizing = false;
    resizeHandle.addEventListener("mousedown", e => {
      isResizing = true;
      document.body.style.cursor = "ns-resize";
    });
    document.addEventListener("mousemove", e => {
      if (!isResizing) return;
      let newHeight = e.clientY;
      newHeight = Math.max(50, newHeight);
      newHeight = Math.min(window.innerHeight * 0.9, newHeight);
      topPanel.style.height = newHeight + "px";
    });
    document.addEventListener("mouseup", e => {
      if (isResizing) {
        isResizing = false;
        document.body.style.cursor = "default";
      }
    });

    /* ----- INITIALIZATION ----- */
    // Start in ionic mode by default.
    initIonicMenu();
    // In ionic mode atoms are added via the menu.
    // When switching to covalent mode, the covalent update loop starts in switchMode().
  </script>
</body>
</html>
