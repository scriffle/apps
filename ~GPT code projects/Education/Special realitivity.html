<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Special Relativity Simulator</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .container {
            position: relative;
            width: 80vw;
            height: 60vh;
            border: 2px solid #000;
            background-color: #fff;
            overflow: hidden;
        }
        .moving-frame {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            padding: 10px;
            background-color: #fff;
            border: 2px solid red;
            z-index: 1; /* Behind the Lorentz thermometer */
        }
        .proper-frame {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            background-color: rgba(128, 128, 128, 0.8); /* Opaque grey background */
            padding: 10px;
            border-radius: 10px;
        }
        .digital-clock {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333; /* Dark grey for clock numbers */
        }
        .proper-digital-clock {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333; /* Dark grey for clock numbers */
        }
        .ruler {
            height: 15px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transform-origin: center;
        }
        .ruler .markings {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: space-between;
        }
        .ruler .markings div {
            width: 2px;
            background-color: black;
        }
        .ruler .markings .long {
            height: 100%;
        }
        .ruler .markings .short {
            height: 50%;
            align-self: flex-end;
        }
        .moving-ruler {
            background-color: red;
        }
        .proper-ruler {
            width: 200px; /* Fixed length for the proper ruler */
            background-color: blue;
            margin-top: 5px;
        }
        .controls {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 150px; /* Fixed width for the controls */
        }
        .controls label {
            margin: 5px 0;
        }
        .controls input[type="range"] {
            width: 100%;
        }
        .controls button {
            margin: 10px 0;
        }
        .dial-container {
            position: relative;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: #ccc;
            border: 2px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .dial-handle {
            position: absolute;
            width: 4px;
            height: 60%;
            background-color: red;
            transform-origin: bottom;
            transform: rotate(0deg);
        }
        .thermometer-container {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 200px;
            background-color: #ddd;
            border: 2px solid #000;
            border-radius: 5px;
            overflow: hidden;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            z-index: 2; /* On top of the moving clocks */
        }
        .thermometer-bar {
            width: 100%;
            background-color: red;
            height: 0%;
            transition: height 0.3s;
        }
        .thermometer-label {
            position: absolute;
            top: 220px;
            right: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            text-align: center;
        }
        .lorentz-factor-display {
            position: absolute;
            top: 230px;
            right: 10px;
            font-size: 1rem;
            font-weight: bold;
        }
        .info {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            font-size: 1rem;
            font-weight: bold;
            color: #000;
        }
        .info-item {
            margin: 5px 0;
        }
        .lorentz-graph {
            position: absolute;
            right: 10px;
            bottom: 10px;
            width: 300px;
            height: 200px;
            background-color: #fff;
            border: 2px solid #000;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <div class="proper-frame">
            <div class="proper-digital-clock" id="proper-digital-clock">12:00:00</div>
            <div class="ruler proper-ruler">
                <div class="markings">
                    <div class="long"></div>
                    <div class="short"></div>
                    <div class="long"></div>
                    <div class="short"></div>
                    <div class="long"></div>
                    <div class="short"></div>
                    <div class="long"></div>
                    <div class="short"></div>
                    <div class="long"></div>
                </div>
            </div>
        </div>
        <div class="thermometer-container">
            <div class="thermometer-bar" id="thermometer-bar"></div>
            <div class="thermometer-label">Lorentz Factor</div>
        </div>
        <div class="lorentz-factor-display" id="lorentz-factor-display">&#947; = 1.00</div>
        <div class="lorentz-graph" id="lorentz-graph"></div>
    </div>
    <div class="controls">
        <label for="speed-slider">Speed (% of c):</label>
        <input type="range" id="speed-slider" min="0" max="99.999" step="0.001" value="0">
        <label for="direction-dial">Direction:</label>
        <div class="dial-container" id="direction-dial">
            <div class="dial-handle" id="dial-handle"></div>
        </div>
        <button id="reset-button">Reset Time</button>
    </div>
    <div class="info">
        <div class="info-item" id="direction-info">Direction: 0°</div>
        <div class="info-item" id="speed-info">Speed: 0.000% of c</div>
    </div>

    <script>
        const container = document.getElementById('container');
        const speedSlider = document.getElementById('speed-slider');
        const dialHandle = document.getElementById('dial-handle');
        const thermometerBar = document.getElementById('thermometer-bar');
        const lorentzFactorDisplay = document.getElementById('lorentz-factor-display');
        const directionInfo = document.getElementById('direction-info');
        const speedInfo = document.getElementById('speed-info');
        const resetButton = document.getElementById('reset-button');
        const lorentzGraph = document.getElementById('lorentz-graph');

        let speed = 0;
        let lorentzFactor = 1;
        let properTime = 0;
        const movingFrames = [];
        let angle = 0; // Direction in degrees

        function createMovingFrame(x, y) {
            const frame = document.createElement('div');
            frame.classList.add('moving-frame');
            frame.style.left = `${x}px`;
            frame.style.top = `${y}px`;

            const clock = document.createElement('div');
            clock.classList.add('digital-clock');
            clock.textContent = '12:00:00';

            const ruler = document.createElement('div');
            ruler.classList.add('ruler', 'moving-ruler');
            ruler.style.width = '200px'; // Fixed length for gamma = 1

            // Add ruler markings
            const markings = document.createElement('div');
            markings.classList.add('markings');

            for (let i = 0; i < 9; i++) {
                const line = document.createElement('div');
                line.classList.add(i % 2 === 0 ? 'long' : 'short');
                markings.appendChild(line);
            }

            ruler.appendChild(markings);
            frame.appendChild(clock);
            frame.appendChild(ruler);
            container.appendChild(frame);

            movingFrames.push({ frame, clock, ruler, time: 0 });
        }

        function initializeFrames() {
            const gridSize = 3; // 3x3 grid
            const stepX = container.clientWidth / gridSize;
            const stepY = container.clientHeight / gridSize;

            // Clear existing frames
            movingFrames.forEach(({ frame }) => container.removeChild(frame));
            movingFrames.length = 0; // Clear the array

            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    createMovingFrame(stepX * i, stepY * j);
                }
            }
        }

        function updateLorentzFactor() {
            speed = speedSlider.value / 100;
            lorentzFactor = 1 / Math.sqrt(1 - Math.pow(speed, 2));

            // Calculate the contracted length in the direction of travel
            const contractedWidth = 200 / lorentzFactor;

            movingFrames.forEach(({ ruler }) => {
                ruler.style.width = `${contractedWidth}px`;
                ruler.style.transform = `rotate(${angle}deg)`;
            });

            // Update thermometer bar height and Lorentz factor display
            const barHeight = (lorentzFactor - 1) * 100;
            thermometerBar.style.height = `${Math.min(barHeight, 100)}%`;
            lorentzFactorDisplay.textContent = `γ = ${lorentzFactor.toFixed(3)}`;

            // Update speed and direction information
            directionInfo.textContent = `Direction: ${angle}°`;
            speedInfo.textContent = `Speed: ${(speed * 100).toFixed(3)}% of c`;
        }

        function updateAngle(newAngle) {
            angle = newAngle;
            dialHandle.style.transform = `rotate(${angle}deg)`;
            updateLorentzFactor();
        }

        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const mins = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
            return `${hrs}:${mins}:${secs}`;
        }

        function updateClocks() {
            properTime += 1;

            movingFrames.forEach((frameData) => {
                frameData.time += 1 / lorentzFactor;
                frameData.clock.textContent = formatTime(frameData.time);
            });

            const properClock = document.getElementById('proper-digital-clock');
            properClock.textContent = formatTime(properTime);
        }

        function animateMovingFrames() {
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;

            movingFrames.forEach(({ frame }) => {
                const frameWidth = frame.offsetWidth;
                const frameHeight = frame.offsetHeight;

                let currentLeft = parseFloat(getComputedStyle(frame).left || 0);
                let currentTop = parseFloat(getComputedStyle(frame).top || 0);

                const deltaX = Math.cos(angle * Math.PI / 180) * (speed + 0.01) * 5;
                const deltaY = Math.sin(angle * Math.PI / 180) * (speed + 0.01) * 5;

                currentLeft += deltaX;
                currentTop += deltaY;

                if (currentLeft > containerWidth) currentLeft = -frameWidth;
                if (currentTop > containerHeight) currentTop = -frameHeight;
                if (currentLeft < -frameWidth) currentLeft = containerWidth;
                if (currentTop < -frameHeight) currentTop = containerHeight;

                frame.style.left = `${currentLeft}px`;
                frame.style.top = `${currentTop}px`;
            });

            requestAnimationFrame(animateMovingFrames);
        }

        function onDialMouseDown(event) {
            const dialContainer = document.getElementById('direction-dial');
            const rect = dialContainer.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            function onMouseMove(moveEvent) {
                const dx = moveEvent.clientX - centerX;
                const dy = moveEvent.clientY - centerY;
                const newAngle = Math.atan2(dy, dx) * (180 / Math.PI);
                updateAngle((newAngle + 360) % 360);
            }

            function onMouseUp() {
                window.removeEventListener('mousemove', onMouseMove);
                window.removeEventListener('mouseup', onMouseUp);
            }

            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('mouseup', onMouseUp);
        }

        function plotLorentzGraph() {
            const graphContext = lorentzGraph.getContext('2d');
            graphContext.clearRect(0, 0, lorentzGraph.width, lorentzGraph.height);
            graphContext.beginPath();
            graphContext.moveTo(0, lorentzGraph.height);

            for (let i = 0; i <= 100; i++) {
                const v = i / 100;
                const gamma = 1 / Math.sqrt(1 - Math.pow(v, 2));
                const x = (i / 100) * lorentzGraph.width;
                const y = lorentzGraph.height - (gamma / 10) * lorentzGraph.height;
                graphContext.lineTo(x, y);
            }

            graphContext.strokeStyle = 'blue';
            graphContext.lineWidth = 2;
            graphContext.stroke();
        }

        const dialContainer = document.getElementById('direction-dial');
        dialContainer.addEventListener('mousedown', onDialMouseDown);

        resetButton.addEventListener('click', () => {
            properTime = 0;
            movingFrames.forEach((frameData) => frameData.time = 0);
            updateClocks();
        });

        speedSlider.addEventListener('input', () => {
            updateLorentzFactor();
            plotLorentzGraph();
        });
        window.addEventListener('resize', initializeFrames);

        initializeFrames(); // Initialize grid on load
        updateLorentzFactor();
        setInterval(updateClocks, 1000);
        animateMovingFrames();
        plotLorentzGraph();
    </script>
</body>
</html>