<!DOCTYPE html>
<html>
<head>
    <title>DeehypothoFish</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            background: #f0f4f8;
        }

        #variables-pool {
            display: flex;
            gap: 20px;
            margin: 5px auto 10px auto;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            min-height: 50px;
            width: 800px;
            transition: background-color 0.3s;
        }

        #fishbone-container {
            position: relative;
            width: 800px;
            height: 300px;  /* Reduced from 400px */
            margin: 0 auto;
            background: white;
            padding: 10px;  /* Reduced from 20px */
            border-radius: 5px;  /* Reduced from 10px */
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Keep all bone-related styles exactly the same */
        .backbone {
            position: absolute;
            left: 100px;
            width: 600px;
            top: 150px;  /* Adjusted for new container height */
            height: 4px;
            background: #333;
        }

        .fish-head {
            position: absolute;
            right: 80px;
            top: 120px;  /* Adjusted for new container height */
            width: 100px;
            height: 60px;
            background: #f0f0f0;
            border-radius: 30px 60px 60px 30px;
            border: 2px solid #333;
        }

        .bone {
            position: absolute;
            width: 150px;
            height: 4px;
            background: #666;
            transform-origin: right center;
        }

        /* Keep bone positions, just adjust top value for new container height */
        .bone1 { right: 600px; top: 150px; transform: rotate(45deg); }
        .bone2 { right: 520px; top: 150px; transform: rotate(-45deg); }
        .bone3 { right: 440px; top: 150px; transform: rotate(45deg); }
        .bone4 { right: 360px; top: 150px; transform: rotate(-45deg); }
        .bone5 { right: 280px; top: 150px; transform: rotate(45deg); }
        .bone6 { right: 200px; top: 150px; transform: rotate(-45deg); }

        .drop-zone {
            position: absolute;
            width: 120px;
            height: 40px;
            background: rgba(255,255,255,0.8);
            border: 2px dashed #999;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
        }

        .variable-card {
            width: 120px;
            height: 40px;
            background: #e0e0e0;
            border: 1px solid #999;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: move;
            user-select: none;
            position: relative;
            transition: background-color 0.3s;
        }

        .variable-card.iv { background: #fff3d4; }
        .variable-card.dv { background: #d4e6ff; }

        .variable-name {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .variable-unit {
            font-size: 0.8em;
            color: #666;
        }

        #hypothesis {
            width: 800px;
            margin: 10px auto 0 auto;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }

        #trend-selector {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div id="variables-pool"></div>
    <div id="fishbone-container">
        <div class="backbone"></div>
        <div class="fish-head"></div>
        <div class="bone bone1"></div>
        <div class="bone bone2"></div>
        <div class="bone bone3"></div>
        <div class="bone bone4"></div>
        <div class="bone bone5"></div>
        <div class="bone bone6"></div>
    </div>
    <div id="hypothesis">
        <select id="trend-selector">
            <option value="increase">increases</option>
            <option value="decrease">decreases</option>
            <option value="linear">changes linearly with</option>
            <option value="square">changes with the square of</option>
            <option value="inverse">is inversely proportional to</option>
            <option value="root">changes with the square root of</option>
            <option value="null">does not change with</option>
        </select>
        <p id="hypothesis-text"></p>
    </div>

    <script>
        const variables = [
            { id: 'period', name: 'Period', unit: 's' },
            { id: 'length', name: 'Length', unit: 'm' },
            { id: 'mass', name: 'Mass', unit: 'kg' },
            { id: 'amplitude', name: 'Amplitude', unit: '°' },
            { id: 'gravity', name: 'Gravity', unit: 'm/s²' },
            { id: 'air_resistance', name: 'Air Resistance', unit: 'kg/m·s' }
        ];

        let currentIV = null;
        let currentDV = null;

        function createVariableCard(variable) {
            const card = document.createElement('div');
            card.className = 'variable-card';
            card.id = variable.id;
            card.draggable = true;
            card.innerHTML = `
                <div class="variable-name">${variable.name}</div>
                <div class="variable-unit">${variable.unit}</div>
            `;
            
            card.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', variable.id);
            });
            
            return card;
        }

        function calculateDropZonePosition(bone) {
   const rect = bone.getBoundingClientRect();
   const containerRect = bone.parentElement.getBoundingClientRect();
   const boneLength = 150;
   
   // Is it a downward bone?
   const isDownwardBone = bone.className.includes('bone2') || 
                         bone.className.includes('bone4') || 
                         bone.className.includes('bone6');
   
   // Calculate exact center point of the angled bone
   const centerX = rect.right - (boneLength / 2);
   const angleOffset = (boneLength / 2) * Math.sin(45 * Math.PI / 180);
   
   // For upward bones (odd numbered), adjust Y position to center on bone
   // For downward bones (even numbered), keep current positioning
   const centerY = rect.top + (isDownwardBone ? angleOffset : angleOffset + 03); // Reduced from 40 to 30px offset for upper bones
   
   return {
       left: centerX - containerRect.left,
       top: centerY - containerRect.top
   };
}






        function createDropZones() {
            const bones = document.querySelectorAll('.bone');
            bones.forEach((bone, index) => {
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone';
                dropZone.dataset.position = `bone${index + 1}`;
                
                const position = calculateDropZonePosition(bone);
                dropZone.style.left = `${position.left}px`;
                dropZone.style.top = `${position.top}px`;
                
                bone.parentElement.appendChild(dropZone);
            });

            const headDropZone = document.createElement('div');
            headDropZone.className = 'drop-zone';
            headDropZone.dataset.position = 'head';
            const head = document.querySelector('.fish-head');
            const rect = head.getBoundingClientRect();
            const containerRect = head.parentElement.getBoundingClientRect();
            headDropZone.style.left = `${rect.left - containerRect.left + 50}px`;
            headDropZone.style.top = `${rect.top - containerRect.top + 30}px`;
            head.parentElement.appendChild(headDropZone);
        }

        function setupDropZoneListeners() {
            const dropZones = document.querySelectorAll('.drop-zone');
            
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.style.borderColor = '#4CAF50';
                });

                zone.addEventListener('dragleave', (e) => {
                    zone.style.borderColor = '#999';
                });

                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.style.borderColor = '#999';
                    
                    const variableId = e.dataTransfer.getData('text/plain');
                    const card = document.getElementById(variableId);
                    
                    if (zone.children.length > 0) {
                        const existingCard = zone.children[0];
                        document.getElementById('variables-pool').appendChild(existingCard);
                        existingCard.className = 'variable-card';
                        if (currentIV === existingCard.id) currentIV = null;
                        if (currentDV === existingCard.id) currentDV = null;
                    }
                    
                    zone.appendChild(card);
                    
                    if (zone.dataset.position === 'head') {
                        currentDV = variableId;
                        card.className = 'variable-card dv';
                    } else {
                        if (currentIV === variableId) {
                            currentIV = null;
                        }
                        card.className = 'variable-card';
                    }
                    
                    updateHypothesis();
                });
            });
        }

        function setupVariablesPool() {
            const pool = document.getElementById('variables-pool');
            
            pool.addEventListener('dragover', (e) => {
                e.preventDefault();
                pool.style.backgroundColor = '#f8f9fa';
            });

            pool.addEventListener('dragleave', () => {
                pool.style.backgroundColor = 'white';
            });

            pool.addEventListener('drop', (e) => {
                e.preventDefault();
                pool.style.backgroundColor = 'white';
                
                const variableId = e.dataTransfer.getData('text/plain');
                const card = document.getElementById(variableId);
                
                if (card) {
                    pool.appendChild(card);
                    card.className = 'variable-card';
                    if (currentIV === variableId) currentIV = null;
                    if (currentDV === variableId) currentDV = null;
                    updateHypothesis();
                }
            });
        }

        function setupVariableSelection() {
            document.addEventListener('click', (e) => {
                if (e.target.closest('.variable-card')) {
                    const card = e.target.closest('.variable-card');
                    if (card.parentElement.className === 'drop-zone' && 
                        card.parentElement.dataset.position !== 'head') {
                        
                        const previousIV = document.querySelector('.variable-card.iv');
                        if (previousIV) {
                            previousIV.className = 'variable-card';
                        }
                        
                        card.className = 'variable-card iv';
                        currentIV = card.id;
                        updateHypothesis();
                    }
                }
            });
        }

        function updateHypothesis() {
            const hypothesisText = document.getElementById('hypothesis-text');
            const trendSelector = document.getElementById('trend-selector');
            
            if (currentDV && currentIV) {
                const dvCard = document.querySelector('.variable-card.dv');
                const ivCard = document.querySelector('.variable-card.iv');
                
                const dvName = dvCard.querySelector('.variable-name').textContent;
                const ivName = ivCard.querySelector('.variable-name').textContent;
                
                hypothesisText.textContent = `As ${ivName} ${trendSelector.value}, ${dvName} will change accordingly when all other variables are held constant.`;
            } else {
                hypothesisText.textContent = 'Drag variables to the bones and head, then click a variable on a bone to set it as IV.';
            }
        }

        window.onload = function() {
            const pool = document.getElementById('variables-pool');
            variables.forEach(variable => {
                pool.appendChild(createVariableCard(variable));
            });
            
            createDropZones();
            setupDropZoneListeners();
            setupVariableSelection();
            setupVariablesPool();
            
            document.getElementById('trend-selector').addEventListener('change', updateHypothesis);
        };
    </script>
</body>
</html>