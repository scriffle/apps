<!DOCTYPE html>
<html>
<head>
    <title>DeehypothoFish</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            background: #f0f4f8;
        }

        #experiment-selector {
            display: flex;
            gap: 20px;
            margin: 5px auto;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            width: 800px;
        }

        #experiment-selector select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
            min-width: 200px;
        }

        #variables-pool {
            display: flex;
            gap: 20px;
            margin: 5px auto 10px auto;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            min-height: 50px;
            width: 800px;
            transition: background-color 0.3s;
        }

        #fishbone-container {
            position: relative;
            width: 800px;
            height: 300px;
            margin: 0 auto;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .backbone {
            position: absolute;
            left: 100px;
            width: 600px;
            top: 150px;
            height: 4px;
            background: #333;
        }

        .fish-head {
            position: absolute;
            right: 80px;
            top: 120px;
            width: 100px;
            height: 60px;
            background: #f0f0f0;
            border-radius: 30px 60px 60px 30px;
            border: 2px solid #333;
        }

        .bone {
            position: absolute;
            width: 150px;
            height: 4px;
            background: #666;
            transform-origin: right center;
        }

        .bone1 { right: 600px; top: 150px; transform: rotate(45deg); }
        .bone2 { right: 520px; top: 150px; transform: rotate(-45deg); }
        .bone3 { right: 440px; top: 150px; transform: rotate(45deg); }
        .bone4 { right: 360px; top: 150px; transform: rotate(-45deg); }
        .bone5 { right: 280px; top: 150px; transform: rotate(45deg); }
        .bone6 { right: 200px; top: 150px; transform: rotate(-45deg); }

        .drop-zone {
            position: absolute;
            width: 120px;
            height: 40px;
            background: rgba(255,255,255,0.8);
            border: 2px dashed #999;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
        }

        .variable-card {
            width: 120px;
            height: 40px;
            background: #e0e0e0;
            border: 1px solid #999;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: move;
            user-select: none;
            position: relative;
            transition: background-color 0.3s;
        }

        .variable-card.iv { background: #fff3d4; }
        .variable-card.dv { background: #d4e6ff; }

        .variable-name {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .variable-unit {
            font-size: 0.8em;
            color: #666;
        }

        #hypothesis {
            width: 800px;
            margin: 10px auto 0 auto;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }

        .trend-selectors {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }

        .trend-selectors select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
            min-width: 200px;
        }

        .hypothesis-container {
            padding: 15px;
            border-radius: 8px;
        }

        .hypothesis-statement {
            font-size: 1.2em;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .iv-highlight {
            color: #B8860B;
            font-weight: 500;
        }

        .dv-highlight {
            color: #0066cc;
            font-weight: 500;
        }

        .cv-highlight {
            color: #444444;
        }

        .trend-highlight {
            padding: 2px 8px;
            border-radius: 12px;
        }

        .iv-trend-highlight {
            background-color: #FFF8DC;
        }

        .dv-trend-highlight {
            background-color: #E6F3FF;
        }

        .valid-background {
            background-color: #F0FFF0;
        }

        .missing-cvs {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            margin-top: 8px;
        }

        .validity-note {
            font-size: 0.9em;
            color: #28a745;
            margin-top: 8px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div id="experiment-selector">
        <select id="category-select">
            <option value="">Select Category</option>
        </select>
        <select id="experiment-select" disabled>
            <option value="">Select Experiment</option>
        </select>
    </div>
    <div id="variables-pool"></div>
    <div id="fishbone-container">
        <div class="backbone"></div>
        <div class="fish-head"></div>
        <div class="bone bone1"></div>
        <div class="bone bone2"></div>
        <div class="bone bone3"></div>
        <div class="bone bone4"></div>
        <div class="bone bone5"></div>
        <div class="bone bone6"></div>
    </div>
    <div id="hypothesis">
        <div class="trend-selectors">
            <select id="iv-trend-selector">
                <option value="increases">increases</option>
                <option value="decreases">decreases</option>
            </select>
            <select id="dv-trend-selector">
                <option value="changes_linearly">is proportional to</option>
                <option value="changes_square">is proportional to the square of</option>
                <option value="changes_cube">is proportional to the cube of</option>
                <option value="changes_root">is proportional to the square root of</option>
                <option value="inverse">is inversely proportional to</option>
                <option value="inverse_square">is inversely proportional to the square of</option>
                <option value="sinusoidal">varies sinusoidally with</option>
                <option value="exponential">varies exponentially with</option>
                <option value="logarithmic">varies logarithmically with</option>
                <option value="stepwise">changes in discrete steps with</option>
                <option value="threshold">shows a threshold effect with</option>
                <option value="does_not_change">does not change with</option>
            </select>
        </div>
        <p id="hypothesis-text"></p>
    </div>

    <script>
        let currentExperiment = 'pendulum';
        let currentIV = null;
        let currentDV = null;

        const validExperiments = {
            'pendulum': [
                {
                    iv: 'length',
                    dv: 'period',
                    cvs: ['mass', 'amplitude', 'air_resistance', 'gravity']
                },
                {
                    iv: 'amplitude',
                    dv: 'period',
                    cvs: ['length', 'mass', 'air_resistance', 'gravity']
                },
                {
                    iv: 'mass',
                    dv: 'period',
                    cvs: ['length', 'amplitude', 'air_resistance', 'gravity']
                },
                {
                    iv: 'air_resistance',
                    dv: 'period',
                    cvs: ['length', 'mass', 'amplitude', 'gravity']
                },
                {
                    iv: 'gravity',
                    dv: 'period',
                    cvs: ['length', 'mass', 'amplitude', 'air_resistance']
                },
                {
                    iv: 'amplitude',
                    dv: 'length',
                    cvs: ['period', 'mass', 'air_resistance', 'gravity']
                },
                {
                    iv: 'gravity',
                    dv: 'length',
                    cvs: ['period', 'mass', 'amplitude', 'air_resistance']
                }
            ],
            'hookes_law': [
                {
                    iv: 'displacement',
                    dv: 'force',
                    cvs: ['spring_constant', 'initial_length', 'mass', 'temperature']
                },
                {
                    iv: 'spring_constant',
                    dv: 'force',
                    cvs: ['displacement', 'initial_length', 'mass', 'temperature']
                },
                {
                    iv: 'temperature',
                    dv: 'spring_constant',
                    cvs: ['force', 'displacement', 'initial_length', 'mass']
                },
                {
                    iv: 'mass',
                    dv: 'force',
                    cvs: ['spring_constant', 'displacement', 'initial_length', 'temperature']
                },
                {
                    iv: 'spring_constant',
                    dv: 'displacement',
                    cvs: ['force', 'initial_length', 'mass', 'temperature']
                }
            ],
            'reaction_rate': [
                {
                    iv: 'concentration',
                    dv: 'rate',
                    cvs: ['temperature', 'catalyst', 'surface_area', 'pressure']
                },
                {
                    iv: 'temperature',
                    dv: 'rate',
                    cvs: ['concentration', 'catalyst', 'surface_area', 'pressure']
                },
                {
                    iv: 'catalyst',
                    dv: 'rate',
                    cvs: ['concentration', 'temperature', 'surface_area', 'pressure']
                },
                {
                    iv: 'surface_area',
                    dv: 'rate',
                    cvs: ['concentration', 'temperature', 'catalyst', 'pressure']
                },
                {
                    iv: 'pressure',
                    dv: 'rate',
                    cvs: ['concentration', 'temperature', 'catalyst', 'surface_area']
                }
            ],
            'gas_laws': [
                {
                    iv: 'pressure',
                    dv: 'volume',
                    cvs: ['temperature', 'moles', 'flow_rate', 'container_mass']
                },
                {
                    iv: 'temperature',
                    dv: 'pressure',
                    cvs: ['volume', 'moles', 'flow_rate', 'container_mass']
                },
                {
                    iv: 'volume',
                    dv: 'pressure',
                    cvs: ['temperature', 'moles', 'flow_rate', 'container_mass']
                },
                {
                    iv: 'temperature',
                    dv: 'volume',
                    cvs: ['pressure', 'moles', 'flow_rate', 'container_mass']
                },
                {
                    iv: 'moles',
                    dv: 'pressure',
                    cvs: ['temperature', 'volume', 'flow_rate', 'container_mass']
                },
                {
                    iv: 'moles',
                    dv: 'volume',
                    cvs: ['temperature', 'pressure', 'flow_rate', 'container_mass']
                },
                {
                    iv: 'flow_rate',
                    dv: 'pressure',
                    cvs: ['temperature', 'volume', 'moles', 'container_mass']
                }
            ]
        };

        const experimentData = {
            physics: {
                name: "Physics",
                experiments: {
                    pendulum: {
                        name: "Simple Pendulum",
                        variables: [
                            { id: 'period', name: 'Period', unit: 's', canBeDV: true, canBeIV: true },
                            { id: 'length', name: 'Length', unit: 'm', canBeDV: true, canBeIV: true },
                            { id: 'mass', name: 'Mass', unit: 'kg', canBeDV: false, canBeIV: true },
                            { id: 'amplitude', name: 'Initial Amplitude', unit: '°', canBeDV: false, canBeIV: true },
                            { id: 'gravity', name: 'Gravity', unit: 'm/s²', canBeCV: true, canBeIV: true },
                            { id: 'air_resistance', name: 'Air Resistance', unit: 'kg/m·s', canBeCV: true, canBeIV: true }
                        ]
                    },
                    hookes_law: {
                        name: "Hooke's Law",
                        variables: [
                            { id: 'force', name: 'Force', unit: 'N', canBeDV: true, canBeIV: true },
                            { id: 'displacement', name: 'Displacement', unit: 'm', canBeDV: true, canBeIV: true },
                            { id: 'spring_constant', name: 'Spring Constant', unit: 'N/m', canBeDV: true, canBeIV: true },
                            { id: 'initial_length', name: 'Initial Length', unit: 'm', canBeDV: false, canBeIV: true },
                            { id: 'mass', name: 'Mass', unit: 'kg', canBeDV: false, canBeIV: true },
                            { id: 'temperature', name: 'Temperature', unit: '°C', canBeDV: false, canBeIV: true }
                        ]
                    }
                }
            },
            chemistry: {
                name: "Chemistry",
                experiments: {
                    reaction_rate: {
                        name: "Reaction Rate",
                        variables: [
                            { id: 'rate', name: 'Reaction Rate', unit: 'mol/L·s', canBeDV: true, canBeIV: false },
                            { id: 'concentration', name: 'Concentration', unit: 'mol/L', canBeDV: true, canBeIV: true },
                            { id: 'temperature', name: 'Temperature', unit: '°C', canBeDV: false, canBeIV: true },
                            { id: 'catalyst', name: 'Catalyst Amount', unit: 'g', canBeDV: false, canBeIV: true },
                            { id: 'surface_area', name: 'Surface Area', unit: 'cm²', canBeDV: false, canBeIV: true },
                            { id: 'pressure', name: 'Pressure', unit: 'kPa', canBeDV: false, canBeIV: true }
                        ]
                    },
                    gas_laws: {
                        name: "Gas Laws",
                        variables: [
                            { id: 'pressure', name: 'Pressure', unit: 'kPa', canBeDV: true, canBeIV: true },
                            { id: 'volume', name: 'Volume', unit: 'L', canBeDV: true, canBeIV: true },
                            { id: 'temperature', name: 'Temperature', unit: 'K', canBeDV: true, canBeIV: true },
                            { id: 'moles', name: 'Number of Moles', unit: 'mol', canBeDV: false, canBeIV: true },
                            { id: 'flow_rate', name: 'Flow Rate', unit: 'L/s', canBeDV: true, canBeIV: true },
                            { id: 'container_mass', name: 'Container Mass', unit: 'kg', canBeDV: false, canBeIV: false }
                        ]
                    }
                }
            },
            biology: {
                name: "Biology",
                experiments: {}
            },
            psychology: {
                name: "Psychology",
                experiments: {}
            }
        };
        function createVariableCard(variable) {
            const card = document.createElement('div');
            card.className = 'variable-card';
            card.id = variable.id;
            card.draggable = true;
            card.innerHTML = `
                <div class="variable-name">${variable.name}</div>
                <div class="variable-unit">${variable.unit}</div>
            `;
            
            card.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', variable.id);
            });
            
            return card;
        }

        function calculateDropZonePosition(bone) {
            const rect = bone.getBoundingClientRect();
            const containerRect = bone.parentElement.getBoundingClientRect();
            const boneLength = 150;
            
            const isDownwardBone = bone.className.includes('bone2') || 
                                 bone.className.includes('bone4') || 
                                 bone.className.includes('bone6');
            
            const centerX = rect.right - (boneLength / 2);
            const angleOffset = (boneLength / 2) * Math.sin(45 * Math.PI / 180);
            
            const centerY = rect.top + (isDownwardBone ? angleOffset : angleOffset + 3);
            
            return {
                left: centerX - containerRect.left,
                top: centerY - containerRect.top
            };
        }

        function createDropZones() {
            const bones = document.querySelectorAll('.bone');
            bones.forEach((bone, index) => {
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone';
                dropZone.dataset.position = `bone${index + 1}`;
                
                const position = calculateDropZonePosition(bone);
                dropZone.style.left = `${position.left}px`;
                dropZone.style.top = `${position.top}px`;
                
                bone.parentElement.appendChild(dropZone);
            });

            const headDropZone = document.createElement('div');
            headDropZone.className = 'drop-zone';
            headDropZone.dataset.position = 'head';
            const head = document.querySelector('.fish-head');
            const rect = head.getBoundingClientRect();
            const containerRect = head.parentElement.getBoundingClientRect();
            headDropZone.style.left = `${rect.left - containerRect.left + 50}px`;
            headDropZone.style.top = `${rect.top - containerRect.top + 30}px`;
            head.parentElement.appendChild(headDropZone);
        }

        function isValidExperiment(iv, dv) {
            if (!validExperiments[currentExperiment]) return false;
            return validExperiments[currentExperiment].some(exp => 
                exp.iv === iv && exp.dv === dv
            );
        }

        function getRequiredCVs(iv, dv) {
            if (!validExperiments[currentExperiment]) return [];
            const experiment = validExperiments[currentExperiment].find(exp => 
                exp.iv === iv && exp.dv === dv
            );
            return experiment ? experiment.cvs : [];
        }

        function getCurrentCVs() {
            const cvCards = Array.from(document.querySelectorAll('.drop-zone:not([data-position="head"]) .variable-card:not(.iv)'));
            return cvCards.map(card => card.id);
        }

        function getMissingCVs(iv, dv) {
            const requiredCVs = getRequiredCVs(iv, dv);
            const currentCVs = getCurrentCVs();
            return requiredCVs.filter(cv => !currentCVs.includes(cv));
        }

        function setupDropZoneListeners() {
            const dropZones = document.querySelectorAll('.drop-zone');
            
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.style.borderColor = '#4CAF50';
                });

                zone.addEventListener('dragleave', (e) => {
                    zone.style.borderColor = '#999';
                });

                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.style.borderColor = '#999';
                    
                    const variableId = e.dataTransfer.getData('text/plain');
                    const card = document.getElementById(variableId);
                    
                    if (zone.children.length > 0) {
                        const existingCard = zone.children[0];
                        document.getElementById('variables-pool').appendChild(existingCard);
                        existingCard.className = 'variable-card';
                        if (currentIV === existingCard.id) currentIV = null;
                        if (currentDV === existingCard.id) currentDV = null;
                    }
                    
                    zone.appendChild(card);
                    
                    if (zone.dataset.position === 'head') {
                        currentDV = variableId;
                        card.className = 'variable-card dv';
                    } else {
                        if (currentIV === variableId) {
                            currentIV = null;
                        }
                        card.className = 'variable-card';
                    }
                    
                    updateHypothesis();
                });
            });
        }

        function setupVariablesPool() {
            const pool = document.getElementById('variables-pool');
            
            pool.addEventListener('dragover', (e) => {
                e.preventDefault();
                pool.style.backgroundColor = '#f8f9fa';
            });

            pool.addEventListener('dragleave', () => {
                pool.style.backgroundColor = 'white';
            });

            pool.addEventListener('drop', (e) => {
                e.preventDefault();
                pool.style.backgroundColor = 'white';
                
                const variableId = e.dataTransfer.getData('text/plain');
                const card = document.getElementById(variableId);
                
                if (card) {
                    pool.appendChild(card);
                    card.className = 'variable-card';
                    if (currentIV === variableId) currentIV = null;
                    if (currentDV === variableId) currentDV = null;
                    updateHypothesis();
                }
            });
        }

        function setupVariableSelection() {
            document.addEventListener('click', (e) => {
                if (e.target.closest('.variable-card')) {
                    const card = e.target.closest('.variable-card');
                    if (card.parentElement.className === 'drop-zone' && 
                        card.parentElement.dataset.position !== 'head') {
                        
                        const previousIV = document.querySelector('.variable-card.iv');
                        if (previousIV) {
                            previousIV.className = 'variable-card';
                        }
                        
                        card.className = 'variable-card iv';
                        currentIV = card.id;
                        updateHypothesis();
                    }
                }
            });
        }

        function setupSelectors() {
            const categorySelect = document.getElementById('category-select');
            const experimentSelect = document.getElementById('experiment-select');

            Object.keys(experimentData).forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = experimentData[category].name;
                categorySelect.appendChild(option);
            });

            categorySelect.addEventListener('change', (e) => {
                experimentSelect.innerHTML = '<option value="">Select Experiment</option>';
                experimentSelect.disabled = !e.target.value;

                if (e.target.value) {
                    const experiments = experimentData[e.target.value].experiments;
                    Object.keys(experiments).forEach(exp => {
                        const option = document.createElement('option');
                        option.value = exp;
                        option.textContent = experiments[exp].name;
                        experimentSelect.appendChild(option);
                    });
                }
            });

            experimentSelect.addEventListener('change', (e) => {
                if (e.target.value) {
                    currentExperiment = e.target.value;
                    const category = categorySelect.value;
                    const experiment = experimentData[category].experiments[e.target.value];
                    loadExperimentVariables(experiment.variables);
                }
            });
        }

        function loadExperimentVariables(variables) {
            const pool = document.getElementById('variables-pool');
            pool.innerHTML = '';
            variables.forEach(variable => {
                pool.appendChild(createVariableCard(variable));
            });
            
            document.querySelectorAll('.drop-zone').forEach(zone => {
                if (zone.children.length > 0) {
                    zone.innerHTML = '';
                }
            });
            
            currentIV = null;
            currentDV = null;
            updateHypothesis();
        }

        function updateHypothesis() {
            const hypothesisText = document.getElementById('hypothesis-text');
            const ivTrendSelector = document.getElementById('iv-trend-selector');
            const dvTrendSelector = document.getElementById('dv-trend-selector');
            
            const trendDescriptions = {
                'changes_linearly': 'is proportional to',
                'changes_square': 'is proportional to the square of',
                'changes_cube': 'is proportional to the cube of',
                'changes_root': 'is proportional to the square root of',
                'inverse': 'is inversely proportional to',
                'inverse_square': 'is inversely proportional to the square of',
                'sinusoidal': 'varies sinusoidally with',
                'exponential': 'varies exponentially with',
                'logarithmic': 'varies logarithmically with',
                'stepwise': 'changes in discrete steps with',
                'threshold': 'shows a threshold effect with',
                'does_not_change': 'does not change with'
            };

            const defaultText = 'Drag variables to the bones and head, then click a variable on a bone to set it as IV.';
            
            if (currentDV && currentIV) {
                const dvCard = document.querySelector('.variable-card.dv');
                const ivCard = document.querySelector('.variable-card.iv');
                
                const dvName = dvCard.querySelector('.variable-name').textContent;
                const ivName = ivCard.querySelector('.variable-name').textContent;
                
                const isValid = isValidExperiment(currentIV, currentDV);
                const missingCVs = getMissingCVs(currentIV, currentDV);
                const currentCVs = getCurrentCVs();
                const hasEnoughCVs = currentCVs.length >= 2;
                
                if (isValid) {
                    let hypothesisHtml = `
                        <div class="hypothesis-container ${hasEnoughCVs ? 'valid-background' : ''}">
                            <div class="hypothesis-statement">
                                As <span class="iv-highlight">${ivName}</span> 
                                <span class="trend-highlight iv-trend-highlight">${ivTrendSelector.value}</span>, 
                                <span class="dv-highlight">${dvName}</span> 
                                <span class="trend-highlight dv-trend-highlight">${trendDescriptions[dvTrendSelector.value]}</span>
                                <span class="iv-highlight">${ivName}</span> 
                                when <span class="cv-highlight">all other variables are held constant</span>
                            </div>`;

                    if (missingCVs.length > 0) {
                        const missingCVNames = missingCVs.map(id => {
                            const variable = experimentData[categorySelect.value].experiments[currentExperiment].variables.find(v => v.id === id);
                            return variable ? variable.name : id;
                        });
                        hypothesisHtml += `
                            <div class="missing-cvs">
                                Missing CVs: ${missingCVNames.join(', ')}
                            </div>`;
                    }

                    if (hasEnoughCVs) {
                        hypothesisHtml += `
                            <div class="validity-note">
                                A valid hypothesis does not indicate it is correct. Go test it!
                            </div>`;
                    }

                    hypothesisHtml += '</div>';
                    hypothesisText.innerHTML = hypothesisHtml;
                } else {
                    hypothesisText.innerHTML = `<div class="hypothesis-container"><span class="hypothesis-text">${defaultText}</span></div>`;
                }
            } else {
                hypothesisText.innerHTML = `<div class="hypothesis-container"><span class="hypothesis-text">${defaultText}</span></div>`;
            }
        }

        window.onload = function() {
            setupSelectors();
            createDropZones();
            setupDropZoneListeners();
            setupVariableSelection();
            setupVariablesPool();
            
            document.getElementById('iv-trend-selector').addEventListener('change', updateHypothesis);
            document.getElementById('dv-trend-selector').addEventListener('change', updateHypothesis);
            
            // Set default DV trend to 'changes_linearly'
            document.getElementById('dv-trend-selector').value = 'changes_linearly';
        };
    </script>
</body>
</html>
