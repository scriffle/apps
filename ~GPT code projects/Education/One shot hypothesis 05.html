<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Interactive Experiment Hypothesis Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    /* Container styling */
    .container {
      margin-bottom: 20px;
    }
    /* Style for droppable zones */
    .zone {
      border: 2px dashed #aaa;
      border-radius: 5px;
      padding: 10px;
      min-height: 50px;
      margin-bottom: 20px;
    }
    .zone.hovered {
      border-color: #555;
      background-color: #f0f0f0;
    }
    /* Style for draggable variable items */
    .draggable {
      padding: 5px 10px;
      margin: 5px;
      background-color: #ddd;
      border: 1px solid #aaa;
      border-radius: 3px;
      cursor: grab;
      display: inline-block;
    }
    /* Style for select elements */
    select, input[type="text"] {
      padding: 5px;
      margin: 5px 0;
      font-size: 1em;
    }
    button {
      padding: 5px 10px;
      margin-top: 10px;
    }
    /* Style for correct/incorrect hypothesis feedback */
    #hypothesisText.correct {
      background-color: #c8e6c9; /* light green */
      padding: 5px;
    }
    #hypothesisText.incorrect {
      background-color: #ffcdd2; /* light red */
      padding: 5px;
    }
  </style>
</head>
<body>
  <h1>Interactive Experiment Hypothesis Generator</h1>

  <!-- Experiment Selection -->
  <div class="container">
    <label for="experimentSelect"><strong>Select an Experiment:</strong></label><br>
    <select id="experimentSelect">
      <option value="">-- Choose an Experiment --</option>
      <optgroup label="Physics Experiments">
        <option value="pendulum">Pendulum Period Experiment</option>
        <option value="projectile">Projectile Motion Experiment</option>
        <option value="friction">Friction on an Inclined Plane</option>
        <option value="hooke">Hooke's Law Experiment</option>
        <option value="resistance">Electrical Resistance Experiment</option>
      </optgroup>
      <optgroup label="Chemistry Experiments">
        <option value="reaction">Reaction Rate Experiment</option>
        <option value="solubility">Solubility Experiment</option>
        <option value="titration">Titration Experiment</option>
        <option value="electrolysis">Electrolysis Experiment</option>
        <option value="diffusion">Diffusion Experiment</option>
      </optgroup>
      <optgroup label="Biology Experiments">
        <option value="plant">Plant Growth Experiment</option>
        <option value="enzyme">Enzyme Activity Experiment</option>
        <option value="photosynthesis">Photosynthesis Experiment</option>
        <option value="bacteria">Bacterial Growth Experiment</option>
        <option value="respiration">Respiration Experiment</option>
      </optgroup>
    </select>
  </div>

  <!-- Variable Pool (static) -->
  <div id="variable-pool" class="container zone">
    <strong>Variables Pool:</strong>
    <p>(Select an experiment to load its variables.)</p>
  </div>

  <!-- Drop zones -->
  <div class="container">
    <h3>Independent Variable (IV)</h3>
    <div id="iv-zone" class="zone"></div>
  </div>
  <div class="container">
    <h3>Dependent Variable (DV)</h3>
    <div id="dv-zone" class="zone"></div>
  </div>
  
  <!-- Add All Control Variables Button (CV can have many) -->
  <div class="container">
    <button id="addCVButton" style="display: none;">Add All Control Variables</button>
  </div>
  
  <div class="container">
    <h3>Control Variables (CV)</h3>
    <div id="cv-zone" class="zone"></div>
  </div>

  <!-- Relationship Selectors -->
  <div class="container">
    <h3>Select How Variables Change</h3>
    <div>
      <label for="ivAction"><strong>IV Action:</strong></label><br>
      <select id="ivAction">
        <option value="">-- Select Relationship --</option>
        <option value="increases">increases</option>
        <option value="decreases">decreases</option>
        <option value="increases exponentially">increases exponentially</option>
        <option value="decreases exponentially">decreases exponentially</option>
        <option value="increases with the square root">increases with the square root</option>
        <option value="decreases with the square root">decreases with the square root</option>
      </select>
    </div>
    <div>
      <label for="dvAction"><strong>DV Response:</strong></label><br>
      <select id="dvAction">
        <option value="">-- Select Relationship --</option>
        <option value="increases">increases</option>
        <option value="decreases">decreases</option>
        <option value="increases exponentially">increases exponentially</option>
        <option value="decreases exponentially">decreases exponentially</option>
        <option value="increases with the square root">increases with the square root</option>
        <option value="decreases with the square root">decreases with the square root</option>
        <option value="remains constant">remains constant</option>
      </select>
    </div>
  </div>

  <!-- Hypothesis Display -->
  <div class="container">
    <h2>Your Hypothesis:</h2>
    <p id="hypothesisText">Select an experiment, assign variables, and choose relationships to see your hypothesis.</p>
  </div>

  <!-- Reset Button -->
  <div class="container">
    <button id="resetButton">Reset Experiment</button>
  </div>

  <script>
    /*********************
     * Global Variables & Unique ID Counter
     *********************/
    let idCounter = 0; // for assigning unique ids to clones
    let currentExperiment = null; // holds the currently selected experiment

    /*********************
     * Experiment Data
     *********************/
    const experiments = {
      // Physics Experiments
      pendulum: {
        name: "Pendulum Period Experiment",
        variables: ["Pendulum Length", "Pendulum Mass", "Angle", "Period", "Gravitational Acceleration"]
      },
      projectile: {
        name: "Projectile Motion Experiment",
        variables: ["Launch Angle", "Initial Speed", "Air Resistance", "Range", "Time of Flight"]
      },
      friction: {
        name: "Friction on an Inclined Plane",
        variables: ["Incline Angle", "Mass", "Friction Coefficient", "Acceleration", "Surface Roughness"]
      },
      hooke: {
        name: "Hooke's Law Experiment",
        variables: ["Applied Force", "Spring Extension", "Spring Constant", "Mass", "Initial Length"]
      },
      resistance: {
        name: "Electrical Resistance Experiment",
        variables: ["Voltage", "Current", "Resistance", "Wire Length", "Wire Temperature"]
      },
      // Chemistry Experiments
      reaction: {
        name: "Reaction Rate Experiment",
        variables: ["Temperature", "Concentration", "Reaction Rate", "Catalyst Amount", "pH Level"]
      },
      solubility: {
        name: "Solubility Experiment",
        variables: ["Solvent Temperature", "Solute Mass", "Solubility", "Stirring Speed", "Time"]
      },
      titration: {
        name: "Titration Experiment",
        variables: ["Titrant Volume", "Titrand Concentration", "pH Change", "Indicator", "Endpoint"]
      },
      electrolysis: {
        name: "Electrolysis Experiment",
        variables: ["Voltage", "Electrolyte Concentration", "Gas Volume", "Current", "Electrode Surface Area"]
      },
      diffusion: {
        name: "Diffusion Experiment",
        variables: ["Membrane Permeability", "Concentration Gradient", "Diffusion Rate", "Temperature", "Molecule Size"]
      },
      // Biology Experiments
      plant: {
        name: "Plant Growth Experiment",
        variables: ["Water Volume", "Sunlight Exposure", "Growth Rate", "Soil Nutrient", "Plant Species"]
      },
      enzyme: {
        name: "Enzyme Activity Experiment",
        variables: ["Temperature", "pH", "Enzyme Concentration", "Reaction Rate", "Substrate Concentration"]
      },
      photosynthesis: {
        name: "Photosynthesis Experiment",
        variables: ["Light Intensity", "CO₂ Concentration", "Oxygen Production", "Temperature", "Chlorophyll Concentration"]
      },
      bacteria: {
        name: "Bacterial Growth Experiment",
        variables: ["Incubation Temperature", "Nutrient Concentration", "Growth Rate", "pH Level", "Oxygen Level"]
      },
      respiration: {
        name: "Respiration Experiment",
        variables: ["Oxygen Concentration", "Carbon Dioxide Production", "Respiration Rate", "Temperature", "Activity Level"]
      }
    };

    /*********************
     * Experiment Standards & Accepted Variations
     *********************/
    // For each experiment, we list the accepted IVs and DVs. We also provide the expected DV response (effect)
    // for each possible IV.
    const experimentStandards = {
      pendulum: {
        acceptedIVs: ["Pendulum Length", "Pendulum Mass", "Angle", "Gravitational Acceleration"],
        acceptedDVs: ["Period"],
        expectedEffects: {
          "Pendulum Length": { effect: "increases with the square root" },
          "Pendulum Mass": { effect: "remains constant" },
          "Angle": { effect: "remains constant" },
          "Gravitational Acceleration": { effect: "decreases" }
        }
      },
      projectile: {
        acceptedIVs: ["Initial Speed", "Launch Angle", "Air Resistance"],
        acceptedDVs: ["Range", "Time of Flight"],
        expectedEffects: {
          "Initial Speed": { effect: "increases" },
          "Launch Angle": { effect: "increases" },
          "Air Resistance": { effect: "decreases" }
        }
      },
      friction: {
        acceptedIVs: ["Incline Angle", "Mass", "Friction Coefficient"],
        acceptedDVs: ["Acceleration"],
        expectedEffects: {
          "Incline Angle": { effect: "increases" },
          "Mass": { effect: "increases" },
          "Friction Coefficient": { effect: "decreases" }
        }
      },
      hooke: {
        acceptedIVs: ["Applied Force", "Spring Constant", "Mass"],
        acceptedDVs: ["Spring Extension"],
        expectedEffects: {
          "Applied Force": { effect: "increases" },
          "Spring Constant": { effect: "decreases" },
          "Mass": { effect: "increases" }
        }
      },
      resistance: {
        acceptedIVs: ["Voltage", "Wire Temperature"],
        acceptedDVs: ["Current"],
        expectedEffects: {
          "Voltage": { effect: "increases" },
          "Wire Temperature": { effect: "increases" }
        }
      },
      reaction: {
        acceptedIVs: ["Temperature", "Concentration"],
        acceptedDVs: ["Reaction Rate"],
        expectedEffects: {
          "Temperature": { effect: "increases" },
          "Concentration": { effect: "increases" }
        }
      },
      solubility: {
        acceptedIVs: ["Solvent Temperature", "Solute Mass"],
        acceptedDVs: ["Solubility"],
        expectedEffects: {
          "Solvent Temperature": { effect: "increases" },
          "Solute Mass": { effect: "increases" }
        }
      },
      titration: {
        acceptedIVs: ["Titrant Volume", "Titrand Concentration"],
        acceptedDVs: ["pH Change"],
        expectedEffects: {
          "Titrant Volume": { effect: "increases" },
          "Titrand Concentration": { effect: "increases" }
        }
      },
      electrolysis: {
        acceptedIVs: ["Voltage", "Electrolyte Concentration"],
        acceptedDVs: ["Gas Volume"],
        expectedEffects: {
          "Voltage": { effect: "increases" },
          "Electrolyte Concentration": { effect: "increases" }
        }
      },
      diffusion: {
        acceptedIVs: ["Concentration Gradient", "Temperature"],
        acceptedDVs: ["Diffusion Rate"],
        expectedEffects: {
          "Concentration Gradient": { effect: "increases" },
          "Temperature": { effect: "increases" }
        }
      },
      plant: {
        acceptedIVs: ["Water Volume", "Sunlight Exposure", "Soil Nutrient"],
        acceptedDVs: ["Growth Rate"],
        expectedEffects: {
          "Water Volume": { effect: "increases" },
          "Sunlight Exposure": { effect: "increases" },
          "Soil Nutrient": { effect: "increases" }
        }
      },
      enzyme: {
        acceptedIVs: ["Temperature", "pH", "Enzyme Concentration", "Substrate Concentration"],
        acceptedDVs: ["Reaction Rate"],
        expectedEffects: {
          "Temperature": { effect: "increases" },
          "pH": { effect: "remains constant" },
          "Enzyme Concentration": { effect: "increases" },
          "Substrate Concentration": { effect: "increases" }
        }
      },
      photosynthesis: {
        acceptedIVs: ["Light Intensity", "CO₂ Concentration", "Temperature"],
        acceptedDVs: ["Oxygen Production"],
        expectedEffects: {
          "Light Intensity": { effect: "increases" },
          "CO₂ Concentration": { effect: "increases" },
          "Temperature": { effect: "increases" }
        }
      },
      bacteria: {
        acceptedIVs: ["Nutrient Concentration", "Incubation Temperature", "pH Level", "Oxygen Level"],
        acceptedDVs: ["Growth Rate"],
        expectedEffects: {
          "Nutrient Concentration": { effect: "increases" },
          "Incubation Temperature": { effect: "increases" },
          "pH Level": { effect: "remains constant" },
          "Oxygen Level": { effect: "increases" }
        }
      },
      respiration: {
        acceptedIVs: ["Oxygen Concentration", "Temperature"],
        acceptedDVs: ["Respiration Rate"],
        expectedEffects: {
          "Oxygen Concentration": { effect: "increases" },
          "Temperature": { effect: "increases" }
        }
      }
    };

    /*********************
     * Populate the Variable Pool on Experiment Selection
     *********************/
    const experimentSelect = document.getElementById("experimentSelect");
    const variablePool = document.getElementById("variable-pool");

    experimentSelect.addEventListener("change", function() {
      const expKey = this.value;
      // Reset pool content to its default state
      variablePool.innerHTML = "";
      const heading = document.createElement("strong");
      heading.textContent = "Variables Pool:";
      variablePool.appendChild(heading);

      if (expKey && experiments[expKey]) {
        currentExperiment = experiments[expKey];
        // Populate pool with the experiment's variables (the pool remains static)
        currentExperiment.variables.forEach(variable => {
          const varElem = document.createElement("div");
          varElem.className = "draggable";
          varElem.setAttribute("draggable", "true");
          varElem.setAttribute("data-variable", variable);
          varElem.textContent = variable;
          varElem.addEventListener("dragstart", dragStart);
          variablePool.appendChild(varElem);
        });
      } else {
        currentExperiment = null;
        const p = document.createElement("p");
        p.textContent = "(Select an experiment to load its variables.)";
        variablePool.appendChild(p);
      }
      updateHypothesis();
    });

    /*********************
     * Drag and Drop Functionality
     *********************/
    // Add dragstart listener to any pre-existing draggables
    document.querySelectorAll('.draggable').forEach(elem => {
      elem.addEventListener('dragstart', dragStart);
    });

    // Make the pool droppable so that dragging an element from a zone back to the pool removes it
    variablePool.addEventListener("dragover", dragOver);
    variablePool.addEventListener("dragleave", dragLeave);
    variablePool.addEventListener("drop", drop);

    // Make the other zones droppable
    const zones = document.querySelectorAll('.zone');
    zones.forEach(zone => {
      // (The pool is also a zone, but we handle it separately in drop())
      zone.addEventListener('dragover', dragOver);
      zone.addEventListener('dragleave', dragLeave);
      zone.addEventListener('drop', drop);
    });

    function dragStart(e) {
      e.dataTransfer.setData("text/plain", e.target.getAttribute("data-variable"));
      e.dataTransfer.setData("sourceZone", e.target.parentElement.id);
      // If this element already has a unique id (i.e. it’s a clone in a drop zone), pass it along.
      if (e.target.id) {
        e.dataTransfer.setData("cloneId", e.target.id);
      }
    }

    function dragOver(e) {
      e.preventDefault();
      e.currentTarget.classList.add('hovered');
    }

    function dragLeave(e) {
      e.currentTarget.classList.remove('hovered');
    }

    function drop(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('hovered');
      const dropZoneId = e.currentTarget.id;
      const variable = e.dataTransfer.getData("text/plain");
      const sourceZone = e.dataTransfer.getData("sourceZone") || "";
      const cloneId = e.dataTransfer.getData("cloneId") || "";

      // If dropping into the pool, remove the dragged clone from its source (if not coming from the pool)
      if (dropZoneId === "variable-pool") {
        if (sourceZone !== "variable-pool" && cloneId) {
          const elem = document.getElementById(cloneId);
          if (elem && elem.parentNode) {
            elem.parentNode.removeChild(elem);
          }
        }
        // Do not add a new element to the pool (it remains static)
        return;
      }

      // For IV and DV zones, allow only one variable at a time.
      if ((dropZoneId === "iv-zone" || dropZoneId === "dv-zone") && e.currentTarget.children.length > 0) {
        // Remove the existing element from that zone
        const existing = e.currentTarget.children[0];
        e.currentTarget.removeChild(existing);
      }
      // (For the CV zone, we allow multiple variables.)

      // Create a new clone element for the drop zone.
      const newElem = document.createElement('div');
      newElem.className = 'draggable';
      newElem.textContent = variable;
      newElem.setAttribute('data-variable', variable);
      newElem.setAttribute("draggable", "true");
      // Assign a unique id so that we can remove it later if needed.
      newElem.id = "clone_" + idCounter++;
      newElem.addEventListener("dragstart", dragStart);
      newElem.addEventListener("dblclick", function() {
        e.currentTarget.removeChild(newElem);
        updateHypothesis();
      });

      e.currentTarget.appendChild(newElem);
      updateHypothesis();
    }

    /*********************
     * Add All Control Variables Button
     *********************/
    const addCVButton = document.getElementById("addCVButton");
    addCVButton.addEventListener("click", function() {
      if (!currentExperiment) return;
      const ivZone = document.getElementById("iv-zone");
      const dvZone = document.getElementById("dv-zone");
      const cvZone = document.getElementById("cv-zone");
      currentExperiment.variables.forEach(variable => {
        // Only add to CV if the variable is not already in IV or DV or CV.
        if (!isVariableInZone(ivZone, variable) &&
            !isVariableInZone(dvZone, variable) &&
            !isVariableInZone(cvZone, variable)) {
          const newElem = document.createElement('div');
          newElem.className = 'draggable';
          newElem.textContent = variable;
          newElem.setAttribute('data-variable', variable);
          newElem.setAttribute("draggable", "true");
          newElem.id = "clone_" + idCounter++;
          newElem.addEventListener("dragstart", dragStart);
          newElem.addEventListener("dblclick", function() {
            cvZone.removeChild(newElem);
            updateHypothesis();
          });
          cvZone.appendChild(newElem);
        }
      });
      updateHypothesis();
    });

    // Helper function to check if a variable is already present in a zone.
    function isVariableInZone(zone, variableName) {
      return Array.from(zone.children).some(child => child.getAttribute('data-variable') === variableName);
    }

    /*********************
     * Hypothesis Generator & Validation
     *********************/
    const ivActionSelect = document.getElementById("ivAction");
    const dvActionSelect = document.getElementById("dvAction");
    const hypothesisTextElem = document.getElementById("hypothesisText");

    // Update the hypothesis when relationship selections change.
    ivActionSelect.addEventListener('change', updateHypothesis);
    dvActionSelect.addEventListener('change', updateHypothesis);

    function updateHypothesis() {
      const ivZone = document.getElementById("iv-zone");
      const dvZone = document.getElementById("dv-zone");
      const cvZone = document.getElementById("cv-zone");

      const ivVariables = Array.from(ivZone.children).map(child => child.getAttribute('data-variable'));
      const dvVariables = Array.from(dvZone.children).map(child => child.getAttribute('data-variable'));
      const cvVariables = Array.from(cvZone.children).map(child => child.getAttribute('data-variable'));

      const ivAction = ivActionSelect.value || "[does something]";
      const dvAction = dvActionSelect.value || "[does something else]";

      let hypothesis = "";
      if (ivVariables.length === 0 && dvVariables.length === 0 && cvVariables.length === 0) {
        hypothesis = "Select an experiment, assign variables, and choose relationships to see your hypothesis.";
      } else {
        hypothesis += "If " + (ivVariables.length > 0 ? ivVariables.join(" and ") : "[Independent Variable]") + " " + ivAction;
        hypothesis += ", then " + (dvVariables.length > 0 ? dvVariables.join(" and ") : "[Dependent Variable]") + " " + dvAction;
        hypothesis += " provided that " + (cvVariables.length > 0 ? cvVariables.join(", ") : "all other variables") + " remain constant.";
      }
      hypothesisTextElem.textContent = hypothesis;

      // Validate the choices and update visual feedback.
      validateChoices();
    }

    function validateChoices() {
      if (!currentExperiment) return;
      const currentExpKey = experimentSelect.value;
      if (!experimentStandards[currentExpKey]) return;
      const standards = experimentStandards[currentExpKey];

      const ivZone = document.getElementById("iv-zone");
      const dvZone = document.getElementById("dv-zone");

      let ivAccepted = false;
      let dvAccepted = false;
      let relationshipCorrect = false;

      // Validate IV: it must be one of the accepted IVs.
      if (ivZone.children.length === 1) {
        const ivVariable = ivZone.children[0].getAttribute("data-variable");
        if (standards.acceptedIVs.includes(ivVariable)) {
          ivZone.children[0].style.backgroundColor = "#c8e6c9"; // light green
          ivAccepted = true;
        } else {
          ivZone.children[0].style.backgroundColor = "#ffcdd2"; // light red
        }
      }

      // Validate DV: it must be one of the accepted DVs.
      if (dvZone.children.length === 1) {
        const dvVariable = dvZone.children[0].getAttribute("data-variable");
        if (standards.acceptedDVs.includes(dvVariable)) {
          dvZone.children[0].style.backgroundColor = "#c8e6c9"; // light green
          dvAccepted = true;
        } else {
          dvZone.children[0].style.backgroundColor = "#ffcdd2"; // light red
        }
      }

      // Validate the DV relationship if there is exactly one IV and one DV.
      if (ivZone.children.length === 1 && dvZone.children.length === 1 && dvActionSelect.value) {
        const chosenIV = ivZone.children[0].getAttribute("data-variable");
        const expected = standards.expectedEffects[chosenIV];
        if (expected) {
          if (dvActionSelect.value === expected.effect) {
            dvActionSelect.style.border = "2px solid green";
            relationshipCorrect = true;
          } else {
            dvActionSelect.style.border = "2px solid red";
          }
        } else {
          dvActionSelect.style.border = "";
        }
      } else {
        dvActionSelect.style.border = "";
      }

      // Overall hypothesis correctness: all conditions must be met.
      if (ivAccepted && dvAccepted && relationshipCorrect) {
        hypothesisTextElem.classList.remove("incorrect");
        hypothesisTextElem.classList.add("correct");
      } else if (ivZone.children.length === 1 && dvZone.children.length === 1 && dvActionSelect.value) {
        // If all parts are filled but one or more is not accepted/correct, mark as incorrect.
        hypothesisTextElem.classList.remove("correct");
        hypothesisTextElem.classList.add("incorrect");
      } else {
        // Incomplete hypothesis – remove special highlighting.
        hypothesisTextElem.classList.remove("correct", "incorrect");
      }
    }

    /*********************
     * Reset Button Functionality
     *********************/
    document.getElementById("resetButton").addEventListener("click", function() {
      document.getElementById("iv-zone").innerHTML = "";
      document.getElementById("dv-zone").innerHTML = "";
      document.getElementById("cv-zone").innerHTML = "";
      ivActionSelect.selectedIndex = 0;
      dvActionSelect.selectedIndex = 0;
      updateHypothesis();
    });

  </script>
</body>
</html>
