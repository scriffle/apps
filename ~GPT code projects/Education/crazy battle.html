<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Student Space Battle Arena</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: radial-gradient(ellipse at center, #0c0c0c 0%, #000000 100%);
            overflow: hidden;
            font-family: 'Courier New', monospace;
            height: 100vh;
            position: relative;
        }

        /* Animated starfield background */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        .student {
            position: absolute;
            padding: 6px 10px;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff, #5f27cd);
            background-size: 400% 400%;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            font-size: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            cursor: crosshair;
            transition: all 0.2s ease;
            box-shadow: 0 0 10px rgba(255,255,255,0.3), inset 0 0 10px rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.6);
            animation: studentGlow 4s ease infinite;
            z-index: 10;
            user-select: none;
        }

        @keyframes studentGlow {
            0% { background-position: 0% 50%; box-shadow: 0 0 20px rgba(255,255,255,0.4); }
            25% { background-position: 100% 50%; box-shadow: 0 0 30px rgba(255,100,100,0.6); }
            50% { background-position: 100% 100%; box-shadow: 0 0 25px rgba(100,255,100,0.6); }
            75% { background-position: 0% 100%; box-shadow: 0 0 35px rgba(100,100,255,0.6); }
            100% { background-position: 0% 50%; box-shadow: 0 0 20px rgba(255,255,255,0.4); }
        }

        .student:hover {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 0 40px rgba(255,255,255,0.8);
        }

        .spaceship {
            position: absolute;
            width: 60px;
            height: 80px;
            background: linear-gradient(135deg, #74b9ff, #0984e3, #2d3436);
            clip-path: polygon(50% 0%, 0% 100%, 20% 85%, 50% 90%, 80% 85%, 100% 100%);
            box-shadow: 0 0 30px #74b9ff, inset 0 0 10px rgba(255,255,255,0.3);
            cursor: move;
            z-index: 50;
            animation: shipHover 2s ease-in-out infinite;
        }

        @keyframes shipHover {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(2deg); }
        }

        .cannon {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 20px;
            background: linear-gradient(to bottom, #ff7675, #d63031);
            border-radius: 4px;
            box-shadow: 0 0 10px #ff7675;
        }

        .laser {
            position: absolute;
            width: 8px;
            height: 30px;
            background: linear-gradient(to bottom, #00ff00, #ffffff, #00ff00);
            border-radius: 4px;
            box-shadow: 0 0 25px #00ff00, 0 0 50px #00ff00, inset 0 0 10px #ffffff;
            animation: laserMove 1s linear, laserPulse 0.1s ease-in-out infinite;
            z-index: 30;
        }

        @keyframes laserPulse {
            0%, 100% { transform: scaleX(1); }
            50% { transform: scaleX(1.3); }
        }

        @keyframes laserMove {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100vh); opacity: 0; }
        }

        .explosion {
            position: absolute;
            pointer-events: none;
            z-index: 100;
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: explode 1.2s ease-out forwards;
        }

        @keyframes explode {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: scale(0) rotate(720deg);
                opacity: 0;
            }
        }

        .respawn-indicator {
            position: absolute;
            color: #00ff00;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 0 0 10px #00ff00;
            animation: respawnGlow 1.5s ease-in-out;
            pointer-events: none;
            z-index: 50;
        }

        @keyframes respawnGlow {
            0% { transform: scale(0) rotate(-360deg); opacity: 0; }
            50% { transform: scale(1.3) rotate(0deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .hud {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 120px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 20px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            text-shadow: 0 0 10px #00ff00;
        }

        .stats {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .timer {
            font-size: 24px;
            color: #ff6b6b;
            text-shadow: 0 0 10px #ff6b6b;
        }

        .leaderboard {
            background: rgba(0,0,0,0.9);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(0,255,0,0.3);
        }

        .leaderboard h3 {
            margin-bottom: 10px;
            color: #feca57;
            text-align: center;
            text-shadow: 0 0 10px #feca57;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
            padding: 2px 5px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
        }

        .leaderboard-entry.top3 {
            background: rgba(255,215,0,0.3);
            color: #ffd700;
        }

        .winner-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.95);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 2000;
            animation: winnerAppear 2s ease-in-out;
        }

        @keyframes winnerAppear {
            0% { opacity: 0; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1); }
        }

        .winner-title {
            font-size: 60px;
            color: #ffd700;
            text-shadow: 0 0 30px #ffd700;
            margin-bottom: 20px;
            animation: winnerGlow 2s ease-in-out infinite;
        }

        @keyframes winnerGlow {
            0%, 100% { transform: scale(1); text-shadow: 0 0 30px #ffd700; }
            50% { transform: scale(1.1); text-shadow: 0 0 50px #ffd700, 0 0 80px #ffd700; }
        }

        .winner-name {
            font-size: 40px;
            color: #00ff00;
            text-shadow: 0 0 20px #00ff00;
            margin-bottom: 30px;
        }

        .restart-btn {
            padding: 15px 30px;
            font-size: 20px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255,255,255,0.8);
        }

        .power-up {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #ffd700, #ff6b6b);
            border-radius: 50%;
            animation: powerUpFloat 3s ease-in-out infinite, powerUpGlow 1s ease-in-out infinite;
            cursor: pointer;
            z-index: 20;
        }

        @keyframes powerUpFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        @keyframes powerUpGlow {
            0%, 100% { box-shadow: 0 0 10px #ffd700; }
            50% { box-shadow: 0 0 30px #ffd700, 0 0 50px #ff6b6b; }
        }

        .health-bar {
            position: absolute;
            top: -10px;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255,0,0,0.3);
            border-radius: 2px;
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(to right, #ff0000, #ffd700, #00ff00);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .combo-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700;
            pointer-events: none;
            z-index: 500;
            animation: comboShow 1s ease-out;
        }

        @keyframes comboShow {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    
    <div class="hud">
        <div class="stats">
            <div class="timer" id="timer">TIME: 05:00</div>
            <div>EXPLOSIONS: <span id="explosionCount">0</span></div>
            <div>CANNON SHOTS: <span id="cannonShots">0</span></div>
            <div>COMBO: <span id="combo">0</span></div>
        </div>
        
        <div class="leaderboard" id="leaderboard">
            <h3>üèÜ LEADERBOARD üèÜ</h3>
            <div id="leaderboardList"></div>
        </div>
    </div>

    <div class="game-container" id="gameContainer">
        <div class="spaceship" id="spaceship">
            <div class="cannon"></div>
        </div>
    </div>

    <div class="winner-screen" id="winnerScreen">
        <div class="winner-title">üèÜ CHAMPION! üèÜ</div>
        <div class="winner-name" id="winnerName"></div>
        <button class="restart-btn" onclick="restartGame()">PLAY AGAIN</button>
    </div>

    <script>
        const students = [
            "AHFAT Angel", "BIDINGAL Amarah", "BLYTH Olivia", "BRAY Tyler",
            "BRODIE Honey", "GHOSH Rish", "HALL Lucy", "HIGGS Angus",
            "HU Jacky", "KASAP Lauren", "KENNEDY Joel", "LAIRD Georgia",
            "LI Derek", "Li Serina", "Li Wendy", "MASON Charlotte",
            "MAY Lachlan", "MCLAUGHLIN Zoe", "MUTSAERS Ben", "SEDGMAN Nathan",
            "SHEERAN Inez", "Shi Kirsten", "STAPLETON Cooper", "Yung Winnie"
        ];

        const gameContainer = document.getElementById('gameContainer');
        const spaceship = document.getElementById('spaceship');
        const explosionCountEl = document.getElementById('explosionCount');
        const cannonShotsEl = document.getElementById('cannonShots');
        const comboEl = document.getElementById('combo');
        const timerEl = document.getElementById('timer');
        const leaderboardList = document.getElementById('leaderboardList');
        const winnerScreen = document.getElementById('winnerScreen');
        const winnerName = document.getElementById('winnerName');

        let gameState = {
            explosionCount: 0,
            cannonShots: 0,
            combo: 0,
            maxCombo: 0,
            timeLeft: 300, // 5 minutes
            gameRunning: true,
            leaderboard: {},
            powerUps: [],
            lasers: []
        };

        let studentElements = [];
        let keys = {};
        let audioContext;

        // Initialize audio context for sound effects
        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }

        // Sound effect functions
        function playSound(frequency, duration, type = 'sine', volume = 0.1) {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function playExplosion() {
            playSound(100, 0.3, 'sawtooth', 0.2);
            setTimeout(() => playSound(50, 0.5, 'square', 0.1), 100);
        }

        function playLaser() {
            playSound(800, 0.1, 'square', 0.15);
            setTimeout(() => playSound(600, 0.1, 'square', 0.1), 50);
        }

        function playPowerUp() {
            playSound(400, 0.2, 'sine', 0.2);
            setTimeout(() => playSound(600, 0.2, 'sine', 0.2), 100);
            setTimeout(() => playSound(800, 0.2, 'sine', 0.2), 200);
        }

        function playCombo() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    playSound(400 + i * 100, 0.1, 'sine', 0.15);
                }, i * 50);
            }
        }

        // Create animated starfield
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = (Math.random() * 3 + 1) + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                starsContainer.appendChild(star);
            }
        }

        class Student {
            constructor(name, index) {
                this.name = name;
                this.element = document.createElement('div');
                this.element.className = 'student';
                this.element.textContent = name;
                this.element.style.animationDelay = `${index * 0.1}s`;
                this.health = 100;
                this.maxHealth = 100;
                this.hits = 0;
                
                // Add health bar
                const healthBar = document.createElement('div');
                healthBar.className = 'health-bar';
                const healthFill = document.createElement('div');
                healthFill.className = 'health-fill';
                healthFill.style.width = '100%';
                healthBar.appendChild(healthFill);
                this.element.appendChild(healthBar);
                this.healthFill = healthFill;
                
                this.respawn();
                this.element.addEventListener('click', () => this.boost());
                gameContainer.appendChild(this.element);
                studentElements.push(this);
                
                if (!gameState.leaderboard[name]) {
                    gameState.leaderboard[name] = { explosions: 0, hits: 0, survival: 0 };
                }
            }

            respawn() {
                this.x = Math.random() * (window.innerWidth - 200);
                this.y = Math.random() * (window.innerHeight - 200) + 100;
                this.vx = (Math.random() - 0.5) * 10;
                this.vy = (Math.random() - 0.5) * 10;
                this.width = 0;
                this.height = 0;
                this.active = true;
                this.health = this.maxHealth;
                
                this.element.style.display = 'block';
                this.element.style.left = this.x + 'px';
                this.element.style.top = this.y + 'px';
                this.updateHealthBar();
                
                this.showRespawnIndicator();
                
                setTimeout(() => {
                    const rect = this.element.getBoundingClientRect();
                    this.width = rect.width;
                    this.height = rect.height;
                }, 10);
            }

            updateHealthBar() {
                const healthPercent = (this.health / this.maxHealth) * 100;
                this.healthFill.style.width = healthPercent + '%';
            }

            showRespawnIndicator() {
                const indicator = document.createElement('div');
                indicator.className = 'respawn-indicator';
                indicator.textContent = '‚ö° RESPAWN ‚ö°';
                indicator.style.left = this.x + 'px';
                indicator.style.top = (this.y - 40) + 'px';
                gameContainer.appendChild(indicator);
                
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.parentNode.removeChild(indicator);
                    }
                }, 1500);
            }

            boost() {
                this.vx *= 1.8;
                this.vy *= 1.8;
                this.element.style.transform = 'scale(1.3) rotate(360deg)';
                setTimeout(() => {
                    this.element.style.transform = 'scale(1)';
                }, 300);
                playPowerUp();
            }

            takeDamage(damage = 25) {
                if (!this.active) return false;
                
                this.health -= damage;
                this.hits++;
                this.updateHealthBar();
                
                if (this.health <= 0) {
                    this.explode();
                    return true;
                }
                
                // Flash effect
                this.element.style.filter = 'brightness(2) hue-rotate(90deg)';
                setTimeout(() => {
                    this.element.style.filter = 'none';
                }, 200);
                
                return false;
            }

            update() {
                if (!this.active || !gameState.gameRunning) return;

                this.x += this.vx;
                this.y += this.vy;

                // Bounce off walls with energy loss
                if (this.x <= 0 || this.x >= window.innerWidth - this.width) {
                    this.vx = -this.vx * 0.9;
                    this.x = Math.max(0, Math.min(this.x, window.innerWidth - this.width));
                }
                if (this.y <= 100 || this.y >= window.innerHeight - this.height) {
                    this.vy = -this.vy * 0.9;
                    this.y = Math.max(100, Math.min(this.y, window.innerHeight - this.height));
                }

                // Apply friction
                this.vx *= 0.999;
                this.vy *= 0.999;

                this.element.style.left = this.x + 'px';
                this.element.style.top = this.y + 'px';
                
                // Update survival time
                gameState.leaderboard[this.name].survival += 0.016;
            }

            checkCollision(other) {
                if (!this.active || !other.active || this === other) return false;
                
                const dx = (this.x + this.width/2) - (other.x + other.width/2);
                const dy = (this.y + this.height/2) - (other.y + other.height/2);
                const distance = Math.sqrt(dx*dx + dy*dy);
                const minDistance = (this.width + other.width) / 2.5;
                
                return distance < minDistance;
            }

            explode() {
                if (!this.active) return;
                
                this.active = false;
                gameState.explosionCount++;
                gameState.combo++;
                gameState.leaderboard[this.name].explosions++;
                
                explosionCountEl.textContent = gameState.explosionCount;
                comboEl.textContent = gameState.combo;
                
                if (gameState.combo > gameState.maxCombo) {
                    gameState.maxCombo = gameState.combo;
                }
                
                if (gameState.combo >= 3) {
                    this.showComboIndicator();
                    playCombo();
                }
                
                this.createExplosion();
                playExplosion();
                this.element.style.display = 'none';
                
                setTimeout(() => {
                    if (gameState.gameRunning) {
                        this.respawn();
                    }
                }, 3000 + Math.random() * 2000);
                
                // Reset combo after delay
                setTimeout(() => {
                    gameState.combo = 0;
                    comboEl.textContent = gameState.combo;
                }, 2000);
            }

            showComboIndicator() {
                const indicator = document.createElement('div');
                indicator.className = 'combo-indicator';
                indicator.textContent = `COMBO x${gameState.combo}!`;
                gameContainer.appendChild(indicator);
                
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.parentNode.removeChild(indicator);
                    }
                }, 1000);
            }

            createExplosion() {
                const centerX = this.x + this.width / 2;
                const centerY = this.y + this.height / 2;
                
                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    
                    const hue = Math.random() * 360;
                    particle.style.background = `hsl(${hue}, 100%, 50%)`;
                    
                    const angle = (i / 20) * Math.PI * 2;
                    const velocity = 80 + Math.random() * 120;
                    const distance = velocity;
                    
                    particle.style.left = centerX + 'px';
                    particle.style.top = centerY + 'px';
                    particle.style.transform = `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)`;
                    
                    gameContainer.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 1200);
                }
            }
        }

        class Laser {
            constructor(x, y) {
                this.element = document.createElement('div');
                this.element.className = 'laser';
                this.x = x;
                this.y = y;
                this.speed = 15;
                
                this.element.style.left = x + 'px';
                this.element.style.top = y + 'px';
                gameContainer.appendChild(this.element);
                gameState.lasers.push(this);
                
                playLaser();
            }

            update() {
                this.y -= this.speed;
                this.element.style.top = this.y + 'px';
                
                if (this.y < -50) {
                    this.destroy();
                    return;
                }
                
                // Check collision with students
                studentElements.forEach(student => {
                    if (student.active && this.checkCollision(student)) {
                        if (student.takeDamage(25)) {
                            gameState.leaderboard[student.name].hits++;
                        }
                        this.destroy();
                    }
                });
            }

            checkCollision(student) {
                const dx = this.x - (student.x + student.width/2);
                const dy = this.y - (student.y + student.height/2);
                const distance = Math.sqrt(dx*dx + dy*dy);
                return distance < 30;
            }

            destroy() {
                if (this.element.parentNode) {
                    this.element.parentNode.removeChild(this.element);
                }
                const index = gameState.lasers.indexOf(this);
                if (index > -1) {
                    gameState.lasers.splice(index, 1);
                }
            }
        }

        class PowerUp {
            constructor() {
                this.element = document.createElement('div');
                this.element.className = 'power-up';
                this.x = Math.random() * (window.innerWidth - 100) + 50;
                this.y = Math.random() * (window.innerHeight - 200) + 150;
                
                this.element.style.left = this.x + 'px';
                this.element.style.top = this.y + 'px';
                this.element.addEventListener('click', () => this.collect());
                
                gameContainer.appendChild(this.element);
                gameState.powerUps.push(this);
                
                // Auto-destroy after 10 seconds
                setTimeout(() => {
                    this.destroy();
                }, 10000);
            }

            collect() {
                // Random power-up effect
                const effects = [
                    () => { // Speed boost all students
                        studentElements.forEach(s => s.boost());
                    },
                    () => { // Damage all students
                        studentElements.forEach(s => {
                            if (s.active) s.takeDamage(50);
                        });
                    },
                    () => { // Extra time
                        gameState.timeLeft += 30;
                    },
                    () => { // Combo multiplier
                        gameState.combo += 5;
                    }
                ];
                
                effects[Math.floor(Math.random() * effects.length)]();
                playPowerUp();
                this.destroy();
            }

            destroy() {
                if (this.element.parentNode) {
                    this.element.parentNode.removeChild(this.element);
                }
                const index = gameState.powerUps.indexOf(this);
                if (index > -1) {
                    gameState.powerUps.splice(index, 1);
                }
            }
        }

        // Spaceship controls
        let spaceshipX = window.innerWidth / 2;
        let spaceshipY = window.innerHeight - 150;

        function updateSpaceship() {
            if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
                spaceshipX = Math.max(30, spaceshipX - 8);
            }
            if (keys['ArrowRight'] || keys['d'] || keys['D']) {
                spaceshipX = Math.min(window.innerWidth - 90, spaceshipX + 8);
            }
            if (keys['ArrowUp'] || keys['w'] || keys['W']) {
                spaceshipY = Math.max(120, spaceshipY - 8);
            }
            if (keys['ArrowDown'] || keys['s'] || keys['S']) {
                spaceshipY = Math.min(window.innerHeight - 100, spaceshipY + 8);
            }
            
            spaceship.style.left = spaceshipX + 'px';
            spaceship.style.top = spaceshipY + 'px';
        }

        function fireLaser() {
            new Laser(spaceshipX + 30, spaceshipY);
            gameState.cannonShots++;
            cannonShotsEl.textContent = gameState.cannonShots;
        }

        // Event listeners
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ' || e.key === 'Enter') {
                e.preventDefault();
                fireLaser();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        document.addEventListener('click', (e) => {
            if (e.target === gameContainer || e.target === spaceship) {
                fireLaser();
            }
        });

        // Initialize audio on first user interaction
        document.addEventListener('click', () => {
            if (!audioContext) {
                initAudio();
            }
        }, { once: true });

        function updateLeaderboard() {
            const sortedStudents = Object.entries(gameState.leaderboard)
                .map(([name, stats]) => ({
                    name,
                    score: stats.explosions * 100 + stats.hits * 10 + Math.floor(stats.survival)
                }))
                .sort((a, b) => b.score - a.score);

            leaderboardList.innerHTML = sortedStudents
                .slice(0, 8)
                .map((student, index) => 
                    `<div class="leaderboard-entry ${index < 3 ? 'top3' : ''}">
                        <span>${index + 1}. ${student.name}</span>
                        <span>${student.score}</span>
                    </div>`
                ).join('');
        }

        function updateTimer() {
            if (!gameState.gameRunning) return;
            
            gameState.timeLeft--;
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            timerEl.textContent = `TIME: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (gameState.timeLeft <= 0) {
                endGame();
            }
        }

        function endGame() {
            gameState.gameRunning = false;
            
            const winner = Object.entries(gameState.leaderboard)
                .map(([name, stats]) => ({
                    name,
                    score: stats.explosions * 100 + stats.hits * 10 + Math.floor(stats.survival)
                }))
                .sort((a, b) => b.score - a.score)[0];
            
            winnerName.textContent = winner.name;
            winnerScreen.style.display = 'flex';
            
            // Victory sound
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    playSound(400 + i * 50, 0.3, 'sine', 0.2);
                }, i * 100);
            }
        }

        function restartGame() {
            gameState = {
                explosionCount: 0,
                cannonShots: 0,
                combo: 0,
                maxCombo: 0,
                timeLeft: 300,
                gameRunning: true,
                leaderboard: {},
                powerUps: [],
                lasers: []
            };
            
            winnerScreen.style.display = 'none';
            
            // Clear existing elements
            studentElements.forEach(student => {
                if (student.element.parentNode) {
                    student.element.parentNode.removeChild(student.element);
                }
            });
            studentElements = [];
            
            // Reset displays
            explosionCountEl.textContent = '0';
            cannonShotsEl.textContent = '0';
            comboEl.textContent = '0';
            
            // Recreate students
            students.forEach((name, index) => {
                setTimeout(() => {
                    new Student(name, index);
                }, index * 150);
            });
        }

        // Game loop
        function gameLoop() {
            if (gameState.gameRunning) {
                updateSpaceship();
                
                studentElements.forEach(student => {
                    student.update();
                });
                
                gameState.lasers.forEach(laser => {
                    laser.update();
                });
                
                // Check collisions between students
                for (let i = 0; i < studentElements.length; i++) {
                    for (let j = i + 1; j < studentElements.length; j++) {
                        if (studentElements[i].checkCollision(studentElements[j])) {
                            studentElements[i].explode();
                            studentElements[j].explode();
                        }
                    }
                }
                
                updateLeaderboard();
                
                // Spawn power-ups occasionally
                if (Math.random() < 0.002 && gameState.powerUps.length < 3) {
                    new PowerUp();
                }
            }
            
            requestAnimationFrame(gameLoop);
        }

        // Initialize game
        createStars();
        
        students.forEach((name, index) => {
            setTimeout(() => {
                new Student(name, index);
            }, index * 100);
        });

        // Start timers
        setInterval(updateTimer, 1000);
        gameLoop();
    </script>
</body>
</html>