<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physical vs Chemical Changes Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            padding: 10px;
            margin: 0;
        }
        .quiz-container {
            background: white;
            padding: 10px;
            border-radius: 8px;
            max-width: 800px;
            margin: 10px auto;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            margin-top: 0;
        }
        .question {
            margin: 5px 0;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fafafa;
        }
        .question p {
            margin: 3px 0;
        }
        button {
            margin: 2px;
            padding: 6px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            box-shadow: 0px 2px 5px rgba(0,0,0,0.15);
        }
        /* Default highlight for user selection (before reveal) */
        .choice-btn.selected {
            background-color: #cbe7f9;
            color: #000;
            border: 1px solid #0094b1;
        }
        /* After reveal classes */
        .correct {
            background-color: #4CAF50 !important; /* green */
            color: #fff !important;
            font-weight: bold;
        }
        .incorrect {
            background-color: #f44336 !important; /* red */
            color: #fff !important;
        }
        .user-selected {
            /* Show a bold blue outline so we can still see correct/incorrect background colors */
            outline: 3px solid #2653d4;
            background-color: inherit !important;
            color: inherit !important;
        }
        /* Sparkle effect for button selection */
        @keyframes sparkle {
            0% {
                box-shadow: 0 0 5px 2px yellow;
            }
            50% {
                box-shadow: 0 0 15px 6px gold;
            }
            100% {
                box-shadow: 0 0 5px 2px yellow;
            }
        }
        .sparkle {
            animation: sparkle 0.5s ease;
        }
        .answer {
            margin-top: 5px;
            color: #333;
            font-style: italic;
        }
        #score {
            font-weight: bold;
        }
        .hidden {
            display: none;
        }
        .btn {
            background-color: #00b4d8;
            color: white;
            transition: background-color 0.3s ease;
            margin: 5px 2px;
        }
        .btn:hover {
            background-color: #0094b1;
        }
        /* We add an invisible input for the code, but no instructions referencing TELLME. */
        #code {
            margin-top: 10px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h2>Classify the Following Changes</h2>
        <p style="margin-bottom: 5px;">Select Physical, Chemical, or Both. Score updates dynamically. Press <strong>Show Answers</strong> to reveal correct and incorrect answers.</p>
        <div id="quiz"></div>
        <p id="score">Score: 0 / 0</p>
        <!-- We keep an input for the code, but do not mention TELLME in the instructions. -->
        <input type="text" id="code" placeholder="Enter code" />
        <button class="btn" id="answersBtn">Show Answers</button>
        <button class="btn" id="resetBtn">Reset</button>
    </div>

    <script>
        // Full dataset of 30 chemical, 30 physical, and 15 both
        const fullChanges = [
            // 30 CHEMICAL
            {process: "Burning wood", type: "Chemical", explanation: "Forms new substances (ash, gases)."},
            {process: "Rusting iron", type: "Chemical", explanation: "Iron reacts with oxygen to form iron oxide."},
            {process: "Baking a cake", type: "Chemical", explanation: "Ingredients react to form a new substance."},
            {process: "Fireworks explosion", type: "Chemical", explanation: "Chemical reactions produce light, sound, gases."},
            {process: "Souring milk", type: "Chemical", explanation: "Bacteria produce new compounds (lactic acid)."},
            {process: "Digesting food", type: "Chemical", explanation: "Enzymes break down food into new substances."},
            {process: "Burning gasoline", type: "Chemical", explanation: "Combustion produces CO2 and water."},
            {process: "Cooking an egg", type: "Chemical", explanation: "Heat changes protein structure irreversibly."},
            {process: "Vinegar and baking soda", type: "Chemical", explanation: "Acid-base reaction releases CO2."},
            {process: "Tarnishing silver", type: "Chemical", explanation: "Silver reacts with sulfur to form silver sulfide."},
            {process: "Rotting fruit", type: "Chemical", explanation: "Decomposition leads to new substances."},
            {process: "Exploding dynamite", type: "Chemical", explanation: "Rapid chemical reaction releasing energy."},
            {process: "Photosynthesis", type: "Chemical", explanation: "Plants convert CO2 and water into glucose and O2."},
            {process: "Respiration", type: "Chemical", explanation: "Cells convert glucose and oxygen into CO2, water."},
            {process: "Corroding metal", type: "Chemical", explanation: "Metal reacts with environment forming oxides."},
            {process: "Fermenting grapes", type: "Chemical", explanation: "Yeast converts sugars into alcohol and CO2."},
            {process: "Burning paper", type: "Chemical", explanation: "Paper reacts with oxygen to form ash and smoke."},
            {process: "Cooking meat", type: "Chemical", explanation: "Proteins denature and form new substances."},
            {process: "Acid rain on marble", type: "Chemical", explanation: "Acid dissolves marble, forming new compounds."},
            {process: "Bleaching hair", type: "Chemical", explanation: "Chemical oxidants remove pigment."},
            {process: "Copper turning green", type: "Chemical", explanation: "Copper reacts to form copper carbonate (patina)."},
            {process: "Exploding methane", type: "Chemical", explanation: "Methane combusts producing CO2 and water."},
            {process: "Making caramel", type: "Chemical", explanation: "Sugar decomposes under heat into new substances."},
            {process: "Decaying leaves", type: "Chemical", explanation: "Microorganisms break down leaf compounds."},
            {process: "Baking bread", type: "Chemical", explanation: "Yeast ferments sugar, producing CO2."},
            {process: "Lighting a match", type: "Chemical", explanation: "Friction ignites chemicals producing flame."},
            {process: "Alka-Seltzer in water", type: "Chemical", explanation: "Tablets react releasing CO2 gas."},
            {process: "Cooking pasta", type: "Chemical", explanation: "Starch partially hydrolyzes, forms new textures."},
            {process: "Digestion of proteins", type: "Chemical", explanation: "Proteins broken down into amino acids."},
            {process: "Browning of apples", type: "Chemical", explanation: "Enzymatic reaction producing brown pigments."},

            // 30 PHYSICAL
            {process: "Melting ice", type: "Physical", explanation: "Solid water changes to liquid water."},
            {process: "Boiling water", type: "Physical", explanation: "Liquid water changes to vapor."},
            {process: "Breaking a glass", type: "Physical", explanation: "Glass is shattered but composition unchanged."},
            {process: "Cutting paper", type: "Physical", explanation: "Paper is cut into pieces but still paper."},
            {process: "Dissolving sugar in water", type: "Physical", explanation: "Sugar mixes, no new substance formed."},
            {process: "Chopping wood", type: "Physical", explanation: "Wood is cut but still wood."},
            {process: "Stretching a rubber band", type: "Physical", explanation: "Shape changes but material is the same."},
            {process: "Crushing a can", type: "Physical", explanation: "Can deforms but remains the same metal."},
            {process: "Shredding cheese", type: "Physical", explanation: "Size changes but composition unchanged."},
            {process: "Condensation on a window", type: "Physical", explanation: "Water vapor becomes liquid."},
            {process: "Freezing juice", type: "Physical", explanation: "Liquid juice becomes solid, still juice."},
            {process: "Sharpening a pencil", type: "Physical", explanation: "Shape changes but material is same."},
            {process: "Mixing sand and salt", type: "Physical", explanation: "No new substance, just a mixture."},
            {process: "Folding paper", type: "Physical", explanation: "Shape changes, composition does not."},
            {process: "Bending a metal rod", type: "Physical", explanation: "Shape changes but it's still metal."},
            {process: "Dissolving salt in water", type: "Physical", explanation: "Ions disperse, no new substance made."},
            {process: "Filtering coffee", type: "Physical", explanation: "Separation of components, no reaction."},
            {process: "Mixing oil and vinegar", type: "Physical", explanation: "They form a mixture but don't react."},
            {process: "Molding clay", type: "Physical", explanation: "Shape changes but composition same."},
            {process: "Cutting a carrot", type: "Physical", explanation: "Carrot pieces remain carrot."},
            {process: "Blowing up a balloon", type: "Physical", explanation: "Air is added, shape changes."},
            {process: "Rolling cookie dough", type: "Physical", explanation: "Shape changes, still dough."},
            {process: "Magnetizing iron", type: "Physical", explanation: "Aligns domains, no new substance."},
            {process: "Sanding wood", type: "Physical", explanation: "Surface is smoothed, still wood."},
            {process: "Cracking an egg", type: "Physical", explanation: "Shell breaks, inside unchanged chemically."},
            {process: "Stretching dough", type: "Physical", explanation: "Shape changes, same dough."},
            {process: "Mixing marbles", type: "Physical", explanation: "No reaction, just combining objects."},
            {process: "Filing nails", type: "Physical", explanation: "Shape changes, composition same."},
            {process: "Dew forming on grass", type: "Physical", explanation: "Water vapor condenses to liquid."},
            {process: "Ice cream melting", type: "Physical", explanation: "Phase change, no new substance."},

            // 15 BOTH (ambiguous)
            {process: "Boiling an egg", type: "Both", explanation: "Water boils (physical) but egg proteins change (chemical)."},
            {process: "Burning magnesium", type: "Both", explanation: "Burning is chemical; bright light, physical heat effects."},
            {process: "Cooking sugar to syrup", type: "Both", explanation: "Sugar melts (physical) then caramelizes (chemical)."},
            {process: "Rusting and flaking iron", type: "Both", explanation: "Rusting is chemical; flaking is physical."},
            {process: "Cutting an onion", type: "Both", explanation: "Cutting is physical; enzymatic tear reaction is chemical."},
            {process: "Dissolving an effervescent tablet", type: "Both", explanation: "Tablet dissolves (physical), reaction releases gas (chemical)."},
            {process: "Melting wax & burning wick", type: "Both", explanation: "Wax melts (physical), wick burns (chemical)."},
            {process: "Painting wood", type: "Both", explanation: "Physical coating but possible chemical curing of paint."},
            {process: "Tarnishing & polishing silver", type: "Both", explanation: "Tarnishing is chemical, polishing is physical removal."},
            {process: "Welding metal", type: "Both", explanation: "Metal melts (physical), can oxidize (chemical)."},
            {process: "Making ice cream w/liquid nitrogen", type: "Both", explanation: "Physical freezing, potential chemical interactions."},
            {process: "Carbonating water", type: "Both", explanation: "Gas dissolves (physical), forms carbonic acid (chemical)."},
            {process: "Heating sugar", type: "Both", explanation: "Melting is physical, decomposition is chemical."},
            {process: "Mixing cement with water", type: "Both", explanation: "Combining is physical, curing is chemical."},
            {process: "Hardening of glue", type: "Both", explanation: "Solvent evaporates (physical), polymerization is chemical."},
        ];

        // Shuffle array each load
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function loadAnswersFromStorage() {
            const saved = localStorage.getItem('quizAnswers');
            if (saved) {
                return JSON.parse(saved);
            } else {
                return {};
            }
        }

        function saveAnswersToStorage(answersObj) {
            localStorage.setItem('quizAnswers', JSON.stringify(answersObj));
        }

        // Build quiz
        let changes = [...fullChanges];
        shuffle(changes);
        
        const quizContainer = document.getElementById('quiz');
        let answersFromStorage = loadAnswersFromStorage();

        function buildQuiz() {
            quizContainer.innerHTML = '';
            for (let i = 0; i < changes.length; i++) {
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('question');
                
                const qNumber = i + 1;
                const processText = changes[i].process;
                const explanation = changes[i].explanation;
                
                questionDiv.innerHTML = `
                    <p><strong>${qNumber}.</strong> ${processText}</p>
                    <button class="choice-btn" data-process="${processText}" data-choice="Physical" data-index="${i}">Physical</button>
                    <button class="choice-btn" data-process="${processText}" data-choice="Chemical" data-index="${i}">Chemical</button>
                    <button class="choice-btn" data-process="${processText}" data-choice="Both" data-index="${i}">Both</button>
                    <p class="answer hidden" id="answer-${i}">
                        <strong>Explanation:</strong> ${explanation}
                    </p>
                `;

                quizContainer.appendChild(questionDiv);
            }
        }

        function computeScore() {
            let correctCount = 0;
            for (let i = 0; i < changes.length; i++) {
                const processText = changes[i].process;
                const correctType = changes[i].type;
                const userChoice = answersFromStorage[processText] || null;
                if (userChoice === correctType) {
                    correctCount++;
                }
            }
            document.getElementById('score').innerText = `Score: ${correctCount} / ${changes.length}`;
        }

        // Highlight selected button (before reveal)
        function highlightSelected(index, choice) {
            // Get all choice buttons for this question
            const questionButtons = document.querySelectorAll(`button[data-index='${index}']`);
            questionButtons.forEach(btn => {
                btn.classList.remove('selected');
                if (btn.getAttribute('data-choice') === choice) {
                    btn.classList.add('selected');
                }
            });
        }

        function selectAnswer(process, choice, index) {
            // add sparkle effect
            const buttonsForQ = document.querySelectorAll(`button[data-index='${index}']`);
            buttonsForQ.forEach(b => b.classList.remove('sparkle'));
            const chosenBtn = document.querySelector(`button[data-index='${index}'][data-choice='${choice}']`);
            if(chosenBtn){
                chosenBtn.classList.add('sparkle');
                setTimeout(()=>{
                    chosenBtn.classList.remove('sparkle');
                }, 600);
            }

            answersFromStorage[process] = choice;
            saveAnswersToStorage(answersFromStorage);
            highlightSelected(index, choice);
            computeScore();
        }

        // Show all correct/wrong answers if code is 'TELLME'; else prompt
        function revealAnswers() {
            const codeInput = document.getElementById('code');
            const code = codeInput.value.trim();

            if (code === 'TELLME') {
                for (let i = 0; i < changes.length; i++) {
                    const processText = changes[i].process;
                    const correctType = changes[i].type;
                    const userChoice = answersFromStorage[processText] || null;

                    // Show explanation
                    document.getElementById(`answer-${i}`).classList.remove('hidden');

                    // Identify all buttons for this question
                    const questionButtons = document.querySelectorAll(`button[data-index='${i}']`);

                    // Remove highlight classes
                    questionButtons.forEach(btn => {
                        btn.classList.remove('selected', 'correct', 'incorrect', 'user-selected', 'sparkle');
                    });

                    // Mark the correct button as .correct
                    questionButtons.forEach(btn => {
                        if (btn.getAttribute('data-choice') === correctType) {
                            btn.classList.add('correct');
                        }
                    });

                    // Mark the user's chosen button
                    if (userChoice) {
                        questionButtons.forEach(btn => {
                            if (btn.getAttribute('data-choice') === userChoice) {
                                // If user choice matches correct type => highlight differently
                                if (userChoice === correctType) {
                                    btn.classList.add('correct');
                                } else {
                                    btn.classList.add('incorrect');
                                }
                                // Add user-selected class for bold blue outline
                                btn.classList.add('user-selected');
                            }
                        });
                    }
                }
            } else {
                // If user enters something but not TELLME
                alert("That code is incorrect. Please ask your teacher.");
            }
        }

        // Reset quiz
        function resetQuiz(){
            const doReset = confirm("Are you sure you want to reset your answers? This will clear your progress.");
            if(doReset){
                localStorage.removeItem('quizAnswers');
                window.location.reload();
            }
        }

        // Event delegation for choice buttons
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('choice-btn')) {
                const process = e.target.getAttribute('data-process');
                const choice = e.target.getAttribute('data-choice');
                const index = parseInt(e.target.getAttribute('data-index'), 10);
                selectAnswer(process, choice, index);
            }
        });

        // Event listener for show answers button
        document.getElementById('answersBtn').addEventListener('click', revealAnswers);

        // Event listener for reset button
        document.getElementById('resetBtn').addEventListener('click', resetQuiz);

        // Build quiz and initial score
        buildQuiz();

        // Mark any already selected answers in local storage
        // This ensures highlight remains on refresh
        function restoreSelections() {
            for (let i = 0; i < changes.length; i++) {
                const processText = changes[i].process;
                const userChoice = answersFromStorage[processText];
                if (userChoice) {
                    highlightSelected(i, userChoice);
                }
            }
        }

        restoreSelections();
        computeScore();
    </script>
</body>
</html>
