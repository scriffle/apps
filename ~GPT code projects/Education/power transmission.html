<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: system-ui; max-width: 1200px; margin: 20px auto; padding: 0 20px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
    .panel { padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
    .slider { width: 100%; margin: 10px 0; }
    .results { background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px; }
    canvas { width: 100%; height: 200px; border: 1px solid #ccc; margin-bottom: 20px; }
    label { display: block; margin-top: 10px; }
    .charts { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
  </style>
</head>
<body>
  <h1>AC Power Transmission Calculator - Grid to Home</h1>
  
  <div class="grid">
    <div class="panel">
      <h2>Generation & Transmission</h2>
      <label>Generator Voltage (kV):
        <input type="range" id="genVoltage" class="slider" min="1" max="50" value="13.8" step="0.1">
        <span id="genVoltageValue">13.8 kV</span>
      </label>
      
      <label>Power to Transmit (MVA):
        <input type="range" id="power" class="slider" min="1" max="100" value="50" step="1">
        <span id="powerValue">50 MVA</span>
      </label>
      
      <label>Transmission Distance (km):
        <input type="range" id="distance" class="slider" min="1" max="500" value="100" step="1">
        <span id="distanceValue">100 km</span>
      </label>
      
      <label>Line Resistance (Ω/km):
        <input type="range" id="resistance" class="slider" min="0.1" max="2" value="0.3" step="0.1">
        <span id="resistanceValue">0.3 Ω/km</span>
      </label>
    </div>
    
    <div class="panel">
      <h2>Transformer Configuration</h2>
      <label>HV Transmission Ratio (13.8kV →):
        <input type="range" id="stepUpRatio" class="slider" min="1" max="20" value="10" step="0.1">
        <span id="stepUpRatioValue">10x</span>
      </label>
      
      <label>Distribution Ratio (→33kV):
        <input type="range" id="distRatio" class="slider" min="1" max="10" value="4.2" step="0.1">
        <span id="distRatioValue">4.2x</span>
      </label>

      <label>Local Step-down (33kV → 11kV):
        <input type="range" id="localRatio" class="slider" min="1" max="5" value="3" step="0.1">
        <span id="localRatioValue">3x</span>
      </label>

      <label>Final Residential (11kV → 240V):
        <input type="range" id="residentialRatio" class="slider" min="20" max="60" value="45.8" step="0.1">
        <span id="residentialRatioValue">45.8x</span>
      </label>
      
      <div class="results">
        <h3>Results:</h3>
        <p>Transmission Voltage: <span id="transVoltage">0</span> kV</p>
        <p>Distribution Voltage: <span id="distVoltage">0</span> kV</p>
        <p>Local Voltage: <span id="localVoltage">0</span> kV</p>
        <p>Residential Voltage: <span id="residentialVoltage">0</span> V</p>
        <p>Total Voltage Drop: <span id="vDrop">0</span> V (<span id="vDropPercent">0</span>%)</p>
        <p>Power Loss: <span id="powerLoss">0</span> MW</p>
        <p>System Efficiency: <span id="efficiency">0</span>%</p>
      </div>
    </div>
  </div>
  
  <canvas id="diagram"></canvas>
  
  <div class="charts">
    <canvas id="voltageProfile"></canvas>
    <canvas id="powerLossProfile"></canvas>
  </div>

  <script>
    // Get all input elements
    const inputs = {
      genVoltage: document.getElementById('genVoltage'),
      power: document.getElementById('power'),
      distance: document.getElementById('distance'),
      resistance: document.getElementById('resistance'),
      stepUpRatio: document.getElementById('stepUpRatio'),
      distRatio: document.getElementById('distRatio'),
      localRatio: document.getElementById('localRatio'),
      residentialRatio: document.getElementById('residentialRatio')
    };
    
    // Update values and recalculate when any input changes
    Object.keys(inputs).forEach(key => {
      inputs[key].addEventListener('input', () => {
        document.getElementById(`${key}Value`).textContent = 
          `${inputs[key].value}${getUnit(key)}`;
        const results = calculate();
        drawDiagram();
        drawVoltageProfile(results);
        drawPowerLossProfile(results);
      });
    });
    
    function getUnit(key) {
      const units = {
        genVoltage: ' kV',
        power: ' MVA',
        distance: ' km',
        resistance: ' Ω/km',
        stepUpRatio: 'x',
        distRatio: 'x',
        localRatio: 'x',
        residentialRatio: 'x'
      };
      return units[key];
    }
    
    function calculate() {
      // Get input values
      const genV = parseFloat(inputs.genVoltage.value);
      const power = parseFloat(inputs.power.value) * 1e6;  // Convert to VA
      const distance = parseFloat(inputs.distance.value);
      const resistance = parseFloat(inputs.resistance.value);
      const stepUp = parseFloat(inputs.stepUpRatio.value);
      const distRatio = parseFloat(inputs.distRatio.value);
      const localRatio = parseFloat(inputs.localRatio.value);
      const residentialRatio = parseFloat(inputs.residentialRatio.value);
      
      // Calculate voltages at each stage
      const transV = genV * stepUp;
      const distV = transV / distRatio;
      const localV = distV / localRatio;
      const residentialV = (localV * 1000) / residentialRatio; // Convert to V
      
      // Calculate currents at each stage
      const transCurrent = power / (transV * 1000);
      const distCurrent = power / (distV * 1000);
      const localCurrent = power / (localV * 1000);
      const residentialCurrent = power / residentialV;
      
      // Calculate voltage drops and losses
      const totalR = resistance * distance;
      const vDrop = (transCurrent * totalR) * 1000; // Convert to V
      const vDropPercent = (vDrop / (transV * 1000)) * 100;
      
      const powerLoss = (transCurrent * transCurrent * totalR) / 1e6; // Convert to MW
      const efficiency = ((power - powerLoss * 1e6) / power) * 100;
      
      // Update results
      document.getElementById('transVoltage').textContent = transV.toFixed(1);
      document.getElementById('distVoltage').textContent = distV.toFixed(1);
      document.getElementById('localVoltage').textContent = localV.toFixed(1);
      document.getElementById('residentialVoltage').textContent = residentialV.toFixed(1);
      document.getElementById('vDrop').textContent = vDrop.toFixed(1);
      document.getElementById('vDropPercent').textContent = vDropPercent.toFixed(1);
      document.getElementById('powerLoss').textContent = powerLoss.toFixed(2);
      document.getElementById('efficiency').textContent = efficiency.toFixed(1);

      return {
        transV,
        distV,
        localV,
        residentialV,
        vDrop,
        powerLoss,
        distance,
        transCurrent
      };
    }

    function drawVoltageProfile(results) {
      const canvas = document.getElementById('voltageProfile');
      const ctx = canvas.getContext('2d');
      
      // Set canvas size
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw axes
      ctx.beginPath();
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      ctx.moveTo(50, 30);
      ctx.lineTo(50, canvas.height - 30);
      ctx.lineTo(canvas.width - 30, canvas.height - 30);
      ctx.stroke();
      
      // Draw voltage profile
      ctx.beginPath();
      ctx.strokeStyle = '#8884d8';
      ctx.lineWidth = 2;
      
      const xScale = (canvas.width - 80) / results.distance;
      const yScale = (canvas.height - 60) / results.transV;
      
      ctx.moveTo(50, canvas.height - 30 - (results.transV * yScale));
      
      for(let x = 0; x <= results.distance; x += results.distance/100) {
        const voltage = results.transV - (results.vDrop * x / results.distance / 1000);
        ctx.lineTo(
          50 + x * xScale,
          canvas.height - 30 - (voltage * yScale)
        );
      }
      ctx.stroke();
      
      // Add labels
      ctx.fillStyle = '#000';
      ctx.font = '12px system-ui';
      ctx.fillText('Voltage (kV)', 10, canvas.height/2);
      ctx.fillText('Distance (km)', canvas.width/2, canvas.height - 10);
      ctx.fillText('Voltage Profile', canvas.width/2 - 40, 20);
    }

    function drawPowerLossProfile(results) {
      const canvas = document.getElementById('powerLossProfile');
      const ctx = canvas.getContext('2d');
      
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw axes
      ctx.beginPath();
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      ctx.moveTo(50, 30);
      ctx.lineTo(50, canvas.height - 30);
      ctx.lineTo(canvas.width - 30, canvas.height - 30);
      ctx.stroke();
      
      // Draw power loss profile
      ctx.beginPath();
      ctx.strokeStyle = '#82ca9d';
      ctx.lineWidth = 2;
      
      const xScale = (canvas.width - 80) / results.distance;
      const yScale = (canvas.height - 60) / results.powerLoss;
      
      ctx.moveTo(50, canvas.height - 30);
      
      for(let x = 0; x <= results.distance; x += results.distance/100) {
        const loss = (results.powerLoss * x / results.distance);
        ctx.lineTo(
          50 + x * xScale,
          canvas.height - 30 - (loss * yScale)
        );
      }
      ctx.stroke();
      
      // Add labels
      ctx.fillStyle = '#000';
      ctx.font = '12px system-ui';
      ctx.fillText('Power Loss (MW)', 10, canvas.height/2);
      ctx.fillText('Distance (km)', canvas.width/2, canvas.height - 10);
      ctx.fillText('Power Loss Profile', canvas.width/2 - 40, 20);
    }
    
    function drawDiagram() {
      const canvas = document.getElementById('diagram');
      const ctx = canvas.getContext('2d');
      
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const results = calculate();
      
      ctx.strokeStyle = '#333';
      ctx.lineWidth = 2;
      ctx.font = '14px system-ui';
      
      // Generator
      ctx.beginPath();
      ctx.arc(50, 100, 20, 0, 2 * Math.PI);
      ctx.stroke();
      ctx.fillText('G', 45, 105);
      
      // Step-up transformer (Generator to Transmission)
      drawTransformer(150, 100);
      ctx.fillText(`${inputs.genVoltage.value}kV → ${results.transV.toFixed(1)}kV`, 120, 80);
      
      // Transmission line
      ctx.beginPath();
      ctx.moveTo(200, 100);
      ctx.lineTo(400, 100);
      ctx.stroke();
      
      // Distribution transformer
      drawTransformer(450, 100);
      ctx.fillText(`${results.transV.toFixed(1)}kV → ${results.distV.toFixed(1)}kV`, 420, 80);
      
      // Distribution line
      ctx.beginPath();
      ctx.moveTo(500, 100);
      ctx.lineTo(600, 100);
      ctx.stroke();
      
      // Local transformer
      drawTransformer(650, 100);
      ctx.fillText(`${results.distV.toFixed(1)}kV → ${results.localV.toFixed(1)}kV`, 620, 80);
      
      // Local line
      ctx.beginPath();
      ctx.moveTo(700, 100);
      ctx.lineTo(800, 100);
      ctx.stroke();
      
      // Residential transformer
      drawTransformer(850, 100);
      ctx.fillText(`${results.localV.toFixed(1)}kV → 240V`, 820, 80);
      
      // House
      ctx.beginPath();
      ctx.moveTo(900, 90);
      ctx.lineTo(920, 70);
      ctx.lineTo(940, 90);
      ctx.lineTo(940, 110);
      ctx.lineTo(900, 110);
      ctx.closePath();
      ctx.stroke();
      
      function drawTransformer(x, y) {
        ctx.beginPath();
        ctx.moveTo(x-20, y-20);
        ctx.lineTo(x-20, y+20);
        ctx.moveTo(x+20, y-20);
        ctx.lineTo(x+20, y+20);
        ctx.stroke();
        
        for(let i = -15; i <= 15; i += 10) {
          ctx.beginPath();

        function drawTransformer(x, y) {
            ctx.beginPath();
            ctx.moveTo(x-20, y-20);
            ctx.lineTo(x-20, y+20);
            ctx.moveTo(x+20, y-20);
            ctx.lineTo(x+20, y+20);
            ctx.stroke();
            
            for(let i = -15; i <= 15; i += 10) {
                ctx.beginPath();
                ctx.arc(x-20, y+i, 5, 0, 2 * Math.PI);
                ctx.arc(x+20, y+i, 5, 0, 2 * Math.PI);
                ctx.stroke();
            }
        }
    
        // Grid for graphs
        function drawGrid(ctx, startX, startY, width, height, steps) {
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 0.5;
            
            // Vertical lines
            for(let i = 0; i <= steps; i++) {
                ctx.beginPath();
                const x = startX + (width * i / steps);
                ctx.moveTo(x, startY);
                ctx.lineTo(x, startY + height);
                ctx.stroke();
            }
            
            // Horizontal lines
            for(let i = 0; i <= steps; i++) {
                ctx.beginPath();
                const y = startY + (height * i / steps);
                ctx.moveTo(startX, y);
                ctx.lineTo(startX + width, y);
                ctx.stroke();
            }
        }
        
        function formatValue(value) {
            if (value >= 1000) {
                return (value/1000).toFixed(1) + 'k';
            }
            return value.toFixed(1);
        }
        
        function addGraphLabels(ctx, startX, startY, width, height, maxY, title, yLabel) {
            ctx.fillStyle = '#000';
            ctx.font = '12px system-ui';
            
            // Title
            ctx.textAlign = 'center';
            ctx.fillText(title, startX + width/2, startY - 10);
            
            // Y-axis labels
            ctx.textAlign = 'right';
            for(let i = 0; i <= 5; i++) {
                const value = maxY * (5-i) / 5;
                const y = startY + (height * i / 5);
                ctx.fillText(formatValue(value), startX - 5, y + 4);
            }
            
            // X-axis labels (distance)
            const distance = parseFloat(inputs.distance.value);
            ctx.textAlign = 'center';
            for(let i = 0; i <= 5; i++) {
                const value = distance * i / 5;
                const x = startX + (width * i / 5);
                ctx.fillText(value.toFixed(0), x, startY + height + 15);
            }
            
            // Axis titles
            ctx.save();
            ctx.translate(startX - 35, startY + height/2);
            ctx.rotate(-Math.PI/2);
            ctx.textAlign = 'center';
            ctx.fillText(yLabel, 0, 0);
            ctx.restore();
            
            ctx.fillText('Distance (km)', startX + width/2, startY + height + 30);
        }
    
        // Initial calculations and rendering
        const results = calculate();
        drawDiagram();
        drawVoltageProfile(results);
        drawPowerLossProfile(results);
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const results = calculate();
            drawDiagram();
            drawVoltageProfile(results);
            drawPowerLossProfile(results);
        });
    </script>
</body>
</html>