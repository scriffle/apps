<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Covalent Reaction Simulation</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    /* Top panel with menu and controls */
    #top-panel {
      background: #eee;
      padding: 5px;
      border-bottom: 2px solid #ccc;
    }
    #element-menu {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 5px;
    }
    .element {
      width: 60px;
      padding: 8px;
      text-align: center;
      font-size: 14px;
      border: 1px solid #aaa;
      border-radius: 5px;
      background: #f0f0f0;
      cursor: pointer;
    }
    .element:hover {
      background: #ddd;
    }
    #controls {
      text-align: center;
      margin-bottom: 5px;
    }
    #controls button {
      margin: 0 5px;
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
    }
    /* Simulation area */
    #simulation {
      position: relative;
      background: #fafafa;
      height: calc(100vh - 120px);
      overflow: hidden;
    }
    /* Molecule particle styling */
    .molecule {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      color: #000;
      user-select: none;
      border: 1px solid #888;
    }
  </style>
</head>
<body>
  <div id="top-panel">
    <div id="element-menu">
      <!-- Elemental molecule buttons will be populated here -->
    </div>
    <div id="controls">
      <button onclick="removeMolecules()">Remove Molecules</button>
      <button onclick="bondNow()">Bond Now</button>
    </div>
  </div>
  <div id="simulation"></div>

  <script>
    /***** Data Structures *****/
    // List of elemental molecules (only covalent, all are diatomic in this simple example)
    const elementalMolecules = [
      { formula: "H2", name: "Hydrogen", mass: 2, color: "#f0f0f0", radius: 20 },
      { formula: "O2", name: "Oxygen", mass: 32, color: "#ffcccb", radius: 20 },
      { formula: "N2", name: "Nitrogen", mass: 28, color: "#add8e6", radius: 20 },
      { formula: "Cl2", name: "Chlorine", mass: 70, color: "#d3ffd3", radius: 20 },
      { formula: "F2", name: "Fluorine", mass: 38, color: "#e0ffff", radius: 20 }
    ];

    // Reaction mapping (keys are sorted reactant formulas joined with "+")
    // Activation energy is a simplified threshold value (arbitrary units)
    // Reaction energy is used here for informational purposes.
    const reactionMapping = {
      "H2+O2": { product: "H2O", name: "Water", activationEnergy: 0.15, reactionEnergy: -1.0 },
      "H2+Cl2": { product: "HCl", name: "Hydrogen Chloride", activationEnergy: 0.12, reactionEnergy: -0.8 },
      "N2+H2": { product: "NH3", name: "Ammonia", activationEnergy: 0.20, reactionEnergy: -1.2 },
      "Cl2+F2": { product: "ClF", name: "Chlorine Monofluoride", activationEnergy: 0.18, reactionEnergy: -0.9 }
      // You can add more reaction mappings here.
    };

    // Global array to hold molecule objects in the simulation.
    let molecules = [];

    // Utility: Calculate kinetic energy (assuming unit mass for simplicity)
    function kineticEnergy(mol) {
      return 0.5 * (mol.vx * mol.vx + mol.vy * mol.vy);
    }

    /***** DOM & Molecule Creation *****/
    const elementMenuDiv = document.getElementById("element-menu");
    const simulationArea = document.getElementById("simulation");

    // Populate the menu with elemental molecule buttons.
    function initElementMenu() {
      elementalMolecules.forEach(elem => {
        const btn = document.createElement("div");
        btn.className = "element";
        btn.style.backgroundColor = elem.color;
        btn.innerHTML = `<strong>${elem.formula}</strong>`;
        btn.onclick = () => addMolecule(elem);
        elementMenuDiv.appendChild(btn);
      });
    }

    // Create a molecule object and its corresponding DOM element.
    function addMolecule(elem) {
      // Each molecule is represented by a circle.
      const mol = {
        formula: elem.formula,
        name: elem.name,
        mass: elem.mass,
        color: elem.color,
        radius: elem.radius,
        // Random initial position within simulation area.
        x: Math.random() * (simulationArea.clientWidth - elem.radius*2),
        y: Math.random() * (simulationArea.clientHeight - elem.radius*2),
        // Random velocities.
        vx: (Math.random() - 0.5) * 2,
        vy: (Math.random() - 0.5) * 2
      };
      // Create the DOM element.
      const div = document.createElement("div");
      div.className = "molecule";
      div.style.backgroundColor = mol.color;
      div.style.left = mol.x + "px";
      div.style.top = mol.y + "px";
      div.innerHTML = mol.formula;
      simulationArea.appendChild(div);
      mol.elem = div;
      molecules.push(mol);
    }

    /***** Simulation Loop *****/
    function updateSimulation() {
      // Move each molecule.
      molecules.forEach(mol => {
        mol.x += mol.vx;
        mol.y += mol.vy + 0.05; // gravity effect
        // Bounce off boundaries.
        if (mol.x < 0) { mol.x = 0; mol.vx *= -1; }
        if (mol.x + mol.radius*2 > simulationArea.clientWidth) {
          mol.x = simulationArea.clientWidth - mol.radius*2;
          mol.vx *= -1;
        }
        if (mol.y < 0) { mol.y = 0; mol.vy *= -1; }
        if (mol.y + mol.radius*2 > simulationArea.clientHeight) {
          mol.y = simulationArea.clientHeight - mol.radius*2;
          mol.vy *= -1;
        }
        mol.elem.style.left = mol.x + "px";
        mol.elem.style.top = mol.y + "px";
      });
      // Check for collisions and possible reactions.
      checkCollisions();
      requestAnimationFrame(updateSimulation);
    }

    // Check collisions between molecules.
    function checkCollisions() {
      for (let i = 0; i < molecules.length; i++) {
        for (let j = i + 1; j < molecules.length; j++) {
          const molA = molecules[i];
          const molB = molecules[j];
          const dx = (molA.x + molA.radius) - (molB.x + molB.radius);
          const dy = (molA.y + molA.radius) - (molB.y + molB.radius);
          const distance = Math.sqrt(dx * dx + dy * dy);
          if (distance < molA.radius + molB.radius) {
            // Collision detected.
            attemptReaction(molA, molB);
          }
        }
      }
    }

    // Attempt to react two colliding molecules.
    function attemptReaction(molA, molB) {
      // Create a reaction key (order independent).
      const formulas = [molA.formula, molB.formula].sort();
      const key = formulas.join("+");
      // Check if a reaction is defined.
      if (reactionMapping[key]) {
        const reaction = reactionMapping[key];
        // Calculate total kinetic energy.
        const totalKE = kineticEnergy(molA) + kineticEnergy(molB);
        // If the kinetic energy is low enough (i.e. gentle collision), then react.
        if (totalKE < reaction.activationEnergy) {
          formCompound(molA, molB, reaction);
          return; // Reaction done.
        }
      }
      // If no reaction or energy too high, bounce the molecules apart.
      bounce(molA, molB);
    }

    // Bounce two molecules apart by reversing their velocities.
    function bounce(molA, molB) {
      // Swap velocities as a simple bounce.
      const tempVx = molA.vx;
      const tempVy = molA.vy;
      molA.vx = molB.vx;
      molA.vy = molB.vy;
      molB.vx = tempVx;
      molB.vy = tempVy;
    }

    // Form a new compound from two molecules.
    function formCompound(molA, molB, reaction) {
      // Remove the reactant molecules.
      simulationArea.removeChild(molA.elem);
      simulationArea.removeChild(molB.elem);
      molecules = molecules.filter(m => m !== molA && m !== molB);
      // Create a new molecule representing the product.
      const product = {
        formula: reaction.product,
        name: reaction.name,
        mass: (molA.mass + molB.mass) * 0.9,  // arbitrary mass adjustment
        color: blendColors(molA.color, molB.color),
        radius: 25, // new product radius
        x: (molA.x + molB.x) / 2,
        y: (molA.y + molB.y) / 2,
        vx: (molA.vx + molB.vx) / 2,
        vy: (molA.vy + molB.vy) / 2
      };
      const div = document.createElement("div");
      div.className = "molecule";
      div.style.backgroundColor = product.color;
      div.style.left = product.x + "px";
      div.style.top = product.y + "px";
      div.innerHTML = product.formula;
      simulationArea.appendChild(div);
      product.elem = div;
      molecules.push(product);
      // Optionally: show a message with the new substanceâ€™s name.
      console.log("Formed " + reaction.name + " (" + reaction.product + ")");
    }

    // Simple function to blend two hex colors (average the RGB values).
    function blendColors(c1, c2) {
      function hexToRgb(hex) {
        hex = hex.replace("#", "");
        return {
          r: parseInt(hex.substring(0,2),16),
          g: parseInt(hex.substring(2,4),16),
          b: parseInt(hex.substring(4,6),16)
        };
      }
      function rgbToHex(r, g, b) {
        return "#" + [r, g, b].map(x => {
          const hex = x.toString(16);
          return hex.length === 1 ? "0" + hex : hex;
        }).join("");
      }
      const rgb1 = hexToRgb(c1);
      const rgb2 = hexToRgb(c2);
      const r = Math.round((rgb1.r + rgb2.r) / 2);
      const g = Math.round((rgb1.g + rgb2.g) / 2);
      const b = Math.round((rgb1.b + rgb2.b) / 2);
      return rgbToHex(r, g, b);
    }

    // "Bond Now" button forces a reaction check among all molecules.
    function bondNow() {
      for (let i = 0; i < molecules.length; i++) {
        for (let j = i + 1; j < molecules.length; j++) {
          attemptReaction(molecules[i], molecules[j]);
        }
      }
    }

    // Remove all molecules.
    function removeMolecules() {
      molecules.forEach(mol => simulationArea.removeChild(mol.elem));
      molecules = [];
    }

    /***** Start the Simulation *****/
    initElementMenu();
    updateSimulation();
  </script>
</body>
</html>
