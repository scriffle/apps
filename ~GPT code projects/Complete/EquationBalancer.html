<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemical Equation Balancing Practice</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .equation-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            margin: 20px 0;
            padding: 10px;
            border-radius: 8px;
            font-size: 20px;
        }
        .equation-content {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .reactants, .products {
            display: flex;
            align-items: center;
        }
        .reactants {
            justify-content: flex-end;
            flex: 1;
        }
        .products {
            justify-content: flex-start;
            flex: 1;
            margin-left: 20px;
        }
        .arrow {
            margin: 0 20px;
            font-size: 30px;
            font-weight: bold;
        }
        select {
            margin: 0 5px;
            padding: 5px;
        }
        .button-container {
            text-align: center;
            margin-top: 30px;
        }
        .solve-button, .refresh-button, .hint-button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        .hint-button {
            font-size: 14px;
            padding: 5px 15px;
        }
        .solve-button {
            cursor: not-allowed;
            opacity: 0.5;
        }
        .solve-button.enabled {
            cursor: pointer;
            opacity: 1;
        }
        .pale-red {
            background-color: #ffdddd;
        }
        .pale-green {
            background-color: #ddffdd;
        }
        .pale-yellow {
            background-color: #ffffcc;
        }
        .red-arrow {
            color: #c70000;
        }
        .green-arrow {
            color: #2e8b57;
        }
        .yellow-arrow {
            color: #d4a017;
        }
        .element {
            font-weight: bold;
            margin: 0 3px;
        }

        /* Individual Element Colors */
        .Ca { color: darkorange; }
        .C { color: black; }
        .O { color: darkblue; }
        .H { color: darkgreen; }
        .N { color: darkblueviolet; }
        .Cl { color: darkcyan; }
        .S { color: darkgoldenrod; }
        .P { color: maroon; }
        .Na { color: darkmagenta; }
        .Mg { color: purple; }
        .Al { color: darkgray; }
        .Fe { color: brown; }
        .Zn { color: navy; }
        .K { color: olive; }

        .flow-label {
            text-align: center;
            font-weight: bold;
            margin: 20px 0;
            font-size: 24px;
        }

        .reaction-name {
            margin-bottom: 5px;
            font-size: 14px;
            color: darkred;
        }
        .reaction-tip {
            margin-top: 5px;
            font-size: 12px;
            color: darkgray;
            font-style: italic;
            display: none; /* Hide tips by default */
        }
        .balanced-name {
            color: darkgreen;
        }
        .equation-actions {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px; /* Adjusted for top placement */
        }
    </style>
</head>
<body>
    <h1>Chemical Equation Balancing Practice</h1>

    <!-- Level Selection Dropdown -->
    <div class="button-container">
        <label for="level-select">Select Level:</label>
        <select id="level-select" onchange="changeLevel()">
            <option value="simple">Simple</option>
            <option value="medium">Medium</option>
            <option value="advanced">Advanced</option>
        </select>
    </div>
    
    <!-- Reactants to Products Flow Label -->
    <div class="flow-label">Reactants → Products</div>
    
    <div id="equations"></div>
    
    <div class="button-container">
        <button class="refresh-button" onclick="refreshPage()">Refresh</button>
    </div>

    <script>
        const levels = {
             simple: [
                { 
                    name: "Combustion of Methane", 
                    tip: "Balance carbon, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["CH4", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 2, 1, 2] 
                },
                { 
                    name: "Formation of Water", 
                    tip: "Balance hydrogen first, followed by oxygen atoms.", 
                    reactants: ["H2", "O2"], 
                    products: ["H2O"], 
                    balanced: [2, 1, 2] 
                },
                { 
                    name: "Decomposition of Hydrogen Peroxide", 
                    tip: "Balance oxygen first, then hydrogen atoms.", 
                    reactants: ["H2O2"], 
                    products: ["H2O", "O2"], 
                    balanced: [2, 2, 1] 
                },
                { 
                    name: "Formation of Sodium Chloride", 
                    tip: "Balance sodium and chlorine atoms directly.", 
                    reactants: ["Na", "Cl2"], 
                    products: ["NaCl"], 
                    balanced: [2, 1, 2] 
                },
                { 
                    name: "Decomposition of Water", 
                    tip: "Balance hydrogen first, then oxygen atoms.", 
                    reactants: ["H2O"], 
                    products: ["H2", "O2"], 
                    balanced: [2, 2, 1] 
                },
                { 
                    name: "Formation of Calcium Oxide", 
                    tip: "Balance calcium first, then oxygen atoms.", 
                    reactants: ["Ca", "O2"], 
                    products: ["CaO"], 
                    balanced: [2, 1, 2] 
                },
                { 
                    name: "Formation of Magnesium Oxide", 
                    tip: "Balance magnesium first, then oxygen atoms.", 
                    reactants: ["Mg", "O2"], 
                    products: ["MgO"], 
                    balanced: [2, 1, 2] 
                },
                { 
                    name: "Combustion of Hydrogen Sulfide", 
                    tip: "Balance sulfur first, then oxygen, and finally hydrogen atoms.", 
                    reactants: ["H2S", "O2"], 
                    products: ["SO2", "H2O"], 
                    balanced: [2, 2, 2, 2] 
                },
                { 
                    name: "Formation of Nitrogen Dioxide", 
                    tip: "Balance nitrogen first, then oxygen atoms.", 
                    reactants: ["NO", "O2"], 
                    products: ["NO2"], 
                    balanced: [2, 1, 2] 
                },
                { 
                    name: "Reaction of Hydrogen with Chlorine", 
                    tip: "Balance hydrogen and chlorine atoms directly.", 
                    reactants: ["H2", "Cl2"], 
                    products: ["HCl"], 
                    balanced: [1, 1, 2] 
                },
                { 
                    name: "Formation of Calcium Hydroxide", 
                    tip: "Balance calcium first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["Ca", "H2O"], 
                    products: ["Ca(OH)2", "H2"], 
                    balanced: [1, 2, 1, 1] 
                },
                { 
                    name: "Formation of Barium Sulfate", 
                    tip: "Balance barium first, then sulfate and chloride ions.", 
                    reactants: ["BaCl2", "H2SO4"], 
                    products: ["BaSO4", "HCl"], 
                    balanced: [1, 1, 1, 2] 
                },
                { 
                    name: "Formation of Zinc Oxide", 
                    tip: "Balance zinc first, then oxygen atoms.", 
                    reactants: ["Zn", "O2"], 
                    products: ["ZnO"], 
                    balanced: [2, 1, 2] 
                },
                { 
                    name: "Formation of Sodium Bromide", 
                    tip: "Balance sodium and bromine atoms directly.", 
                    reactants: ["Na", "Br2"], 
                    products: ["NaBr"], 
                    balanced: [2, 1, 2] 
                },
                { 
                    name: "Combustion of Ethylene", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C2H4", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 2, 2, 2] 
                },
                { 
                    name: "Formation of Lead (II) Oxide", 
                    tip: "Balance lead first, then oxygen atoms.", 
                    reactants: ["Pb", "O2"], 
                    products: ["PbO"], 
                    balanced: [2, 1, 2] 
                },
                { 
                    name: "Formation of Potassium Chloride", 
                    tip: "Balance potassium and chlorine atoms directly.", 
                    reactants: ["K", "Cl2"], 
                    products: ["KCl"], 
                    balanced: [2, 1, 2] 
                },
                { 
                    name: "Combustion of Hydrogen Sulfide", 
                    tip: "Balance hydrogen, sulfur, and then oxygen atoms.", 
                    reactants: ["H2S", "O2"], 
                    products: ["SO2", "H2O"], 
                    balanced: [2, 1, 2, 2] 
                },
                { 
                    name: "Combustion of Carbon Monoxide", 
                    tip: "Balance carbon first, then oxygen atoms.", 
                    reactants: ["CO", "O2"], 
                    products: ["CO2"], 
                    balanced: [2, 1, 2] 
                },
                { 
                    name: "Decomposition of Sodium Bicarbonate", 
                    tip: "Balance sodium, then carbon and hydrogen atoms.", 
                    reactants: ["NaHCO3"], 
                    products: ["Na2CO3", "CO2", "H2O"], 
                    balanced: [2, 1, 1, 1] 
                }
            ],
            medium: [
                { 
                    name: "Combustion of Ethylene Glycol", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C2H6O2", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [2, 5, 4, 6] 
                },
                { 
                    name: "Formation of Aluminum Bromide", 
                    tip: "Balance aluminum first, then bromine atoms.", 
                    reactants: ["Al", "Br2"], 
                    products: ["AlBr3"], 
                    balanced: [2, 3, 2] 
                },
                { 
                    name: "Combustion of Propane", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C3H8", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 5, 3, 4] 
                },
                { 
                    name: "Reaction of Iron and Oxygen", 
                    tip: "Balance iron first, then oxygen atoms.", 
                    reactants: ["Fe", "O2"], 
                    products: ["Fe2O3"], 
                    balanced: [4, 3, 2] 
                },
                { 
                    name: "Formation of Nitric Acid from Nitrogen Dioxide", 
                    tip: "Balance nitrogen first, then oxygen atoms.", 
                    reactants: ["NO2", "H2O"], 
                    products: ["HNO3", "NO"], 
                    balanced: [3, 1, 2, 1] 
                },
                { 
                    name: "Formation of Sulfur Trioxide", 
                    tip: "Balance sulfur first, then oxygen atoms.", 
                    reactants: ["SO2", "O2"], 
                    products: ["SO3"], 
                    balanced: [2, 1, 2] 
                },
                { 
                    name: "Combustion of Ethanol", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C2H5OH", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 3, 2, 3] 
                },
                { 
                    name: "Formation of Iron(III) Chloride", 
                    tip: "Balance iron first, then chlorine atoms.", 
                    reactants: ["Fe", "Cl2"], 
                    products: ["FeCl3"], 
                    balanced: [2, 3, 2] 
                },
                { 
                    name: "Decomposition of Calcium Phosphate", 
                    tip: "Balance calcium, phosphorus, and oxygen atoms step-by-step.", 
                    reactants: ["Ca3(PO4)2", "SiO2", "C"], 
                    products: ["P4", "CO", "CaSiO3"], 
                    balanced: [2, 6, 10, 1, 10, 6] 
                },
                { 
                    name: "Formation of Lead (II) Sulfate", 
                    tip: "Balance lead first, then sulfate and nitrate ions.", 
                    reactants: ["Pb(NO3)2", "K2SO4"], 
                    products: ["PbSO4", "KNO3"], 
                    balanced: [1, 1, 1, 2] 
                },
                { 
                    name: "Decomposition of Sodium Chlorate", 
                    tip: "Balance sodium, then oxygen atoms.", 
                    reactants: ["NaClO3"], 
                    products: ["NaCl", "O2"], 
                    balanced: [2, 2, 3] 
                },
                { 
                    name: "Formation of Copper(II) Sulfate", 
                    tip: "Balance copper first, then sulfur and oxygen atoms.", 
                    reactants: ["Cu", "H2SO4"], 
                    products: ["CuSO4", "SO2", "H2O"], 
                    balanced: [1, 2, 1, 1, 2] 
                },
                { 
                    name: "Formation of Chromium(III) Oxide", 
                    tip: "Balance chromium first, then oxygen atoms.", 
                    reactants: ["Cr", "O2"], 
                    products: ["Cr2O3"], 
                    balanced: [4, 3, 2] 
                },
                { 
                    name: "Reaction of Aluminum with Sulfuric Acid", 
                    tip: "Balance aluminum first, then sulfur and oxygen atoms.", 
                    reactants: ["Al", "H2SO4"], 
                    products: ["Al2(SO4)3", "H2"], 
                    balanced: [2, 3, 1, 3] 
                },
                { 
                    name: "Combustion of Glucose", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C6H12O6", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 6, 6, 6] 
                },
                { 
                    name: "Formation of Silver Nitrate", 
                    tip: "Balance silver first, then nitrogen, oxygen, and hydrogen atoms.", 
                    reactants: ["Ag", "HNO3"], 
                    products: ["AgNO3", "NO2", "H2O"], 
                    balanced: [3, 4, 3, 1, 2] 
                },
                { 
                    name: "Combustion of Ethylene", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C2H4", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 3, 2, 2] 
                },
                { 
                    name: "Reaction of Sodium with Water", 
                    tip: "Balance sodium first, then hydrogen and oxygen atoms.", 
                    reactants: ["Na", "H2O"], 
                    products: ["NaOH", "H2"], 
                    balanced: [2, 2, 2, 1] 
                },
                { 
                    name: "Formation of Copper(II) Nitrate", 
                    tip: "Balance copper first, then nitrogen, oxygen, and hydrogen atoms.", 
                    reactants: ["Cu", "HNO3"], 
                    products: ["Cu(NO3)2", "NO", "H2O"], 
                    balanced: [3, 8, 3, 2, 4] 
                },
                { 
                    name: "Combustion of Methyl Alcohol", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["CH3OH", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [2, 3, 2, 4] 
                }
            ],                        advanced: [
                { 
                    name: "Combustion of Pentane", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C5H12", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 8, 5, 6] 
                },
                { 
                    name: "Formation of Potassium Dichromate", 
                    tip: "Balance potassium, then chromium, and finally oxygen atoms.", 
                    reactants: ["K2Cr2O7", "H2SO4", "H2O2"], 
                    products: ["CrO5", "K2SO4", "H2O"], 
                    balanced: [1, 4, 3, 2, 1, 5] 
                },
                { 
                    name: "Decomposition of Ammonium Dichromate", 
                    tip: "Balance nitrogen first, then oxygen and hydrogen atoms.", 
                    reactants: ["(NH4)2Cr2O7"], 
                    products: ["Cr2O3", "N2", "H2O"], 
                    balanced: [1, 1, 1, 4] 
                },
                { 
                    name: "Formation of Lead(II) Iodide", 
                    tip: "Balance lead and iodine atoms directly.", 
                    reactants: ["Pb(NO3)2", "KI"], 
                    products: ["PbI2", "KNO3"], 
                    balanced: [1, 2, 1, 2] 
                },
                { 
                    name: "Combustion of Cyclohexane", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C6H12", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 9, 6, 6] 
                },
                { 
                    name: "Formation of Calcium Phosphate", 
                    tip: "Balance calcium, then phosphorus, and finally oxygen atoms.", 
                    reactants: ["Ca(OH)2", "H3PO4"], 
                    products: ["Ca3(PO4)2", "H2O"], 
                    balanced: [3, 2, 1, 6] 
                },
                { 
                    name: "Combustion of Glutaric Acid", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C5H8O4", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 5, 5, 4] 
                },
                { 
                    name: "Formation of Sodium Tetraborate", 
                    tip: "Balance sodium, then boron, and finally oxygen atoms.", 
                    reactants: ["Na2B4O7", "HCl"], 
                    products: ["B2O3", "NaCl", "H2O"], 
                    balanced: [1, 7, 2, 2, 5] 
                },
                { 
                    name: "Decomposition of Potassium Chlorate", 
                    tip: "Balance potassium first, then oxygen atoms.", 
                    reactants: ["KClO3"], 
                    products: ["KCl", "O2"], 
                    balanced: [2, 2, 3] 
                },
                { 
                    name: "Formation of Tetraphosphorus Decaoxide", 
                    tip: "Balance phosphorus first, then oxygen atoms.", 
                    reactants: ["P4", "O2"], 
                    products: ["P4O10"], 
                    balanced: [1, 5, 1] 
                },
                { 
                    name: "Combustion of Heptane", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C7H16", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 11, 7, 8] 
                },
                { 
                    name: "Formation of Ferric Chloride", 
                    tip: "Balance iron first, then chlorine atoms.", 
                    reactants: ["Fe2O3", "HCl"], 
                    products: ["FeCl3", "H2O"], 
                    balanced: [1, 6, 2, 3] 
                },
                { 
                    name: "Decomposition of Mercuric Oxide", 
                    tip: "Balance mercury first, then oxygen atoms.", 
                    reactants: ["HgO"], 
                    products: ["Hg", "O2"], 
                    balanced: [2, 2, 1] 
                },
                { 
                    name: "Combustion of Propanol", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C3H8O", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [2, 9, 6, 8] 
                },
                { 
                    name: "Formation of Sodium Aluminate", 
                    tip: "Balance sodium, then aluminum, then oxygen atoms.", 
                    reactants: ["NaOH", "Al2O3", "H2O"], 
                    products: ["NaAl(OH)4"], 
                    balanced: [2, 1, 3, 2] 
                },
                { 
                    name: "Formation of Phosphoric Acid", 
                    tip: "Balance phosphorus first, then hydrogen and oxygen atoms.", 
                    reactants: ["P2O5", "H2O"], 
                    products: ["H3PO4"], 
                    balanced: [1, 3, 2] 
                },
                { 
                    name: "Formation of Aluminum Sulfate", 
                    tip: "Balance aluminum first, then sulfate and hydroxide ions.", 
                    reactants: ["Al2(SO4)3", "Ca(OH)2"], 
                    products: ["Al(OH)3", "CaSO4"], 
                    balanced: [1, 3, 2, 3] 
                },
                { 
                    name: "Formation of Sodium Bromate", 
                    tip: "Balance sodium first, then bromine, and finally chlorine atoms.", 
                    reactants: ["NaBr", "NaOCl"], 
                    products: ["NaBrO3", "NaCl"], 
                    balanced: [3, 3, 1, 3] 
                },
                { 
                    name: "Formation of Ammonium Phosphate", 
                    tip: "Balance nitrogen, then phosphorus and oxygen atoms.", 
                    reactants: ["H3PO4", "NH3"], 
                    products: ["(NH4)3PO4"], 
                    balanced: [1, 3, 1] 
                },
                { 
                    name: "Formation of Magnesium Nitrate", 
                    tip: "Balance magnesium first, then nitrogen and oxygen atoms.", 
                    reactants: ["Mg", "HNO3"], 
                    products: ["Mg(NO3)2", "H2"], 
                    balanced: [1, 2, 1, 1] 
                }
            ]
        };

        function changeLevel() {
            const selectedLevel = document.getElementById('level-select').value;
            loadEquations(selectedLevel);
        }

        function loadEquations(level) {
            const selectedEquations = levels[level].sort(() => 0.5 - Math.random()).slice(0, 10);
            const equationContainer = document.getElementById('equations');
            equationContainer.innerHTML = '';  // Clear existing equations

            selectedEquations.forEach((equation, index) => {
                const container = document.createElement('div');
                container.className = 'equation-container pale-red';
                container.id = `equation-${index}`;

                // Action Buttons (Hint and Solve)
                const equationActions = document.createElement('div');
                equationActions.className = 'equation-actions';

                // Show/Hide Hint Button
                const hintButton = document.createElement('button');
                hintButton.className = 'hint-button';
                hintButton.innerText = 'Show/Hide Hint';
                hintButton.onclick = () => toggleHint(index);
                equationActions.appendChild(hintButton);

                // Solve button
                const solveButton = document.createElement('button');
                solveButton.className = 'solve-button';
                solveButton.innerText = 'Solve';
                solveButton.disabled = true; // Disable solve button by default
                solveButton.onclick = () => solveEquation(level, index, equation);
                solveButton.id = `solve-button-${index}`;
                equationActions.appendChild(solveButton);

                container.appendChild(equationActions);

                // Reaction Name Label
                const reactionName = document.createElement('div');
                reactionName.className = 'reaction-name';
                reactionName.innerText = equation.name;
                container.appendChild(reactionName);

                // Equation content (Reactants, Arrow, Products)
                const equationContent = document.createElement('div');
                equationContent.className = 'equation-content';

                // Reactants
                const reactants = document.createElement('div');
                reactants.className = 'reactants';
                
                equation.reactants.forEach((element, i) => {
                    const select = createSelect(level, index, i, equation.balanced[i]);
                    reactants.appendChild(select);
                    reactants.appendChild(createColoredCompound(element));
                    if (i < equation.reactants.length - 1) {
                        reactants.appendChild(createPlusSymbol());
                    }
                });

                // Arrow
                const arrow = document.createElement('div');
                arrow.className = 'arrow red-arrow';
                arrow.id = `arrow-${index}`;
                arrow.innerHTML = '→';

                // Products
                const products = document.createElement('div');
                products.className = 'products';

                equation.products.forEach((element, i) => {
                    const select = createSelect(level, index, equation.reactants.length + i, equation.balanced[equation.reactants.length + i]);
                    products.appendChild(select);
                    products.appendChild(createColoredCompound(element));
                    if (i < equation.products.length - 1) {
                        products.appendChild(createPlusSymbol());
                    }
                });

                equationContent.appendChild(reactants);
                equationContent.appendChild(arrow);
                equationContent.appendChild(products);
                container.appendChild(equationContent);

                // Reaction Tip Label
                const reactionTip = document.createElement('div');
                reactionTip.className = 'reaction-tip';
                reactionTip.id = `tip-${index}`;
                reactionTip.innerText = equation.tip;
                container.appendChild(reactionTip);
                
                equationContainer.appendChild(container);
            });
        }

        function createSelect(level, index, pos, correctValue) {
            const select = document.createElement('select');
            select.onchange = () => {
                checkEquation(level, index);
                enableSolveButtonWithDelay(index, level);  // Enable solve button after delay
            };
            const options = level === 'advanced' ? ["", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"] : ["", "2", "3", "4", "5", "6"];
            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.text = opt;
                select.appendChild(option);
            });
            select.id = `select-${index}-${pos}`;
            return select;
        }

        function createColoredCompound(compound) {
            const fragment = document.createDocumentFragment();
            const elements = compound.match(/[A-Z][a-z]?\d*/g);  // Regex to separate elements and their counts

            elements.forEach(element => {
                const elementName = element.match(/[A-Z][a-z]?/)[0]; // Extract element symbol (e.g., "Ca")
                const subscript = element.match(/\d+/);  // Extract subscript if any (e.g., "3" in "CO3")
                const span = document.createElement('span');
                span.className = `element ${elementName}`;  // Apply color class
                span.innerHTML = elementName + (subscript ? `<sub>${subscript[0]}</sub>` : '');  // Add subscript if exists
                fragment.appendChild(span);
            });

            return fragment;
        }

        function createPlusSymbol() {
            const plus = document.createElement('span');
            plus.innerHTML = '+';
            plus.style.margin = '0 5px';
            return plus;
        }

        function checkEquation(level, index) {
            const container = document.getElementById(`equation-${index}`);
            const arrow = document.getElementById(`arrow-${index}`);
            const reactionName = container.querySelector('.reaction-name');
            const solveButton = document.getElementById(`solve-button-${index}`);
            const equation = levels[level][index];
            let isBalanced = true;

            equation.reactants.forEach((_, i) => {
                let selectValue = document.getElementById(`select-${index}-${i}`).value;
                if (selectValue === "") selectValue = "1"; // Treat empty as "1"
                if (parseInt(selectValue) !== equation.balanced[i]) isBalanced = false;
            });

            equation.products.forEach((_, i) => {
                let selectValue = document.getElementById(`select-${index}-${equation.reactants.length + i}`).value;
                if (selectValue === "") selectValue = "1"; // Treat empty as "1"
                if (parseInt(selectValue) !== equation.balanced[equation.reactants.length + i]) isBalanced = false;
            });

            if (isBalanced) {
                container.className = 'equation-container pale-green';
                arrow.className = 'arrow green-arrow';
                reactionName.classList.remove('reaction-name');
                reactionName.classList.add('balanced-name');
                solveButton.disabled = true;  // Disable the solve button when balanced
                solveButton.classList.remove('enabled');  // Remove the enabled style
                solveButton.setAttribute('data-balanced', 'true');  // Mark as balanced
            } else {
                container.className = 'equation-container pale-red';
                arrow.className = 'arrow red-arrow';
                reactionName.classList.remove('balanced-name');
                reactionName.classList.add('reaction-name');
            }
        }

        function enableSolveButtonWithDelay(index, level) {
            const solveButton = document.getElementById(`solve-button-${index}`);
            if (solveButton.classList.contains('enabled') || solveButton.getAttribute('data-balanced') === 'true') return;  // Already enabled or balanced, return

            setTimeout(() => {
                if (solveButton.getAttribute('data-balanced') !== 'true') {  // Only enable if not balanced
                    solveButton.classList.add('enabled');
                    solveButton.disabled = false;  // Enable the button
                }
            }, 10000);  // 10 seconds delay
        }

        function solveEquation(level, index, equation) {
            equation.reactants.forEach((_, i) => {
                document.getElementById(`select-${index}-${i}`).value = equation.balanced[i] === 1 ? "" : equation.balanced[i]; // Display "1" as ""
            });
            equation.products.forEach((_, i) => {
                document.getElementById(`select-${index}-${equation.reactants.length + i}`).value = equation.balanced[equation.reactants.length + i] === 1 ? "" : equation.balanced[equation.reactants.length + i]; // Display "1" as ""
            });

            const container = document.getElementById(`equation-${index}`);
            const arrow = document.getElementById(`arrow-${index}`);
            const solveButton = document.getElementById(`solve-button-${index}`);
            
            // Check and set the status to yellow
            container.className = 'equation-container pale-yellow';
            arrow.className = 'arrow yellow-arrow';
            solveButton.disabled = true;  // Disable the solve button when used
            solveButton.classList.remove('enabled');  // Remove the enabled style
            solveButton.setAttribute('data-balanced', 'true');  // Mark as balanced
        }

        function refreshPage() {
            window.location.reload();
        }

        function toggleHint(index) {
            const tip = document.getElementById(`tip-${index}`);
            tip.style.display = (tip.style.display === 'none' || tip.style.display === '') ? 'block' : 'none';
        }

        // Load default level (Simple) on page load
        window.onload = function() {
            loadEquations('simple');
        };
    </script>
</body>
</html>
