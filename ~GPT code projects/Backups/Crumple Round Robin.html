<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crumple Zone Round Robin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 22px;
            margin: 0;
            padding: 0;
        }
        .container {
            padding: 20px;
        }
        .hidden {
            display: none;
        }
        .team-input {
            margin: 5px 0;
        }
        .match {
            margin: 10px 0;
            display: flex;
        }
        .radio-label {
            margin-right: 10px;
        }
        .panel {
            margin-left: 40px;
            min-width: 250px;
        }
        .navigation {
            margin-top: 20px;
        }
        .running-total {
            font-size: 24px;
            font-weight: bold;
        }
        .wrapper {
            display: flex;
            justify-content: space-between;
        }
        h1, h2 {
            margin-top: 10px;
        }
        .centered {
            text-align: center;
        }
        .pulsing-bg {
            animation: pulse 4s infinite;
        }
        @keyframes pulse {
            0% {
                background-color: #ffffff;
            }
            50% {
                background-color: var(--pastel-color);
            }
            100% {
                background-color: #ffffff;
            }
        }
    </style>
</head>
<body>

<!-- Page 1: Team input -->
<div id="page1" class="container pulsing-bg" style="--pastel-color: #ffe4e1;">
    <h1>Crumple Zone Round Robin</h1>
    <h2>Enter Team Names and Pick an Emoji</h2>
    <div class="team-input">Team 1 (ğŸ¶ Brave Dogs): <input type="text" id="team1" value="Brave Dogs"></div>
    <div class="team-input">Team 2 (ğŸ± Clever Cats): <input type="text" id="team2" value="Clever Cats"></div>
    <div class="team-input">Team 3 (ğŸ¦Š Sly Foxes): <input type="text" id="team3" value="Sly Foxes"></div>
    <div class="team-input">Team 4 (ğŸ» Strong Bears): <input type="text" id="team4" value="Strong Bears"></div>
    <div class="team-input">Team 5 (ğŸ¼ Gentle Pandas): <input type="text" id="team5" value="Gentle Pandas"></div>
    <div class="team-input">Team 6 (ğŸ¦ Fierce Lions): <input type="text" id="team6" value="Fierce Lions"></div>
    <button onclick="startTournament()">Start Tournament</button>
</div>

<!-- Pages 2 to 6: Rounds -->
<div id="collision" class="hidden container pulsing-bg">
    <div class="navigation">
        <button onclick="prevCollision()">Previous</button>
        <button onclick="nextCollision()">Next</button>
    </div>
    <h2 id="collisionTitle"></h2>
    <div class="wrapper">
        <div id="matches"></div>
        <div class="panel" id="runningTotal"></div>
    </div>
</div>

<!-- Final Page: Results -->
<div id="results" class="hidden container centered pulsing-bg" style="--pastel-color: #fffacd;">
    <div class="navigation">
        <button onclick="goBackToLastCollision()">Back</button>
        <button onclick="confirmRestart()">Restart Tournament</button>
    </div>
    <h2 style="font-size: 36px;">Final Results</h2>
    <div id="finalScores" style="font-size: 28px;"></div> <!-- Larger font for final scores -->
</div>

<script>
// Team data and scores
let teams = [];
let points = [0, 0, 0, 0, 0, 0];
let resultsByCollision = [];
let currentCollision = 0;
let previousResults = [];

// Corrected round-robin matchups
const matchups = [
    [["ğŸ¶", "ğŸ±"], ["ğŸ¦Š", "ğŸ¦"], ["ğŸ»", "ğŸ¼"]],  // Round 1
    [["ğŸ¶", "ğŸ¦Š"], ["ğŸ±", "ğŸ¼"], ["ğŸ¦", "ğŸ»"]],  // Round 2
    [["ğŸ¶", "ğŸ»"], ["ğŸ¦Š", "ğŸ¼"], ["ğŸ±", "ğŸ¦"]],  // Round 3
    [["ğŸ¶", "ğŸ¼"], ["ğŸ±", "ğŸ»"], ["ğŸ¦Š", "ğŸ¦"]],  // Round 4
    [["ğŸ¶", "ğŸ¦"], ["ğŸ±", "ğŸ¦Š"], ["ğŸ¼", "ğŸ»"]]   // Round 5
];

// Initialize radio button states for each round
for (let i = 0; i < 5; i++) {
    resultsByCollision.push([
        {team1Result: 0, team2Result: 0},
        {team1Result: 0, team2Result: 0},
        {team1Result: 0, team2Result: 0}
    ]);
}

// Start the tournament by capturing team names
function startTournament() {
    teams = [
        document.getElementById("team1").value || "Brave Dogs",
        document.getElementById("team2").value || "Clever Cats",
        document.getElementById("team3").value || "Sly Foxes",
        document.getElementById("team4").value || "Strong Bears",
        document.getElementById("team5").value || "Gentle Pandas",
        document.getElementById("team6").value || "Fierce Lions"
    ];
    document.getElementById("page1").classList.add("hidden");
    document.getElementById("collision").classList.remove("hidden");
    setPastelColor(currentCollision);
    displayCollision(currentCollision);
}

// Display the current round and matchups
function displayCollision(collisionIndex) {
    const roundTitles = ["Round 1", "Round 2", "Round 3", "Round 4", "Round 5"];
    document.getElementById("collisionTitle").textContent = roundTitles[collisionIndex];
    
    const matchDiv = document.getElementById("matches");
    matchDiv.innerHTML = '';
    
    matchups[collisionIndex].forEach((match, index) => {
        const team1Emoji = match[0];
        const team2Emoji = match[1];
        const team1Index = getTeamIndex(team1Emoji);
        const team2Index = getTeamIndex(team2Emoji);
        const team1Name = teams[team1Index];
        const team2Name = teams[team2Index];

        // Build match row
        matchDiv.innerHTML += `
            <div class="match">
                <div>
                    <h3>${team1Emoji} ${team1Name} vs ${team2Emoji} ${team2Name}</h3>
                    ${team1Name}: 
                    <label class="radio-label"><input type="radio" name="result${index}team1" value="2" onclick="setResult(${collisionIndex}, ${index}, 'team1', 2)" ${resultsByCollision[collisionIndex][index].team1Result === 2 ? 'checked' : ''}> Survived</label>
                    <label class="radio-label"><input type="radio" name="result${index}team1" value="1" onclick="setResult(${collisionIndex}, ${index}, 'team1', 1)" ${resultsByCollision[collisionIndex][index].team1Result === 1 ? 'checked' : ''}> Injured</label>
                    <label class="radio-label"><input type="radio" name="result${index}team1" value="0" onclick="setResult(${collisionIndex}, ${index}, 'team1', 0)" ${resultsByCollision[collisionIndex][index].team1Result === 0 ? 'checked' : ''}> Fatal</label><br>
                    ${team2Name}: 
                    <label class="radio-label"><input type="radio" name="result${index}team2" value="2" onclick="setResult(${collisionIndex}, ${index}, 'team2', 2)" ${resultsByCollision[collisionIndex][index].team2Result === 2 ? 'checked' : ''}> Survived</label>
                    <label class="radio-label"><input type="radio" name="result${index}team2" value="1" onclick="setResult(${collisionIndex}, ${index}, 'team2', 1)" ${resultsByCollision[collisionIndex][index].team2Result === 1 ? 'checked' : ''}> Injured</label>
                    <label class="radio-label"><input type="radio" name="result${index}team2" value="0" onclick="setResult(${collisionIndex}, ${index}, 'team2', 0)" ${resultsByCollision[collisionIndex][index].team2Result === 0 ? 'checked' : ''}> Fatal</label>
                </div>
            </div>
        `;
    });

    // Display running total and sort teams by score
    displayRunningTotal();
}

// Set pastel color for the current page
function setPastelColor(collisionIndex) {
    const pastelColors = ["#ffe4e1", "#e6e6fa", "#e0ffff", "#f5f5dc", "#fafad2"];
    document.getElementById("collision").style.setProperty("--pastel-color", pastelColors[collisionIndex % pastelColors.length]);
}

// Get team index based on the emoji
function getTeamIndex(emoji) {
    switch (emoji) {
        case "ğŸ¶": return 0;
        case "ğŸ±": return 1;
        case "ğŸ¦Š": return 2;
        case "ğŸ»": return 3;
        case "ğŸ¼": return 4;
        case "ğŸ¦": return 5;
    }
}

// Set the result for the current round
function setResult(collisionIndex, matchIndex, team, value) {
    resultsByCollision[collisionIndex][matchIndex][`${team}Result`] = parseInt(value);
    updatePoints();
}

// Update the points for all teams based on selected results
function updatePoints() {
    points = [0, 0, 0, 0, 0, 0]; // Reset points

    resultsByCollision.forEach((collision, collisionIndex) => {
        collision.forEach((match, matchIndex) => {
            const team1Index = getTeamIndex(matchups[collisionIndex][matchIndex][0]);
            const team2Index = getTeamIndex(matchups[collisionIndex][matchIndex][1]);
            if (match.team1Result !== null) points[team1Index] += match.team1Result;
            if (match.team2Result !== null) points[team2Index] += match.team2Result;
        });
    });

    displayCollision(currentCollision);
}

// Save the results of the current round and move to the next
function nextCollision() {
    saveResults();
    currentCollision++;
    if (currentCollision < 5) {
        setPastelColor(currentCollision);
        displayCollision(currentCollision);
    } else {
        showResults();
    }
}

// Move to the previous round
function prevCollision() {
    if (currentCollision > 0) {
        currentCollision--;
        setPastelColor(currentCollision);
        displayCollision(currentCollision);
    } else if (currentCollision === 0) {
        document.getElementById("collision").classList.add("hidden");
        document.getElementById("page1").classList.remove("hidden");
    }
}

// Save the results for each team
function saveResults() {
    const results = document.querySelectorAll(".match");
    let roundResults = [];

    results.forEach((match, index) => {
        const team1Index = getTeamIndex(matchups[currentCollision][index][0]);
        const team2Index = getTeamIndex(matchups[currentCollision][index][1]);
        
        const team1Result = resultsByCollision[currentCollision][index].team1Result;
        const team2Result = resultsByCollision[currentCollision][index].team2Result;
        
        roundResults.push({
            team1: teams[team1Index],
            team2: teams[team2Index],
            team1Points: team1Result,
            team2Points: team2Result
        });
    });

    // Save the results for the current round
    previousResults[currentCollision] = roundResults;

    // Update running total after saving results
    displayRunningTotal();
}

// Display the final results
function showResults() {
    document.getElementById("collision").classList.add("hidden");
    document.getElementById("results").classList.remove("hidden");

    const resultsDiv = document.getElementById("finalScores");
    resultsDiv.innerHTML = '<h3>Final Scores</h3>';
    
    const sortedTeams = [...teams].map((team, index) => ({team, points: points[index], emoji: getEmoji(index)}))
        .sort((a, b) => b.points - a.points);
    
    sortedTeams.forEach(teamData => {
        resultsDiv.innerHTML += `<p>${teamData.team} (${teamData.emoji}): ${teamData.points} ${teamData.points === 1 ? 'point' : 'points'}</p>`;
    });
}

// Display running total of scores
function displayRunningTotal() {
    const runningTotalDiv = document.getElementById("runningTotal");
    runningTotalDiv.innerHTML = 'Current Points:<br>';
    
    const sortedTeams = [...teams].map((team, index) => ({team, points: points[index], emoji: getEmoji(index)}))
        .sort((a, b) => b.points - a.points);
    
    sortedTeams.forEach(teamData => {
        runningTotalDiv.innerHTML += `${teamData.team} (${teamData.emoji}): ${teamData.points} ${teamData.points === 1 ? 'point' : 'points'}<br>`;
    });
}

// Get the emoji for the team
function getEmoji(index) {
    switch (index) {
        case 0: return "ğŸ¶";
        case 1: return "ğŸ±";
        case 2: return "ğŸ¦Š";
        case 3: return "ğŸ»";
        case 4: return "ğŸ¼";
        case 5: return "ğŸ¦";
    }
}

// Confirm restart with a dialog
function confirmRestart() {
    if (confirm("Are you sure you want to reset the tournament? All progress will be lost.")) {
        restart();
    }
}

// Restart the tournament
function restart() {
    points = [0, 0, 0, 0, 0, 0];
    resultsByCollision = [
        [{team1Result: 0, team2Result: 0}, {team1Result: 0, team2Result: 0}, {team1Result: 0, team2Result: 0}],
        [{team1Result: 0, team2Result: 0}, {team1Result: 0, team2Result: 0}, {team1Result: 0, team2Result: 0}],
        [{team1Result: 0, team2Result: 0}, {team1Result: 0, team2Result: 0}, {team1Result: 0, team2Result: 0}],
        [{team1Result: 0, team2Result: 0}, {team1Result: 0, team2Result: 0}, {team1Result: 0, team2Result: 0}],
        [{team1Result: 0, team2Result: 0}, {team1Result: 0, team2Result: 0}, {team1Result: 0, team2Result: 0}]
    ];
    previousResults = [];
    currentCollision = 0;
    document.getElementById("results").classList.add("hidden");
    document.getElementById("page1").classList.remove("hidden");
}

// Go back directly to the last round (Round 5)
function goBackToLastCollision() {
    currentCollision = 4; // Set to the last round (index 4)
    document.getElementById("results").classList.add("hidden");
    document.getElementById("collision").classList.remove("hidden");
    setPastelColor(currentCollision);
    displayCollision(currentCollision);
}
</script>

</body>
</html>
