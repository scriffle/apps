<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave-Particle Duality: Multi-Round VCE Physics Review</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #5a67d8;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .round-indicator {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #5a67d8;
            margin: 20px 0;
            padding: 10px;
            background: #f0f4ff;
            border-radius: 10px;
            display: none;
        }
        
        .round-indicator.visible {
            display: block;
        }
        
        .header-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
        }
        
        .header-info input {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 3px solid #5a67d8;
            margin-bottom: 0;
            background: #e8e8e8;
            padding: 5px 5px 0 5px;
            border-radius: 10px 10px 0 0;
        }
        
        .tab {
            padding: 12px 24px;
            background: #d0d0d0;
            border: 1px solid #999;
            cursor: pointer;
            font-size: 16px;
            margin-right: 3px;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
            color: #333;
            font-weight: 500;
            position: relative;
        }
        
        .tab.completed-r1::before {
            content: "①";
            position: absolute;
            top: 3px;
            right: 20px;
            color: #48bb78;
            font-size: 12px;
        }
        
        .tab.completed-r2::before {
            content: "②";
            position: absolute;
            top: 3px;
            right: 10px;
            color: #4299e1;
            font-size: 12px;
        }
        
        .tab.completed-r3::before {
            content: "③";
            position: absolute;
            top: 3px;
            right: 0px;
            color: #9f7aea;
            font-size: 12px;
        }
        
        .tab:hover {
            background: #c0c0c0;
            transform: translateY(-2px);
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
        }
        
        .tab.active {
            background: white;
            color: #5a67d8;
            font-weight: bold;
            border-bottom: 3px solid white;
            position: relative;
            top: 3px;
            box-shadow: 0 -3px 8px rgba(0,0,0,0.15);
            border: 1px solid #5a67d8;
            border-bottom: 1px solid white;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border: 1px solid #5a67d8;
            border-top: none;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            margin-top: -1px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .content-section {
            margin: 25px 0;
            padding: 25px;
            background: #f8f9ff;
            border-left: 4px solid #5a67d8;
            border-radius: 5px;
            line-height: 2;
            font-size: 17px;
            text-align: left;
        }
        
        .content-section h3 {
            color: #4c51bf;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        select {
            padding: 5px 10px;
            margin: 0 3px;
            border: 2px solid #cbd5e0;
            border-radius: 5px;
            font-size: 16px;
            background: #fffacd;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        select:hover {
            border-color: #5a67d8;
        }
        
        select.selected {
            background: #add8e6;
            border-color: #4682b4;
        }
        
        select.correct {
            background: #90ee90;
            border-color: #228b22;
        }
        
        select.incorrect {
            background: #d3d3d3;
            border-color: #696969;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            pointer-events: none;
        }
        
        .tooltip .tooltiptext.show-delayed {
            visibility: visible;
            opacity: 1;
        }
        
        .button-container {
            text-align: center;
            margin-top: 30px;
        }
        
        button {
            padding: 12px 30px;
            font-size: 18px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 10px;
        }
        
        button:hover:not(:disabled) {
            background: #4c51bf;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(90, 103, 216, 0.3);
        }
        
        button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .review-button {
            background: #48bb78;
        }
        
        .review-button:hover:not(:disabled) {
            background: #38a169;
        }
        
        .stats {
            margin-top: 30px;
            padding: 20px;
            background: #edf2f7;
            border-radius: 10px;
            text-align: center;
        }
        
        .stats h3 {
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .stat-item {
            display: inline-block;
            margin: 0 20px;
            padding: 10px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #5a67d8;
        }
        
        .stat-label {
            font-size: 14px;
            color: #718096;
            margin-top: 5px;
        }
        
        .stat-explanation {
            font-size: 12px;
            color: #a0aec0;
            margin-top: 3px;
            font-style: italic;
        }
        
        .progress-indicator {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background: #edf2f7;
            border-radius: 8px;
            font-size: 16px;
            color: #4a5568;
        }
        
        .progress-indicator span {
            font-weight: bold;
            color: #5a67d8;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 400px;
            border-radius: 10px;
            text-align: center;
        }
        
        .modal-buttons {
            margin-top: 20px;
        }
        
        .modal-buttons button {
            margin: 0 10px;
        }
        
        .cancel-btn {
            background: #e53e3e;
        }
        
        .cancel-btn:hover {
            background: #c53030;
        }
        
        /* Review Page Styles */
        .review-container {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
        }
        
        .review-container.active {
            display: block;
        }
        
        .review-filters {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            margin: 0 5px;
            background: #e2e8f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .filter-btn.active {
            background: #5a67d8;
            color: white;
        }
        
        .weakness-item {
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-left: 4px solid #f56565;
            border-radius: 5px;
        }
        
        .weakness-title {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .weakness-details {
            color: #4a5568;
            font-size: 15px;
            line-height: 1.6;
        }
        
        .weakness-details strong {
            color: #2d3748;
            display: inline-block;
            margin-top: 5px;
        }
        
        .weakness-details em {
            display: block;
            margin-top: 8px;
            font-size: 13px;
            color: #718096;
        }
        
        .improvement-trend {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .trend-improving {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .trend-declining {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .trend-stable {
            background: #feebc8;
            color: #744210;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Wave-Particle Duality: Multi-Round VCE Physics Review</h1>
        
        <div class="round-indicator" id="roundIndicator">
            Round <span id="currentRound">1</span> of 3
        </div>
        
        <div class="header-info">
            <div>
                <label>Name: </label>
                <input type="text" id="studentName" placeholder="Enter your name">
            </div>
            <div>
                <label>First Attempt: </label>
                <input type="text" id="firstAttempt" readonly>
            </div>
        </div>
        
        <div class="progress-indicator">
            Current Tab - Completed: <span id="progressCount">0/6</span> | Submit button will activate when current tab is complete
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'debroglie')">de Broglie Wavelength</button>
            <button class="tab" onclick="openTab(event, 'photons')">Photon Momentum</button>
            <button class="tab" onclick="openTab(event, 'diffraction')">Diffraction & Microscopy</button>
            <button class="tab" onclick="openTab(event, 'doubleslit')">Double Slit Experiment</button>
        </div>
        
        <!-- Tab Content Container -->
        <div id="tabContentContainer">
            <!-- de Broglie Tab -->
            <div id="debroglie" class="tab-content active">
                <div id="debroglie-content"></div>
                <div class="button-container">
                    <button id="debroglieSubmitBtn" onclick="submitTab('debroglie')" disabled>Submit de Broglie Wavelength</button>
                    <button onclick="resetTab('debroglie')">Reset This Section</button>
                </div>
            </div>
            
            <!-- Photons Tab -->
            <div id="photons" class="tab-content">
                <div id="photons-content"></div>
                <div class="button-container">
                    <button id="photonsSubmitBtn" onclick="submitTab('photons')" disabled>Submit Photon Momentum</button>
                    <button onclick="resetTab('photons')">Reset This Section</button>
                </div>
            </div>
            
            <!-- Diffraction Tab -->
            <div id="diffraction" class="tab-content">
                <div id="diffraction-content"></div>
                <div class="button-container">
                    <button id="diffractionSubmitBtn" onclick="submitTab('diffraction')" disabled>Submit Diffraction & Microscopy</button>
                    <button onclick="resetTab('diffraction')">Reset This Section</button>
                </div>
            </div>
            
            <!-- Double Slit Tab -->
            <div id="doubleslit" class="tab-content">
                <div id="doubleslit-content"></div>
                <div class="button-container">
                    <button id="doubleslitSubmitBtn" onclick="submitTab('doubleslit')" disabled>Submit Double Slit Experiment</button>
                    <button onclick="resetTab('doubleslit')">Reset This Section</button>
                </div>
            </div>
        </div>
        
        <!-- Review Button (appears after completing all tabs in a round) -->
        <div class="button-container" id="reviewButtonContainer" style="display: none;">
            <button class="review-button" onclick="showReview()">Review Performance & Continue</button>
        </div>
        
        <!-- Review Container -->
        <div class="review-container" id="reviewContainer">
            <h2>Performance Review</h2>
            <div class="review-filters">
                <button class="filter-btn active" onclick="filterReview('current')">Current Round</button>
                <button class="filter-btn" onclick="filterReview('round1')">Round 1</button>
                <button class="filter-btn" onclick="filterReview('round2')">Round 2</button>
                <button class="filter-btn" onclick="filterReview('round3')">Round 3</button>
                <button class="filter-btn" onclick="filterReview('total')">Total</button>
            </div>
            <div id="reviewContent"></div>
            <div class="button-container">
                <button onclick="continueToNextRound()">Continue to Next Round</button>
                <button onclick="resetRound()">Reset Current Round</button>
                <button onclick="resetAll()">Reset Everything</button>
            </div>
        </div>
        
        <!-- Stats Container -->
        <div class="stats" id="stats" style="display: none;">
            <h3>Your Performance Summary</h3>
            <div id="roundStats"></div>
            <hr style="margin: 20px 0; border: 1px solid #e0e0e0;">
            <div style="display: flex; justify-content: center; flex-wrap: wrap;">
                <div class="stat-item">
                    <div class="stat-value" id="overallScore">0/0</div>
                    <div class="stat-label">Cumulative Score</div>
                    <div class="stat-explanation">Total across all rounds</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="overallPercent">0%</div>
                    <div class="stat-label">Overall Average</div>
                    <div class="stat-explanation">Average % across all attempts</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalSubmissions">0</div>
                    <div class="stat-label">Total Submissions</div>
                    <div class="stat-explanation">Tab submissions made</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="completedRounds">0/3</div>
                    <div class="stat-label">Rounds Completed</div>
                    <div class="stat-explanation">Full rounds finished</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for Reset Confirmation -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Confirm Reset</h3>
            <p id="modalMessage">Are you sure you want to reset?</p>
            <div class="modal-buttons">
                <button onclick="confirmReset()">Yes, Reset</button>
                <button class="cancel-btn" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>
    
    <script>
        // Round content definitions (kept the same as original)
        const roundContent = {
            round1: {
                debroglie: `
                    <div class="content-section">
                        <h3>Matter Waves and de Broglie's Hypothesis</h3>
                        In 1924, Louis de Broglie hypothesised that
                        <span class="tooltip">
                            <select id="d1" data-correct="electrons">
                                <option value="">--Select--</option>
                                <option value="electrons">electrons</option>
                                <option value="photons">photons</option>
                                <option value="neutrons">neutrons</option>
                                <option value="protons">protons</option>
                            </select>
                            <span class="tooltiptext">First particles to show diffraction</span>
                        </span>
                        and all matter must have wave-like properties with an associated wavelength called the
                        <span class="tooltip">
                            <select id="d2" data-correct="de Broglie wavelength">
                                <option value="">--Select--</option>
                                <option value="de Broglie wavelength">de Broglie wavelength</option>
                                <option value="Compton wavelength">Compton wavelength</option>
                                <option value="matter wavelength">matter wavelength</option>
                                <option value="electron wavelength">electron wavelength</option>
                            </select>
                            <span class="tooltiptext">Named after the physicist</span>
                        </span>.
                        When electrons travel through small gaps like spaces between atoms in a
                        <span class="tooltip">
                            <select id="d3" data-correct="crystal lattice">
                                <option value="">--Select--</option>
                                <option value="crystal lattice">crystal lattice</option>
                                <option value="metal surface">metal surface</option>
                                <option value="glass plate">glass plate</option>
                                <option value="polymer chain">polymer chain</option>
                            </select>
                            <span class="tooltiptext">Regular atomic arrangement</span>
                        </span>,
                        they undergo diffraction and form an
                        <span class="tooltip">
                            <select id="d4" data-correct="interference pattern">
                                <option value="">--Select--</option>
                                <option value="interference pattern">interference pattern</option>
                                <option value="absorption spectrum">absorption spectrum</option>
                                <option value="emission spectrum">emission spectrum</option>
                                <option value="continuous spectrum">continuous spectrum</option>
                            </select>
                            <span class="tooltiptext">Pattern from wave superposition</span>
                        </span>.
                        This phenomenon demonstrates
                        <span class="tooltip">
                            <select id="d5" data-correct="wave-particle duality">
                                <option value="">--Select--</option>
                                <option value="wave-particle duality">wave-particle duality</option>
                                <option value="quantum entanglement">quantum entanglement</option>
                                <option value="uncertainty principle">uncertainty principle</option>
                                <option value="quantum tunneling">quantum tunneling</option>
                            </select>
                            <span class="tooltiptext">Dual nature of matter</span>
                        </span>,
                        showing that matter exhibits properties of both waves and
                        <span class="tooltip">
                            <select id="d6" data-correct="particles">
                                <option value="">--Select--</option>
                                <option value="particles">particles</option>
                                <option value="fields">fields</option>
                                <option value="energy">energy</option>
                                <option value="forces">forces</option>
                            </select>
                            <span class="tooltiptext">Discrete entities</span>
                        </span>.
                    </div>
                `,
                photons: `
                    <div class="content-section">
                        <h3>Photon Properties and Momentum</h3>
                        Although photons don't have
                        <span class="tooltip">
                            <select id="p1" data-correct="mass">
                                <option value="">--Select--</option>
                                <option value="mass">mass</option>
                                <option value="charge">charge</option>
                                <option value="volume">volume</option>
                                <option value="density">density</option>
                            </select>
                            <span class="tooltiptext">Photons are massless</span>
                        </span>,
                        experiments show they still possess
                        <span class="tooltip">
                            <select id="p2" data-correct="momentum">
                                <option value="">--Select--</option>
                                <option value="momentum">momentum</option>
                                <option value="inertia">inertia</option>
                                <option value="weight">weight</option>
                                <option value="torque">torque</option>
                            </select>
                            <span class="tooltiptext">Can exert radiation pressure</span>
                        </span>
                        since objects rebound in collisions with them. The relationship between photon energy and momentum is E =
                        <span class="tooltip">
                            <select id="p3" data-correct="pc">
                                <option value="">--Select--</option>
                                <option value="pc">pc</option>
                                <option value="mc²">mc²</option>
                                <option value="hf">hf</option>
                                <option value="½mv²">½mv²</option>
                            </select>
                            <span class="tooltiptext">Energy equals momentum times c</span>
                        </span>
                        where c is the
                        <span class="tooltip">
                            <select id="p4" data-correct="speed of light">
                                <option value="">--Select--</option>
                                <option value="speed of light">speed of light</option>
                                <option value="speed of sound">speed of sound</option>
                                <option value="wave velocity">wave velocity</option>
                                <option value="phase velocity">phase velocity</option>
                            </select>
                            <span class="tooltiptext">3.0 × 10⁸ m/s in vacuum</span>
                        </span>.
                        Since both photons and matter follow λ = h/p, they will have the same de Broglie wavelength if they have the same
                        <span class="tooltip">
                            <select id="p5" data-correct="momentum">
                                <option value="">--Select--</option>
                                <option value="momentum">momentum</option>
                                <option value="energy">energy</option>
                                <option value="frequency">frequency</option>
                                <option value="velocity">velocity</option>
                            </select>
                            <span class="tooltiptext">p in the equation</span>
                        </span>,
                        where h is
                        <span class="tooltip">
                            <select id="p6" data-correct="Planck's constant">
                                <option value="">--Select--</option>
                                <option value="Planck's constant">Planck's constant</option>
                                <option value="Hubble's constant">Hubble's constant</option>
                                <option value="Boltzmann's constant">Boltzmann's constant</option>
                                <option value="Rydberg's constant">Rydberg's constant</option>
                            </select>
                            <span class="tooltiptext">6.63 × 10⁻³⁴ J·s</span>
                        </span>.
                    </div>
                `,
                diffraction: `
                    <div class="content-section">
                        <h3>Diffraction Patterns and Imaging Limitations</h3>
                        When matter and photons with the same wavelength pass through gaps of the same width, they create
                        <span class="tooltip">
                            <select id="f1" data-correct="identically spaced">
                                <option value="">--Select--</option>
                                <option value="identically spaced">identically spaced</option>
                                <option value="differently spaced">differently spaced</option>
                                <option value="randomly spaced">randomly spaced</option>
                                <option value="inversely spaced">inversely spaced</option>
                            </select>
                            <span class="tooltiptext">Same fringe separation</span>
                        </span>
                        diffraction patterns. The amount of diffraction depends on the ratio
                        <span class="tooltip">
                            <select id="f2" data-correct="λ/w">
                                <option value="">--Select--</option>
                                <option value="λ/w">λ/w</option>
                                <option value="w/λ">w/λ</option>
                                <option value="λ×w">λ×w</option>
                                <option value="λ+w">λ+w</option>
                            </select>
                            <span class="tooltiptext">Wavelength over gap width</span>
                        </span>.
                        Light microscopes are limited because significant diffraction occurs when this ratio is
                        <span class="tooltip">
                            <select id="f3" data-correct="≥ 1">
                                <option value="">--Select--</option>
                                <option value="≥ 1">≥ 1</option>
                                <option value="≤ 1">≤ 1</option>
                                <option value="= 0">= 0</option>
                                <option value=">> 1">>> 1</option>
                            </select>
                            <span class="tooltiptext">Greater than or equal to one</span>
                        </span>,
                        meaning the object is similar size or smaller than the wavelength. Electron microscopes overcome this limitation because electrons have much
                        <span class="tooltip">
                            <select id="f4" data-correct="smaller">
                                <option value="">--Select--</option>
                                <option value="smaller">smaller</option>
                                <option value="larger">larger</option>
                                <option value="variable">variable</option>
                                <option value="complex">complex</option>
                            </select>
                            <span class="tooltiptext">Tiny de Broglie wavelength</span>
                        </span>
                        de Broglie wavelengths than visible light. While X-rays have small wavelengths, they can
                        <span class="tooltip">
                            <select id="f5" data-correct="damage">
                                <option value="">--Select--</option>
                                <option value="damage">damage</option>
                                <option value="enhance">enhance</option>
                                <option value="preserve">preserve</option>
                                <option value="illuminate">illuminate</option>
                            </select>
                            <span class="tooltiptext">High energy destroys samples</span>
                        </span>
                        organic matter, making electron microscopes safer for imaging
                        <span class="tooltip">
                            <select id="f6" data-correct="viruses">
                                <option value="">--Select--</option>
                                <option value="viruses">viruses</option>
                                <option value="planets">planets</option>
                                <option value="galaxies">galaxies</option>
                                <option value="continents">continents</option>
                            </select>
                            <span class="tooltiptext">Nanometer-scale organisms</span>
                        </span>
                        and proteins.
                    </div>
                `,
                doubleslit: `
                    <div class="content-section">
                        <h3>Double Slit Experiment Evidence</h3>
                        In the double slit experiment with individual photons or electrons, particles are sent
                        <span class="tooltip">
                            <select id="s1" data-correct="one at a time">
                                <option value="">--Select--</option>
                                <option value="one at a time">one at a time</option>
                                <option value="in pairs">in pairs</option>
                                <option value="continuously">continuously</option>
                                <option value="simultaneously">simultaneously</option>
                            </select>
                            <span class="tooltiptext">Individual particle detection</span>
                        </span>
                        through the slits. Each particle creates a single
                        <span class="tooltip">
                            <select id="s2" data-correct="spot">
                                <option value="">--Select--</option>
                                <option value="spot">spot</option>
                                <option value="wave">wave</option>
                                <option value="line">line</option>
                                <option value="circle">circle</option>
                            </select>
                            <span class="tooltiptext">Discrete detection point</span>
                        </span>
                        on the detector screen, demonstrating their
                        <span class="tooltip">
                            <select id="s3" data-correct="particle">
                                <option value="">--Select--</option>
                                <option value="particle">particle</option>
                                <option value="wave">wave</option>
                                <option value="energy">energy</option>
                                <option value="field">field</option>
                            </select>
                            <span class="tooltiptext">Discrete nature</span>
                        </span>
                        nature. Over time, these spots build up to form an
                        <span class="tooltip">
                            <select id="s4" data-correct="interference pattern">
                                <option value="">--Select--</option>
                                <option value="interference pattern">interference pattern</option>
                                <option value="absorption spectrum">absorption spectrum</option>
                                <option value="continuous distribution">continuous distribution</option>
                                <option value="random scatter">random scatter</option>
                            </select>
                            <span class="tooltiptext">Wave-like pattern</span>
                        </span>,
                        demonstrating wave properties. This suggests each particle interferes with
                        <span class="tooltip">
                            <select id="s5" data-correct="itself">
                                <option value="">--Select--</option>
                                <option value="itself">itself</option>
                                <option value="others">others</option>
                                <option value="the screen">the screen</option>
                                <option value="the slits">the slits</option>
                            </select>
                            <span class="tooltiptext">Self-interference phenomenon</span>
                        </span>,
                        providing evidence for
                        <span class="tooltip">
                            <select id="s6" data-correct="wave-particle duality">
                                <option value="">--Select--</option>
                                <option value="wave-particle duality">wave-particle duality</option>
                                <option value="quantum entanglement">quantum entanglement</option>
                                <option value="energy conservation">energy conservation</option>
                                <option value="momentum transfer">momentum transfer</option>
                            </select>
                            <span class="tooltiptext">Dual nature of quantum objects</span>
                        </span>.
                    </div>
                `
            },
            round2: {
                debroglie: `
                    <div class="content-section">
                        <h3>Wave Properties of Matter</h3>
                        The revolutionary concept of the
                        <span class="tooltip">
                            <select id="d1" data-correct="de Broglie wavelength">
                                <option value="">--Select--</option>
                                <option value="de Broglie wavelength">de Broglie wavelength</option>
                                <option value="Compton scattering">Compton scattering</option>
                                <option value="photoelectric effect">photoelectric effect</option>
                                <option value="Planck radiation">Planck radiation</option>
                            </select>
                            <span class="tooltiptext">Matter wave concept</span>
                        </span>
                        demonstrates that all matter particles exhibit wave-like behavior. The wavelength is calculated using λ =
                        <span class="tooltip">
                            <select id="d2" data-correct="h/p">
                                <option value="">--Select--</option>
                                <option value="h/p">h/p</option>
                                <option value="p/h">p/h</option>
                                <option value="hp">hp</option>
                                <option value="h/E">h/E</option>
                            </select>
                            <span class="tooltiptext">Planck's constant over momentum</span>
                        </span>
                        where p represents the particle's
                        <span class="tooltip">
                            <select id="d3" data-correct="momentum">
                                <option value="">--Select--</option>
                                <option value="momentum">momentum</option>
                                <option value="energy">energy</option>
                                <option value="frequency">frequency</option>
                                <option value="velocity">velocity</option>
                            </select>
                            <span class="tooltiptext">Mass times velocity</span>
                        </span>.
                        In 1927, electron
                        <span class="tooltip">
                            <select id="d4" data-correct="diffraction">
                                <option value="">--Select--</option>
                                <option value="diffraction">diffraction</option>
                                <option value="reflection">reflection</option>
                                <option value="absorption">absorption</option>
                                <option value="emission">emission</option>
                            </select>
                            <span class="tooltiptext">Wave bending phenomenon</span>
                        </span>
                        was experimentally demonstrated, confirming de Broglie's hypothesis. Larger objects have
                        <span class="tooltip">
                            <select id="d5" data-correct="extremely small">
                                <option value="">--Select--</option>
                                <option value="extremely small">extremely small</option>
                                <option value="very large">very large</option>
                                <option value="undefined">undefined</option>
                                <option value="infinite">infinite</option>
                            </select>
                            <span class="tooltiptext">Too tiny to measure</span>
                        </span>
                        wavelengths, making their wave properties
                        <span class="tooltip">
                            <select id="d6" data-correct="unobservable">
                                <option value="">--Select--</option>
                                <option value="unobservable">unobservable</option>
                                <option value="dominant">dominant</option>
                                <option value="destructive">destructive</option>
                                <option value="amplified">amplified</option>
                            </select>
                            <span class="tooltiptext">Cannot be detected</span>
                        </span>
                        at macroscopic scales.
                    </div>
                `,
                photons: `
                    <div class="content-section">
                        <h3>Massless Particles with Momentum</h3>
                        Photons demonstrate that particles without
                        <span class="tooltip">
                            <select id="p1" data-correct="mass">
                                <option value="">--Select--</option>
                                <option value="mass">mass</option>
                                <option value="energy">energy</option>
                                <option value="wavelength">wavelength</option>
                                <option value="frequency">frequency</option>
                            </select>
                            <span class="tooltiptext">Rest mass is zero</span>
                        </span>
                        can still carry momentum. Solar sails utilize photon
                        <span class="tooltip">
                            <select id="p2" data-correct="momentum">
                                <option value="">--Select--</option>
                                <option value="momentum">momentum</option>
                                <option value="energy">energy</option>
                                <option value="mass">mass</option>
                                <option value="charge">charge</option>
                            </select>
                            <span class="tooltiptext">Radiation pressure</span>
                        </span>
                        for spacecraft propulsion. The formula relating photon energy to momentum is
                        <span class="tooltip">
                            <select id="p3" data-correct="E = pc">
                                <option value="">--Select--</option>
                                <option value="E = pc">E = pc</option>
                                <option value="E = mc²">E = mc²</option>
                                <option value="p = mv">p = mv</option>
                                <option value="E = hf">E = hf</option>
                            </select>
                            <span class="tooltiptext">Energy-momentum relation</span>
                        </span>,
                        where c equals
                        <span class="tooltip">
                            <select id="p4" data-correct="3.0 × 10⁸">
                                <option value="">--Select--</option>
                                <option value="3.0 × 10⁸">3.0 × 10⁸</option>
                                <option value="6.63 × 10⁻³⁴">6.63 × 10⁻³⁴</option>
                                <option value="9.1 × 10⁻³¹">9.1 × 10⁻³¹</option>
                                <option value="1.6 × 10⁻¹⁹">1.6 × 10⁻¹⁹</option>
                            </select>
                            <span class="tooltiptext">Speed of light in m/s</span>
                        </span>
                        m/s. For equal wavelengths, photons and matter particles must have equal
                        <span class="tooltip">
                            <select id="p5" data-correct="momentum">
                                <option value="">--Select--</option>
                                <option value="momentum">momentum</option>
                                <option value="energy">energy</option>
                                <option value="mass">mass</option>
                                <option value="velocity">velocity</option>
                            </select>
                            <span class="tooltiptext">From λ = h/p</span>
                        </span>
                        since both follow the relationship λ =
                        <span class="tooltip">
                            <select id="p6" data-correct="h/p">
                                <option value="">--Select--</option>
                                <option value="h/p">h/p</option>
                                <option value="E/c">E/c</option>
                                <option value="mc/h">mc/h</option>
                                <option value="p/h">p/h</option>
                            </select>
                            <span class="tooltiptext">de Broglie equation</span>
                        </span>.
                    </div>
                `,
                diffraction: `
                    <div class="content-section">
                        <h3>Microscopy and Wave Limitations</h3>
                        The resolution limit of optical microscopes stems from the
                        <span class="tooltip">
                            <select id="f1" data-correct="diffraction">
                                <option value="">--Select--</option>
                                <option value="diffraction">diffraction</option>
                                <option value="reflection">reflection</option>
                                <option value="absorption">absorption</option>
                                <option value="dispersion">dispersion</option>
                            </select>
                            <span class="tooltiptext">Wave spreading effect</span>
                        </span>
                        of light waves. When the ratio λ/w approaches or exceeds
                        <span class="tooltip">
                            <select id="f2" data-correct="1">
                                <option value="">--Select--</option>
                                <option value="1">1</option>
                                <option value="0">0</option>
                                <option value="∞">∞</option>
                                <option value="0.5">0.5</option>
                            </select>
                            <span class="tooltiptext">Unity ratio</span>
                        </span>,
                        significant blurring occurs. Visible light wavelengths range from
                        <span class="tooltip">
                            <select id="f3" data-correct="400-700 nm">
                                <option value="">--Select--</option>
                                <option value="400-700 nm">400-700 nm</option>
                                <option value="10-100 nm">10-100 nm</option>
                                <option value="1-10 μm">1-10 μm</option>
                                <option value="700-1000 nm">700-1000 nm</option>
                            </select>
                            <span class="tooltiptext">Visible spectrum range</span>
                        </span>,
                        limiting resolution to cellular structures. Electron beams achieve
                        <span class="tooltip">
                            <select id="f4" data-correct="nanometer">
                                <option value="">--Select--</option>
                                <option value="nanometer">nanometer</option>
                                <option value="micrometer">micrometer</option>
                                <option value="millimeter">millimeter</option>
                                <option value="picometer">picometer</option>
                            </select>
                            <span class="tooltiptext">10⁻⁹ meter scale</span>
                        </span>
                        resolution due to their tiny de Broglie wavelengths. Unlike X-rays, electrons don't
                        <span class="tooltip">
                            <select id="f5" data-correct="ionize">
                                <option value="">--Select--</option>
                                <option value="ionize">ionize</option>
                                <option value="penetrate">penetrate</option>
                                <option value="reflect">reflect</option>
                                <option value="scatter">scatter</option>
                            </select>
                            <span class="tooltiptext">Damage by removing electrons</span>
                        </span>
                        biological samples as severely, enabling imaging of
                        <span class="tooltip">
                            <select id="f6" data-correct="proteins">
                                <option value="">--Select--</option>
                                <option value="proteins">proteins</option>
                                <option value="atoms">atoms</option>
                                <option value="quarks">quarks</option>
                                <option value="nuclei">nuclei</option>
                            </select>
                            <span class="tooltiptext">Biological macromolecules</span>
                        </span>
                        and viral structures.
                    </div>
                `,
                doubleslit: `
                    <div class="content-section">
                        <h3>Single Particle Interference</h3>
                        Modern double slit experiments fire
                        <span class="tooltip">
                            <select id="s1" data-correct="individual">
                                <option value="">--Select--</option>
                                <option value="individual">individual</option>
                                <option value="multiple">multiple</option>
                                <option value="continuous">continuous</option>
                                <option value="paired">paired</option>
                            </select>
                            <span class="tooltiptext">One by one</span>
                        </span>
                        electrons or photons through the apparatus. Each particle registers as a
                        <span class="tooltip">
                            <select id="s2" data-correct="discrete">
                                <option value="">--Select--</option>
                                <option value="discrete">discrete</option>
                                <option value="continuous">continuous</option>
                                <option value="diffuse">diffuse</option>
                                <option value="scattered">scattered</option>
                            </select>
                            <span class="tooltiptext">Single point detection</span>
                        </span>
                        impact on the screen, confirming particle behavior. Remarkably, the accumulation reveals
                        <span class="tooltip">
                            <select id="s3" data-correct="interference">
                                <option value="">--Select--</option>
                                <option value="interference">interference</option>
                                <option value="absorption">absorption</option>
                                <option value="reflection">reflection</option>
                                <option value="polarization">polarization</option>
                            </select>
                            <span class="tooltiptext">Wave pattern formation</span>
                        </span>
                        fringes characteristic of waves. Since particles travel
                        <span class="tooltip">
                            <select id="s4" data-correct="individually">
                                <option value="">--Select--</option>
                                <option value="individually">individually</option>
                                <option value="collectively">collectively</option>
                                <option value="randomly">randomly</option>
                                <option value="coherently">coherently</option>
                            </select>
                            <span class="tooltiptext">One at a time</span>
                        </span>,
                        each must somehow interfere with
                        <span class="tooltip">
                            <select id="s5" data-correct="itself">
                                <option value="">--Select--</option>
                                <option value="itself">itself</option>
                                <option value="neighbors">neighbors</option>
                                <option value="the apparatus">the apparatus</option>
                                <option value="photons">photons</option>
                            </select>
                            <span class="tooltiptext">Self-interference</span>
                        </span>.
                        This paradox epitomizes
                        <span class="tooltip">
                            <select id="s6" data-correct="quantum mechanics">
                                <option value="">--Select--</option>
                                <option value="quantum mechanics">quantum mechanics</option>
                                <option value="classical physics">classical physics</option>
                                <option value="relativity">relativity</option>
                                <option value="thermodynamics">thermodynamics</option>
                            </select>
                            <span class="tooltiptext">Quantum realm physics</span>
                        </span>
                        where particles exhibit dual wave-particle nature.
                    </div>
                `
            },
            round3: {
                debroglie: `
                    <div class="content-section">
                        <h3>Matter Wave Theory Applications</h3>
                        Electron microscopy exploits the
                        <span class="tooltip">
                            <select id="d1" data-correct="wave nature">
                                <option value="">--Select--</option>
                                <option value="wave nature">wave nature</option>
                                <option value="particle nature">particle nature</option>
                                <option value="electric charge">electric charge</option>
                                <option value="magnetic moment">magnetic moment</option>
                            </select>
                            <span class="tooltiptext">Wave properties of electrons</span>
                        </span>
                        of electrons to achieve superior resolution. The formula λ = h/p shows wavelength is
                        <span class="tooltip">
                            <select id="d2" data-correct="inversely proportional">
                                <option value="">--Select--</option>
                                <option value="inversely proportional">inversely proportional</option>
                                <option value="directly proportional">directly proportional</option>
                                <option value="independent">independent</option>
                                <option value="exponentially related">exponentially related</option>
                            </select>
                            <span class="tooltiptext">Inverse relationship</span>
                        </span>
                        to momentum. High-energy electrons possess
                        <span class="tooltip">
                            <select id="d3" data-correct="short">
                                <option value="">--Select--</option>
                                <option value="short">short</option>
                                <option value="long">long</option>
                                <option value="infinite">infinite</option>
                                <option value="zero">zero</option>
                            </select>
                            <span class="tooltiptext">Small wavelength</span>
                        </span>
                        wavelengths enabling atomic-scale imaging. The value of Planck's constant,
                        <span class="tooltip">
                            <select id="d4" data-correct="6.63 × 10⁻³⁴">
                                <option value="">--Select--</option>
                                <option value="6.63 × 10⁻³⁴">6.63 × 10⁻³⁴</option>
                                <option value="3.0 × 10⁸">3.0 × 10⁸</option>
                                <option value="9.1 × 10⁻³¹">9.1 × 10⁻³¹</option>
                                <option value="1.6 × 10⁻¹⁹">1.6 × 10⁻¹⁹</option>
                            </select>
                            <span class="tooltiptext">In J·s units</span>
                        </span>
                        J·s, determines the scale at which
                        <span class="tooltip">
                            <select id="d5" data-correct="quantum">
                                <option value="">--Select--</option>
                                <option value="quantum">quantum</option>
                                <option value="classical">classical</option>
                                <option value="relativistic">relativistic</option>
                                <option value="nuclear">nuclear</option>
                            </select>
                            <span class="tooltiptext">Quantum mechanical</span>
                        </span>
                        effects become significant. Crystal
                        <span class="tooltip">
                            <select id="d6" data-correct="diffraction">
                                <option value="">--Select--</option>
                                <option value="diffraction">diffraction</option>
                                <option value="absorption">absorption</option>
                                <option value="emission">emission</option>
                                <option value="reflection">reflection</option>
                            </select>
                            <span class="tooltiptext">Scattering pattern</span>
                        </span>
                        experiments validate de Broglie's predictions about matter waves.
                    </div>
                `,
                photons: `
                    <div class="content-section">
                        <h3>Photon-Matter Equivalence</h3>
                        The universal relationship
                        <span class="tooltip">
                            <select id="p1" data-correct="λ = h/p">
                                <option value="">--Select--</option>
                                <option value="λ = h/p">λ = h/p</option>
                                <option value="E = mc²">E = mc²</option>
                                <option value="F = ma">F = ma</option>
                                <option value="p = mv">p = mv</option>
                            </select>
                            <span class="tooltiptext">de Broglie equation</span>
                        </span>
                        applies equally to photons and matter particles. Massless photons derive momentum from their
                        <span class="tooltip">
                            <select id="p2" data-correct="energy">
                                <option value="">--Select--</option>
                                <option value="energy">energy</option>
                                <option value="frequency">frequency</option>
                                <option value="amplitude">amplitude</option>
                                <option value="polarization">polarization</option>
                            </select>
                            <span class="tooltiptext">E = pc relationship</span>
                        </span>
                        content. Radiation pressure from photon
                        <span class="tooltip">
                            <select id="p3" data-correct="collisions">
                                <option value="">--Select--</option>
                                <option value="collisions">collisions</option>
                                <option value="absorption">absorption</option>
                                <option value="creation">creation</option>
                                <option value="annihilation">annihilation</option>
                            </select>
                            <span class="tooltiptext">Momentum transfer events</span>
                        </span>
                        drives solar sails and comet tails. Matter and photons produce identical diffraction when their
                        <span class="tooltip">
                            <select id="p4" data-correct="wavelengths">
                                <option value="">--Select--</option>
                                <option value="wavelengths">wavelengths</option>
                                <option value="energies">energies</option>
                                <option value="frequencies">frequencies</option>
                                <option value="velocities">velocities</option>
                            </select>
                            <span class="tooltiptext">λ values match</span>
                        </span>
                        match. The constant
                        <span class="tooltip">
                            <select id="p5" data-correct="h">
                                <option value="">--Select--</option>
                                <option value="h">h</option>
                                <option value="c">c</option>
                                <option value="e">e</option>
                                <option value="k">k</option>
                            </select>
                            <span class="tooltiptext">Planck's constant symbol</span>
                        </span>
                        bridges the wave-particle domains. X-rays and electrons with equal
                        <span class="tooltip">
                            <select id="p6" data-correct="momentum">
                                <option value="">--Select--</option>
                                <option value="momentum">momentum</option>
                                <option value="mass">mass</option>
                                <option value="charge">charge</option>
                                <option value="spin">spin</option>
                            </select>
                            <span class="tooltiptext">p values</span>
                        </span>
                        create indistinguishable diffraction patterns.
                    </div>
                `,
                diffraction: `
                    <div class="content-section">
                        <h3>Resolution and Wavelength Limits</h3>
                        Imaging resolution fundamentally depends on the
                        <span class="tooltip">
                            <select id="f1" data-correct="wavelength">
                                <option value="">--Select--</option>
                                <option value="wavelength">wavelength</option>
                                <option value="intensity">intensity</option>
                                <option value="frequency">frequency</option>
                                <option value="amplitude">amplitude</option>
                            </select>
                            <span class="tooltiptext">λ of probe radiation</span>
                        </span>
                        of the probing radiation. Objects smaller than λ cause severe
                        <span class="tooltip">
                            <select id="f2" data-correct="diffraction">
                                <option value="">--Select--</option>
                                <option value="diffraction">diffraction</option>
                                <option value="reflection">reflection</option>
                                <option value="transmission">transmission</option>
                                <option value="absorption">absorption</option>
                            </select>
                            <span class="tooltiptext">Wave spreading</span>
                        </span>,
                        blurring image details. Electron microscopes achieve
                        <span class="tooltip">
                            <select id="f3" data-correct="10⁻¹²">
                                <option value="">--Select--</option>
                                <option value="10⁻¹²">10⁻¹²</option>
                                <option value="10⁻⁶">10⁻⁶</option>
                                <option value="10⁻⁹">10⁻⁹</option>
                                <option value="10⁻¹⁵">10⁻¹⁵</option>
                            </select>
                            <span class="tooltiptext">Picometer wavelengths</span>
                        </span>
                        meter wavelengths, far superior to optical microscopes. X-ray microscopy, despite short wavelengths, causes
                        <span class="tooltip">
                            <select id="f4" data-correct="radiation damage">
                                <option value="">--Select--</option>
                                <option value="radiation damage">radiation damage</option>
                                <option value="heat buildup">heat buildup</option>
                                <option value="charge accumulation">charge accumulation</option>
                                <option value="magnetic interference">magnetic interference</option>
                            </select>
                            <span class="tooltiptext">Ionization damage</span>
                        </span>
                        to biological specimens. The ratio λ/w determines whether
                        <span class="tooltip">
                            <select id="f5" data-correct="significant">
                                <option value="">--Select--</option>
                                <option value="significant">significant</option>
                                <option value="negligible">negligible</option>
                                <option value="destructive">destructive</option>
                                <option value="constructive">constructive</option>
                            </select>
                            <span class="tooltiptext">Major diffraction effects</span>
                        </span>
                        diffraction occurs. Modern electron microscopes can resolve individual
                        <span class="tooltip">
                            <select id="f6" data-correct="atoms">
                                <option value="">--Select--</option>
                                <option value="atoms">atoms</option>
                                <option value="galaxies">galaxies</option>
                                <option value="planets">planets</option>
                                <option value="continents">continents</option>
                            </select>
                            <span class="tooltiptext">Atomic resolution</span>
                        </span>
                        in crystalline materials.
                    </div>
                `,
                doubleslit: `
                    <div class="content-section">
                        <h3>Quantum Superposition Evidence</h3>
                        The double slit paradox reveals that quantum particles exist in
                        <span class="tooltip">
                            <select id="s1" data-correct="superposition">
                                <option value="">--Select--</option>
                                <option value="superposition">superposition</option>
                                <option value="opposition">opposition</option>
                                <option value="composition">composition</option>
                                <option value="decomposition">decomposition</option>
                            </select>
                            <span class="tooltiptext">Multiple states simultaneously</span>
                        </span>
                        states until measured. Individual particle impacts appear
                        <span class="tooltip">
                            <select id="s2" data-correct="randomly">
                                <option value="">--Select--</option>
                                <option value="randomly">randomly</option>
                                <option value="predictably">predictably</option>
                                <option value="uniformly">uniformly</option>
                                <option value="symmetrically">symmetrically</option>
                            </select>
                            <span class="tooltiptext">No predictable pattern</span>
                        </span>
                        distributed, yet collectively form predictable
                        <span class="tooltip">
                            <select id="s3" data-correct="interference">
                                <option value="">--Select--</option>
                                <option value="interference">interference</option>
                                <option value="diffusion">diffusion</option>
                                <option value="absorption">absorption</option>
                                <option value="emission">emission</option>
                            </select>
                            <span class="tooltiptext">Wave interference pattern</span>
                        </span>
                        patterns. This demonstrates the
                        <span class="tooltip">
                            <select id="s4" data-correct="probabilistic">
                                <option value="">--Select--</option>
                                <option value="probabilistic">probabilistic</option>
                                <option value="deterministic">deterministic</option>
                                <option value="chaotic">chaotic</option>
                                <option value="classical">classical</option>
                            </select>
                            <span class="tooltiptext">Statistical nature</span>
                        </span>
                        nature of quantum mechanics. Neither purely wave nor particle models explain why single particles create
                        <span class="tooltip">
                            <select id="s5" data-correct="interference">
                                <option value="">--Select--</option>
                                <option value="interference">interference</option>
                                <option value="reflection">reflection</option>
                                <option value="absorption">absorption</option>
                                <option value="emission">emission</option>
                            </select>
                            <span class="tooltiptext">Wave pattern buildup</span>
                        </span>
                        patterns. The phenomenon confirms
                        <span class="tooltip">
                            <select id="s6" data-correct="complementarity">
                                <option value="">--Select--</option>
                                <option value="complementarity">complementarity</option>
                                <option value="uncertainty">uncertainty</option>
                                <option value="exclusion">exclusion</option>
                                <option value="conservation">conservation</option>
                            </select>
                            <span class="tooltiptext">Wave-particle complementarity principle</span>
                        </span>
                        - the principle that wave and particle descriptions are both necessary.
                    </div>
                `
            }
        };
        
        // Global variables
        let currentRound = 1;
        let submitted = {};
        let currentTab = 'debroglie';
        let tabScores = {};
        let errorTracking = {};
        let tooltipTimers = {};
        let pendingReset = null;
        
        // Initialize on load
        window.onload = function() {
            initializeRound();
            loadSavedData();
            addChangeListeners();
            addTooltipListeners();
            addDebugListener();
            checkCompletion();
        };
        
        // Debug feature - press q+w+e together
        function addDebugListener() {
            let keysPressed = {};
            
            document.addEventListener('keydown', function(e) {
                keysPressed[e.key.toLowerCase()] = true;
                
                // Check if q, w, and e are all pressed
                if (keysPressed['q'] && keysPressed['w'] && keysPressed['e']) {
                    populateAllFields();
                    keysPressed = {}; // Reset after triggering
                }
            });
            
            document.addEventListener('keyup', function(e) {
                delete keysPressed[e.key.toLowerCase()];
            });
        }
        
        function populateAllFields() {
            console.log('Debug mode activated: Auto-filling all fields with correct answers');
            const selects = document.querySelectorAll('select');
            let filled = 0;
            
            selects.forEach(select => {
                if (select.value === '') {
                    // Get the correct answer
                    const correctAnswer = select.getAttribute('data-correct');
                    
                    // Find and select the correct option
                    for (let i = 0; i < select.options.length; i++) {
                        if (select.options[i].value === correctAnswer) {
                            select.value = correctAnswer;
                            select.classList.add('selected');
                            filled++;
                            break;
                        }
                    }
                }
            });
            
            console.log(`Filled ${filled} empty fields`);
            
            // Update completion status
            checkCompletion();
            saveCurrentProgress();
            
            // Visual feedback
            const indicator = document.getElementById('progressCount');
            const originalColor = indicator.style.color;
            indicator.style.color = '#48bb78';
            setTimeout(() => {
                indicator.style.color = originalColor;
            }, 1000);
        }
        
        function initializeRound() {
            // Load content for current round
            const roundKey = 'round' + currentRound;
            
            // Load content for each tab
            document.getElementById('debroglie-content').innerHTML = roundContent[roundKey].debroglie;
            document.getElementById('photons-content').innerHTML = roundContent[roundKey].photons;
            document.getElementById('diffraction-content').innerHTML = roundContent[roundKey].diffraction;
            document.getElementById('doubleslit-content').innerHTML = roundContent[roundKey].doubleslit;
            
            // Only show round indicator after Round 1 is complete
            // Check if Round 1 has been completed
            if (currentRound > 1 || (tabScores['round1'] && Object.keys(tabScores['round1']).length === 4)) {
                document.getElementById('roundIndicator').classList.add('visible');
                document.getElementById('currentRound').textContent = currentRound;
            }
            
            // Randomize dropdowns
            randomizeDropdowns();
        }
        
        function randomizeDropdowns() {
            const selects = document.querySelectorAll('select');
            
            selects.forEach(select => {
                const options = Array.from(select.options).slice(1);
                
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [options[i], options[j]] = [options[j], options[i]];
                }
                
                while (select.options.length > 1) {
                    select.remove(1);
                }
                
                options.forEach(option => {
                    select.add(option);
                });
            });
        }
        
        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
            currentTab = tabName;
            
            checkCompletion();
        }
        
        function addChangeListeners() {
            const selects = document.querySelectorAll('select');
            selects.forEach(select => {
                select.addEventListener('change', function() {
                    if (this.value !== '') {
                        this.classList.add('selected');
                    } else {
                        this.classList.remove('selected');
                    }
                    saveCurrentProgress();
                    checkCompletion();
                });
            });
        }
        
        function addTooltipListeners() {
            const tooltips = document.querySelectorAll('.tooltip');
            
            tooltips.forEach((tooltip, index) => {
                const tooltipText = tooltip.querySelector('.tooltiptext');
                const select = tooltip.querySelector('select');
                
                if (tooltipText && select) {
                    let hoverTimer = null;
                    let tooltipShown = false;
                    
                    tooltip.addEventListener('mouseenter', function() {
                        if (select.classList.contains('incorrect')) {
                            if (hoverTimer) {
                                clearTimeout(hoverTimer);
                            }
                            
                            tooltipShown = false;
                            
                            hoverTimer = setTimeout(() => {
                                tooltipText.classList.add('show-delayed');
                                tooltipShown = true;
                            }, 1500);
                        }
                    });
                    
                    tooltip.addEventListener('mouseleave', function() {
                        if (hoverTimer) {
                            clearTimeout(hoverTimer);
                            hoverTimer = null;
                        }
                        tooltipText.classList.remove('show-delayed');
                        tooltipShown = false;
                    });
                    
                    tooltip.addEventListener('mousemove', function() {
                        if (tooltipShown) {
                            tooltipText.classList.remove('show-delayed');
                            tooltipShown = false;
                            if (hoverTimer) {
                                clearTimeout(hoverTimer);
                                hoverTimer = null;
                            }
                        }
                    });
                }
            });
        }
        
        function checkCompletion() {
            let prefix = '';
            switch(currentTab) {
                case 'debroglie': prefix = 'd'; break;
                case 'photons': prefix = 'p'; break;
                case 'diffraction': prefix = 'f'; break;
                case 'doubleslit': prefix = 's'; break;
            }
            
            let completed = 0;
            let total = 6;
            
            for (let i = 1; i <= 6; i++) {
                const select = document.getElementById(prefix + i);
                if (select && select.value !== '') {
                    completed++;
                }
            }
            
            document.getElementById('progressCount').textContent = completed + '/' + total;
            
            const submitBtn = document.getElementById(currentTab + 'SubmitBtn');
            if (submitBtn) {
                submitBtn.disabled = (completed !== total);
            }
            
            // Check if all tabs in current round are complete
            checkRoundCompletion();
        }
        
        function checkRoundCompletion() {
            const roundKey = 'round' + currentRound;
            if (!tabScores[roundKey]) return;
            
            const tabs = ['debroglie', 'photons', 'diffraction', 'doubleslit'];
            let allComplete = true;
            
            for (let tab of tabs) {
                if (!tabScores[roundKey][tab]) {
                    allComplete = false;
                    break;
                }
            }
            
            if (allComplete) {
                document.getElementById('reviewButtonContainer').style.display = 'block';
            }
        }
        
        function submitTab(tabName) {
            const studentName = document.getElementById('studentName').value;
            if (studentName) {
                localStorage.setItem('physicsStudentName', studentName);
            }
            
            if (!localStorage.getItem('physicsFirstAttemptDate')) {
                const now = new Date();
                const dateStr = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
                localStorage.setItem('physicsFirstAttemptDate', dateStr);
                document.getElementById('firstAttempt').value = dateStr;
            }
            
            let prefix = '';
            switch(tabName) {
                case 'debroglie': prefix = 'd'; break;
                case 'photons': prefix = 'p'; break;
                case 'diffraction': prefix = 'f'; break;
                case 'doubleslit': prefix = 's'; break;
            }
            
            let correct = 0;
            let total = 6;
            const roundKey = 'round' + currentRound;
            
            if (!tabScores[roundKey]) {
                tabScores[roundKey] = {};
            }
            
            if (!errorTracking[roundKey]) {
                errorTracking[roundKey] = {};
            }
            
            // Track total submissions (not attempts)
            let totalSubmissions = parseInt(localStorage.getItem('physicsTotalSubmissions') || '0') + 1;
            localStorage.setItem('physicsTotalSubmissions', totalSubmissions.toString());
            
            for (let i = 1; i <= 6; i++) {
                const select = document.getElementById(prefix + i);
                if (select) {
                    const correctAnswer = select.getAttribute('data-correct');
                    const selectedAnswer = select.value;
                    
                    select.classList.remove('selected', 'correct', 'incorrect');
                    
                    if (selectedAnswer === correctAnswer) {
                        select.classList.add('correct');
                        correct++;
                    } else if (selectedAnswer !== '') {
                        select.classList.add('incorrect');
                        
                        // Track errors
                        const questionKey = tabName + '_q' + i;
                        if (!errorTracking[roundKey][questionKey]) {
                            // Get context from the question
                            const tooltipElement = select.parentElement.querySelector('.tooltiptext');
                            const contextHint = tooltipElement ? tooltipElement.textContent : '';
                            
                            errorTracking[roundKey][questionKey] = {
                                concept: correctAnswer,
                                attempts: [],
                                context: contextHint
                            };
                        }
                        errorTracking[roundKey][questionKey].attempts.push(selectedAnswer);
                    }
                }
            }
            
            tabScores[roundKey][tabName] = {
                score: correct,
                total: total,
                percentage: Math.round((correct/total)*100)
            };
            
            // Update tab visual indicator
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                if (tab.textContent.includes(getTabLabel(tabName))) {
                    tab.classList.add('completed-r' + currentRound);
                }
            });
            
            localStorage.setItem('physicsTabScores', JSON.stringify(tabScores));
            localStorage.setItem('physicsErrorTracking', JSON.stringify(errorTracking));
            
            document.getElementById(tabName + 'SubmitBtn').disabled = true;
            
            checkRoundCompletion();
            updateStatsDisplay();
        }
        
        function showReview() {
            document.getElementById('reviewContainer').classList.add('active');
            filterReview('current');
        }
        
        function filterReview(filter) {
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => btn.classList.remove('active'));
            
            // Find and activate the clicked button
            filterBtns.forEach(btn => {
                const btnText = btn.textContent.toLowerCase();
                if ((filter === 'current' && btn.textContent.includes('Current')) ||
                    (filter === 'total' && btn.textContent.includes('Total')) ||
                    (filter === 'round1' && btnText.includes('round 1')) ||
                    (filter === 'round2' && btnText.includes('round 2')) ||
                    (filter === 'round3' && btnText.includes('round 3'))) {
                    btn.classList.add('active');
                }
            });
            
            let content = '<div>';
            
            if (filter === 'current') {
                content += generateReviewContent('round' + currentRound);
            } else if (filter === 'total') {
                content += generateTotalReview();
            } else {
                content += generateReviewContent(filter);
            }
            
            content += '</div>';
            document.getElementById('reviewContent').innerHTML = content;
        }
        
        function generateReviewContent(roundKey) {
            if (!errorTracking[roundKey] || Object.keys(errorTracking[roundKey]).length === 0) {
                return '<p><strong>Perfect score!</strong> No errors in this round - excellent understanding of all concepts!</p>';
            }
            
            let content = '<h3>Areas for Improvement</h3>';
            
            Object.keys(errorTracking[roundKey]).forEach(questionKey => {
                const error = errorTracking[roundKey][questionKey];
                const explanation = getConceptExplanation(error.concept, error.context);
                content += `
                    <div class="weakness-item">
                        <div class="weakness-title">Incorrect: ${error.concept}</div>
                        <div class="weakness-details">
                            <strong>You selected:</strong> ${error.attempts.join(', ')}<br>
                            <strong>Explanation:</strong> ${explanation}<br>
                            <em>Context: ${error.context || 'General concept'}</em>
                        </div>
                    </div>
                `;
            });
            
            return content;
        }
        
        function getConceptExplanation(concept, context) {
            const explanations = {
                // de Broglie concepts
                "electrons": "Electrons were the first particles experimentally shown to exhibit wave-like diffraction patterns (Davisson-Germer experiment, 1927). This confirmed de Broglie's hypothesis about matter waves.",
                "de Broglie wavelength": "The de Broglie wavelength (λ = h/p) is the wavelength associated with any moving particle, named after Louis de Broglie who proposed that all matter has wave properties.",
                "crystal lattice": "A crystal lattice provides regularly spaced atoms that act as a diffraction grating for electron waves. The spacing between atoms is similar to electron wavelengths, enabling diffraction.",
                "interference pattern": "When waves pass through multiple openings, they create an interference pattern of alternating bright and dark regions due to constructive and destructive interference.",
                "wave-particle duality": "Wave-particle duality is the fundamental principle that all quantum objects exhibit both wave-like and particle-like properties, depending on how they're observed.",
                "particles": "In quantum mechanics, 'particles' refers to discrete, localized entities that can be counted individually, contrasting with continuous wave behavior.",
                
                // Photon concepts
                "mass": "Photons are unique as massless particles that still carry momentum (p = E/c). Their momentum comes from their energy, not mass.",
                "momentum": "Despite having no mass, photons carry momentum (p = E/c = h/λ) which can exert radiation pressure and transfer momentum in collisions.",
                "pc": "For photons, E = pc relates energy to momentum (where c is light speed). This differs from massive particles where E = mc² + kinetic energy.",
                "speed of light": "The speed of light (c = 3.0 × 10⁸ m/s) is the universal speed limit and the speed at which all electromagnetic radiation travels in vacuum.",
                "Planck's constant": "Planck's constant (h = 6.63 × 10⁻³⁴ J·s) is the fundamental constant that relates a photon's energy to its frequency (E = hf) and wavelength to momentum (λ = h/p).",
                "h/p": "The de Broglie equation λ = h/p applies to both matter and photons, showing that wavelength is inversely proportional to momentum for all quantum objects.",
                
                // Diffraction concepts
                "identically spaced": "When matter and photons have the same wavelength and pass through identical gaps, they produce identically spaced diffraction patterns, demonstrating their wave similarity.",
                "λ/w": "The ratio λ/w (wavelength/gap width) determines diffraction severity. When λ/w ≥ 1, significant diffraction occurs, limiting resolution in microscopy.",
                "≥ 1": "Significant diffraction occurs when λ/w ≥ 1, meaning the wavelength is similar to or larger than the gap size, causing severe spreading of waves.",
                "smaller": "Electrons have much smaller de Broglie wavelengths than visible light at practical energies, enabling much higher resolution in electron microscopes.",
                "damage": "While X-rays have short wavelengths, their high energy can damage biological samples through ionization. Electrons cause less damage at similar resolutions.",
                "viruses": "Electron microscopes are ideal for imaging viruses (20-300 nm) because electron wavelengths can be made much smaller than viral dimensions.",
                "diffraction": "Diffraction is the spreading of waves when passing through openings or around obstacles, fundamentally limiting the resolution of all wave-based imaging.",
                "wavelength": "The wavelength of the probing radiation fundamentally limits imaging resolution - you cannot clearly resolve objects smaller than about half the wavelength used.",
                "10⁻¹²": "Modern electron microscopes can achieve picometer (10⁻¹² m) wavelengths with high-energy electrons, enabling atomic-scale resolution.",
                "radiation damage": "X-ray microscopy causes radiation damage through ionization, breaking chemical bonds in biological samples. This limits its use for living specimens.",
                "significant": "When λ/w ratio approaches or exceeds 1, diffraction effects become significant enough to severely blur images and limit resolution.",
                "atoms": "The ultimate achievement of electron microscopy is resolving individual atoms, possible because electron wavelengths can be made smaller than atomic dimensions.",
                
                // Double slit concepts
                "one at a time": "Sending particles one at a time through double slits proves that interference isn't between different particles - each particle interferes with itself.",
                "spot": "Each individual photon or electron creates a single spot on the detector, demonstrating particle-like detection despite wave-like propagation.",
                "particle": "The discrete detection of individual impacts shows the particle nature of photons and electrons, even as they display wave interference.",
                "itself": "The most profound result: each particle must somehow pass through both slits and interfere with itself to create the pattern, defying classical logic.",
                "individual": "Modern experiments fire individual particles to ensure no inter-particle interference, yet the wave pattern still emerges from accumulated single impacts.",
                "discrete": "Each particle registers as a discrete, localized impact rather than a spread-out wave, showing the measurement collapses the wave function.",
                "interference": "The accumulated pattern shows interference fringes characteristic of waves, proving the wave nature despite particle-by-particle detection.",
                "individually": "Particles traveling individually (not in groups) still create interference patterns, proving each particle has wave properties.",
                "quantum mechanics": "This paradox epitomizes quantum mechanics - the need for a new physics framework to understand wave-particle complementarity.",
                "superposition": "Quantum superposition allows particles to exist in multiple states simultaneously until measured, explaining how one particle can interfere with itself.",
                "randomly": "Individual impacts appear randomly distributed, yet their statistical accumulation forms a predictable interference pattern.",
                "probabilistic": "Quantum mechanics is inherently probabilistic - we can predict the pattern statistically but not individual particle positions.",
                "complementarity": "Bohr's complementarity principle states that wave and particle descriptions are complementary aspects of the same quantum reality.",
                
                // Additional concepts for Rounds 2 and 3
                "h/p": "The de Broglie relation λ = h/p shows wavelength is inversely proportional to momentum - faster particles have shorter wavelengths.",
                "inversely proportional": "In λ = h/p, wavelength and momentum are inversely proportional - doubling momentum halves the wavelength.",
                "short": "High-energy particles have short wavelengths due to their large momentum, enabling high-resolution imaging applications.",
                "6.63 × 10⁻³⁴": "Planck's constant (6.63 × 10⁻³⁴ J·s) is tiny, explaining why quantum effects only become noticeable at atomic scales.",
                "quantum": "Quantum effects dominate when the de Broglie wavelength becomes comparable to the system size, typically at atomic scales.",
                "3.0 × 10⁸": "The speed of light (3.0 × 10⁸ m/s) appears in photon momentum (p = E/c) since photons always travel at this speed.",
                "E = pc": "For massless photons, all energy is kinetic: E = pc. This differs from massive particles where E includes rest mass energy.",
                "1": "When λ/w = 1, the wavelength equals the gap width, marking the threshold for severe diffraction effects.",
                "400-700 nm": "Visible light spans 400-700 nm, limiting optical microscopes to resolving structures larger than about 200 nm (half the wavelength).",
                "nanometer": "Electron microscopes achieve nanometer (10⁻⁹ m) or better resolution, far surpassing optical microscopes limited by light wavelengths.",
                "ionize": "X-rays ionize atoms by ejecting electrons, breaking molecular bonds and damaging biological specimens during imaging.",
                "proteins": "Electron microscopy can image proteins and other biological macromolecules without the severe radiation damage caused by X-rays.",
                "wave nature": "The wave nature of electrons enables diffraction-based imaging, with resolution determined by the de Broglie wavelength.",
                "extremely small": "Macroscopic objects have extremely small de Broglie wavelengths (due to large mass/momentum), making wave properties unobservable.",
                "unobservable": "Wave properties become unobservable when wavelengths are vastly smaller than any measurable dimension or experimental apparatus.",
                "λ = h/p": "The universal de Broglie relation λ = h/p applies to all matter and radiation, unifying the wave description of particles and photons.",
                "energy": "Photon momentum derives from energy (p = E/c) rather than mass, showing energy itself carries momentum.",
                "collisions": "Photon-matter collisions demonstrate momentum transfer through radiation pressure, proving photons carry real momentum despite zero mass.",
                "wavelengths": "When particles have equal wavelengths (λ = h/p), they produce identical diffraction patterns regardless of their mass or nature.",
                "h": "Planck's constant (h) is the fundamental quantum of action, appearing in all quantum equations and setting the scale of quantum effects."
            };
            
            return explanations[concept] || `The correct answer is '${concept}'. This concept is fundamental to understanding wave-particle duality and quantum behavior.`;
        }
        
        function generateTotalReview() {
            let content = '<h3>Overall Performance Analysis</h3>';
            let conceptErrors = {};
            
            // Collect all errors by concept
            Object.keys(errorTracking).forEach(roundKey => {
                Object.keys(errorTracking[roundKey]).forEach(questionKey => {
                    const error = errorTracking[roundKey][questionKey];
                    if (!conceptErrors[error.concept]) {
                        conceptErrors[error.concept] = {
                            count: 0,
                            rounds: [],
                            context: error.context
                        };
                    }
                    conceptErrors[error.concept].count++;
                    const roundNum = roundKey.replace('round', '');
                    if (!conceptErrors[error.concept].rounds.includes(roundNum)) {
                        conceptErrors[error.concept].rounds.push(roundNum);
                    }
                });
            });
            
            // Sort by error count (most errors first)
            const sortedConcepts = Object.keys(conceptErrors).sort((a, b) => 
                conceptErrors[b].count - conceptErrors[a].count
            );
            
            sortedConcepts.forEach(concept => {
                const errorData = conceptErrors[concept];
                const explanation = getConceptExplanation(concept, errorData.context);
                
                content += `
                    <div class="weakness-item">
                        <div class="weakness-title">
                            ${concept}
                            <span class="improvement-trend trend-stable">
                                ${errorData.count} error${errorData.count > 1 ? 's' : ''} in round${errorData.rounds.length > 1 ? 's' : ''} ${errorData.rounds.join(', ')}
                            </span>
                        </div>
                        <div class="weakness-details">
                            <strong>Key Learning Point:</strong> ${explanation}
                        </div>
                    </div>
                `;
            });
            
            if (Object.keys(conceptErrors).length === 0) {
                content += '<p><strong>Excellent work!</strong> No errors to review. You\'ve mastered all concepts!</p>';
            }
            
            return content;
        }
        
        function continueToNextRound() {
            if (currentRound < 3) {
                currentRound++;
                localStorage.setItem('physicsCurrentRound', currentRound);
                
                // Reset tabs for new round
                const tabs = ['debroglie', 'photons', 'diffraction', 'doubleslit'];
                tabs.forEach(tab => {
                    resetTabQuietly(tab);
                });
                
                // Reinitialize with new content
                initializeRound();
                addChangeListeners();
                addTooltipListeners();
                
                // Hide review and show main content
                document.getElementById('reviewContainer').classList.remove('active');
                document.getElementById('reviewButtonContainer').style.display = 'none';
                
                // Show round indicator when entering Round 2 for the first time
                if (currentRound === 2) {
                    document.getElementById('roundIndicator').classList.add('visible');
                }
                document.getElementById('currentRound').textContent = currentRound;
            } else {
                alert('Congratulations! You have completed all three rounds of review!');
            }
        }
        
        function resetTab(tabName) {
            pendingReset = { type: 'tab', target: tabName };
            showResetModal('Reset Current Tab', `Are you sure you want to reset the ${getTabLabel(tabName)} section? Your answers will be cleared but your score will remain.`);
        }
        
        function resetRound() {
            pendingReset = { type: 'round', target: currentRound };
            showResetModal('Reset Current Round', 'Are you sure you want to reset Round ' + currentRound + '? All progress for this round will be lost.');
        }
        
        function resetAll() {
            pendingReset = { type: 'all' };
            showResetModal('Reset Everything', 'Are you sure you want to reset everything? All progress across all rounds will be permanently deleted.');
        }
        
        function showResetModal(title, message) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('confirmModal').style.display = 'block';
        }
        
        function confirmReset() {
            if (!pendingReset) return;
            
            if (pendingReset.type === 'tab') {
                // Just clear the fields, don't remove the score
                resetTabQuietly(pendingReset.target);
                updateStatsDisplay();
            } else if (pendingReset.type === 'round') {
                resetRoundData(pendingReset.target);
            } else if (pendingReset.type === 'all') {
                resetAllData();
            }
            
            closeModal();
        }
        
        function resetTabQuietly(tabName) {
            let prefix = '';
            switch(tabName) {
                case 'debroglie': prefix = 'd'; break;
                case 'photons': prefix = 'p'; break;
                case 'diffraction': prefix = 'f'; break;
                case 'doubleslit': prefix = 's'; break;
            }
            
            for (let i = 1; i <= 6; i++) {
                const select = document.getElementById(prefix + i);
                if (select) {
                    select.value = '';
                    select.classList.remove('selected', 'correct', 'incorrect');
                    
                    // Hide any tooltips
                    const tooltip = select.parentElement.querySelector('.tooltiptext');
                    if (tooltip) {
                        tooltip.classList.remove('show-delayed');
                    }
                }
            }
            
            // Re-enable submit button
            const submitBtn = document.getElementById(tabName + 'SubmitBtn');
            if (submitBtn) {
                submitBtn.disabled = false;
            }
            
            checkCompletion();
        }
        
        function resetRoundData(round) {
            const roundKey = 'round' + round;
            delete tabScores[roundKey];
            delete errorTracking[roundKey];
            
            localStorage.setItem('physicsTabScores', JSON.stringify(tabScores));
            localStorage.setItem('physicsErrorTracking', JSON.stringify(errorTracking));
            
            // Reset all tabs for this round
            const tabs = ['debroglie', 'photons', 'diffraction', 'doubleslit'];
            tabs.forEach(tab => {
                resetTabQuietly(tab);
                
                // Remove completion indicators
                const tabElements = document.querySelectorAll('.tab');
                tabElements.forEach(tabEl => {
                    if (tabEl.textContent.includes(getTabLabel(tab))) {
                        tabEl.classList.remove('completed-r' + round);
                    }
                });
            });
            
            document.getElementById('reviewContainer').classList.remove('active');
            document.getElementById('reviewButtonContainer').style.display = 'none';
            
            // Update stats display
            updateStatsDisplay();
            
            // If no scores remain, hide stats
            if (Object.keys(tabScores).length === 0) {
                document.getElementById('stats').style.display = 'none';
            }
        }
        
        function resetAllData() {
            // Clear all localStorage items
            localStorage.removeItem('physicsTabScores');
            localStorage.removeItem('physicsErrorTracking');
            localStorage.removeItem('physicsCurrentRound');
            localStorage.removeItem('physicsCurrentSelections');
            localStorage.removeItem('physicsTotalSubmissions');
            localStorage.removeItem('physicsStudentName');
            localStorage.removeItem('physicsFirstAttemptDate');
            
            // Force clear with a small delay to ensure it's removed before reload
            localStorage.clear();
            
            currentRound = 1;
            tabScores = {};
            errorTracking = {};
            
            // Reset to round 1
            initializeRound();
            
            // Reset all visual elements
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('completed-r1', 'completed-r2', 'completed-r3');
            });
            
            document.getElementById('roundIndicator').classList.remove('visible');
            document.getElementById('reviewContainer').classList.remove('active');
            document.getElementById('reviewButtonContainer').style.display = 'none';
            document.getElementById('stats').style.display = 'none';
            
            // Clear input fields
            document.getElementById('studentName').value = '';
            document.getElementById('firstAttempt').value = '';
            
            // Ensure total submissions is visually reset before reload
            document.getElementById('totalSubmissions').textContent = '0';
            
            // Delay reload slightly to ensure localStorage operations complete
            setTimeout(() => {
                location.reload();
            }, 100);
        }
        
        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
            pendingReset = null;
        }
        
        function getTabLabel(tabName) {
            switch(tabName) {
                case 'debroglie': return 'de Broglie Wavelength';
                case 'photons': return 'Photon Momentum';
                case 'diffraction': return 'Diffraction & Microscopy';
                case 'doubleslit': return 'Double Slit Experiment';
                default: return '';
            }
        }
        
        function saveCurrentProgress() {
            let currentSelections = JSON.parse(localStorage.getItem('physicsCurrentSelections') || '{}');
            
            const selects = document.querySelectorAll('select');
            selects.forEach(select => {
                if (select.id && select.value !== '') {
                    currentSelections[select.id] = select.value;
                } else if (select.id && select.value === '') {
                    delete currentSelections[select.id];
                }
            });
            
            localStorage.setItem('physicsCurrentSelections', JSON.stringify(currentSelections));
        }
        
        function loadSavedData() {
            const savedName = localStorage.getItem('physicsStudentName');
            const firstAttemptDate = localStorage.getItem('physicsFirstAttemptDate');
            const savedRound = localStorage.getItem('physicsCurrentRound');
            
            if (savedRound) {
                currentRound = parseInt(savedRound);
            }
            
            const savedScores = localStorage.getItem('physicsTabScores');
            if (savedScores) {
                tabScores = JSON.parse(savedScores);
                
                // Update visual indicators for completed tabs
                Object.keys(tabScores).forEach(roundKey => {
                    const roundNum = parseInt(roundKey.replace('round', ''));
                    Object.keys(tabScores[roundKey]).forEach(tabName => {
                        if (tabScores[roundKey][tabName]) {
                            const tabs = document.querySelectorAll('.tab');
                            tabs.forEach(tab => {
                                if (tab.textContent.includes(getTabLabel(tabName))) {
                                    tab.classList.add('completed-r' + roundNum);
                                }
                            });
                        }
                    });
                });
                
                // Only show round indicator if Round 1 is complete or we're past Round 1
                if (currentRound > 1 || (tabScores['round1'] && Object.keys(tabScores['round1']).length === 4)) {
                    document.getElementById('roundIndicator').classList.add('visible');
                    document.getElementById('currentRound').textContent = currentRound;
                }
                
                updateStatsDisplay();
            }
            
            const savedErrors = localStorage.getItem('physicsErrorTracking');
            if (savedErrors) {
                errorTracking = JSON.parse(savedErrors);
            }
            
            if (savedName) {
                document.getElementById('studentName').value = savedName;
            }
            
            if (firstAttemptDate) {
                document.getElementById('firstAttempt').value = firstAttemptDate;
            }
        }
        
        function updateStatsDisplay() {
            let totalCorrect = 0;
            let totalQuestions = 0;
            let hasAnyScore = false;
            let roundStatsHTML = '';
            let completedRounds = 0;
            
            // Calculate scores for each round
            for (let r = 1; r <= 3; r++) {
                const roundKey = 'round' + r;
                let roundCorrect = 0;
                let roundTotal = 0;
                let roundTabsCompleted = 0;
                
                if (tabScores[roundKey]) {
                    ['debroglie', 'photons', 'diffraction', 'doubleslit'].forEach(tab => {
                        if (tabScores[roundKey][tab]) {
                            hasAnyScore = true;
                            const tabData = tabScores[roundKey][tab];
                            roundCorrect += tabData.score || 0;
                            roundTotal += tabData.total || 0;
                            totalCorrect += tabData.score || 0;
                            totalQuestions += tabData.total || 0;
                            roundTabsCompleted++;
                        }
                    });
                }
                
                if (roundTabsCompleted === 4) {
                    completedRounds++;
                }
                
                if (roundTotal > 0) {
                    const roundPercent = Math.round((roundCorrect / roundTotal) * 100);
                    roundStatsHTML += `
                        <div class="stat-item" style="margin: 5px; display: inline-block;">
                            <div class="stat-value">${roundCorrect}/${roundTotal}</div>
                            <div class="stat-label">Round ${r} (${roundPercent}%)</div>
                        </div>
                    `;
                }
            }
            
            if (hasAnyScore) {
                // Update round stats
                if (roundStatsHTML) {
                    document.getElementById('roundStats').innerHTML = roundStatsHTML;
                }
                
                // Update overall score display (cumulative)
                document.getElementById('overallScore').textContent = totalCorrect + '/' + totalQuestions;
                
                // Calculate overall average percentage
                const overallPercentage = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
                document.getElementById('overallPercent').textContent = overallPercentage + '%';
                
                // Add visual feedback for perfect scores
                if (overallPercentage === 100 && totalQuestions > 0) {
                    document.getElementById('overallPercent').style.color = '#48bb78';
                    document.getElementById('overallScore').style.color = '#48bb78';
                } else {
                    document.getElementById('overallPercent').style.color = '#5a67d8';
                    document.getElementById('overallScore').style.color = '#5a67d8';
                }
                
                // Get total submissions
                let totalSubmissions = parseInt(localStorage.getItem('physicsTotalSubmissions') || '0');
                document.getElementById('totalSubmissions').textContent = totalSubmissions;
                
                // Update completed rounds
                document.getElementById('completedRounds').textContent = completedRounds + '/3';
                
                document.getElementById('stats').style.display = 'block';
            } else {
                // No scores yet, hide stats
                document.getElementById('stats').style.display = 'none';
            }
        }
    </script>
</body>
</html>