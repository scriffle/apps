<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Rating Applet</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
        }
        canvas {
            border: 2px solid #000;
            background-color: #fff;
        }
        #controls {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <canvas id="ratingCanvas" width="600" height="400"></canvas>
    <div id="controls">
        <label for="decayTime">Decay Time (seconds): </label>
        <input type="range" id="decayTime" min="5" max="30" value="5">
        <span id="decayTimeValue">5</span>
    </div>

    <script>
        const canvas = document.getElementById('ratingCanvas');
        const ctx = canvas.getContext('2d');
        const decayTimeSlider = document.getElementById('decayTime');
        const decayTimeValue = document.getElementById('decayTimeValue');

        const maxPresses = 100;
        let decayTime = decayTimeSlider.value;
        const keyPresses = Array(10).fill(0);
        const lastPressTime = Array(10).fill(0);

        decayTimeSlider.addEventListener('input', () => {
            decayTimeValue.textContent = decayTimeSlider.value;
            decayTime = decayTimeSlider.value;
        });

        document.addEventListener('keydown', (event) => {
            const key = event.key;
            if (key >= '0' && key <= '9') {
                const index = parseInt(key, 10);
                keyPresses[index] += 1;
                lastPressTime[index] = performance.now();
            }
        });

        function getColor(index) {
            const gradientStart = [255, 105, 97]; // Red
            const gradientMiddle = [255, 255, 126]; // Yellow
            const gradientEnd = [34, 139, 34]; // Green

            let r, g, b;
            if (index <= 4) {
                const ratio = index / 4;
                r = gradientStart[0] + ratio * (gradientMiddle[0] - gradientStart[0]);
                g = gradientStart[1] + ratio * (gradientMiddle[1] - gradientStart[1]);
                b = gradientStart[2] + ratio * (gradientMiddle[2] - gradientStart[2]);
            } else {
                const ratio = (index - 5) / 4;
                r = gradientMiddle[0] + ratio * (gradientEnd[0] - gradientMiddle[0]);
                g = gradientMiddle[1] + ratio * (gradientEnd[1] - gradientMiddle[1]);
                b = gradientMiddle[2] + ratio * (gradientEnd[2] - gradientMiddle[2]);
            }
            return `rgb(${r}, ${g}, ${b})`;
        }

        function drawGraph() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const barWidth = canvas.width / keyPresses.length;
            const maxBarHeight = canvas.height * 2; // 200% of the canvas height

            const currentTime = performance.now();
            for (let i = 0; i < keyPresses.length; i++) {
                const elapsed = (currentTime - lastPressTime[i]) / 1000;
                const decayFactor = Math.max(1 - (elapsed / decayTime), 0);
                const effectivePresses = keyPresses[i] * decayFactor;
                const barHeight = (Math.log1p(effectivePresses) / Math.log1p(maxPresses)) * maxBarHeight;
                const x = i * barWidth;
                const y = canvas.height - barHeight;

                ctx.fillStyle = getColor(i);
                ctx.fillRect(x, y, barWidth - 2, barHeight);

                // Update key presses to reflect decay
                if (effectivePresses > 0) {
                    keyPresses[i] = effectivePresses;
                } else {
                    keyPresses[i] = 0;
                }
            }

            requestAnimationFrame(drawGraph);
        }

        drawGraph();
    </script>
</body>
</html>
