<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agency Mapping Survey</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #555;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
            font-size: 20px;
        }
        
        .question {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border-left: 3px solid #007bff;
        }
        
        .question-text {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }
        
        .scale-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .scale-start {
            font-size: 11px;
            color: #888;
            min-width: 60px;
        }
        
        .scale-container {
            display: flex;
            gap: 15px;
            align-items: center;
            background-color: #fff;
            padding: 8px 10px 5px 10px;
            border-radius: 20px;
            border: 1px solid #e0e0e0;
            margin-top: 20px;
            margin-left: 0;
        }
        
        .scale-item {
            display: flex;
            align-items: center;
            position: relative;
        }
        
        .scale-item input[type="radio"] {
            margin: 0;
            cursor: pointer;
            width: 18px;
            height: 18px;
        }
        
        .scale-item label {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: #666;
            cursor: pointer;
            font-weight: bold;
        }
        
        .comment-section {
            flex: 1;
            margin-left: 10px;
        }
        
        textarea {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 30px;
            box-sizing: border-box;
            font-size: 12px;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #545b62;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #007bff;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            margin-bottom: 10px;
            color: #666;
        }
        
        .summary-section {
            margin-bottom: 20px;
        }
        
        .summary-item {
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        
        .summary-category {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .summary-responses {
            font-size: 14px;
            color: #666;
        }
        
        .category-average {
            float: right;
            font-weight: bold;
            color: #007bff;
        }
        
        .hidden {
            display: none;
        }
        
        .intro {
            text-align: center;
            padding: 40px 20px;
        }
        
        .intro p {
            font-size: 18px;
            line-height: 1.6;
            color: #555;
            margin-bottom: 20px;
        }
        
        .scale-explanation {
            background-color: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .scale-explanation h3 {
            margin-top: 0;
            color: #0066cc;
        }
        
        .scale-explanation ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .scale-explanation li {
            padding: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Agency Mapping Survey</h1>
        
        <div class="progress-text" id="progressText">Welcome</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
        </div>
        
        <div id="introPage" class="page">
            <div class="intro">
                <h2>Welcome to the Agency Mapping Survey</h2>
                <p>This survey explores your sense of choice and control across different aspects of life and consciousness.</p>
                <p>You'll be asked to rate various experiences on a scale from 0 to 4:</p>
                
                <div class="scale-explanation">
                    <h3>Rating Scale:</h3>
                    <ul>
                        <li><strong>0 - No Agency:</strong> No choice or control whatsoever</li>
                        <li><strong>1 - Minimal Agency:</strong> Very little choice or control</li>
                        <li><strong>2 - Moderate Agency:</strong> Some choice or control</li>
                        <li><strong>3 - Substantial Agency:</strong> Significant choice or control</li>
                        <li><strong>4 - Complete Autonomy:</strong> Full choice and control</li>
                    </ul>
                </div>
                
                <p>The survey contains <span id="totalQuestions">105</span> questions across 21 categories, exploring everything from biological givens to conscious decisions.</p>
                <p>Your responses are saved automatically and stored locally on your device.</p>
            </div>
        </div>
        
        <div id="surveyPages" class="hidden"></div>
        
        <div id="summaryPage" class="page hidden">
            <h2>Survey Summary</h2>
            <p>Please review your responses before submitting:</p>
            <div id="summaryContent"></div>
        </div>
        
        <div class="navigation">
            <button id="prevBtn" class="btn-secondary" onclick="navigate(-1)">Previous</button>
            <button id="nextBtn" class="btn-primary" onclick="navigate(1)">Start Survey</button>
        </div>
    </div>

    <script>
        const categories = [
            {
                name: "Birth and Biology",
                questions: [
                    "How much choice did you have in being born?",
                    "How much choice did you have in choosing your parents?",
                    "How much choice did you have in where you were born?",
                    "How much choice did you have in your biological sex?",
                    "How much choice did you have in your biological traits (e.g., height, eye color)?",
                    "How much choice did you have in your genetic makeup?",
                    "How much choice did you have in your birth circumstances (time, place, family)?",
                    "How much choice did you have in your natural eye color?"
                ]
            },
            {
                name: "Early Life Experiences",
                questions: [
                    "How much choice did you have in the school you attended?",
                    "How much choice did you have in your early friendships?",
                    "How much choice did you have in your friends growing up?",
                    "How much choice did you have in what food you enjoyed as a child?"
                ]
            },
            {
                name: "Adolescent Experiences",
                questions: [
                    "How much choice did you have in what to wear on your first day of high school?",
                    "How much choice did you have in what music you listened to as a teenager?",
                    "How much choice did you have in who to hang out with in high school?",
                    "How much choice did you have in your taste in music?"
                ]
            },
            {
                name: "Young Adult Transitions",
                questions: [
                    "How much choice did you have in when to learn how to drive?",
                    "How much choice did you have in when to get your first part-time job?",
                    "How much choice did you have in the career path you initially took?"
                ]
            },
            {
                name: "Current Life Circumstances",
                questions: [
                    "How much choice do you have in what job you do?",
                    "How much choice do you have in where you live now?",
                    "How much choice do you have in living in your current city?",
                    "How much choice do you have in the car you drive?",
                    "How much choice do you have in the type of car you drive?"
                ]
            },
            {
                name: "Personal Relationships",
                questions: [
                    "How much choice do you have in who you fell in love with?",
                    "How much choice did you have in your romantic partner?"
                ]
            },
            {
                name: "Values and Identity",
                questions: [
                    "How much choice do you have in your hobbies and interests?",
                    "How much choice do you have in the hobbies or activities you enjoy today?",
                    "How much choice did you have in your personal values and beliefs?",
                    "How much choice do you have in your creative pursuits?"
                ]
            },
            {
                name: "Daily Behaviors",
                questions: [
                    "How much choice do you have in wearing what you're wearing today?",
                    "How much choice do you have in your daily activities?",
                    "How much choice do you have in which side you sleep on?"
                ]
            },
            {
                name: "Bodily Functions",
                questions: [
                    "How much choice do you have in how you react to stressful situations?",
                    "How much choice did you have the last time you got hungry?",
                    "How much choice did you have to yawn the last time you were tired?",
                    "How much choice do you have over your heartbeat right now?",
                    "How much choice do you have over your digestion?",
                    "How much choice do you have over your body temperature regulation?",
                    "How much choice do you have over your cellular regeneration?",
                    "How much choice do you have over when you feel thirsty?"
                ]
            },
            {
                name: "Present Moment Actions",
                questions: [
                    "How much choice did you have to use this webapp?",
                    "How much choice do you have to continue or stop using this app?",
                    "How much choice do you have to raise your finger in the next 15 seconds?",
                    "How much choice do you have over your next thought?"
                ]
            },
            {
                name: "Infant Reflexes and Early Development",
                questions: [
                    "How much choice did you have in your infant reflexes (sucking, grasping)?",
                    "How much choice did you have in taking your first breath?",
                    "How much choice did you have in your first cry?",
                    "How much choice did you have in forming early attachments?",
                    "How much choice did you have in when you first smiled?",
                    "How much choice did you have in your fetal position in the womb?",
                    "How much choice did you have when to take your first breath?",
                    "How much choice did you have in your attachment style as an infant?"
                ]
            },
            {
                name: "Early Childhood Development",
                questions: [
                    "How much choice did you have in when you learned to walk?",
                    "How much choice did you have in your first words?",
                    "How much choice did you have in your childhood fears?",
                    "How much choice did you have in what foods you liked as a toddler?",
                    "How much choice did you have in your early personality traits?"
                ]
            },
            {
                name: "Sleep and Dream States",
                questions: [
                    "How much choice do you have over your dreams?",
                    "How much choice do sleepwalkers have during sleepwalking episodes?",
                    "How much choice do you have during sleep paralysis?",
                    "How much choice do you have over talking in your sleep?",
                    "How much choice do you have over your sleeping position throughout the night?",
                    "How much choice do you have over your dreams last night?",
                    "How much choice do you have in what position you slept in last night?",
                    "How much choice did you have when you last fell asleep?"
                ]
            },
            {
                name: "Altered Consciousness Experiences",
                questions: [
                    "If you've been under anesthesia, how much choice did you have during that experience?",
                    "Have you ever been hypnotized and how much choice did you feel over actions during it?",
                    "If you've consumed alcohol, how much choice did you have over all your intoxicated behaviors?",
                    "Have you experienced meditation states where you lost control?",
                    "If you've used drugs, how much choice did you have during those experiences?",
                    "If you've been extremely intoxicated, how much choice did you have in all your behaviors?",
                    "If you've experienced sleep deprivation hallucinations, how much choice did you have in seeing them?",
                    "How much choice do people have during a psychotic episode?",
                    "If you've experienced severe dissociation, how much choice did you have during it?",
                    "How much choice do you have if experiencing drug-induced unconsciousness?"
                ]
            },
            {
                name: "Physical Reflexes",
                questions: [
                    "How much choice do you have when you last blinked?",
                    "How much choice do you have in your fight-or-flight response?",
                    "How much choice do you have in your startle reflex?",
                    "How much choice do you have when you blush?",
                    "How much choice do you have in pupil dilation?",
                    "How much choice do you have in getting goosebumps?"
                ]
            },
            {
                name: "Emotional and Psychological Responses",
                questions: [
                    "How much choice do you have in your sexual orientation?",
                    "How much choice do you have in your deepest fears?",
                    "How much choice do you have when you last felt anxious?",
                    "How much choice do you have in your emotional reaction to your last conflict?",
                    "How much choice do you have in feeling grief when losing someone?",
                    "How much choice do you have in what makes you laugh spontaneously?",
                    "How much choice do you have in feeling anxiety?",
                    "How much choice do you have in your immediate anger response?"
                ]
            },
            {
                name: "Habits and Repetitive Behaviors",
                questions: [
                    "How much choice do you have every time you check your phone?",
                    "If applicable, how much choice do you have in your addictive behaviors?",
                    "How much choice do you have in your nervous habits (nail-biting, fidgeting)?",
                    "How much choice did you have in your accent or speech patterns?",
                    "How much choice do you have in every thought that enters your mind?",
                    "How much choice do people with severe addictions have in their cravings?",
                    "How much choice do people with OCD have in their compulsions?",
                    "How much choice do people with Tourette's have in their tics?",
                    "How much choice do you have in intrusive thoughts?"
                ]
            },
            {
                name: "Social Situations",
                questions: [
                    "How much choice did you have in your political beliefs entirely on your own?",
                    "How much choice did you have in your cultural values?",
                    "How much choice do you have when going along with a group against your judgment?",
                    "How much choice did you have in all your learned biases?",
                    "How much choice do you have in how peer pressure affects you?",
                    "How much choice do you have in yawning when others yawn?",
                    "How much choice do you have in your response to hypnotic suggestions?",
                    "How much choice do you have when following crowd behavior in emergencies?",
                    "How much choice do you have in absorbing the mood of a room?"
                ]
            },
            {
                name: "Response to Suggestions",
                questions: [
                    "When someone yawns near you, how much choice do you have not to yawn in response?",
                    "If a hypnotist suggests your arm will feel heavy, how much choice do you have to keep it feeling normal?",
                    "When reading 'don't think of a pink elephant,' how much choice do you have not to think of one?",
                    "If someone confidently states false information in a group, how much choice do you have not to doubt your own correct knowledge?",
                    "When a commercial makes you crave a specific food, how much choice did you have in that craving?"
                ]
            },
            {
                name: "Career and Life Paths",
                questions: [
                    "How much choice do you have in your career path?",
                    "How much choice do you have in where you currently live?",
                    "How much choice do you have in your current relationships?",
                    "How much choice do you have in your hobbies?",
                    "How much choice do you have in your life goals?"
                ]
            },
            {
                name: "Memory and Perception",
                questions: [
                    "How much choice do you have to forget a painful memory?",
                    "How much choice do you have not to see an optical illusion?",
                    "How much choice do you have to stop a song stuck in your head?",
                    "How much choice did you have in your learning style?",
                    "How much choice do you have in your next thought?"
                ]
            }
        ];

        let currentPage = 0;
        let responses = {};
        let totalQuestionCount = 0;

        // Count total questions
        function countTotalQuestions() {
            totalQuestionCount = categories.reduce((sum, cat) => sum + cat.questions.length, 0);
            document.getElementById('totalQuestions').textContent = totalQuestionCount;
        }

        // Load saved responses from localStorage
        function loadResponses() {
            const saved = localStorage.getItem('agencySurveyResponses');
            if (saved) {
                responses = JSON.parse(saved);
            }
        }

        // Save responses to localStorage
        function saveResponses() {
            localStorage.setItem('agencySurveyResponses', JSON.stringify(responses));
        }

        // Create survey pages
        function createSurveyPages() {
            const container = document.getElementById('surveyPages');
            let globalQuestionIndex = 0;
            
            categories.forEach((category, catIndex) => {
                const pageDiv = document.createElement('div');
                pageDiv.className = 'page hidden';
                pageDiv.id = `page-${catIndex + 1}`;
                
                const categoryTitle = document.createElement('h2');
                categoryTitle.textContent = category.name;
                pageDiv.appendChild(categoryTitle);
                
                category.questions.forEach((question, qIndex) => {
                    const questionIndex = globalQuestionIndex++;
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question';
                    
                    const questionText = document.createElement('div');
                    questionText.className = 'question-text';
                    questionText.textContent = `${questionIndex + 1}. ${question}`;
                    questionDiv.appendChild(questionText);
                    
                    const scaleWrapper = document.createElement('div');
                    scaleWrapper.className = 'scale-wrapper';
                    
                    const scaleContainer = document.createElement('div');
                    scaleContainer.className = 'scale-container';
                    
                    for (let i = 0; i <= 4; i++) {
                        const scaleItem = document.createElement('div');
                        scaleItem.className = 'scale-item';
                        
                        const radio = document.createElement('input');
                        radio.type = 'radio';
                        radio.name = `q${questionIndex}`;
                        radio.value = i;
                        radio.id = `q${questionIndex}_${i}`;
                        
                        if (responses[`q${questionIndex}`] && responses[`q${questionIndex}`].rating === i) {
                            radio.checked = true;
                        }
                        
                        radio.addEventListener('change', () => {
                            if (!responses[`q${questionIndex}`]) {
                                responses[`q${questionIndex}`] = {};
                            }
                            responses[`q${questionIndex}`].rating = i;
                            saveResponses();
                        });
                        
                        const label = document.createElement('label');
                        label.htmlFor = `q${questionIndex}_${i}`;
                        label.textContent = i;
                        
                        scaleItem.appendChild(radio);
                        scaleItem.appendChild(label);
                        scaleContainer.appendChild(scaleItem);
                    }
                    
                    scaleWrapper.appendChild(scaleContainer);
                    
                    const commentSection = document.createElement('div');
                    commentSection.className = 'comment-section';
                    
                    const textarea = document.createElement('textarea');
                    textarea.placeholder = 'Optional comment...';
                    textarea.value = responses[`q${questionIndex}`]?.comment || '';
                    textarea.addEventListener('input', (e) => {
                        if (!responses[`q${questionIndex}`]) {
                            responses[`q${questionIndex}`] = {};
                        }
                        responses[`q${questionIndex}`].comment = e.target.value;
                        saveResponses();
                    });
                    
                    commentSection.appendChild(textarea);
                    scaleWrapper.appendChild(commentSection);
                    
                    questionDiv.appendChild(scaleWrapper);
                    pageDiv.appendChild(questionDiv);
                });
                
                container.appendChild(pageDiv);
            });
        }

        // Show specific page
        function showPage(pageIndex) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Hide intro and summary pages
            document.getElementById('introPage').classList.add('hidden');
            document.getElementById('summaryPage').classList.add('hidden');
            
            // Show intro page
            if (pageIndex === 0) {
                document.getElementById('introPage').classList.remove('hidden');
                document.getElementById('surveyPages').classList.add('hidden');
                document.getElementById('prevBtn').style.visibility = 'hidden';
                document.getElementById('nextBtn').textContent = 'Start Survey';
                document.getElementById('progressText').textContent = 'Welcome';
            }
            // Show survey pages
            else if (pageIndex >= 1 && pageIndex <= categories.length) {
                document.getElementById('surveyPages').classList.remove('hidden');
                document.getElementById(`page-${pageIndex}`).classList.remove('hidden');
                document.getElementById('prevBtn').style.visibility = 'visible';
                document.getElementById('nextBtn').textContent = 'Next';
                document.getElementById('progressText').textContent = `Category ${pageIndex} of ${categories.length}: ${categories[pageIndex - 1].name}`;
            }
            // Show summary page
            else if (pageIndex === categories.length + 1) {
                showSummary();
                document.getElementById('surveyPages').classList.add('hidden');
                document.getElementById('summaryPage').classList.remove('hidden');
                document.getElementById('prevBtn').style.visibility = 'visible';
                document.getElementById('nextBtn').textContent = 'Submit';
                document.getElementById('nextBtn').className = 'btn-success';
                document.getElementById('progressText').textContent = 'Review Your Responses';
            }
            
            // Update progress bar
            const progress = (pageIndex / (categories.length + 1)) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // Navigate between pages
        function navigate(direction) {
            if (direction === 1 && currentPage === categories.length + 1) {
                // Submit survey
                submitSurvey();
                return;
            }
            
            currentPage += direction;
            
            if (currentPage < 0) currentPage = 0;
            if (currentPage > categories.length + 1) currentPage = categories.length + 1;
            
            showPage(currentPage);
            window.scrollTo(0, 0);
        }

        // Show summary
        function showSummary() {
            const summaryContent = document.getElementById('summaryContent');
            summaryContent.innerHTML = '';
            
            let totalQuestions = totalQuestionCount;
            let answeredQuestions = 0;
            let globalQuestionIndex = 0;
            
            categories.forEach((category, catIndex) => {
                const summarySection = document.createElement('div');
                summarySection.className = 'summary-section';
                
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'summary-item';
                
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'summary-category';
                categoryTitle.textContent = category.name;
                
                let categorySum = 0;
                let categoryCount = 0;
                
                category.questions.forEach((question, qIndex) => {
                    const questionIndex = globalQuestionIndex++;
                    
                    if (responses[`q${questionIndex}`] && responses[`q${questionIndex}`].rating !== undefined) {
                        answeredQuestions++;
                        categorySum += responses[`q${questionIndex}`].rating;
                        categoryCount++;
                    }
                });
                
                const categoryAverage = categoryCount > 0 ? (categorySum / categoryCount).toFixed(2) : 'N/A';
                
                const averageSpan = document.createElement('span');
                averageSpan.className = 'category-average';
                averageSpan.textContent = `Average: ${categoryAverage}`;
                
                categoryTitle.appendChild(averageSpan);
                categoryDiv.appendChild(categoryTitle);
                
                const responsesDiv = document.createElement('div');
                responsesDiv.className = 'summary-responses';
                responsesDiv.textContent = categoryCount > 0 ? 
                    `Answered: ${categoryCount}/${category.questions.length} questions` : 
                    'No questions answered';
                categoryDiv.appendChild(responsesDiv);
                
                summarySection.appendChild(categoryDiv);
                summaryContent.appendChild(summarySection);
            });
            
            // Add overall summary
            const overallSummary = document.createElement('div');
            overallSummary.className = 'summary-item';
            overallSummary.style.marginTop = '20px';
            overallSummary.style.backgroundColor = '#e8f4f8';
            overallSummary.innerHTML = `
                <div class="summary-category">Overall Progress</div>
                <div class="summary-responses">
                    Answered ${answeredQuestions} out of ${totalQuestions} questions 
                    (${Math.round((answeredQuestions/totalQuestions) * 100)}%)
                </div>
            `;
            summaryContent.appendChild(overallSummary);
        }

        // Submit survey
        function submitSurvey() {
            const data = {
                responses: responses,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent
            };
            
            // Save final submission
            localStorage.setItem('agencySurveySubmission', JSON.stringify(data));
            
            // Show completion message
            alert('Thank you for completing the Agency Mapping Survey! Your responses have been saved locally.');
            
            // Optional: Clear responses after submission
            if (confirm('Would you like to clear your responses and start fresh?')) {
                localStorage.removeItem('agencySurveyResponses');
                responses = {};
                currentPage = 0;
                showPage(0);
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            countTotalQuestions();
            loadResponses();
            createSurveyPages();
            showPage(currentPage);
        });
    </script>
</body>
</html>