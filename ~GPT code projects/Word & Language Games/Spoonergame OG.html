<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Talked Fung</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f4f7fa;
        }
        h1 {
            margin: 0 0 10px;
            font-size: 2em;
        }
        .status-bar {
            width: 100%;
            text-align: center;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .panels {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 20px;
        }
        .panel {
            border: 2px dashed #aaa;
            border-radius: 10px;
            width: 45%;
            padding: 15px;
            min-height: 100px;
            background-color: white;
            cursor: pointer;
        }
        .panel strong {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .container {
            display: flex;
            justify-content: space-around;
            width: 100%;
        }
        .word-list {
            border: 2px dashed #aaa;
            border-radius: 10px;
            width: 40%;
            padding: 15px;
            min-height: 150px;
            background-color: white;
            margin-bottom: 20px;
        }
        .word {
            margin: 10px;
            padding: 8px;
            background-color: #cce5ff;
            border-radius: 6px;
            cursor: grab;
            text-align: center;
            font-weight: bold;
        }
        .word.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .highlight {
            background-color: #ffe58f;
        }
        .pair {
            padding: 5px;
            margin: 5px 0;
            background-color: #d4edda;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h1>Talked Fung</h1>
<div class="status-bar" id="statusBar"></div>
<div class="panels">
    <div class="panel" id="foundPairs">
        <strong>Found Spoonerisms:</strong>
    </div>
    <div class="panel" id="selectedPairs">
        <strong>Selected Pairs (Debug):</strong>
    </div>
</div>
<div class="container">
    <div class="word-list" id="listA"></div>
    <div class="word-list" id="listB"></div>
</div>

<script>
// Dataset placeholder; insert full entries here
const fullSpoonerisms = {
"ability,disappointment":"disability,appointment","able,version":"verbal,asian","about,shove":"shout,above","above,shout":"shove,about","accept,it":"except,at","access,suspect":"success,aspect","accompany,clock":"company,o'clock","accompany,count":"company,account","accompany,cross":"company,across","according,reply":"recording,apply","according,reward":"recording,award","account,clock":"count,o'clock","account,company":"count,accompany","account,cross":"count,across","account,distract":"discount,attract","accounting,hunt":"hunting,account","accounting,paint":"painting,account","acre,um":"occur,aim","across,clock":"cross,o'clock","across,company":"cross,accompany","across,count":"cross,account","act,attraction":"attract,action","act,attractive":"attract,active","act,collection":"collect,action","act,collective":"collect,active","act,connection":"connect,action","act,correction":"correct,action","act,detective":"detect,active","act,direction":"direct,action","act,director":"direct,actor","act,effective":"affect,effect,active","act,effectively":"affect,effect,actively","act,election":"elect,action","act,factor":"fact,actor","act,reaction":"react,action","act,respectively":"respect,actively","act,selection":"select,action","action,attractive":"attraction,active","action,cent":"section,aunt","action,collective":"collection,active","action,creativity":"creation,activity","action,director":"direction,actor","action,finger":"fiction,anger","action,motive":"motion,active","action,motor":"motion,actor","action,native":"nation,active","action,objective":"objection,active","action,sector":"section,actor","action,send":"section,and","action,sensor":"section,answer","active,attraction":"attractive,action","active,collection":"collective,action","active,creativity":"creative,activity","active,effectively":"effective,actively","active,motion":"motive,action","active,motor":"motive,actor","active,nation":"native,action","active,objection":"objective,action","active,relatively":"relative,actively","active,sensitivity":"sensitive,activity","actively,effective":"effectively,active","actor,cent":"sector,aunt","actor,collection":"collector,action","actor,collective":"collector,active","actor,creativity":"creator,activity","actor,direction":"director,action","actor,fact":"factor,act","actor,motion":"motor,action","actor,motive":"motor,active","actor,out":"outer,act","actor,section":"sector,action","actor,send":"sector,and","actor,sensor":"sector,answer","actual,usually":"usual,actually","actually,equal":"equally,actual","actually,usual":"usually,actual","ad,aim":"aid,aide,am","ad,band":"bad,and","ad,banker":"bad,anchor","ad,belly":"bed,alley","ad,bend":"bed,and","ad,dancer":"dad,answer","ad,desk":"dead,ask","ad,eight":"aid,aide,at","ad,highly":"hide,alley","ad,lend":"lead,and","ad,mask":"mad,ask","ad,pant":"pad,aunt","ad,really":"rid,alley","ad,rent":"read,red,aunt","ad,revenue":"read,red,avenue","ad,risk":"rid,ask","ad,sand":"sad,and","ad,wind":"wide,and",
"row,wear":"whoa,rare","row,wedding":"whoa,reading","row,west":"whoa,rest","row,whale":"whoa,rail","row,wheel":"whoa,real","row,which":"whoa,rich","row,whip":"whoa,rip","row,white":"whoa,right","row,wide":"whoa,ride","row,wing":"whoa,ring","row,wise":"whoa,rise","row,wound":"whoa,round","rule,scale":"school,rail","rule,scare":"school,rare","rule,scope":"school,rope","rule,skip":"school,rip","rule,tail":"tool,rail","rule,tank":"tool,rank","rule,tap":"tool,wrap","rule,tape":"tool,rape","rule,teach":"tool,reach","rule,tear":"tool,rare","rule,tender":"tool,render","rule,tent":"tool,rent","rule,test":"tool,rest","rule,tide":"tool,ride","rule,tight":"tool,right","rule,tip":"tool,rip","rule,toe":"tool,row","rule,toll":"tool,role","rule,tough":"tool,rough","rule,toward":"tool,reward","rule,tumor":"tool,rumor","rumor,tail":"tumor,rail","rumor,tank":"tumor,rank","rumor,tap":"tumor,wrap","rumor,tape":"tumor,rape","rumor,teach":"tumor,reach","rumor,tear":"tumor,rare","rumor,tender":"tumor,render","rumor,tent":"tumor,rent","rumor,test":"tumor,rest","rumor,tide":"tumor,ride","rumor,tight":"tumor,right","rumor,tip":"tumor,rip","rumor,toe":"tumor,row","rumor,toll":"tumor,role","rumor,tool":"tumor,rule","rumor,tough":"tumor,rough","rumor,toward":"tumor,reward","run,sack":"son,rack","run,sail":"son,rail","run,say":"son,ray","run,seal":"son,real","run,season":"son,reason","run,side":"son,ride","run,silly":"son,really","run,sing":"son,ring","run,size":"son,rise","run,so":"son,row","run,soap":"son,rope","run,sock":"son,rock","run,sole":"son,role","run,song":"son,wrong","run,sound":"son,round","run,suffer":"son,refer","run,suit":"son,root","run,supply":"son,reply","run,supporter":"son,reporter","run,suspect":"son,respect","run,wage":"one,rage","run,wait":"one,rate","run,walk":"one,rock","run,way":"one,ray","run,wear":"one,rare","run,wedding":"one,reading","run,west":"one,rest","run,whale":"one,rail","run,wheel":"one,real","run,which":"one,rich","run,whip":"one,rip","run,white":"one,right","run,whoa":"one,row","run,wide":"one,ride","run,wing":"one,ring","run,wise":"one,rise","run,wound":"one,round","runner,training":"trainer,running","running,stack":"stunning,rack","running,stage":"stunning,rage","running,stair":"stunning,rare","running,state":"stunning,rate","running,steady":"stunning,ready","running,steal":"stunning,real","running,step":"stunning,rep","running,stock":"stunning,rock","running,stuff":"stunning,rough","sack,stake":"stack,sake","sack,stand":"stack,sand","sack,steal":"stack,seal"

};

const negations = [
    'nope', 'no', "that\'s not a pair", 'uh. uh!', 'not this one', 'nah', 'wrong', 'no way', 'not really', 'nopes', 'negative', 'no no no'
];

let selectedPairs = [];
let validWordsA = [], validWordsB = [];
let distractorWordsA = [], distractorWordsB = [];
let foundCount = 0, wrongCount = 0;
let timer = 0, timerInterval;
let draggingWord = null, lastSpoken = '';
let voice = null;

function speakText(text) {
    const utter = new SpeechSynthesisUtterance(text.replace(/,/g, ' '));
    utter.voice = voice;
    window.speechSynthesis.speak(utter);
}

function loadVoice() {
    return new Promise(resolve => {
        const synth = window.speechSynthesis;
        function setVoice() {
            const voices = synth.getVoices();
            voice = voices.find(v => v.lang === 'en-US') || voices[0];
            const preload = new SpeechSynthesisUtterance('Hello');
            preload.voice = voice;
            synth.speak(preload);
            resolve();
        }
        synth.onvoiceschanged = setVoice;
        const vs = synth.getVoices();
        if (vs.length) setVoice();
    });
}

function disableRightPanel(letter) {
    document.querySelectorAll('#listB .word').forEach(div => {
        if (div.textContent.charAt(0).toLowerCase() === letter.toLowerCase()) {
            div.classList.add('disabled');
            div.draggable = false;
        }
    });
}

function enableRightPanel() {
    document.querySelectorAll('#listB .word.disabled').forEach(div => {
        div.classList.remove('disabled');
        div.draggable = true;
    });
}

function disableLeftPanel() {
    document.querySelectorAll('#listA .word').forEach(div => {
        div.classList.add('disabled');
        div.draggable = false;
    });
}

function enableLeftPanel() {
    document.querySelectorAll('#listA .word.disabled').forEach(div => {
        div.classList.remove('disabled');
        div.draggable = true;
    });
}

function pickRandomPairs() {
    selectedPairs = [];
    validWordsA = [];
    validWordsB = [];
    const entries = Object.entries(fullSpoonerisms).sort(() => 0.5 - Math.random());
    const used = new Set();
    for (let [pair, result] of entries) {
        if (selectedPairs.length === 5) break;
        const [a, b] = pair.split(',');
        if (!used.has(a) && !used.has(b)) {
            used.add(a); used.add(b);
            selectedPairs.push([pair, result]);
            validWordsA.push(a);
            validWordsB.push(b);
        }
    }
}

function pickDistractors() {
    const pool = new Set(Object.keys(fullSpoonerisms).flatMap(k => k.split(',')));
    validWordsA.concat(validWordsB).forEach(w => pool.delete(w));
    const arr = Array.from(pool).sort(() => 0.5 - Math.random());
    distractorWordsA = arr.slice(0, 5);
    distractorWordsB = arr.slice(5, 10);
}

function updateStatus() {
    document.getElementById('statusBar').textContent =
        `Time: ${timer}s | Found: ${foundCount}/5 | Mistakes: ${wrongCount}/5`;
}

function populateSelectedPanel() {
    const sel = document.getElementById('selectedPairs');
    selectedPairs.forEach(([p, r]) => {
        const div = document.createElement('div');
        div.className = 'pair';
        div.textContent = `${p} → ${r}`;
        sel.appendChild(div);
    });
}

function createWordElement(word, listId) {
    const div = document.createElement('div');
    div.textContent = word;
    div.className = 'word';
    div.draggable = true;

    div.addEventListener('dragstart', () => {
        draggingWord = word;
        disableLeftPanel();
        disableRightPanel(word.charAt(0));
    });
    div.addEventListener('dragend', () => {
        enableLeftPanel();
        enableRightPanel();
        draggingWord = null;
    });

    div.addEventListener('dragover', e => {
        e.preventDefault();
        if (!div.classList.contains('disabled')) {
            div.classList.add('highlight');
            if (draggingWord && draggingWord !== word) {
                const cand = `${draggingWord} ${word}`;
                if (cand !== lastSpoken) {
                    speakText(cand);
                    lastSpoken = cand;
                }
            }
        }
    });

    div.addEventListener('dragleave', () => {
        div.classList.remove('highlight');
        window.speechSynthesis.cancel();
        lastSpoken = '';
    });

    div.addEventListener('drop', e => {
        e.preventDefault();
        div.classList.remove('highlight');
        checkSpoonerism(draggingWord, word);
        enableLeftPanel();
        enableRightPanel();
        draggingWord = null;
        lastSpoken = '';
    });

    return div;
}

function loadWords() {
    const a = document.getElementById('listA'), b = document.getElementById('listB');
    a.innerHTML = '';
    b.innerHTML = '';
    [...validWordsA, ...distractorWordsA]
        .sort(() => 0.5 - Math.random())
        .forEach(w => a.appendChild(createWordElement(w, 'listA')));
    [...validWordsB, ...distractorWordsB]
        .sort(() => 0.5 - Math.random())
        .forEach(w => b.appendChild(createWordElement(w, 'listB')));
}

function checkSpoonerism(w1, w2) {
    const cand = `${w1},${w2}`, rev = `${w2},${w1}`;
    const match = selectedPairs.find(([p]) => p === cand || p === rev);
    if (match) {
        const fp = document.getElementById('foundPairs');
        const el = document.createElement('div');
        el.className = 'pair';
        el.textContent = `${match[0]} → ${match[1]}`;
        fp.appendChild(el);
        removeWord(w1); removeWord(w2);
        foundCount++;
        speakText(`${match[0]} ${match[1]}`);
    } else {
        wrongCount++;
        const phrase = negations[Math.floor(Math.random()*negations.length)];
        speakText(phrase);
    }
    updateStatus();
}

function removeWord(w) {
    document.querySelectorAll('.word').forEach(div => {
        if (div.textContent === w) div.remove();
    });
}

async function startGame() {
    foundCount = 0; wrongCount = 0; timer = 0;
    document.getElementById('foundPairs').innerHTML = '<strong>Found Spoonerisms:</strong>';
    document.getElementById('selectedPairs').addEventListener('click', function handler() {
        populateSelectedPanel(); this.removeEventListener('click', handler);
    });

    pickRandomPairs(); pickDistractors(); loadWords(); updateStatus();

    await loadVoice();
    const welcome = new SpeechSynthesisUtterance('Welcome to Talked Fung');
    welcome.voice = voice;
    welcome.onend = () => { timerInterval = setInterval(() => { timer++; updateStatus(); }, 1000); };
    window.speechSynthesis.speak(welcome);
}

startGame();
</script>

</body>
</html>
