<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Image Filter and Effect Example</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; max-width: 800px; margin: 0 auto; padding: 20px; }
        canvas { border: 1px solid #ddd; margin-top: 20px; max-width: 100%; height: auto; }
        select, button, input { margin: 10px; padding: 5px; }
        .controls { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; }
        .control-group { margin: 10px; }
    </style>
</head>
<body>
    <h1>Comprehensive Image Filter and Effect Example</h1>
    <input type="file" id="imageUpload" accept="image/*">
    <div class="controls">
        <div class="control-group">
            <select id="filterSelect">
                <option value="none">None</option>
                <option value="grayscale">Grayscale</option>
                <option value="sepia">Sepia</option>
                <option value="invert">Invert</option>
                <option value="threshold">Threshold</option>
            </select>
        </div>
        <div class="control-group">
            <label for="brightness">Brightness:</label>
            <input type="range" id="brightness" min="-100" max="100" value="0">
        </div>
        <div class="control-group">
            <label for="contrast">Contrast:</label>
            <input type="range" id="contrast" min="-100" max="100" value="0">
        </div>
        <div class="control-group">
            <label for="saturation">Saturation:</label>
            <input type="range" id="saturation" min="-100" max="100" value="0">
        </div>
        <div class="control-group">
            <label for="blur">Blur:</label>
            <input type="range" id="blur" min="0" max="20" value="0">
        </div>
        <div class="control-group">
            <button id="sharpen">Sharpen</button>
        </div>
        <div class="control-group">
            <button id="emboss">Emboss</button>
        </div>
        <div class="control-group">
            <button id="edge">Edge Detection</button>
        </div>
        <div class="control-group">
            <button id="reset">Reset</button>
        </div>
    </div>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const imageUpload = document.getElementById('imageUpload');
        const filterSelect = document.getElementById('filterSelect');
        const brightnessSlider = document.getElementById('brightness');
        const contrastSlider = document.getElementById('contrast');
        const saturationSlider = document.getElementById('saturation');
        const blurSlider = document.getElementById('blur');
        const sharpenBtn = document.getElementById('sharpen');
        const embossBtn = document.getElementById('emboss');
        const edgeBtn = document.getElementById('edge');
        const resetBtn = document.getElementById('reset');
        let image = new Image();
        let originalImageData;

        imageUpload.addEventListener('change', loadImage);
        filterSelect.addEventListener('change', applyEffects);
        brightnessSlider.addEventListener('input', applyEffects);
        contrastSlider.addEventListener('input', applyEffects);
        saturationSlider.addEventListener('input', applyEffects);
        blurSlider.addEventListener('input', applyEffects);
        sharpenBtn.addEventListener('click', () => { applyConvolutionFilter(sharpenKernel); });
        embossBtn.addEventListener('click', () => { applyConvolutionFilter(embossKernel); });
        edgeBtn.addEventListener('click', () => { applyConvolutionFilter(edgeDetectionKernel); });
        resetBtn.addEventListener('click', resetImage);

        function loadImage(e) {
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                image.onload = function() {
                    canvas.width = image.width;
                    canvas.height = image.height;
                    ctx.drawImage(image, 0, 0);
                    originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                }
                image.src = event.target.result;
            }
            reader.readAsDataURL(file);
        }

        function applyEffects() {
            if (!originalImageData) return;

            ctx.putImageData(originalImageData, 0, 0);
            let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let data = imageData.data;

            // Apply selected filter
            switch(filterSelect.value) {
                case 'grayscale':
                    for (let i = 0; i < data.length; i += 4) {
                        const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                        data[i] = data[i + 1] = data[i + 2] = avg;
                    }
                    break;
                case 'sepia':
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i], g = data[i + 1], b = data[i + 2];
                        data[i] = Math.min(255, (r * 0.393) + (g * 0.769) + (b * 0.189));
                        data[i + 1] = Math.min(255, (r * 0.349) + (g * 0.686) + (b * 0.168));
                        data[i + 2] = Math.min(255, (r * 0.272) + (g * 0.534) + (b * 0.131));
                    }
                    break;
                case 'invert':
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = 255 - data[i];
                        data[i + 1] = 255 - data[i + 1];
                        data[i + 2] = 255 - data[i + 2];
                    }
                    break;
                case 'threshold':
                    for (let i = 0; i < data.length; i += 4) {
                        const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                        const v = avg > 128 ? 255 : 0;
                        data[i] = data[i + 1] = data[i + 2] = v;
                    }
                    break;
            }

            // Apply brightness
            const brightnessValue = parseInt(brightnessSlider.value);
            for (let i = 0; i < data.length; i += 4) {
                data[i] += brightnessValue;
                data[i + 1] += brightnessValue;
                data[i + 2] += brightnessValue;
            }

            // Apply contrast
            const contrastValue = parseInt(contrastSlider.value);
            const factor = (259 * (contrastValue + 255)) / (255 * (259 - contrastValue));
            for (let i = 0; i < data.length; i += 4) {
                data[i] = factor * (data[i] - 128) + 128;
                data[i + 1] = factor * (data[i + 1] - 128) + 128;
                data[i + 2] = factor * (data[i + 2] - 128) + 128;
            }

            // Apply saturation
            const saturationValue = parseInt(saturationSlider.value) / 100 + 1;
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                data[i] = avg + saturationValue * (data[i] - avg);
                data[i + 1] = avg + saturationValue * (data[i + 1] - avg);
                data[i + 2] = avg + saturationValue * (data[i + 2] - avg);
            }

            ctx.putImageData(imageData, 0, 0);

            // Apply blur
            const blurValue = parseInt(blurSlider.value);
            if (blurValue > 0) {
                ctx.filter = `blur(${blurValue}px)`;
                ctx.drawImage(canvas, 0, 0);
                ctx.filter = 'none';
            }
        }

        const sharpenKernel = [0, -1, 0, -1, 5, -1, 0, -1, 0];
        const embossKernel = [-2, -1, 0, -1, 1, 1, 0, 1, 2];
        const edgeDetectionKernel = [-1, -1, -1, -1, 8, -1, -1, -1, -1];

        function applyConvolutionFilter(kernel) {
            if (!originalImageData) return;

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            const result = new Uint8ClampedArray(data.length);

            const width = canvas.width;
            const height = canvas.height;

            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    const idx = (y * width + x) * 4;
                    let r = 0, g = 0, b = 0;

                    for (let ky = -1; ky <= 1; ky++) {
                        for (let kx = -1; kx <= 1; kx++) {
                            const kdx = ((y + ky) * width + (x + kx)) * 4;
                            const weight = kernel[(ky + 1) * 3 + (kx + 1)];
                            r += data[kdx] * weight;
                            g += data[kdx + 1] * weight;
                            b += data[kdx + 2] * weight;
                        }
                    }

                    result[idx] = r;
                    result[idx + 1] = g;
                    result[idx + 2] = b;
                    result[idx + 3] = data[idx + 3];
                }
            }

            const newImageData = new ImageData(result, width, height);
            ctx.putImageData(newImageData, 0, 0);
        }

        function resetImage() {
            if (originalImageData) {
                ctx.putImageData(originalImageData, 0, 0);
                filterSelect.value = 'none';
                brightnessSlider.value = 0;
                contrastSlider.value = 0;
                saturationSlider.value = 0;
                blurSlider.value = 0;
            }
        }
    </script>
</body>
</html>
