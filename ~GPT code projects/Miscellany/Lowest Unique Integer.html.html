<!DOCTYPE html>
<html>
<head>
    <title>Interactive Lowest Unique Number Game Simulation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .chart-container {
            margin-bottom: 40px;
            border: 1px solid #eee;
            padding: 20px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: 400px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background: #45a049;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        label {
            margin-right: 15px;
        }
        #gameLog {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-top: 40px;
        }
        .code-display {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.5;
            max-height: 500px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <h2>Simulation Controls</h2>
            <div>
                <label>Number of Games:
                    <input type="number" id="numGames" value="100" min="1" max="1000">
                </label>
                <label>Number of Agents:
                    <input type="number" id="numAgents" value="25" min="5" max="100">
                </label>
            </div>
            <div id="strategyDistribution"></div>
        </div>

        <h2>Agent Performance Analysis</h2>
        <div class="chart-container">
            <canvas id="winChart"></canvas>
        </div>
        
        <h2>Strategy Performance Distribution</h2>
        <div class="chart-container">
            <canvas id="strategyChart"></canvas>
        </div>
        
        <h2>Winning Numbers Distribution</h2>
        <div class="chart-container">
            <canvas id="histogramChart"></canvas>
        </div>
        
        <h2>Temporal Analysis of Winning Numbers</h2>
        <div class="chart-container">
            <canvas id="timeSeriesChart"></canvas>
        </div>
        
        <div id="gameLog">
            <h2>Game History Log</h2>
            <div id="gameLogContent" style="height: 300px; overflow-y: scroll;"></div>
        </div>
    </div>

<script>
class GameHistory {
    constructor() {
        this.games = [];
        this.winningNumbers = [];
        this.numberFrequency = new Array(51).fill(0);
    }

    addGame(picks, winner, winningNumber) {
        this.games.push({ picks, winner, winningNumber });
        this.winningNumbers.push(winningNumber);
        picks.forEach(pick => this.numberFrequency[pick]++);
    }

    getLastNGames(n) {
        return this.games.slice(-n);
    }

    getWinningNumberFrequency() {
        return this.winningNumbers.reduce((acc, num) => {
            acc[num] = (acc[num] || 0) + 1;
            return acc;
        }, {});
    }

    reset() {
        this.games = [];
        this.winningNumbers = [];
        this.numberFrequency = new Array(51).fill(0);
    }
}

class Agent {
    constructor(id, strategy, color, strategyName) {
        this.id = id;
        this.strategy = strategy;
        this.color = color;
        this.strategyName = strategyName;
        this.wins = 0;
    }

    makeGuess(history, currentPicks) {
        return this.strategy(history, currentPicks, this.id);
    }

    reset() {
        this.wins = 0;
    }
}

const strategies = {
    conservative: (history, currentPicks, id) => {
        const freq = history.numberFrequency;
        const avg = freq.reduce((a, b) => a + b) / freq.length;
        for (let i = 1; i <= 50; i++) {
            if (freq[i] < avg && !currentPicks.includes(i)) return i;
        }
        return Math.floor(Math.random() * 50) + 1;
    },

    aggressive: (history, currentPicks, id) => {
        const recentWins = history.getLastNGames(5).map(g => g.winningNumber);
        const target = recentWins[0] || Math.floor(Math.random() * 10) + 1;
        return target + Math.floor(Math.random() * 3) - 1 || target;
    },

    primeHunter: (history, currentPicks, id) => {
        const primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47];
        const available = primes.filter(p => !currentPicks.includes(p));
        return available[Math.floor(Math.random() * available.length)] || primes[0];
    },

    patternSeeker: (history, currentPicks, id) => {
        if (history.games.length < 2) return id % 50 + 1;
        const lastGame = history.games[history.games.length - 1];
        return (lastGame.winningNumber + 7) % 50 + 1;
    },

    gapFinder: (history, currentPicks, id) => {
        const freq = history.numberFrequency;
        let gaps = [];
        for (let i = 1; i <= 48; i++) {
            if (freq[i] === 0 && freq[i+1] > 0) gaps.push(i);
        }
        return gaps[Math.floor(Math.random() * gaps.length)] || Math.floor(Math.random() * 50) + 1;
    }
};

const agentTypes = [
    { name: 'Conservative', color: '#FF6B6B', strategy: strategies.conservative },
    { name: 'Aggressive', color: '#4ECDC4', strategy: strategies.aggressive },
    { name: 'Prime Hunter', color: '#45B7D1', strategy: strategies.primeHunter },
    { name: 'Pattern Seeker', color: '#96CEB4', strategy: strategies.patternSeeker },
    { name: 'Gap Finder', color: '#FFEEAD', strategy: strategies.gapFinder }
];

let agents = [];
const history = new GameHistory();
let charts = {};

function createAgents(numAgents) {
    agents = [];
    for (let i = 0; i < numAgents; i++) {
        const type = agentTypes[i % agentTypes.length];
        agents.push(new Agent(i + 1, type.strategy, type.color, type.name));
    }
}

function findLowestUnique(numbers) {
    const frequency = {};
    numbers.forEach(n => frequency[n] = (frequency[n] || 0) + 1);
    const unique = Object.entries(frequency)
        .filter(([_, count]) => count === 1)
        .map(([num, _]) => parseInt(num));
    return Math.min(...unique);
}

function runGame(agents, history) {
    const picks = [];
    agents.forEach(agent => {
        const pick = agent.makeGuess(history, picks);
        picks.push(pick);
    });

    const winningNumber = findLowestUnique(picks);
    const winnerIndex = picks.indexOf(winningNumber);
    const winner = agents[winnerIndex];
    
    if (winner) winner.wins++;
    
    history.addGame(picks, winner ? winner.id : null, winningNumber);
    return { picks, winner, winningNumber };
}

function updateCharts() {
    // Destroy existing charts
    Object.values(charts).forEach(chart => chart.destroy());

    const strategyWins = agentTypes.map(type => ({
        name: type.name,
        color: type.color,
        wins: agents.filter(a => a.strategyName === type.name)
            .reduce((sum, agent) => sum + agent.wins, 0)
    }));

    const histogramData = new Array(50).fill(0);
    history.winningNumbers.forEach(num => histogramData[num-1]++);

    const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'right',
                labels: {
                    padding: 20
                }
            }
        }
    };

    // Individual agent performance chart
    charts.winChart = new Chart(document.getElementById('winChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: agents.map(a => `Agent ${a.id} (${a.strategyName})`),
            datasets: [{
                label: 'Wins per Agent',
                data: agents.map(a => a.wins),
                backgroundColor: agents.map(a => a.color)
            }]
        },
        options: {
            ...chartOptions,
            plugins: {
                ...chartOptions.plugins,
                title: {
                    display: true,
                    text: 'Individual Agent Performance',
                    font: { size: 16 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Wins'
                    }
                }
            }
        }
    });

    // Strategy performance pie chart
    charts.strategyChart = new Chart(document.getElementById('strategyChart').getContext('2d'), {
        type: 'pie',
        data: {
            labels: strategyWins.map(s => s.name),
            datasets: [{
                data: strategyWins.map(s => s.wins),
                backgroundColor: strategyWins.map(s => s.color)
            }]
        },
        options: {
            ...chartOptions,
            plugins: {
                ...chartOptions.plugins,
                title: {
                    display: true,
                    text: 'Wins by Strategy Type',
                    font: { size: 16 }
                }
            }
        }
    });

    // Winning numbers histogram
    charts.histogramChart = new Chart(document.getElementById('histogramChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: Array.from({length: 50}, (_, i) => i + 1),
            datasets: [{
                label: 'Frequency of Winning Numbers',
                data: histogramData,
                backgroundColor: '#6c757d'
            }]
        },
        options: {
            ...chartOptions,
            plugins: {
                ...chartOptions.plugins,
                title: {
                    display: true,
                    text: 'Distribution of Winning Numbers',
                    font: { size: 16 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Frequency'
                    }
                }
            }
        }
    });

    // Time series of winning numbers
    charts.timeSeriesChart = new Chart(document.getElementById('timeSeriesChart').getContext('2d'), {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Winning Numbers Over Time',
                data: history.winningNumbers.map((num, index) => ({
                    x: index + 1,
                    y: num
                })),
                backgroundColor: '#17a2b8'
            }]
        },
        options: {
            ...chartOptions,
            plugins: {
                ...chartOptions.plugins,
                title: {
                    display: true,
                    text: 'Winning Numbers vs Game Number',
                    font: { size: 16 }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Game Number'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Winning Number'
                    },
                    min: 0,
                    max: 50
                }
            }
        }
    });
}

function updateGameLog() {
    const gameLogContent = document.getElementById('gameLogContent');
    gameLogContent.innerHTML = '';
    history.games.forEach((game, index) => {
        const winner = game.winner ? agents[game.winner - 1] : null;
        const logEntry = `Game ${index + 1}: ${winner ? 'Agent ' + winner.id + ' (' + winner.strategyName + ')' : 'No winner'} | Number: ${game.winningNumber}`;
        gameLogContent.innerHTML += `<div style="color: ${winner ? winner.color : 'gray'}">${logEntry}</div>`;
    });
}

// Initialize simulation on page load
window.onload = () => {
    const numGames = parseInt(document.getElementById('numGames').value);
    const numAgents = parseInt(document.getElementById('numAgents').value);
    
    createAgents(numAgents);
    for (let i = 0; i < numGames; i++) {
        runGame(agents, history);
    }
    
    updateCharts();
    updateGameLog();
    
    // Update strategy distribution info
    const strategyDistribution = document.getElementById('strategyDistribution');
    const counts = agents.reduce((acc, agent) => {
        acc[agent.strategyName] = (acc[agent.strategyName] || 0) + 1;
        return acc;
    }, {});
    
    strategyDistribution.innerHTML = '<h3>Strategy Distribution:</h3>' + 
        Object.entries(counts)
            .map(([strategy, count]) => `${strategy}: ${count} agents`)
            .join(' | ');
};
</script>
</body>
</html>