<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Depreciating Value Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #191b22;
      color: #fff;
      font-family: system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .container {
      width: 100%;
      max-width: 480px;
      margin: auto;
      padding: 0.25rem 0.25rem 0.5rem 0.25rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.6rem;
    }
    h1 {
      font-size: 1.4rem;
      letter-spacing: 1px;
      margin: 0 0 0.3em 0;
      font-weight: 700;
    }
    .button-row {
      display: flex;
      gap: 0.3rem;
      margin-bottom: 0.2rem;
      flex-wrap: wrap;
    }
    button {
      background: #27ae60;
      color: #fff;
      font-size: 1.1rem;
      border: none;
      border-radius: 0.9rem;
      padding: 0.55rem 0.75rem;
      font-weight: bold;
      transition: background 0.2s;
      cursor: pointer;
      flex: 1;
      box-shadow: 0 2px 8px #0003;
    }
    button:active {
      background: #219150;
    }
    .totals {
      width: 100%;
      background: #21232b;
      border-radius: 0.8rem;
      box-shadow: 0 1px 5px #0002;
      padding: 0.7rem 0.5rem 0.55rem 0.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 0.3rem;
    }
    .total-value {
      font-size: 1.4rem;
      font-weight: 900;
      letter-spacing: 1px;
      margin-bottom: 0.15rem;
      color: #ffd86b;
      text-shadow: 0 2px 8px #0004;
      font-family: "Fira Mono", "Consolas", monospace;
    }
    .label {
      font-size: 0.93rem;
      color: #bbb;
      margin-bottom: 0.15rem;
    }
    .deprec {
      font-size: 0.82rem;
      color: #89d;
      margin-bottom: 0.12rem;
      opacity: 0.75;
      letter-spacing: 0.2px;
      font-family: "Fira Mono", "Consolas", monospace;
    }
    .est-date {
      font-size: 0.81rem;
      color: #94b6e6;
      opacity: 0.77;
      font-family: "Fira Mono", "Consolas", monospace;
      margin-top: -0.12em;
    }
    .list {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0.27rem;
      margin-bottom: 0.15rem;
    }
    .item {
      background: #242631;
      border-radius: 0.7rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.45rem 0.55rem;
      font-size: 1.02rem;
      box-shadow: 0 1px 4px #0001;
      user-select: none;
      font-family: "Fira Mono", "Consolas", monospace;
      min-height: 36px;
      gap: 0.25rem;
    }
    .item-info {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      flex: 1;
      gap: 0.01rem;
    }
    .item-label {
      color: #aaa;
      font-size: 0.97em;
    }
    .item-dt {
      color: #7dc6f2;
      font-size: 0.78em;
      margin-top: -0.08em;
      opacity: 0.8;
    }
    .item-deprec {
      color: #a1faab;
      font-size: 0.82em;
      margin-top: -0.04em;
      opacity: 0.8;
    }
    .item-est-date {
      color: #94b6e6;
      font-size: 0.81em;
      opacity: 0.77;
      margin-top: -0.06em;
    }
    .item-amount {
      font-weight: bold;
      color: #ffd86b;
      font-family: "Fira Mono", "Consolas", monospace;
      text-align: right;
      min-width: 120px;
    }
    .item-del {
      background: none;
      border: none;
      color: #fa5151;
      font-size: 1.17em;
      margin-left: 0.45em;
      margin-right: -0.17em;
      opacity: 0.75;
      cursor: pointer;
      font-weight: bold;
      line-height: 1;
      padding: 0 0.15em;
      border-radius: 50%;
      transition: background 0.2s, opacity 0.15s;
      align-self: flex-start;
    }
    .item-del:hover, .item-del:focus {
      background: #fa515133;
      opacity: 1;
    }
    @media (max-width: 500px) {
      .container {
        padding: 0.12rem;
      }
      button {
        padding: 0.51rem 0.3rem;
        font-size: 1.05rem;
      }
      .totals, .item {
        font-size: 0.98rem;
        padding: 0.38rem 0.35rem;
      }
      .total-value {
        font-size: 1.05rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Depreciating Value</h1>
    <div class="button-row">
      <button onclick="addAmount(1)">$1</button>
      <button onclick="addAmount(10)">$10</button>
      <button onclick="addAmount(100)">$100</button>
      <button onclick="addAmount(1000)">$1000</button>
    </div>
    <div class="totals">
      <div class="label">TOTAL VALUE REMAINING</div>
      <div class="total-value" id="grandTotal">$0.000000000000</div>
      <div class="deprec" id="totalDeprec">Depreciation: 0.000000%</div>
      <div class="est-date" id="totalEstDate"></div>
    </div>
    <div class="list" id="itemsList"></div>
    <div class="label" style="margin-top:1.3em;font-size:0.91rem;opacity:0.7;">
      3% p.a. depreciation, compounded per second. <br>
      Precise to 12 decimals. Hold <b>Q</b>+<b>W</b>+<b>E</b> to clear all.
    </div>
  </div>

  <script>
    // Constants
    const RATE_PER_YEAR = 0.03; // 3%
    const SECS_PER_YEAR = 365.25 * 24 * 60 * 60;
    const DECAY_PER_SEC = Math.log(1 - RATE_PER_YEAR) / SECS_PER_YEAR;

    let items = []; // {amount, ts, dt}
    let pressedKeys = {};

    // Local Storage Handling
    function saveItems() {
      localStorage.setItem('depreciate_items', JSON.stringify(items));
    }
    function loadItems() {
      const raw = localStorage.getItem('depreciate_items');
      if (raw) {
        try {
          items = JSON.parse(raw);
        } catch (e) {
          items = [];
        }
      }
    }

    // Add new item
    function addAmount(amount) {
      const now = Date.now();
      items.push({
        amount: Number(amount),
        ts: now,
        dt: new Date(now).toISOString() // for display
      });
      saveItems();
      render();
    }

    // Remove by index
    function removeItem(idx) {
      items.splice(idx, 1);
      saveItems();
      render();
    }

    // Calculate depreciated value for an item
    function getDepValue(item, nowTs) {
      const t = (nowTs - item.ts) / 1000; // seconds since added
      return item.amount * Math.exp(DECAY_PER_SEC * t);
    }

    // Format to 12 decimals, always shows trailing zeros
    function format12(value) {
      return value.toLocaleString(undefined, {
        minimumFractionDigits: 12,
        maximumFractionDigits: 12
      });
    }

    // Format ISO8601 to readable
    function formatDT(iso) {
      const d = new Date(iso);
      // e.g. 2025-07-17 20:31:19
      const pad = x => x.toString().padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }

    // Each item's depreciation %
    function itemDeprec(item, nowTs) {
      const curr = getDepValue(item, nowTs);
      return (1 - curr / item.amount) * 100;
    }

    // Estimate the date/time when item will hit 10% remaining
    function item10pctDate(item) {
      // t_10 = ln(0.10) / DECAY_PER_SEC (positive value)
      const t10 = Math.log(0.10) / DECAY_PER_SEC; // seconds
      const dt = new Date(item.ts + t10 * 1000);
      return formatDT(dt.toISOString());
    }

    // Estimate for the whole total: when all (if left untouched) would hit 10%
    function total10pctDate() {
      // For same rate, all decay the same, so
      // t_10 = ln(0.10) / DECAY_PER_SEC
      if (items.length === 0) return "";
      const earliest = Math.min(...items.map(item => item.ts));
      const t10 = Math.log(0.10) / DECAY_PER_SEC; // seconds
      const dt = new Date(earliest + t10 * 1000);
      return formatDT(dt.toISOString());
    }

    // Clear all with confirmation
    function clearAll() {
      if (items.length === 0) return;
      if (confirm("Clear ALL contributions? This cannot be undone.")) {
        items = [];
        saveItems();
        render();
      }
    }

    // Hotkey handler for Q+W+E
    document.addEventListener('keydown', e => {
      pressedKeys[e.key.toLowerCase()] = true;
      if (pressedKeys['q'] && pressedKeys['w'] && pressedKeys['e']) {
        clearAll();
      }
    });
    document.addEventListener('keyup', e => {
      pressedKeys[e.key.toLowerCase()] = false;
    });

    // Render everything
    function render() {
      const now = Date.now();
      let total = 0, originalSum = 0;
      let listHtml = '';
      // Sort most recent first:
      let sorted = items.slice().sort((a, b) => b.ts - a.ts);
      sorted.forEach((item, idxOnScreen) => {
        const realIdx = items.findIndex(i => i.ts === item.ts && i.amount === item.amount && i.dt === item.dt);
        const curr = getDepValue(item, now);
        total += curr;
        originalSum += item.amount;
        const itemDep = itemDeprec(item, now);
        listHtml += `
          <div class="item">
            <div class="item-info">
              <span class="item-label">+$${format12(item.amount)}</span>
              <span class="item-dt">${formatDT(item.dt)}</span>
              <span class="item-deprec">-${itemDep.toFixed(6)}%</span>
              <span class="item-est-date">Est. 10%: ${item10pctDate(item)}</span>
            </div>
            <span class="item-amount">$${format12(curr)}</span>
            <button class="item-del" title="Remove" onclick="removeItem(${realIdx})">&times;</button>
          </div>
        `;
      });
      document.getElementById('grandTotal').textContent = '$' + format12(total);

      // Total depreciation %
      let deprec = 0;
      if (originalSum > 0) {
        deprec = (1 - total/originalSum)*100;
      }
      document.getElementById('totalDeprec').textContent =
        'Depreciation: ' + deprec.toFixed(6) + '%';

      document.getElementById('itemsList').innerHTML = listHtml;

      // Total est. 10% date
      const tenPctDate = total10pctDate();
      document.getElementById('totalEstDate').textContent = 
        tenPctDate ? ("Est. 10% total: " + tenPctDate) : "";
    }

    // Live updating ticker
    function startTicker() {
      render();
      setInterval(render, 100);
    }

    // Init
    loadItems();
    startTicker();
  </script>
</body>
</html>
