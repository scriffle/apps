<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Tool - You Can't Fake This (Inside Folder)</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        h1 {
            color: #00ffff;
            border-bottom: 2px solid #00ffff;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            background: #0a0a0a;
            border-radius: 5px;
        }
        .test-title {
            color: #ffff00;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .success {
            color: #00ff00;
            padding: 5px;
            margin: 5px 0;
        }
        .error {
            color: #ff0000;
            padding: 5px;
            margin: 5px 0;
        }
        .warning {
            color: #ffaa00;
            padding: 5px;
            margin: 5px 0;
        }
        .info {
            color: #00aaff;
            padding: 5px;
            margin: 5px 0;
        }
        button {
            background: #00ffff;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 3px;
        }
        button:hover {
            background: #00cccc;
        }
        pre {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            color: #fff;
        }
        .json-preview {
            max-height: 300px;
            overflow-y: auto;
        }
        input[type="text"] {
            background: #2a2a2a;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 5px;
            width: 300px;
            margin: 5px;
        }
        .path-display {
            background: #2a2a2a;
            padding: 8px;
            margin: 5px 0;
            border-left: 3px solid #00ffff;
            font-family: monospace;
        }
        .quick-fix {
            background: #1a3a1a;
            border: 1px solid #00ff00;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
        }
        .quick-fix h4 {
            color: #00ff00;
            margin-top: 0;
        }
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .status-ok { background: #0a4a0a; color: #00ff00; }
        .status-error { background: #4a0a0a; color: #ff0000; }
        .status-warning { background: #4a3a0a; color: #ffaa00; }
    </style>
</head>
<body>
    <h1>üîç Debug Tool - Running from /youcantfakethis/ folder</h1>
    
    <div class="test-section">
        <div class="test-title">üìã Debug Configuration</div>
        <div id="config-display"></div>
        <button onclick="testAll()">üöÄ Run All Tests</button>
        <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
        <button onclick="quickDiagnose()">‚ö° Quick Diagnosis</button>
    </div>

    <div class="test-section">
        <div class="test-title">Test 1: Environment Check</div>
        <div id="test1-result"></div>
    </div>

    <div class="test-section">
        <div class="test-title">Test 2: Manifest in Current Directory</div>
        <div id="test2-result"></div>
        <button onclick="testManifest()">Test Manifest</button>
    </div>

    <div class="test-section">
        <div class="test-title">Test 3: Validate Manifest Structure</div>
        <div id="test3-result"></div>
        <button onclick="validateManifest()">Validate Structure</button>
    </div>

    <div class="test-section">
        <div class="test-title">Test 4: Load Specific Topic File</div>
        <input type="text" id="subject-input" placeholder="Subject (e.g., physics)" value="physics">
        <input type="text" id="filename-input" placeholder="Filename (e.g., U4-AOS1-11-Comparing-Light-Matter.json)" value="U4-AOS1-11-Comparing-Light-Matter.json">
        <button onclick="testTopicFile()">Test Topic File</button>
        <div id="test4-result"></div>
    </div>

    <div class="test-section">
        <div class="test-title">Test 5: File Structure Check</div>
        <div id="test5-result"></div>
        <button onclick="testFileStructure()">Check File Structure</button>
    </div>

    <div class="test-section">
        <div class="test-title">Test 6: Test from Application Perspective</div>
        <div id="test6-result"></div>
        <button onclick="testFromAppPerspective()">Test App Paths</button>
    </div>

    <div class="test-section">
        <div class="test-title">Test 7: All Topics Availability</div>
        <div id="test7-result"></div>
        <button onclick="testAllTopics()">Test All Topics</button>
    </div>

    <div class="test-section">
        <div class="test-title">Test 8: Console & Network Monitor</div>
        <pre id="console-log" class="json-preview"></pre>
    </div>

    <script>
        // Since we're running FROM the youcantfakethis folder:
        // - manifest.json is in the same directory
        // - topic files are in subdirectories (physics/, chemistry/, etc.)
        
        const CONFIG = {
            // From inside youcantfakethis folder
            manifestPath: 'manifest.json',
            
            // From app's perspective (one level up)
            appManifestPath: '../youcantfakethis/manifest.json',
            appContentPath: '../youcantfakethis/'
        };

        // Custom console log
        const logToPage = (message, type = 'info') => {
            const consoleEl = document.getElementById('console-log');
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            const colorClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            consoleEl.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
            consoleEl.scrollTop = consoleEl.scrollHeight;
        };

        // Override console methods
        const originalLog = console.log;
        const originalError = console.error;
        console.log = (...args) => {
            originalLog(...args);
            logToPage(args.join(' '), 'info');
        };
        console.error = (...args) => {
            originalError(...args);
            logToPage(args.join(' '), 'error');
        };

        // Display configuration
        function updateConfig() {
            document.getElementById('config-display').innerHTML = `
                <div class="path-display">Current Location: ${window.location.pathname}</div>
                <div class="path-display">Current Directory: /youcantfakethis/</div>
                <div class="path-display">Manifest (local): ${CONFIG.manifestPath}</div>
                <div class="path-display">Manifest (from app): ${CONFIG.appManifestPath}</div>
                <div class="info">This debug tool is running from inside the youcantfakethis folder</div>
            `;
        }
        updateConfig();

        // Test 1: Environment Check
        function testEnvironment() {
            const result = document.getElementById('test1-result');
            result.innerHTML = '';
            
            // Check location
            result.innerHTML += `<div class="info">Protocol: ${window.location.protocol}</div>`;
            result.innerHTML += `<div class="info">Host: ${window.location.host}</div>`;
            result.innerHTML += `<div class="info">Path: ${window.location.pathname}</div>`;
            
            // Check if we're in the right folder
            if (window.location.pathname.includes('youcantfakethis')) {
                result.innerHTML += `<div class="success">‚úÖ Running from youcantfakethis folder</div>`;
            } else {
                result.innerHTML += `<div class="warning">‚ö†Ô∏è Not in youcantfakethis folder - paths may be incorrect</div>`;
            }
            
            // Protocol check
            if (window.location.protocol === 'file:') {
                result.innerHTML += `<div class="error">‚ùå Running from file:// protocol - this will cause CORS issues!</div>`;
                result.innerHTML += `<div class="quick-fix">
                    <h4>Quick Fix:</h4>
                    <div>1. Install a local server: <code>npm install -g http-server</code></div>
                    <div>2. Navigate to your project root</div>
                    <div>3. Run: <code>http-server -c-1</code></div>
                    <div>4. Open: <code>http://localhost:8080/youcantfakethis/debug.html</code></div>
                </div>`;
            } else {
                result.innerHTML += `<div class="success">‚úÖ Running from ${window.location.protocol}</div>`;
            }
        }

        // Test 2: Load Manifest from current directory
        async function testManifest() {
            const result = document.getElementById('test2-result');
            result.innerHTML = '<div class="info">Testing manifest in current directory...</div>';
            
            try {
                // Test local manifest (same directory)
                result.innerHTML += `<div class="path-display">Trying: ${CONFIG.manifestPath}</div>`;
                
                const response = await fetch(CONFIG.manifestPath);
                
                result.innerHTML += `<div class="info">Status: ${response.status} ${response.statusText}</div>`;
                result.innerHTML += `<div class="info">Content-Type: ${response.headers.get('content-type') || 'not set'}</div>`;
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                window.manifestData = data;
                
                result.innerHTML += `<div class="success">‚úÖ Manifest loaded successfully!</div>`;
                
                // Quick summary
                if (data.subjects) {
                    result.innerHTML += `<div class="success">‚úÖ Found ${data.subjects.length} subjects</div>`;
                    data.subjects.forEach(subj => {
                        const status = subj.units && subj.units.length > 0 ? 'status-ok' : 'status-warning';
                        result.innerHTML += `<div class="info">  ‚Ä¢ ${subj.name} <span class="status-badge ${status}">${subj.units?.length || 0} units</span></div>`;
                    });
                }
                
                // Show first 500 chars
                result.innerHTML += `<details><summary>View Manifest Content</summary><pre class="json-preview">${JSON.stringify(data, null, 2).substring(0, 1000)}...</pre></details>`;
                
            } catch (error) {
                result.innerHTML += `<div class="error">‚ùå Failed to load manifest: ${error.message}</div>`;
                
                // Provide solutions
                if (error.message.includes('404')) {
                    result.innerHTML += `<div class="quick-fix">
                        <h4>Fix: manifest.json not found</h4>
                        <div>1. Ensure manifest.json exists in /youcantfakethis/</div>
                        <div>2. Check filename is exactly "manifest.json" (case-sensitive)</div>
                        <div>3. Current directory: ${window.location.pathname}</div>
                    </div>`;
                } else if (error.message.includes('Failed to fetch')) {
                    result.innerHTML += `<div class="quick-fix">
                        <h4>Fix: Network/CORS error</h4>
                        <div>You must run this from a web server, not file://</div>
                        <div>See Test 1 for server setup instructions</div>
                    </div>`;
                }
            }
        }

        // Test 3: Validate Manifest Structure
        async function validateManifest() {
            const result = document.getElementById('test3-result');
            result.innerHTML = '<div class="info">Validating manifest structure...</div>';
            
            try {
                if (!window.manifestData) {
                    await testManifest();
                    if (!window.manifestData) {
                        throw new Error('Could not load manifest');
                    }
                }
                
                const manifest = window.manifestData;
                let errors = [];
                let warnings = [];
                let topicFiles = [];
                
                // Check structure
                if (!manifest.subjects || !Array.isArray(manifest.subjects)) {
                    errors.push('Missing or invalid "subjects" array');
                } else {
                    manifest.subjects.forEach(subject => {
                        if (!subject.id) errors.push(`Subject missing "id"`);
                        if (!subject.name) warnings.push(`Subject "${subject.id}" missing "name"`);
                        
                        (subject.units || []).forEach(unit => {
                            if (!unit.id) errors.push(`Unit in ${subject.id} missing "id"`);
                            
                            (unit.areasOfStudy || []).forEach(aos => {
                                if (!aos.id) errors.push(`AOS in ${subject.id}/${unit.id} missing "id"`);
                                
                                (aos.topics || []).forEach(topic => {
                                    if (!topic.filename) {
                                        errors.push(`Topic ${topic.id} missing "filename"`);
                                    } else {
                                        topicFiles.push({
                                            subject: subject.id,
                                            filename: topic.filename,
                                            status: topic.status || 'unknown'
                                        });
                                    }
                                });
                            });
                        });
                    });
                }
                
                // Display results
                if (errors.length === 0) {
                    result.innerHTML += `<div class="success">‚úÖ Structure valid! No errors found.</div>`;
                } else {
                    result.innerHTML += `<div class="error">‚ùå Found ${errors.length} errors:</div>`;
                    errors.forEach(err => result.innerHTML += `<div class="error">  ‚Ä¢ ${err}</div>`);
                }
                
                if (warnings.length > 0) {
                    result.innerHTML += `<div class="warning">‚ö†Ô∏è ${warnings.length} warnings:</div>`;
                    warnings.forEach(warn => result.innerHTML += `<div class="warning">  ‚Ä¢ ${warn}</div>`);
                }
                
                // List expected files
                result.innerHTML += `<div class="info">üìÑ Expected topic files (${topicFiles.length}):</div>`;
                topicFiles.forEach(file => {
                    const badge = file.status === 'available' ? 'status-ok' : 'status-warning';
                    result.innerHTML += `<div class="info">  ‚Ä¢ ${file.subject}/${file.filename} <span class="status-badge ${badge}">${file.status}</span></div>`;
                });
                
                window.expectedFiles = topicFiles;
                
            } catch (error) {
                result.innerHTML += `<div class="error">‚ùå Validation failed: ${error.message}</div>`;
            }
        }

        // Test 4: Load specific topic file
        async function testTopicFile() {
            const result = document.getElementById('test4-result');
            const subject = document.getElementById('subject-input').value;
            const filename = document.getElementById('filename-input').value;
            
            if (!subject || !filename) {
                result.innerHTML = '<div class="error">Please enter both subject and filename</div>';
                return;
            }
            
            const path = `${subject}/${filename}`;
            result.innerHTML = `<div class="info">Testing topic file...</div>`;
            result.innerHTML += `<div class="path-display">Path: ${path}</div>`;
            
            try {
                const response = await fetch(path);
                
                result.innerHTML += `<div class="info">Status: ${response.status}</div>`;
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                result.innerHTML += `<div class="success">‚úÖ Topic file loaded!</div>`;
                
                // Validate structure
                const checks = [
                    { field: 'metadata', required: true },
                    { field: 'metadata.tabs', required: true },
                    { field: 'content', required: true },
                    { field: 'content.round1', required: true },
                    { field: 'content.round2', required: true },
                    { field: 'content.round3', required: true }
                ];
                
                checks.forEach(check => {
                    const parts = check.field.split('.');
                    let obj = data;
                    let valid = true;
                    
                    for (const part of parts) {
                        if (!obj || !obj[part]) {
                            valid = false;
                            break;
                        }
                        obj = obj[part];
                    }
                    
                    if (valid) {
                        result.innerHTML += `<div class="success">  ‚úÖ Has ${check.field}</div>`;
                    } else {
                        result.innerHTML += `<div class="error">  ‚ùå Missing ${check.field}</div>`;
                    }
                });
                
            } catch (error) {
                result.innerHTML += `<div class="error">‚ùå Failed: ${error.message}</div>`;
                
                if (error.message.includes('404')) {
                    result.innerHTML += `<div class="quick-fix">
                        <h4>Fix: File not found</h4>
                        <div>1. Check file exists at: /youcantfakethis/${path}</div>
                        <div>2. Verify filename spelling and case</div>
                        <div>3. Ensure subject folder exists</div>
                    </div>`;
                }
            }
        }

        // Test 5: File Structure Check
        async function testFileStructure() {
            const result = document.getElementById('test5-result');
            result.innerHTML = '<div class="info">Checking file structure...</div>';
            
            const expectedDirs = ['physics', 'chemistry', 'biology'];
            
            for (const dir of expectedDirs) {
                try {
                    // Try to fetch a directory (will usually fail but shows 403 if exists)
                    const response = await fetch(dir + '/');
                    
                    if (response.status === 403 || response.status === 200) {
                        result.innerHTML += `<div class="success">‚úÖ /${dir}/ directory exists</div>`;
                    } else if (response.status === 404) {
                        result.innerHTML += `<div class="warning">‚ö†Ô∏è /${dir}/ directory not found</div>`;
                    } else {
                        result.innerHTML += `<div class="info">  /${dir}/ - Status: ${response.status}</div>`;
                    }
                } catch (error) {
                    result.innerHTML += `<div class="error">‚ùå /${dir}/ - ${error.message}</div>`;
                }
            }
            
            result.innerHTML += `<div class="info">Note: 403 Forbidden usually means the directory exists but listing is disabled (normal)</div>`;
        }

        // Test 6: Test from Application Perspective
        async function testFromAppPerspective() {
            const result = document.getElementById('test6-result');
            result.innerHTML = '<div class="info">Testing paths as the main app would see them...</div>';
            
            // The app uses these paths from root
            const appPath = 'youcantfakethis/manifest.json';
            const fullPath = window.location.origin + '/' + appPath;
            
            result.innerHTML += `<div class="info">App would request: ${appPath}</div>`;
            result.innerHTML += `<div class="info">Full URL: ${fullPath}</div>`;
            
            try {
                // Go up one level and try the app's path
                const testPath = '../' + appPath;
                result.innerHTML += `<div class="info">Testing: ${testPath}</div>`;
                
                const response = await fetch(testPath);
                
                if (response.ok) {
                    result.innerHTML += `<div class="success">‚úÖ App path works! The application should load correctly.</div>`;
                } else {
                    result.innerHTML += `<div class="error">‚ùå App path failed: ${response.status}</div>`;
                    result.innerHTML += `<div class="warning">The main application may not be able to load files</div>`;
                }
                
            } catch (error) {
                result.innerHTML += `<div class="error">‚ùå Cannot test app perspective: ${error.message}</div>`;
            }
            
            // Show what the app expects
            result.innerHTML += `<div class="quick-fix">
                <h4>Expected Structure for App:</h4>
                <div>üìÅ / (root)</div>
                <div>  üìÑ review-platform.html</div>
                <div>  üìÅ youcantfakethis/</div>
                <div>    üìÑ manifest.json</div>
                <div>    üìÅ physics/</div>
                <div>      üìÑ [topic].json files</div>
            </div>`;
        }

        // Test 7: Test all topic files
        async function testAllTopics() {
            const result = document.getElementById('test7-result');
            result.innerHTML = '<div class="info">Testing all topic files...</div>';
            
            if (!window.expectedFiles) {
                result.innerHTML += '<div class="warning">Run "Validate Structure" first to get file list</div>';
                await validateManifest();
            }
            
            if (!window.expectedFiles || window.expectedFiles.length === 0) {
                result.innerHTML += '<div class="error">No topic files found in manifest</div>';
                return;
            }
            
            let success = 0;
            let failed = 0;
            
            for (const file of window.expectedFiles) {
                const path = `${file.subject}/${file.filename}`;
                
                try {
                    const response = await fetch(path);
                    
                    if (response.ok) {
                        success++;
                        result.innerHTML += `<div class="success">‚úÖ ${path}</div>`;
                    } else {
                        failed++;
                        result.innerHTML += `<div class="error">‚ùå ${path} (${response.status})</div>`;
                    }
                } catch (error) {
                    failed++;
                    result.innerHTML += `<div class="error">‚ùå ${path} (${error.message})</div>`;
                }
            }
            
            // Summary
            const total = window.expectedFiles.length;
            result.innerHTML += `<div class="info">üìä Results: ${success}/${total} files loaded successfully</div>`;
            
            if (failed > 0) {
                result.innerHTML += `<div class="quick-fix">
                    <h4>Missing Files Fix:</h4>
                    <div>1. Create the missing JSON files</div>
                    <div>2. Place them in the correct subject folder</div>
                    <div>3. Ensure filenames match exactly (case-sensitive)</div>
                </div>`;
            }
        }

        // Quick Diagnosis
        async function quickDiagnose() {
            console.log('Running quick diagnosis...');
            
            const results = [];
            
            // Check 1: Protocol
            if (window.location.protocol === 'file:') {
                results.push('‚ùå Running from file:// - must use web server');
            } else {
                results.push('‚úÖ Running from web server');
            }
            
            // Check 2: Manifest
            try {
                const response = await fetch('manifest.json');
                if (response.ok) {
                    results.push('‚úÖ manifest.json found');
                } else {
                    results.push('‚ùå manifest.json not found (404)');
                }
            } catch (e) {
                results.push('‚ùå Cannot load manifest (CORS/Network)');
            }
            
            // Check 3: Sample topic
            try {
                const response = await fetch('physics/U4-AOS1-11-Comparing-Light-Matter.json');
                if (response.ok) {
                    results.push('‚úÖ Sample topic file found');
                } else {
                    results.push('‚ùå Sample topic file not found');
                }
            } catch (e) {
                results.push('‚ùå Cannot load topic files');
            }
            
            // Display results
            alert('Quick Diagnosis:\n\n' + results.join('\n'));
        }

        // Run all tests
        async function testAll() {
            console.log('Starting comprehensive tests...');
            
            testEnvironment();
            await new Promise(r => setTimeout(r, 300));
            
            await testManifest();
            await new Promise(r => setTimeout(r, 300));
            
            await validateManifest();
            await new Promise(r => setTimeout(r, 300));
            
            await testFileStructure();
            await new Promise(r => setTimeout(r, 300));
            
            await testFromAppPerspective();
            
            console.log('All tests completed!');
        }

        // Clear results
        function clearResults() {
            ['test1-result', 'test2-result', 'test3-result', 'test4-result', 
             'test5-result', 'test6-result', 'test7-result', 'console-log']
            .forEach(id => document.getElementById(id).innerHTML = '');
            
            console.log('Results cleared');
        }

        // Auto-run environment test
        window.onload = () => {
            testEnvironment();
            console.log('Debug tool ready. This is running from /youcantfakethis/ folder.');
            console.log('Click "Run All Tests" to start comprehensive testing.');
        };
    </script>
</body>
</html>