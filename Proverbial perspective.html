<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimist or Pessimist: Proverb Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .user-info {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .user-info input {
            padding: 10px 15px;
            border-radius: 25px;
            border: none;
            font-size: 1em;
            width: 200px;
            text-align: center;
        }

        .help-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .help-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: slideIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #000;
        }

        .modal h2 {
            color: #495057;
            margin-bottom: 20px;
        }

        .modal p {
            color: #6c757d;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        /* Tooltip styles */
        .tooltip {
            position: absolute;
            background: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            max-width: 250px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            line-height: 1.4;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 5px solid #333;
        }

        .quiz-container {
            padding: 30px;
        }

        .question {
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        .question-number {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .proverb-pair {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #5e72e4;
            color: white;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            transition: all 0.2s ease;
        }

        .info-icon:hover {
            background: #4c63d2;
            transform: translateY(-50%) scale(1.1);
        }

        .proverb-option {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px 50px 20px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: visible;
        }

        .proverb-option:hover {
            border-color: #5e72e4;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(94, 114, 228, 0.1);
        }

        .proverb-option.selected {
            border-color: #5e72e4;
            background: linear-gradient(135deg, #f3f4ff 0%, #eef1ff 100%);
        }

        .proverb-option.previously-selected {
            border: 3px solid #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .proverb-option input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .proverb-text {
            font-size: 1.2em;
            color: #212529;
            font-weight: 500;
            position: relative;
            padding-left: 30px;
        }

        .proverb-text::before {
            content: '"';
            position: absolute;
            left: 0;
            top: -5px;
            font-size: 2em;
            color: #5e72e4;
            opacity: 0.3;
        }

        .progress-bar {
            background: #e9ecef;
            height: 6px;
            border-radius: 3px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #5e72e4 0%, #825ee4 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 30px;
            gap: 10px;
        }

        .nav-left {
            display: flex;
            gap: 10px;
        }

        .nav-right {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(94, 114, 228, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #5e72e4;
            color: #5e72e4;
        }

        .btn-outline:hover {
            background: #5e72e4;
            color: white;
        }

        .results {
            display: none;
            padding: 40px;
            text-align: center;
        }

        .result-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .result-title {
            font-size: 2em;
            color: #212529;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .result-score {
            font-size: 1.2em;
            color: #6c757d;
            margin-bottom: 20px;
        }

        .result-description {
            color: #495057;
            line-height: 1.6;
            margin-bottom: 30px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .score-breakdown {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            color: #6c757d;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .score-value {
            font-size: 2em;
            font-weight: 700;
        }

        .optimist-score {
            color: #28a745;
        }

        .pessimist-score {
            color: #dc3545;
        }

        .cumulative-stats {
            background: #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .cumulative-stats h3 {
            color: #495057;
            margin-bottom: 15px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        /* All Answers Modal */
        .all-answers-modal {
            max-height: 80vh;
            overflow-y: auto;
        }

        .answer-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #5e72e4;
        }

        .answer-item.optimistic {
            border-left-color: #28a745;
        }

        .answer-item.pessimistic {
            border-left-color: #dc3545;
        }

        .answer-theme {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }

        .answer-choice {
            color: #212529;
            font-style: italic;
        }

        .btn-outline:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
            .header h1 {
                font-size: 2em;
            }
            
            .proverb-text {
                font-size: 1.1em;
            }
            
            .navigation {
                flex-direction: column-reverse;
                gap: 10px;
            }

            .nav-group {
                width: 100%;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9em;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="quizTitle">Glass Half Full or Half Empty</h1>
            <div class="user-info">
                <label style="color: white; margin-right: 10px;">Your Name (optional):</label>
                <input type="text" id="userName" placeholder="Enter your name" onchange="saveUserName()">
                <button class="help-btn" onclick="showHelp()">?</button>
            </div>
        </div>

        <div class="quiz-container" id="quizContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="questionContainer"></div>
            <div class="navigation">
                <div class="nav-left">
                    <button class="btn btn-secondary" onclick="previousQuestion()" id="prevBtn">Previous</button>
                    <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn" disabled>Next</button>
                </div>
                <div class="nav-right">
                    <button class="btn btn-outline" onclick="showAllAnswers()" id="seeAllBtn" style="display: none;">See All Answers</button>
                </div>
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <button class="btn btn-outline" onclick="showResults()" id="seeResultsBtn" disabled>See Results</button>
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <label style="cursor: pointer; color: #6c757d; font-size: 0.9em;">
                    <input type="checkbox" id="autoAdvanceCheckbox" onchange="toggleAutoAdvance()" style="margin-right: 5px;">
                    Auto-advance to next question
                </label>
            </div>
        </div>

        <div class="results" id="results">
            <div class="result-icon" id="resultIcon"></div>
            <h2 class="result-title" id="resultTitle"></h2>
            <p class="result-score" id="resultScore"></p>
            <p class="result-description" id="resultDescription"></p>
            <div class="score-breakdown">
                <div class="score-item">
                    <div class="score-label">Optimistic Choices</div>
                    <div class="score-value optimist-score" id="optimistCount">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Pessimistic Choices</div>
                    <div class="score-value pessimist-score" id="pessimistCount">0</div>
                </div>
            </div>
            <div class="cumulative-stats" id="cumulativeStats">
                <h3>Cumulative Statistics</h3>
                <p id="totalQuizzes">Total quizzes taken: 0</p>
                <p id="averageOptimism">Average optimism: 0%</p>
            </div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="resetQuiz()">Take Quiz Again</button>
                <button class="btn btn-danger" onclick="clearHistory()">Clear History</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeHelp()">&times;</span>
            <h2>How It Works</h2>
            <p>You'll be presented with 10 pairs of contrasting proverbs from a pool of 40 pairs. Each pair contains one optimistic and one pessimistic perspective on the same theme.</p>
            <p>Choose the proverb that resonates more with your worldview. Click the info icon (ℹ️) to see what each proverb means.</p>
            <p>Your previous selections will be highlighted with a blue border, but you can change your mind at any time.</p>
            <p>At the end, we'll calculate whether you lean more towards optimism or pessimism based on your choices. Your results are saved and contribute to cumulative statistics.</p>
            <p><strong>Note:</strong> Neither perspective is "right" or "wrong" - they simply reflect different ways of viewing the world.</p>
        </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip"></div>

    <!-- All Answers Modal -->
    <div id="allAnswersModal" class="modal">
        <div class="modal-content all-answers-modal">
            <span class="close-modal" onclick="closeAllAnswers()">&times;</span>
            <h2>Your Answers So Far</h2>
            <div id="answersContainer"></div>
        </div>
    </div>

    <script>
        // Title synonyms
        const titleSynonyms = [
            "Glass Half Full or Half Empty",
            "Sunny Side or Cloudy Day",
            "Silver Lining or Storm Cloud",
            "Bright Side or Dark Side",
            "Rose-Colored or Gray-Tinted",
            "Light Seeker or Shadow Finder",
            "Hope Springs or Doubt Lingers",
            "Dream Weaver or Reality Checker",
            "Possibility Thinker or Risk Assessor",
            "Star Gazer or Ground Watcher"
        ];

        // All 40 proverb pairs with meanings
        const allProverbPairs = [
            {
                theme: "Opportunity",
                optimistic: { text: "When one door closes, another opens", meaning: "New opportunities will always arise after setbacks" },
                pessimistic: { text: "Opportunity knocks but once", meaning: "You may only get one chance at something important" }
            },
            {
                theme: "Risk-taking",
                optimistic: { text: "Fortune favors the bold", meaning: "Taking risks often leads to rewards" },
                pessimistic: { text: "Better safe than sorry", meaning: "It's wiser to avoid risks than to regret them later" }
            },
            {
                theme: "Timing",
                optimistic: { text: "Good things come to those who wait", meaning: "Patience will eventually be rewarded" },
                pessimistic: { text: "Time and tide wait for no man", meaning: "Time passes quickly and opportunities can be missed" }
            },
            {
                theme: "Human Nature",
                optimistic: { text: "What goes around comes around", meaning: "Good deeds will be rewarded and bad deeds punished" },
                pessimistic: { text: "Nice guys finish last", meaning: "Being kind puts you at a disadvantage" }
            },
            {
                theme: "Change",
                optimistic: { text: "It's never too late to learn", meaning: "People can always grow and improve" },
                pessimistic: { text: "You can't teach an old dog new tricks", meaning: "People become set in their ways and resist change" }
            },
            {
                theme: "Relationships",
                optimistic: { text: "Absence makes the heart grow fonder", meaning: "Distance strengthens love and appreciation" },
                pessimistic: { text: "Out of sight, out of mind", meaning: "People forget about those who aren't present" }
            },
            {
                theme: "Adversity",
                optimistic: { text: "Every cloud has a silver lining", meaning: "Something good comes from every bad situation" },
                pessimistic: { text: "When it rains, it pours", meaning: "Bad things tend to happen all at once" }
            },
            {
                theme: "Progress",
                optimistic: { text: "Where there's a will, there's a way", meaning: "Determination can overcome any obstacle" },
                pessimistic: { text: "You can lead a horse to water, but you can't make it drink", meaning: "You can't force someone to do what's good for them" }
            },
            {
                theme: "Knowledge",
                optimistic: { text: "Knowledge is power", meaning: "Learning and understanding give you advantages" },
                pessimistic: { text: "Ignorance is bliss", meaning: "Sometimes it's happier not to know the truth" }
            },
            {
                theme: "Wealth",
                optimistic: { text: "The best things in life are free", meaning: "True happiness doesn't require money" },
                pessimistic: { text: "You get what you pay for", meaning: "Quality requires spending money" }
            },
            {
                theme: "Action",
                optimistic: { text: "Nothing ventured, nothing gained", meaning: "You must take risks to achieve rewards" },
                pessimistic: { text: "A bird in the hand is worth two in the bush", meaning: "It's better to keep what you have than risk it for more" }
            },
            {
                theme: "Persistence",
                optimistic: { text: "If at first you don't succeed, try, try again", meaning: "Persistence will eventually lead to success" },
                pessimistic: { text: "Know when to quit", meaning: "Sometimes it's wise to give up on lost causes" }
            },
            {
                theme: "Trust",
                optimistic: { text: "Give people the benefit of the doubt", meaning: "Assume the best in others until proven otherwise" },
                pessimistic: { text: "Once bitten, twice shy", meaning: "Past betrayals make future trust difficult" }
            },
            {
                theme: "Planning",
                optimistic: { text: "The journey of a thousand miles begins with a single step", meaning: "Great achievements start with small actions" },
                pessimistic: { text: "Look before you leap", meaning: "Consider consequences before acting" }
            },
            {
                theme: "Contentment",
                optimistic: { text: "Bloom where you are planted", meaning: "Make the best of your current situation" },
                pessimistic: { text: "The grass is always greener on the other side", meaning: "People always think others have it better" }
            },
            {
                theme: "Time",
                optimistic: { text: "Better late than never", meaning: "It's good to accomplish something even if delayed" },
                pessimistic: { text: "The early bird catches the worm", meaning: "Those who act first get the best opportunities" }
            },
            {
                theme: "Effort",
                optimistic: { text: "Many hands make light work", meaning: "Cooperation makes tasks easier" },
                pessimistic: { text: "Too many cooks spoil the broth", meaning: "Too many people involved creates problems" }
            },
            {
                theme: "Truth",
                optimistic: { text: "The truth will set you free", meaning: "Honesty brings liberation and peace" },
                pessimistic: { text: "Sometimes a white lie is kinder", meaning: "The truth can hurt more than it helps" }
            },
            {
                theme: "Life Philosophy",
                optimistic: { text: "Live life to the fullest", meaning: "Embrace every experience and opportunity" },
                pessimistic: { text: "Everything in moderation", meaning: "Excess in anything is harmful" }
            },
            {
                theme: "Success",
                optimistic: { text: "Shoot for the moon; even if you miss, you'll land among the stars", meaning: "Aim high and you'll achieve something great" },
                pessimistic: { text: "Don't bite off more than you can chew", meaning: "Taking on too much leads to failure" }
            },
            {
                theme: "Healing",
                optimistic: { text: "Time heals all wounds", meaning: "Emotional pain will fade with time" },
                pessimistic: { text: "Some scars never heal", meaning: "Some hurts stay with us forever" }
            },
            {
                theme: "Unity",
                optimistic: { text: "United we stand, divided we fall", meaning: "Working together makes us stronger" },
                pessimistic: { text: "Every man for himself", meaning: "You can only rely on yourself" }
            },
            {
                theme: "Justice",
                optimistic: { text: "Good triumphs over evil", meaning: "Right will prevail in the end" },
                pessimistic: { text: "No good deed goes unpunished", meaning: "Helping others often backfires" }
            },
            {
                theme: "Learning",
                optimistic: { text: "Every mistake is a learning opportunity", meaning: "Failures teach valuable lessons" },
                pessimistic: { text: "History repeats itself", meaning: "People never learn from past mistakes" }
            },
            {
                theme: "Hope",
                optimistic: { text: "It's always darkest before the dawn", meaning: "Things improve after hitting rock bottom" },
                pessimistic: { text: "Hope for the best, prepare for the worst", meaning: "Expect bad outcomes while wishing for good" }
            },
            {
                theme: "Character",
                optimistic: { text: "People can change", meaning: "Everyone has the capacity for growth" },
                pessimistic: { text: "A leopard can't change its spots", meaning: "People's basic nature never changes" }
            },
            {
                theme: "Fate",
                optimistic: { text: "You make your own luck", meaning: "Success comes from effort, not chance" },
                pessimistic: { text: "What will be, will be", meaning: "Fate controls outcomes regardless of effort" }
            },
            {
                theme: "Conflict",
                optimistic: { text: "Kill them with kindness", meaning: "Respond to negativity with positivity" },
                pessimistic: { text: "Fight fire with fire", meaning: "Match aggression with aggression" }
            },
            {
                theme: "Communication",
                optimistic: { text: "The pen is mightier than the sword", meaning: "Words and ideas are more powerful than violence" },
                pessimistic: { text: "Actions speak louder than words", meaning: "Talk is cheap without follow-through" }
            },
            {
                theme: "Ambition",
                optimistic: { text: "The sky's the limit", meaning: "There are no boundaries to what you can achieve" },
                pessimistic: { text: "Pride comes before a fall", meaning: "Ambition leads to downfall" }
            },
            {
                theme: "Preparation",
                optimistic: { text: "Practice makes perfect", meaning: "Continuous effort leads to mastery" },
                pessimistic: { text: "The best-laid plans of mice and men often go awry", meaning: "Even careful planning can fail" }
            },
            {
                theme: "Perspective",
                optimistic: { text: "Beauty is in the eye of the beholder", meaning: "Everyone finds value in different things" },
                pessimistic: { text: "All that glitters is not gold", meaning: "Appearances are often deceiving" }
            },
            {
                theme: "Independence",
                optimistic: { text: "God helps those who help themselves", meaning: "Self-reliance leads to success" },
                pessimistic: { text: "No man is an island", meaning: "Everyone needs help sometimes" }
            },
            {
                theme: "Experience",
                optimistic: { text: "Variety is the spice of life", meaning: "Different experiences make life enjoyable" },
                pessimistic: { text: "Better the devil you know", meaning: "Familiar problems are preferable to unknown ones" }
            },
            {
                theme: "Generosity",
                optimistic: { text: "It's better to give than to receive", meaning: "Generosity brings more joy than getting" },
                pessimistic: { text: "No good deed goes unpunished", meaning: "Being helpful often backfires" }
            },
            {
                theme: "Patience",
                optimistic: { text: "Slow and steady wins the race", meaning: "Consistent effort beats rushed attempts" },
                pessimistic: { text: "Strike while the iron is hot", meaning: "Delay means missed opportunities" }
            },
            {
                theme: "Forgiveness",
                optimistic: { text: "To err is human, to forgive divine", meaning: "Forgiveness is a noble virtue" },
                pessimistic: { text: "Fool me once, shame on you; fool me twice, shame on me", meaning: "Don't give second chances to those who betray you" }
            },
            {
                theme: "Simplicity",
                optimistic: { text: "Less is more", meaning: "Simplicity often yields better results" },
                pessimistic: { text: "The devil is in the details", meaning: "Small overlooked things cause big problems" }
            },
            {
                theme: "Intuition",
                optimistic: { text: "Follow your heart", meaning: "Trust your feelings to guide you" },
                pessimistic: { text: "The heart wants what it wants", meaning: "Emotions lead to poor decisions" }
            },
            {
                theme: "Resilience",
                optimistic: { text: "What doesn't kill you makes you stronger", meaning: "Hardships build character and strength" },
                pessimistic: { text: "The straw that broke the camel's back", meaning: "Everyone has a breaking point" }
            }
        ];

        // Quiz state - using localStorage
        let gameState = {
            selectedPairs: [],
            currentQuestion: 0,
            userAnswers: [],
            allAnswers: {}, // Store all answers ever given
            userName: '',
            history: {
                totalQuizzes: 0,
                totalOptimistic: 0,
                totalPessimistic: 0
            },
            autoAdvanceEnabled: true,
            autoAdvanceTimeout: null
        };

        // Load state from localStorage
        function loadState() {
            const savedState = localStorage.getItem('optimistPessimistQuizState');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                gameState.allAnswers = parsed.allAnswers || {};
                gameState.userName = parsed.userName || '';
                gameState.history = parsed.history || {
                    totalQuizzes: 0,
                    totalOptimistic: 0,
                    totalPessimistic: 0
                };
                gameState.autoAdvanceEnabled = parsed.autoAdvanceEnabled !== false;
            }
        }

        // Save state to localStorage
        function saveState() {
            const stateToSave = {
                allAnswers: gameState.allAnswers,
                userName: gameState.userName,
                history: gameState.history,
                autoAdvanceEnabled: gameState.autoAdvanceEnabled
            };
            localStorage.setItem('optimistPessimistQuizState', JSON.stringify(stateToSave));
        }

        // Tooltip handling
        let tooltipTimeout;
        let currentTooltip = null;

        function showTooltip(element, text) {
            const tooltip = document.getElementById('tooltip');
            const rect = element.getBoundingClientRect();
            
            tooltip.textContent = text;
            tooltip.style.left = rect.left + rect.width / 2 + 'px';
            tooltip.style.top = rect.bottom + 10 + 'px';
            tooltip.style.opacity = '1';
            
            // Adjust position if tooltip goes off screen
            const tooltipRect = tooltip.getBoundingClientRect();
            if (tooltipRect.right > window.innerWidth) {
                tooltip.style.left = (window.innerWidth - tooltipRect.width - 10) + 'px';
            }
            if (tooltipRect.left < 0) {
                tooltip.style.left = '10px';
            }
        }

        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.opacity = '0';
        }

        function setupTooltips() {
            const proverbOptions = document.querySelectorAll('.proverb-option');
            
            proverbOptions.forEach(option => {
                option.addEventListener('mouseenter', function() {
                    const meaning = this.getAttribute('data-meaning');
                    clearTimeout(tooltipTimeout);
                    tooltipTimeout = setTimeout(() => {
                        showTooltip(this, meaning);
                    }, 2000);
                });
                
                option.addEventListener('mouseleave', function() {
                    clearTimeout(tooltipTimeout);
                    hideTooltip();
                });
            });
        }

        // Modal functions
        function showHelp() {
            document.getElementById('helpModal').style.display = 'block';
        }

        function closeHelp() {
            document.getElementById('helpModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('helpModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
            const allAnswersModal = document.getElementById('allAnswersModal');
            if (event.target == allAnswersModal) {
                allAnswersModal.style.display = 'none';
            }
        }

        // User name handling
        function saveUserName() {
            gameState.userName = document.getElementById('userName').value;
            saveState();
        }

        // Initialize quiz
        function initializeQuiz() {
            // Load saved state
            loadState();
            
            // Set random title
            const randomTitle = titleSynonyms[Math.floor(Math.random() * titleSynonyms.length)];
            document.getElementById('quizTitle').textContent = randomTitle;
            
            // Load user name
            document.getElementById('userName').value = gameState.userName || '';
            
            // Create weighted selection favoring unanswered questions
            const answered = [];
            const unanswered = [];
            
            allProverbPairs.forEach((pair, index) => {
                if (gameState.allAnswers[index]) {
                    answered.push(pair);
                } else {
                    unanswered.push(pair);
                }
            });
            
            // Build selection pool with bias towards unanswered
            let selectionPool = [...unanswered, ...unanswered, ...unanswered]; // 3x weight for unanswered
            if (answered.length > 0) {
                selectionPool = [...selectionPool, ...answered]; // 1x weight for answered
            }
            
            // Shuffle and select 10
            const shuffled = selectionPool.sort(() => Math.random() - 0.5);
            const uniquePairs = [];
            const usedIndices = new Set();
            
            for (const pair of shuffled) {
                const index = allProverbPairs.indexOf(pair);
                if (!usedIndices.has(index) && uniquePairs.length < 10) {
                    uniquePairs.push(pair);
                    usedIndices.add(index);
                }
            }
            
            // If we still need more pairs, add from the full list
            if (uniquePairs.length < 10) {
                const remaining = allProverbPairs.filter((_, index) => !usedIndices.has(index));
                const additionalPairs = remaining.sort(() => Math.random() - 0.5).slice(0, 10 - uniquePairs.length);
                uniquePairs.push(...additionalPairs);
            }
            
            gameState.selectedPairs = uniquePairs;
            gameState.currentQuestion = 0;
            gameState.userAnswers = new Array(10).fill(null);
            
            displayQuestion();
            updateProgress();
            updateNavigation();
        }

        // Display current question
        function displayQuestion() {
            const container = document.getElementById('questionContainer');
            const pair = gameState.selectedPairs[gameState.currentQuestion];
            const pairIndex = allProverbPairs.indexOf(pair);
            const isFirstOptimistic = Math.random() > 0.5;
            
            // Check if user has previously answered this proverb pair
            const previousAnswer = gameState.allAnswers[pairIndex];
            
            container.innerHTML = `
                <div class="question" style="animation-delay: ${gameState.currentQuestion * 0.1}s">
                    <div class="question-number">Question ${gameState.currentQuestion + 1} of 10 - ${pair.theme}</div>
                    <div class="proverb-pair">
                        <label class="proverb-option ${gameState.userAnswers[gameState.currentQuestion] === (isFirstOptimistic ? 'optimistic' : 'pessimistic') ? 'selected' : ''} ${previousAnswer === (isFirstOptimistic ? 'optimistic' : 'pessimistic') ? 'previously-selected' : ''}"
                               data-meaning="${isFirstOptimistic ? pair.optimistic.meaning : pair.pessimistic.meaning}">
                            <input type="radio" name="q${gameState.currentQuestion}" value="${isFirstOptimistic ? 'optimistic' : 'pessimistic'}" 
                                ${gameState.userAnswers[gameState.currentQuestion] === (isFirstOptimistic ? 'optimistic' : 'pessimistic') ? 'checked' : ''}
                                onchange="selectAnswer(this.value, ${pairIndex})">
                            <div class="proverb-text">${isFirstOptimistic ? pair.optimistic.text : pair.pessimistic.text}</div>
                            <span class="info-icon" onclick="showMeaning(event, '${(isFirstOptimistic ? pair.optimistic.meaning : pair.pessimistic.meaning).replace(/'/g, "\\'")}')">ℹ️</span>
                        </label>
                        <label class="proverb-option ${gameState.userAnswers[gameState.currentQuestion] === (!isFirstOptimistic ? 'optimistic' : 'pessimistic') ? 'selected' : ''} ${previousAnswer === (!isFirstOptimistic ? 'optimistic' : 'pessimistic') ? 'previously-selected' : ''}"
                               data-meaning="${!isFirstOptimistic ? pair.optimistic.meaning : pair.pessimistic.meaning}">
                            <input type="radio" name="q${gameState.currentQuestion}" value="${!isFirstOptimistic ? 'optimistic' : 'pessimistic'}"
                                ${gameState.userAnswers[gameState.currentQuestion] === (!isFirstOptimistic ? 'optimistic' : 'pessimistic') ? 'checked' : ''}
                                onchange="selectAnswer(this.value, ${pairIndex})">
                            <div class="proverb-text">${!isFirstOptimistic ? pair.optimistic.text : pair.pessimistic.text}</div>
                            <span class="info-icon" onclick="showMeaning(event, '${(!isFirstOptimistic ? pair.optimistic.meaning : pair.pessimistic.meaning).replace(/'/g, "\\'")}')">ℹ️</span>
                        </label>
                    </div>
                </div>
            `;
            
            // Update button visibility
            const answeredCount = gameState.userAnswers.filter(a => a !== null).length;
            document.getElementById('seeResultsBtn').disabled = answeredCount < 10;
            
            // Check if user has answered at least half of ALL questions (20 out of 40)
            const totalAnswered = Object.keys(gameState.allAnswers).length;
            document.getElementById('seeAllBtn').style.display = totalAnswered >= 20 ? 'block' : 'none';
            
            // Update auto-advance checkbox state
            document.getElementById('autoAdvanceCheckbox').checked = gameState.autoAdvanceEnabled;
            
            setupTooltips();
        }

        // Show meaning when info icon is clicked
        function showMeaning(event, meaning) {
            event.stopPropagation();
            event.preventDefault();
            
            const tooltip = document.getElementById('tooltip');
            const icon = event.target;
            const rect = icon.getBoundingClientRect();
            
            tooltip.textContent = meaning;
            tooltip.style.left = rect.left - 200 + 'px';
            tooltip.style.top = rect.bottom + 10 + 'px';
            tooltip.style.opacity = '1';
            
            // Adjust position if tooltip goes off screen
            const tooltipRect = tooltip.getBoundingClientRect();
            if (tooltipRect.right > window.innerWidth) {
                tooltip.style.left = (window.innerWidth - tooltipRect.width - 10) + 'px';
            }
            if (tooltipRect.left < 0) {
                tooltip.style.left = '10px';
            }
            
            // Hide after 3 seconds or on next click
            setTimeout(() => hideTooltip(), 3000);
            
            // Add click listener to hide on next click
            setTimeout(() => {
                document.addEventListener('click', hideTooltip, { once: true });
            }, 100);
        }

        // Toggle auto-advance
        function toggleAutoAdvance() {
            gameState.autoAdvanceEnabled = document.getElementById('autoAdvanceCheckbox').checked;
            saveState();
            
            // If turning off, cancel any pending auto-advance
            if (!gameState.autoAdvanceEnabled && gameState.autoAdvanceTimeout) {
                clearTimeout(gameState.autoAdvanceTimeout);
                gameState.autoAdvanceTimeout = null;
            }
        }

        // Handle answer selection
        function selectAnswer(value, pairIndex) {
            // Cancel any existing timeout
            if (gameState.autoAdvanceTimeout) {
                clearTimeout(gameState.autoAdvanceTimeout);
                gameState.autoAdvanceTimeout = null;
            }
            
            gameState.userAnswers[gameState.currentQuestion] = value;
            gameState.allAnswers[pairIndex] = value;
            saveState();
            updateNavigation();
            
            // Update visual selection
            const options = document.querySelectorAll('.proverb-option');
            options.forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.proverb-option').classList.add('selected');
            
            // Update button visibility
            const answeredCount = gameState.userAnswers.filter(a => a !== null).length;
            document.getElementById('seeResultsBtn').disabled = answeredCount < 10;
            
            // Check if user has answered at least half of ALL questions (20 out of 40)
            const totalAnswered = Object.keys(gameState.allAnswers).length;
            document.getElementById('seeAllBtn').style.display = totalAnswered >= 20 ? 'block' : 'none';
            
            // Auto-advance if enabled
            if (gameState.autoAdvanceEnabled && gameState.currentQuestion < gameState.selectedPairs.length - 1) {
                gameState.autoAdvanceTimeout = setTimeout(() => {
                    nextQuestion();
                }, 1000);
            }
        }

        // Navigation functions
        function nextQuestion() {
            hideTooltip(); // Hide any open tooltips
            if (gameState.currentQuestion < gameState.selectedPairs.length - 1) {
                gameState.currentQuestion++;
                displayQuestion();
                updateProgress();
                updateNavigation();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            hideTooltip(); // Hide any open tooltips
            if (gameState.currentQuestion > 0) {
                gameState.currentQuestion--;
                displayQuestion();
                updateProgress();
                updateNavigation();
            }
        }

        // Update progress bar
        function updateProgress() {
            const progress = ((gameState.currentQuestion + 1) / gameState.selectedPairs.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Show all answers modal
        function showAllAnswers() {
            const container = document.getElementById('answersContainer');
            container.innerHTML = '';
            
            // Show all answers from gameState.allAnswers
            let count = 0;
            allProverbPairs.forEach((pair, index) => {
                if (gameState.allAnswers[index]) {
                    count++;
                    const answer = gameState.allAnswers[index];
                    const isOptimistic = answer === 'optimistic';
                    const chosenProverb = isOptimistic ? pair.optimistic.text : pair.pessimistic.text;
                    
                    const answerDiv = document.createElement('div');
                    answerDiv.className = `answer-item ${answer}`;
                    answerDiv.innerHTML = `
                        <div class="answer-theme">${pair.theme}</div>
                        <div class="answer-choice">"${chosenProverb}"</div>
                    `;
                    container.appendChild(answerDiv);
                }
            });
            
            // Add summary at top
            const summary = document.createElement('p');
            summary.style.marginBottom = '20px';
            summary.style.color = '#6c757d';
            summary.textContent = `You have answered ${count} out of 40 total proverb pairs.`;
            container.insertBefore(summary, container.firstChild);
            
            document.getElementById('allAnswersModal').style.display = 'block';
        }

        // Close all answers modal
        function closeAllAnswers() {
            document.getElementById('allAnswersModal').style.display = 'none';
        }

        // Update navigation buttons
        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.style.display = gameState.currentQuestion === 0 ? 'none' : 'block';
            nextBtn.disabled = !gameState.userAnswers[gameState.currentQuestion];
            
            // Don't show "See Results" text on Next button on last question
            if (gameState.currentQuestion === gameState.selectedPairs.length - 1) {
                nextBtn.textContent = 'Next';
            } else {
                nextBtn.textContent = 'Next';
            }
            
            // Update See Results button
            const answeredCount = gameState.userAnswers.filter(a => a !== null).length;
            document.getElementById('seeResultsBtn').disabled = answeredCount < 10;
            
            // Check if user has answered at least half of ALL questions (20 out of 40)
            const totalAnswered = Object.keys(gameState.allAnswers).length;
            document.getElementById('seeAllBtn').style.display = totalAnswered >= 20 ? 'block' : 'none';
        }

        // Show results
        function showResults() {
            // Check if all questions are answered
            if (!gameState.userAnswers.every(answer => answer !== null)) {
                alert('Please answer all 10 questions before seeing results.');
                return;
            }
            
            const optimistCount = gameState.userAnswers.filter(a => a === 'optimistic').length;
            const pessimistCount = gameState.userAnswers.filter(a => a === 'pessimistic').length;
            const percentage = (optimistCount / gameState.userAnswers.length) * 100;
            
            // Update history
            gameState.history.totalQuizzes++;
            gameState.history.totalOptimistic += optimistCount;
            gameState.history.totalPessimistic += pessimistCount;
            saveState();
            
            let title, description, icon;
            const userName = gameState.userName ? gameState.userName + ', you are' : 'You are';
            
            // 10 different buckets at 10% intervals
            if (percentage >= 90) {
                title = `${userName} an Eternal Optimist`;
                description = "You see sunshine in every storm. Your unwavering positive outlook illuminates even the darkest situations. You're the person others turn to for hope and encouragement.";
                icon = "☀️🌟";
            } else if (percentage >= 80) {
                title = `${userName} a Radiant Optimist`;
                description = "Your bright perspective lights up the room. You consistently find the positive angle and believe deeply in good outcomes. Your enthusiasm is contagious.";
                icon = "🌞😊";
            } else if (percentage >= 70) {
                title = `${userName} a Cheerful Optimist`;
                description = "You have a naturally sunny disposition. While aware of challenges, you choose to focus on possibilities and silver linings. Your positive energy uplifts those around you.";
                icon = "😄🌻";
            } else if (percentage >= 60) {
                title = `${userName} a Hopeful Optimist`;
                description = "You lean into hope and possibility. You balance awareness of reality with a preference for positive perspectives. Your outlook helps you navigate life with grace.";
                icon = "🌈😌";
            } else if (percentage >= 50) {
                title = `${userName} a Balanced Thinker`;
                description = "You walk the middle path with wisdom. You see both sides equally and choose your perspective based on the situation. Your balanced view helps you make thoughtful decisions.";
                icon = "⚖️🤝";
            } else if (percentage >= 40) {
                title = `${userName} a Practical Realist`;
                description = "You prefer facts over fantasies. Your grounded approach helps you prepare for various outcomes while staying open to possibilities. You value truth and practicality.";
                icon = "🎯🧭";
            } else if (percentage >= 30) {
                title = `${userName} a Cautious Realist`;
                description = "You believe in being prepared. Your careful consideration of potential challenges helps you navigate life successfully. You find strength in realistic expectations.";
                icon = "🛡️🔍";
            } else if (percentage >= 20) {
                title = `${userName} a Protective Thinker`;
                description = "You guard against disappointment wisely. Your cautious approach shields you and others from unnecessary risks. You find comfort in careful planning.";
                icon = "🏰🗿";
            } else if (percentage >= 10) {
                title = `${userName} a Strategic Pessimist`;
                description = "You excel at spotting potential issues. Your ability to anticipate problems makes you an excellent planner and problem-solver. You protect yourself and others through foresight.";
                icon = "♟️🎲";
            } else {
                title = `${userName} a Philosophical Pessimist`;
                description = "You embrace life's complexities. Your deep understanding of challenges gives you unique insights. You find meaning in acknowledging life's difficulties while still moving forward.";
                icon = "🌙💭";
            }
            
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            
            document.getElementById('resultIcon').textContent = icon;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultScore').textContent = `You chose optimistic proverbs ${optimistCount} out of 10 times (${percentage}%)`;
            document.getElementById('resultDescription').textContent = description;
            document.getElementById('optimistCount').textContent = optimistCount;
            document.getElementById('pessimistCount').textContent = pessimistCount;
            
            // Update cumulative stats
            const avgOptimism = Math.round((gameState.history.totalOptimistic / (gameState.history.totalOptimistic + gameState.history.totalPessimistic)) * 100);
            document.getElementById('totalQuizzes').textContent = `Total quizzes taken: ${gameState.history.totalQuizzes}`;
            document.getElementById('averageOptimism').textContent = `Average optimism: ${avgOptimism}%`;
        }

        // Reset quiz
        function resetQuiz() {
            document.getElementById('quizContainer').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            initializeQuiz();
        }

        // Clear history
        function clearHistory() {
            if (confirm('Are you sure you want to clear all your quiz history?')) {
                gameState.history = {
                    totalQuizzes: 0,
                    totalOptimistic: 0,
                    totalPessimistic: 0
                };
                gameState.allAnswers = {};
                saveState();
                alert('History cleared.');
                resetQuiz();
            }
        }

        // Start quiz on load
        window.onload = initializeQuiz;
    </script>
</body>
</html>