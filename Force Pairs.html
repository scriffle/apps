<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Force Pair Dynamics Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 8px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 8px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 4px;
            font-weight: 300;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .animation-section {
            background: #f8f9fa;
            padding: 12px 20px 16px;
            border: 2px solid #e9ecef;
            margin: 8px;
            border-radius: 8px;
        }

        #animationCanvas {
            width: 100%;
            height: 200px;
            position: relative;
            background: linear-gradient(to bottom, #e3f2fd 0%, #f5f5f5 100%);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 4px;
        }

        .origin-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 1px;
            border-left: 1px dotted #999;
            opacity: 0.5;
            pointer-events: none;
        }

        .block {
            position: absolute;
            bottom: 0;
            border-radius: 4px;
            transition: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            transform-origin: center bottom;
        }

        #block1 {
            background: linear-gradient(135deg, #FF6B6B, #FF5252);
            box-shadow: 0 4px 8px rgba(255, 107, 107, 0.3);
        }

        #block2 {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            box-shadow: 0 4px 8px rgba(78, 205, 196, 0.3);
        }

        .physics-label {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7em;
            color: #333;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 3px;
            white-space: nowrap;
            margin-bottom: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .physics-label.velocity {
            bottom: calc(100% + 20px);
        }

        .physics-label.edge-stuck {
            position: fixed;
            bottom: auto;
            top: auto;
        }

        .spring {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform: translate(-50%, 50%);
            width: 60px;
            height: 20px;
            opacity: 0;
            pointer-events: none;
            z-index: 5;
        }

        .spring svg {
            width: 100%;
            height: 100%;
        }

        .spring.active {
            animation: springCompress 0.5s ease-in-out;
        }

        @keyframes springCompress {
            0% {
                width: 60px;
                opacity: 1;
            }
            25% {
                width: 30px;
                opacity: 1;
            }
            50% {
                width: 40px;
                opacity: 1;
            }
            75% {
                width: 35px;
                opacity: 1;
            }
            100% {
                width: 60px;
                opacity: 1;
            }
        }

        .force-arrows {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform: translate(-50%, 50%);
            width: 200px;
            height: 40px;
            pointer-events: none;
        }

        .arrow {
            position: absolute;
            height: 4px;
            background: #FF5722;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: none;
        }

        .arrow::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            top: 50%;
            transform: translateY(-50%);
        }

        .arrow-left {
            right: 55%;
            width: 40%;
            transform-origin: right center;
        }

        .arrow-left::after {
            border-width: 8px 12px 8px 0;
            border-color: transparent #FF5722 transparent transparent;
            left: -12px;
        }

        .arrow-right {
            left: 55%;
            width: 40%;
            transform-origin: left center;
        }

        .arrow-right::after {
            border-width: 8px 0 8px 12px;
            border-color: transparent transparent transparent #FF5722;
            right: -12px;
        }

        .surface-line {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #333;
        }

        .meter-scale {
            height: 25px;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            font-size: 0.75em;
            color: #666;
            background: rgba(0,0,0,0.02);
            border-radius: 0 0 4px 4px;
            margin-bottom: 12px;
        }

        .meter-scale span {
            position: relative;
        }

        .meter-scale span::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 1px;
            height: 5px;
            background: #999;
        }

        .control-buttons {
            display: flex;
            gap: 8px;
            width: 100%;
        }

        .control-buttons button {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .animate-btn {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
        }

        .animate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(78, 205, 196, 0.3);
        }

        .pause-btn {
            background: linear-gradient(135deg, #FFA726, #FF7043);
        }

        .pause-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 167, 38, 0.3);
        }

        .reset-btn {
            background: linear-gradient(135deg, #EF5350, #E53935);
        }

        .reset-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(239, 83, 80, 0.3);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .scale-option {
            margin-top: 8px;
            padding: 8px;
            background: #e9ecef;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .scale-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 0 8px 8px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        .input-section h2 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
            margin-bottom: 4px;
        }

        .input-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-controls input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .input-controls input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4ECDC4;
            cursor: pointer;
            transition: all 0.2s;
        }

        .input-controls input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 2px 8px rgba(78, 205, 196, 0.4);
        }

        .input-controls input[type="number"] {
            width: 80px;
            padding: 6px 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.9em;
            text-align: center;
        }

        .input-controls input[type="number"]:focus {
            border-color: #4ECDC4;
            outline: none;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        .unit {
            color: #666;
            font-weight: normal;
            font-size: 0.9em;
            min-width: 25px;
        }

        .preset-controls {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid #dee2e6;
        }

        .preset-controls select {
            flex: 1;
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.9em;
            background: white;
            cursor: pointer;
        }

        .preset-controls select:focus {
            border-color: #4ECDC4;
            outline: none;
        }

        .randomize-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .randomize-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
        }

        .calculations-section {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            max-height: 500px;
            overflow-y: auto;
        }

        .calculations-section h2 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .calc-block {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            margin-bottom: 12px;
        }

        .calc-block h3 {
            font-size: 1em;
            margin-bottom: 8px;
        }

        .calc-block.red h3 {
            color: #FF6B6B;
        }

        .calc-block.teal h3 {
            color: #4ECDC4;
        }

        .calc-step {
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            line-height: 1.8;
            color: #333;
            margin: 4px 0;
            padding-left: 10px;
        }

        .calc-step.formula {
            color: #666;
            font-style: italic;
        }

        .calc-step.result {
            font-weight: bold;
            color: #000;
            background: #f0f8ff;
            padding: 4px 10px;
            border-radius: 4px;
            margin-top: 6px;
        }

        .physics-note {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 6px;
            margin-top: 12px;
            font-size: 0.85em;
            color: #2e7d32;
        }

        /* Scrollbar styling */
        .calculations-section::-webkit-scrollbar {
            width: 8px;
        }

        .calculations-section::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .calculations-section::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .calculations-section::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.4em;
            }
            
            .calculations-section {
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Force Pair Dynamics Calculator</h1>
            <p>Newton's Third Law: Equal Forces, Different Accelerations</p>
        </div>

        <div class="animation-section">
            <div id="animationCanvas">
                <div class="origin-line"></div>
                <div class="block" id="block1">
                    m₁
                    <div class="physics-label velocity" id="vel1Label">v: 0.00 m/s</div>
                    <div class="physics-label" id="acc1Label">a: 0.00 m/s²</div>
                </div>
                <div class="block" id="block2">
                    m₂
                    <div class="physics-label velocity" id="vel2Label">v: 0.00 m/s</div>
                    <div class="physics-label" id="acc2Label">a: 0.00 m/s²</div>
                </div>
                <div class="force-arrows">
                    <div class="arrow arrow-left"></div>
                    <div class="arrow arrow-right"></div>
                </div>
                <div class="spring" id="spring">
                    <svg viewBox="0 0 60 20">
                        <path d="M 5 10 L 10 5 L 15 15 L 20 5 L 25 15 L 30 5 L 35 15 L 40 5 L 45 15 L 50 5 L 55 10" 
                              stroke="#FF5722" 
                              stroke-width="3" 
                              fill="none"/>
                    </svg>
                </div>
                <div class="surface-line"></div>
            </div>
            <div class="meter-scale" id="meterScale">
                <span>-5m</span>
                <span>-2.5m</span>
                <span>0</span>
                <span>2.5m</span>
                <span>5m</span>
            </div>
            <div class="control-buttons">
                <button class="animate-btn" id="animateBtn" onclick="startAnimation()">Start Animation</button>
                <button class="pause-btn" id="pauseBtn" onclick="pauseAnimation()" disabled>Pause</button>
                <button class="reset-btn" id="resetBtn" onclick="resetAnimation()">Reset</button>
            </div>
            <div class="scale-option">
                <input type="checkbox" id="autoScale" onchange="updateScaleMode()">
                <label for="autoScale">Auto-scale view to keep both blocks visible</label>
            </div>
        </div>

        <div class="main-content">
            <div class="left-column">
                <div class="input-section">
                    <h2>System Parameters</h2>
                    
                    <div class="input-group">
                        <label for="mass1">Mass 1 (m₁)</label>
                        <div class="input-controls">
                            <input type="range" id="mass1Slider" min="1" max="1200" value="100" oninput="updateFromSlider('mass1')">
                            <input type="number" id="mass1Input" min="1" max="1200" value="100" oninput="updateFromInput('mass1')">
                            <span class="unit">kg</span>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="mass2">Mass 2 (m₂)</label>
                        <div class="input-controls">
                            <input type="range" id="mass2Slider" min="1" max="1200" value="300" oninput="updateFromSlider('mass2')">
                            <input type="number" id="mass2Input" min="1" max="1200" value="300" oninput="updateFromInput('mass2')">
                            <span class="unit">kg</span>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="force">Force Magnitude</label>
                        <div class="input-controls">
                            <input type="range" id="forceSlider" min="100" max="10000" value="1200" step="100" oninput="updateFromSlider('force')">
                            <input type="number" id="forceInput" min="100" max="10000" value="1200" step="100" oninput="updateFromInput('force')">
                            <span class="unit">N</span>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="duration">Force Duration</label>
                        <div class="input-controls">
                            <input type="range" id="durationSlider" min="0.1" max="1.0" value="0.5" step="0.05" oninput="updateFromSlider('duration')">
                            <input type="number" id="durationInput" min="0.1" max="1.0" value="0.5" step="0.05" oninput="updateFromInput('duration')">
                            <span class="unit">s</span>
                        </div>
                    </div>
                    
                    <div class="preset-controls">
                        <select id="presetSelect" onchange="loadPreset()">
                            <option value="">Select a preset...</option>
                            <option value="equal">Equal Masses</option>
                            <option value="feather-bowling">Feather vs Bowling Ball</option>
                            <option value="car-truck">Car vs Truck</option>
                            <option value="extreme-light">Extreme Light Mass</option>
                            <option value="extreme-heavy">Extreme Heavy Mass</option>
                            <option value="high-force">High Force Impact</option>
                            <option value="low-force">Gentle Push</option>
                            <option value="long-duration">Long Duration Force</option>
                            <option value="short-burst">Short Burst</option>
                            <option value="maximum">Maximum Values</option>
                        </select>
                        <button class="randomize-btn" onclick="randomizeValues()">Randomize</button>
                    </div>
                </div>
            </div>

            <div class="right-column">
                <div class="calculations-section">
                    <h2>Step-by-Step Calculations</h2>
                    
                    <div class="calc-block red">
                        <h3>Mass 1 (Red Block - Moving Left)</h3>
                        <div id="calc1Content">
                            <!-- Content will be filled by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="calc-block teal">
                        <h3>Mass 2 (Teal Block - Moving Right)</h3>
                        <div id="calc2Content">
                            <!-- Content will be filled by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="physics-note" id="physicsNote">
                        <!-- Content will be filled by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let animationInProgress = false;
        let animationPaused = false;
        let animationStartTime = null;
        let pausedTime = 0;
        let animationFrame = null;
        let currentPhase = 'waiting'; // 'waiting', 'force', 'coasting'
        let autoScale = false;
        let currentScale = 1;
        let baseBlockSizes = { block1: 50, block2: 50 };
        
        // Physics values storage
        let physicsData = {
            mass1: 100,
            mass2: 300,
            force: 1200,
            duration: 0.5,
            acc1: 0,
            acc2: 0,
            vel1: 0,
            vel2: 0,
            maxDistance: 5 // meters visible on screen at scale 1
        };
        
        // Preset configurations
        const presets = {
            'equal': { mass1: 100, mass2: 100, force: 1000, duration: 0.5, name: 'Equal Masses' },
            'feather-bowling': { mass1: 1, mass2: 7, force: 200, duration: 0.3, name: 'Feather vs Bowling Ball' },
            'car-truck': { mass1: 1000, mass2: 5000, force: 8000, duration: 0.6, name: 'Car vs Truck Collision' },
            'extreme-light': { mass1: 1, mass2: 500, force: 1000, duration: 0.4, name: 'Extreme Light vs Normal' },
            'extreme-heavy': { mass1: 50, mass2: 1200, force: 5000, duration: 0.7, name: 'Normal vs Extreme Heavy' },
            'high-force': { mass1: 200, mass2: 300, force: 10000, duration: 0.2, name: 'High Force Impact' },
            'low-force': { mass1: 150, mass2: 250, force: 100, duration: 1.0, name: 'Gentle Push' },
            'long-duration': { mass1: 80, mass2: 120, force: 500, duration: 1.0, name: 'Long Duration Force' },
            'short-burst': { mass1: 100, mass2: 200, force: 5000, duration: 0.1, name: 'Short Burst' },
            'maximum': { mass1: 1200, mass2: 1200, force: 10000, duration: 1.0, name: 'Maximum Values' }
        };
        
        function loadPreset() {
            const select = document.getElementById('presetSelect');
            const presetKey = select.value;
            
            if (!presetKey) return;
            
            const preset = presets[presetKey];
            if (preset) {
                // Update all values
                updateValue('mass1', preset.mass1);
                updateValue('mass2', preset.mass2);
                updateValue('force', preset.force);
                updateValue('duration', preset.duration);
                
                // Reset animation
                resetAnimation();
            }
        }
        
        function randomizeValues() {
            // Generate random values within reasonable ranges
            const randomMass1 = Math.floor(Math.random() * 1000) + 10; // 10-1010 kg
            const randomMass2 = Math.floor(Math.random() * 1000) + 10; // 10-1010 kg
            const randomForce = Math.floor(Math.random() * 9000) + 500; // 500-9500 N
            const randomDuration = (Math.random() * 0.8 + 0.2).toFixed(2); // 0.2-1.0 s
            
            updateValue('mass1', randomMass1);
            updateValue('mass2', randomMass2);
            updateValue('force', randomForce);
            updateValue('duration', parseFloat(randomDuration));
            
            // Clear preset selection
            document.getElementById('presetSelect').value = '';
            
            // Reset animation
            resetAnimation();
        }
        
        function updateValue(param, value) {
            const slider = document.getElementById(param + 'Slider');
            const input = document.getElementById(param + 'Input');
            
            slider.value = value;
            input.value = value;
            physicsData[param] = value;
            
            calculate();
        }
        
        function updateScaleMode() {
            autoScale = document.getElementById('autoScale').checked;
            if (!animationInProgress) {
                currentScale = 1;
                updateMeterScale();
            }
        }
        
        function updateMeterScale() {
            const meterScale = document.getElementById('meterScale');
            const visibleRange = physicsData.maxDistance * currentScale;
            
            // Generate 5 evenly spaced marks
            const marks = [];
            for (let i = 0; i < 5; i++) {
                const value = -visibleRange + (i * visibleRange * 2 / 4);
                const displayValue = Math.abs(value) < 0.01 ? '0' : 
                    Math.abs(value) >= 10 ? value.toFixed(0) : value.toFixed(1);
                marks.push(`<span>${displayValue}m</span>`);
            }
            
            meterScale.innerHTML = marks.join('');
        }
        
        function updateFromSlider(param) {
            const slider = document.getElementById(param + 'Slider');
            const input = document.getElementById(param + 'Input');
            input.value = slider.value;
            physicsData[param] = parseFloat(slider.value);
            calculate();
            // Reset animation when values change
            resetAnimation();
        }
        
        function updateFromInput(param) {
            const slider = document.getElementById(param + 'Slider');
            const input = document.getElementById(param + 'Input');
            const value = parseFloat(input.value);
            
            // Clamp to valid range
            const min = parseFloat(slider.min);
            const max = parseFloat(slider.max);
            const clampedValue = Math.max(min, Math.min(max, value));
            
            input.value = clampedValue;
            slider.value = clampedValue;
            physicsData[param] = clampedValue;
            calculate();
            // Reset animation when values change
            resetAnimation();
        }
        
        function calculate() {
            const { mass1, mass2, force, duration } = physicsData;
            
            // Calculate accelerations (Newton's Second Law: F = ma, so a = F/m)
            physicsData.acc1 = -force / mass1;  // Negative for leftward
            physicsData.acc2 = force / mass2;   // Positive for rightward
            
            // Calculate final velocities (v = at)
            physicsData.vel1 = physicsData.acc1 * duration;
            physicsData.vel2 = physicsData.acc2 * duration;
            
            // Calculate distances
            const dist1During = 0.5 * physicsData.acc1 * duration * duration;
            const dist2During = 0.5 * physicsData.acc2 * duration * duration;
            
            // Update calculations display for Mass 1
            document.getElementById('calc1Content').innerHTML = `
                <div class="calc-step formula">F₁ = -F = -${force} N (leftward)</div>
                <div class="calc-step">a₁ = F₁/m₁ = -${force}/${mass1}</div>
                <div class="calc-step result">a₁ = ${physicsData.acc1.toFixed(2)} m/s²</div>
                <div class="calc-step">v₁ = a₁ × t = ${physicsData.acc1.toFixed(2)} × ${duration}</div>
                <div class="calc-step result">v₁ = ${physicsData.vel1.toFixed(2)} m/s</div>
                <div class="calc-step">Distance during force: s₁ = ½a₁t²</div>
                <div class="calc-step">s₁ = ½ × ${physicsData.acc1.toFixed(2)} × ${duration}²</div>
                <div class="calc-step result">s₁ = ${dist1During.toFixed(3)} m</div>
            `;
            
            // Update calculations display for Mass 2
            document.getElementById('calc2Content').innerHTML = `
                <div class="calc-step formula">F₂ = +F = +${force} N (rightward)</div>
                <div class="calc-step">a₂ = F₂/m₂ = ${force}/${mass2}</div>
                <div class="calc-step result">a₂ = ${physicsData.acc2.toFixed(2)} m/s²</div>
                <div class="calc-step">v₂ = a₂ × t = ${physicsData.acc2.toFixed(2)} × ${duration}</div>
                <div class="calc-step result">v₂ = ${physicsData.vel2.toFixed(2)} m/s</div>
                <div class="calc-step">Distance during force: s₂ = ½a₂t²</div>
                <div class="calc-step">s₂ = ½ × ${physicsData.acc2.toFixed(2)} × ${duration}²</div>
                <div class="calc-step result">s₂ = ${dist2During.toFixed(3)} m</div>
            `;
            
            // Check momentum conservation
            const momentum1 = mass1 * physicsData.vel1;
            const momentum2 = mass2 * physicsData.vel2;
            const totalMomentum = momentum1 + momentum2;
            
            // Update physics note
            document.getElementById('physicsNote').innerHTML = `
                <strong>Key Physics:</strong> The forces are equal and opposite (F₁ = -F₂), but the accelerations are inversely proportional to mass. The lighter object accelerates more!<br>
                <strong>Momentum Check:</strong> p₁ = ${momentum1.toFixed(1)} kg·m/s, p₂ = ${momentum2.toFixed(1)} kg·m/s<br>
                <strong>Total:</strong> p₁ + p₂ = ${totalMomentum.toFixed(1)} kg·m/s ≈ 0 (conserved)
            `;
            
            updateBlockSizes();
        }
        
        function updateBlockSizes() {
            const block1 = document.getElementById('block1');
            const block2 = document.getElementById('block2');
            
            // Calculate base sizes based on cube root of mass (for volume)
            const baseSize = 30;
            const maxSize = 80;
            baseBlockSizes.block1 = Math.min(maxSize, baseSize + (Math.pow(physicsData.mass1, 1/3) * 2));
            baseBlockSizes.block2 = Math.min(maxSize, baseSize + (Math.pow(physicsData.mass2, 1/3) * 2));
            
            block1.style.width = `${baseBlockSizes.block1}px`;
            block1.style.height = `${baseBlockSizes.block1}px`;
            block2.style.width = `${baseBlockSizes.block2}px`;
            block2.style.height = `${baseBlockSizes.block2}px`;
            
            // Update labels - must use innerHTML to update the text content only
            block1.innerHTML = `${physicsData.mass1}kg<div class="physics-label velocity" id="vel1Label">v: 0.00 m/s</div><div class="physics-label" id="acc1Label">a: 0.00 m/s²</div>`;
            block2.innerHTML = `${physicsData.mass2}kg<div class="physics-label velocity" id="vel2Label">v: 0.00 m/s</div><div class="physics-label" id="acc2Label">a: 0.00 m/s²</div>`;
            
            if (!animationInProgress) {
                resetAnimation();
            }
        }
        
        function getBlockPositions(elapsed) {
            const canvas = document.getElementById('animationCanvas');
            const canvasWidth = canvas.offsetWidth;
            const centerX = canvasWidth / 2;
            const pixelsPerMeter = canvasWidth / (2 * physicsData.maxDistance);
            
            let pos1, pos2;
            
            if (elapsed <= physicsData.duration * 1000) {
                // During force application
                const t = elapsed / 1000;
                pos1 = centerX + (0.5 * physicsData.acc1 * t * t) * pixelsPerMeter / currentScale;
                pos2 = centerX + (0.5 * physicsData.acc2 * t * t) * pixelsPerMeter / currentScale;
            } else {
                // After force stops - constant velocity
                const t = physicsData.duration;
                const tAfter = (elapsed / 1000) - physicsData.duration;
                
                const dist1During = 0.5 * physicsData.acc1 * t * t;
                const dist2During = 0.5 * physicsData.acc2 * t * t;
                
                pos1 = centerX + (dist1During + physicsData.vel1 * tAfter) * pixelsPerMeter / currentScale;
                pos2 = centerX + (dist2During + physicsData.vel2 * tAfter) * pixelsPerMeter / currentScale;
            }
            
            return { pos1, pos2 };
        }
        
        function updateDynamicScale(pos1, pos2, block1Width, block2Width) {
            if (!autoScale) return;
            
            const canvas = document.getElementById('animationCanvas');
            const canvasWidth = canvas.offsetWidth;
            const centerX = canvasWidth / 2;
            const margin = 20; // pixels margin from edge
            
            // Calculate how far blocks are from center in meters
            const pixelsPerMeter = canvasWidth / (2 * physicsData.maxDistance);
            const dist1FromCenter = Math.abs(pos1 - centerX) / pixelsPerMeter * currentScale;
            const dist2FromCenter = Math.abs(pos2 - centerX) / pixelsPerMeter * currentScale;
            
            // Find the maximum distance that needs to be visible
            const maxDist = Math.max(dist1FromCenter, dist2FromCenter);
            
            // Calculate required scale to fit
            const availableHalfWidth = (canvasWidth / 2 - margin - Math.max(block1Width, block2Width) / 2);
            const requiredScale = (maxDist * pixelsPerMeter) / availableHalfWidth;
            
            // Smooth scaling with smaller increments for less jumping
            const targetScale = requiredScale * 1.1; // 10% buffer
            const scaleDiff = targetScale - currentScale;
            
            if (targetScale > currentScale) {
                // Gradually increase scale with smaller steps
                currentScale += scaleDiff * 0.15; // Smooth transition
                currentScale = Math.min(currentScale, 50); // max scale 50
                updateMeterScale();
            }
        }
        
        function animate(timestamp) {
            if (!animationStartTime) animationStartTime = timestamp;
            
            const elapsed = timestamp - animationStartTime + pausedTime;
            const { pos1, pos2 } = getBlockPositions(elapsed);
            
            const block1 = document.getElementById('block1');
            const block2 = document.getElementById('block2');
            const block1Width = parseFloat(block1.style.width) || 50;
            const block2Width = parseFloat(block2.style.width) || 50;
            
            // Update dynamic scaling
            updateDynamicScale(pos1, pos2, block1Width, block2Width);
            
            // Apply scaled block sizes
            const minSize = 40; // minimum visible size - increased for better visibility
            const scaledSize1 = Math.max(minSize, baseBlockSizes.block1 / Math.sqrt(currentScale));
            const scaledSize2 = Math.max(minSize, baseBlockSizes.block2 / Math.sqrt(currentScale));
            
            block1.style.width = `${scaledSize1}px`;
            block1.style.height = `${scaledSize1}px`;
            block2.style.width = `${scaledSize2}px`;
            block2.style.height = `${scaledSize2}px`;
            
            // Update positions
            block1.style.left = `${pos1 - scaledSize1 - 5}px`;
            block2.style.left = `${pos2 + 5}px`;
            
            // Update physics labels
            const t = elapsed / 1000;
            let v1, v2, a1, a2;
            
            if (t <= physicsData.duration) {
                // During acceleration phase
                a1 = physicsData.acc1;
                a2 = physicsData.acc2;
                v1 = a1 * t;
                v2 = a2 * t;
            } else {
                // After acceleration phase - constant velocity
                a1 = 0;
                a2 = 0;
                v1 = physicsData.vel1;
                v2 = physicsData.vel2;
            }
            
            // Update velocity and acceleration labels
            const vel1Label = document.getElementById('vel1Label');
            const vel2Label = document.getElementById('vel2Label');
            const acc1Label = document.getElementById('acc1Label');
            const acc2Label = document.getElementById('acc2Label');
            
            vel1Label.textContent = `v: ${v1.toFixed(2)} m/s`;
            vel2Label.textContent = `v: ${v2.toFixed(2)} m/s`;
            acc1Label.textContent = `a: ${a1.toFixed(2)} m/s²`;
            acc2Label.textContent = `a: ${a2.toFixed(2)} m/s²`;
            
            // Show/hide acceleration labels based on phase
            acc1Label.style.display = (a1 !== 0) ? 'block' : 'none';
            acc2Label.style.display = (a2 !== 0) ? 'block' : 'none';
            
            // Handle velocity labels when blocks go off screen
            const canvas = document.getElementById('animationCanvas');
            const canvasRect = canvas.getBoundingClientRect();
            
            // Check if blocks are off screen and stick velocity labels
            if (pos1 - scaledSize1 < 0) {
                vel1Label.classList.add('edge-stuck');
                vel1Label.style.position = 'absolute';
                vel1Label.style.left = '10px';
                vel1Label.style.top = `${canvasRect.top + 20}px`;
            } else {
                vel1Label.classList.remove('edge-stuck');
                vel1Label.style.position = '';
                vel1Label.style.left = '';
                vel1Label.style.top = '';
            }
            
            if (pos2 + scaledSize2 > canvas.offsetWidth) {
                vel2Label.classList.add('edge-stuck');
                vel2Label.style.position = 'absolute';
                vel2Label.style.right = '10px';
                vel2Label.style.left = 'auto';
                vel2Label.style.top = `${canvasRect.top + 20}px`;
            } else {
                vel2Label.classList.remove('edge-stuck');
                vel2Label.style.position = '';
                vel2Label.style.right = '';
                vel2Label.style.left = '';
                vel2Label.style.top = '';
            }
            
            // Check if BOTH blocks have reached edges
            const block1AtEdge = pos1 - scaledSize1 <= 0;
            const block2AtEdge = pos2 + scaledSize2 >= canvas.offsetWidth;
            
            if (block1AtEdge && block2AtEdge) {
                // Animation complete
                animationInProgress = false;
                document.getElementById('pauseBtn').disabled = true;
                return;
            }
            
            // Update phase
            if (elapsed <= physicsData.duration * 1000) {
                currentPhase = 'force';
            } else {
                currentPhase = 'coasting';
            }
            
            // Continue animation
            if (animationInProgress && !animationPaused) {
                animationFrame = requestAnimationFrame(animate);
            }
        }
        
        function startAnimation() {
            // Always allow starting/restarting animation
            if (animationInProgress && !animationPaused) {
                // If already running, restart
                resetAnimation();
                setTimeout(() => startAnimation(), 100);
                return;
            }
            
            if (animationPaused) {
                // Resume from pause
                animationPaused = false;
                document.getElementById('pauseBtn').textContent = 'Pause';
                animationFrame = requestAnimationFrame(animate);
                return;
            }
            
            // Start new animation
            animationInProgress = true;
            animationPaused = false;
            animationStartTime = null;
            pausedTime = 0;
            currentPhase = 'force';
            currentScale = 1;
            updateMeterScale();
            
            document.getElementById('pauseBtn').disabled = false;
            
            const canvas = document.getElementById('animationCanvas');
            
            // Show force arrows and spring
            const arrows = canvas.querySelectorAll('.arrow');
            const spring = document.getElementById('spring');
            
            // Show spring compression
            spring.style.opacity = '1';
            spring.classList.add('active');
            
            // Show arrows at full opacity for the entire duration
            arrows.forEach(arrow => {
                arrow.style.opacity = '1';
            });
            
            // Hide arrows and spring after force duration
            setTimeout(() => {
                arrows.forEach(arrow => {
                    arrow.style.opacity = '0';
                    arrow.style.transition = 'opacity 0.1s ease-out';
                });
                spring.style.opacity = '0';
                spring.classList.remove('active');
            }, physicsData.duration * 1000);
            
            // Start physics animation
            setTimeout(() => {
                animationFrame = requestAnimationFrame(animate);
            }, 100);
        }
        
        function pauseAnimation() {
            if (!animationInProgress || !animationFrame) return;
            
            if (animationPaused) {
                // Resume
                animationPaused = false;
                document.getElementById('pauseBtn').textContent = 'Pause';
                animationFrame = requestAnimationFrame(animate);
            } else {
                // Pause
                animationPaused = true;
                pausedTime += performance.now() - animationStartTime;
                animationStartTime = null;
                document.getElementById('pauseBtn').textContent = 'Resume';
                cancelAnimationFrame(animationFrame);
            }
        }
        
        function resetAnimation() {
            // Cancel any ongoing animation
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
                animationFrame = null;
            }
            
            animationInProgress = false;
            animationPaused = false;
            animationStartTime = null;
            pausedTime = 0;
            currentPhase = 'waiting';
            currentScale = 1;
            updateMeterScale();
            
            // Reset button states
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('pauseBtn').textContent = 'Pause';
            
            const block1 = document.getElementById('block1');
            const block2 = document.getElementById('block2');
            const canvas = document.getElementById('animationCanvas');
            
            // Reset block sizes
            block1.style.width = `${baseBlockSizes.block1}px`;
            block1.style.height = `${baseBlockSizes.block1}px`;
            block2.style.width = `${baseBlockSizes.block2}px`;
            block2.style.height = `${baseBlockSizes.block2}px`;
            
            // Position blocks at center
            const canvasWidth = canvas.offsetWidth;
            const centerX = canvasWidth / 2;
            const block1Width = parseFloat(block1.style.width) || 50;
            const block2Width = parseFloat(block2.style.width) || 50;
            
            block1.style.left = `${centerX - block1Width - 5}px`;
            block2.style.left = `${centerX + 5}px`;
            
            // Reset velocity and acceleration labels
            const vel1Label = document.getElementById('vel1Label');
            const vel2Label = document.getElementById('vel2Label');
            const acc1Label = document.getElementById('acc1Label');
            const acc2Label = document.getElementById('acc2Label');
            
            if (vel1Label) {
                vel1Label.textContent = 'v: 0.00 m/s';
                vel1Label.classList.remove('edge-stuck');
                vel1Label.style.position = '';
                vel1Label.style.left = '';
                vel1Label.style.top = '';
            }
            if (vel2Label) {
                vel2Label.textContent = 'v: 0.00 m/s';
                vel2Label.classList.remove('edge-stuck');
                vel2Label.style.position = '';
                vel2Label.style.right = '';
                vel2Label.style.left = '';
                vel2Label.style.top = '';
            }
            if (acc1Label) {
                acc1Label.textContent = 'a: 0.00 m/s²';
                acc1Label.style.display = 'none';
            }
            if (acc2Label) {
                acc2Label.textContent = 'a: 0.00 m/s²';
                acc2Label.style.display = 'none';
            }
            
            // Hide spring and arrows
            const spring = document.getElementById('spring');
            if (spring) {
                spring.style.opacity = '0';
                spring.classList.remove('active');
            }
            
            const arrows = canvas.querySelectorAll('.arrow');
            arrows.forEach(arrow => {
                arrow.style.opacity = '0';
                arrow.style.transition = 'none';
            });
        }
        
        // Initialize on load
        window.onload = function() {
            calculate();
            resetAnimation();
        };
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (!animationInProgress) {
                resetAnimation();
            }
        });
    </script>
</body>
</html>