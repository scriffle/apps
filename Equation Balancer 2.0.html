<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemical Equation Balancing Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding-top: 100px; /* Space for fixed header */
        }

        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            padding: 15px 20px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .name-input {
            padding: 6px 12px;
            font-size: 0.95rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: white;
            min-width: 150px;
            transition: all 0.3s ease;
        }

        .name-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .name-input::placeholder {
            color: #999;
        }

        .scores-container {
            font-size: 0.85rem;
            color: #555;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .score-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .score-label {
            font-weight: 600;
            min-width: 65px;
        }

        .score-values {
            display: flex;
            gap: 15px;
            font-size: 0.8rem;
        }

        .score-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .score-number {
            font-weight: 700;
        }

        .solved { color: #27ae60; }
        .assisted { color: #f39c12; }

        h1 {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            color: #2c3e50;
            letter-spacing: -0.5px;
        }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .help-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #3498db;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .help-button:hover {
            background-color: #2980b9;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); }
            to { transform: translateY(0); }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover,
        .close:focus {
            color: #000;
        }

        .modal h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .modal h3 {
            color: #34495e;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .modal p, .modal li {
            line-height: 1.6;
            margin-bottom: 10px;
            color: #555;
        }

        .modal ul {
            margin-left: 20px;
        }

        .color-guide {
            display: flex;
            gap: 15px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .color-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        #level-select {
            padding: 6px 12px;
            font-size: 0.95rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            min-width: 100px;
        }

        #level-select:hover {
            border-color: #3498db;
        }

        #level-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .equation-container {
            position: relative;
            display: flex;
            flex-direction: column;
            margin: 12px 0;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 1.3rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .equation-container:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .equation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .equation-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .external-links {
            display: flex;
            gap: 8px;
        }

        .external-link {
            font-size: 0.75rem;
            color: #3498db;
            text-decoration: none;
            padding: 2px 6px;
            border: 1px solid #3498db;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .external-link:hover {
            background-color: #3498db;
            color: white;
        }

        .equation-actions {
            display: flex;
            gap: 10px;
            margin-top: 12px;
            justify-content: center;
        }

        .reaction-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .reaction-name {
            font-size: 1rem;
            font-weight: 600;
            color: #c0392b;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .balanced-name {
            font-size: 1rem;
            font-weight: 600;
            color: #27ae60;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .reaction-type-row, .word-equation-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .energy-select {
            padding: 4px 8px;
            font-size: 0.95rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: white;
            min-width: 120px;
            margin-left: 20px;
        }

        .energy-select:hover {
            border-color: #3498db;
        }

        .energy-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .energy-label {
            font-weight: 500;
            color: #555;
            margin-left: 20px;
            transition: color 0.3s ease;
        }

        .energy-label.correct {
            color: #27ae60;
            font-weight: 600;
        }

        .energy-label.solved {
            color: #f39c12;
            font-weight: 600;
        }

        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #3498db;
            color: white;
            font-size: 12px;
            text-align: center;
            line-height: 16px;
            margin-left: 5px;
            font-weight: bold;
        }

        .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: left;
            padding: 10px;
            border-radius: 8px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            line-height: 1.4;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .reaction-type-row label, .word-equation-row label {
            font-weight: 500;
            color: #555;
            min-width: 120px;
            transition: color 0.3s ease;
        }

        .reaction-type-row label.correct, .word-equation-row label.correct {
            color: #27ae60;
            font-weight: 600;
        }

        .reaction-type-row label.solved, .word-equation-row label.solved {
            color: #f39c12;
            font-weight: 600;
        }

        .reaction-type-select, .word-select {
            padding: 4px 8px;
            font-size: 0.95rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: white;
            min-width: 150px;
        }

        .reaction-type-select:hover, .word-select:hover {
            border-color: #3498db;
        }

        .reaction-type-select:focus, .word-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .word-equation-row {
            flex-wrap: wrap;
        }

        .word-equation-content {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .equation-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 12px;
        }

        .reactants, .products {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .arrow {
            font-size: 2rem;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        select {
            width: 48px;
            height: 36px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: white;
            font-weight: 500;
        }

        select:hover {
            border-color: #3498db;
        }

        select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .button-container {
            text-align: center;
            margin-top: 2rem;
        }

        .clear-scores-container {
            text-align: center;
            margin-top: 3rem;
            padding: 20px;
            background-color: #ecf0f1;
            border-radius: 12px;
        }

        .clear-scores-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #34495e;
        }

        .clear-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            font-family: inherit;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .solve-button, .hint-button {
            padding: 6px 14px;
            font-size: 0.9rem;
        }

        .hint-button {
            background-color: #3498db;
            color: white;
        }

        .hint-button:hover {
            background-color: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }

        .solve-button {
            background-color: #95a5a6;
            color: white;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .solve-button.enabled {
            background-color: #e74c3c;
            cursor: pointer;
            opacity: 1;
        }

        .solve-button.enabled:hover {
            background-color: #c0392b;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
        }

        .refresh-button {
            padding: 12px 24px;
            font-size: 1.1rem;
            background-color: #34495e;
            color: white;
        }

        .refresh-button:hover {
            background-color: #2c3e50;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(52, 73, 94, 0.3);
        }

        .clear-button {
            padding: 8px 16px;
            font-size: 0.9rem;
            background-color: #95a5a6;
            color: white;
        }

        .clear-button:hover {
            background-color: #7f8c8d;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(149, 165, 166, 0.3);
        }

        /* Background colors with better contrast */
        .pale-red {
            background-color: #ffebee;
            border: 1px solid #ffcdd2;
        }

        .pale-green {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
        }

        .pale-yellow {
            background-color: #fff9c4;
            border: 1px solid #fff59d;
        }

        /* Sparkly green for perfect completion */
        .sparkly-green {
            background: linear-gradient(45deg, #c8e6c9 25%, #e8f5e9 25%, #e8f5e9 50%, #c8e6c9 50%, #c8e6c9 75%, #e8f5e9 75%, #e8f5e9);
            background-size: 20px 20px;
            animation: sparkle 1s linear infinite;
            border: 1px solid #4caf50;
        }

        @keyframes sparkle {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 20px 20px;
            }
        }

        /* Arrow colors */
        .red-arrow {
            color: #e74c3c;
        }

        .green-arrow {
            color: #27ae60;
        }

        .yellow-arrow {
            color: #f39c12;
        }

        /* Element styling */
        .element {
            font-weight: 600;
            margin: 0;
            font-size: 1.35rem;
        }

        .element sub {
            font-size: 0.85em;
            vertical-align: sub;
        }

        /* Element Colors */
        .Ca { color: #ff7043; }
        .C { color: #424242; }
        .O { color: #1e88e5; }
        .H { color: #43a047; }
        .N { color: #7b1fa2; }
        .Cl { color: #00acc1; }
        .S { color: #ffa000; }
        .P { color: #d32f2f; }
        .Na { color: #ab47bc; }
        .Mg { color: #7e57c2; }
        .Al { color: #616161; }
        .Fe { color: #6d4c41; }
        .Zn { color: #3949ab; }
        .K { color: #7cb342; }
        .Br { color: #8d6e63; }
        .Pb { color: #455a64; }
        .Ag { color: #78909c; }
        .Hg { color: #b0bec5; }
        .Cr { color: #4db6ac; }
        .Cu { color: #ff8a65; }
        .Ba { color: #9575cd; }
        .B { color: #66bb6a; }
        .I { color: #5c6bc0; }

        .reaction-tip {
            margin-top: 8px;
            font-size: 0.95rem;
            color: #7f8c8d;
            font-style: italic;
            display: none;
            line-height: 1.4;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .fixed-header {
                padding: 10px 15px;
            }

            h1 {
                font-size: 1.4rem;
            }

            .scores-container {
                font-size: 0.75rem;
            }

            .equation-container {
                font-size: 1.1rem;
                padding: 16px;
            }

            .arrow {
                font-size: 1.5rem;
            }

            select {
                width: 42px;
                height: 32px;
                font-size: 1.1rem;
            }
        }

        /* Animation for state changes */
        .equation-container {
            transition: background-color 0.4s ease, border-color 0.4s ease;
        }

        .arrow {
            transition: color 0.4s ease;
        }
    </style>
</head>
<body>
    <div class="fixed-header">
        <div class="header-content">
            <div class="scores-container">
                <div class="score-row">
                    <span class="score-label">Simple:</span>
                    <div class="score-values">
                        <span class="score-item solved">S: <span class="score-number" id="simple-solved">0</span></span>
                        <span class="score-item assisted">A: <span class="score-number" id="simple-assisted">0</span></span>
                    </div>
                </div>
                <div class="score-row">
                    <span class="score-label">Medium:</span>
                    <div class="score-values">
                        <span class="score-item solved">S: <span class="score-number" id="medium-solved">0</span></span>
                        <span class="score-item assisted">A: <span class="score-number" id="medium-assisted">0</span></span>
                    </div>
                </div>
                <div class="score-row">
                    <span class="score-label">Advanced:</span>
                    <div class="score-values">
                        <span class="score-item solved">S: <span class="score-number" id="advanced-solved">0</span></span>
                        <span class="score-item assisted">A: <span class="score-number" id="advanced-assisted">0</span></span>
                    </div>
                </div>
            </div>
            <input type="text" class="name-input" id="student-name" placeholder="Enter your name" onchange="saveName()">
            <h1>Chemical Equation Practice</h1>
            <div class="header-controls">
                <select id="level-select" onchange="changeLevel()">
                    <option value="simple">Simple</option>
                    <option value="medium">Medium</option>
                    <option value="advanced">Advanced</option>
                </select>
                <button class="help-button" onclick="openModal()">?</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Chemical Equation Practice Guide</h2>
            
            <h3>Overview</h3>
            <p>This app helps you practice balancing chemical equations, identifying reaction types, and writing word equations. Complete all three components correctly to master each equation.</p>
            
            <h3>How to Use</h3>
            <ul>
                <li><strong>Select Level:</strong> Choose Simple, Medium, or Advanced from the dropdown in the top-right corner</li>
                <li><strong>Balance Equations:</strong> Use the dropdown menus to add coefficients (blank = 1)</li>
                <li><strong>Identify Reaction Type:</strong> Select the correct type from the dropdown menu</li>
                <li><strong>Energy Classification:</strong> Choose whether the reaction is Exothermic, Endothermic, or neither (blank)</li>
                <li><strong>Build Word Equations:</strong> Select the correct chemical names for reactants and products</li>
                <li><strong>Get Hints:</strong> Click "Show/Hide Hint" for balancing tips</li>
                <li><strong>Solve Button:</strong> Becomes available after 10 seconds after you begin work on balancing the equation</li>
            </ul>
            
            <h3>Color Indicators</h3>
            <div class="color-guide">
                <div class="color-item">
                    <div class="color-box" style="background-color: #ffebee;"></div>
                    <span>Red: Incomplete equation</span>
                </div>
                <div class="color-item">
                    <div class="color-box" style="background-color: #e8f5e9;"></div>
                    <span>Green: Balanced equation</span>
                </div>
                <div class="color-item">
                    <div class="color-box" style="background: linear-gradient(45deg, #c8e6c9 50%, #e8f5e9 50%);"></div>
                    <span>Sparkly Green: All components correct</span>
                </div>
                <div class="color-item">
                    <div class="color-box" style="background-color: #fff9c4;"></div>
                    <span>Yellow: Used solve button</span>
                </div>
            </div>
            
            <h3>Label Colors</h3>
            <ul>
                <li><strong style="color: #27ae60;">Green Labels:</strong> Correctly identified by student</li>
                <li><strong style="color: #f39c12;">Orange Labels:</strong> Filled using solve button</li>
            </ul>
            
            <h3>Scoring System</h3>
            <p>Your progress is tracked for each level:</p>
            <ul>
                <li><strong style="color: #27ae60;">Solved (S):</strong> Equations you completed without assistance</li>
                <li><strong style="color: #f39c12;">Assisted (A):</strong> Equations completed using the solve button</li>
            </ul>
            <p>Scores are saved automatically and persist between sessions. Use the "Clear" buttons at the bottom to reset scores for each level.</p>
            
            <h3>Reaction Types</h3>
            <ul>
                <li><strong>Combination:</strong> Two or more reactants form one product</li>
                <li><strong>Decomposition:</strong> One compound breaks into simpler products</li>
                <li><strong>Single Displacement:</strong> One element replaces another in a compound</li>
                <li><strong>Double Displacement:</strong> Two compounds exchange components</li>
                <li><strong>Combustion:</strong> Substance burns in oxygen</li>
                <li><strong>Neutralization:</strong> Acid + base → salt + water</li>
                <li><strong>Precipitation:</strong> Forms an insoluble solid</li>
                <li>And more advanced types in higher levels</li>
            </ul>
            
            <h3>Energy Types</h3>
            <ul>
                <li><strong>Exothermic:</strong> Releases energy (heat) to surroundings</li>
                <li><strong>Endothermic:</strong> Absorbs energy (heat) from surroundings</li>
                <li><strong>Blank:</strong> For reactions where energy type is not specified</li>
            </ul>
            
            <h3>Tips for Success</h3>
            <ul>
                <li>Start by identifying the reaction type - it can guide your balancing</li>
                <li>Count atoms on both sides systematically</li>
                <li>Balance polyatomic ions as units when possible</li>
                <li>Leave H and O for last in combustion reactions</li>
                <li>Check your work by counting all atoms again</li>
                <li>Use the tooltip (i) for real-world context about each reaction</li>
            </ul>
        </div>
    </div>

    <div class="main-content">
        <div id="equations"></div>
        
        <div class="button-container">
            <button class="refresh-button" onclick="refreshPage()">Refresh</button>
        </div>

        <div class="clear-scores-container">
            <div class="clear-scores-title">Clear Scores</div>
            <div class="clear-buttons">
                <button class="clear-button" onclick="clearScores('simple')">Clear Simple</button>
                <button class="clear-button" onclick="clearScores('medium')">Clear Medium</button>
                <button class="clear-button" onclick="clearScores('advanced')">Clear Advanced</button>
            </div>
        </div>
    </div>

    <script>
        // Score tracking
        let scores = {
            simple: { solved: 0, assisted: 0 },
            medium: { solved: 0, assisted: 0 },
            advanced: { solved: 0, assisted: 0 }
        };

        // Save and load student name
        function saveName() {
            const name = document.getElementById('student-name').value;
            localStorage.setItem('studentName', name);
        }

        function loadName() {
            const savedName = localStorage.getItem('studentName');
            if (savedName) {
                document.getElementById('student-name').value = savedName;
            }
        }

        // Track equation states
        let equationStates = {};

        // Track completion status by equation name
        let completionStatus = {};

        // Load completion status from localStorage
        function loadCompletionStatus() {
            const saved = localStorage.getItem('chemEquationStatus');
            if (saved) {
                completionStatus = JSON.parse(saved);
            }
        }

        // Save completion status to localStorage
        function saveCompletionStatus() {
            localStorage.setItem('chemEquationStatus', JSON.stringify(completionStatus));
        }

        // Load scores from localStorage
        function loadScores() {
            const savedScores = localStorage.getItem('chemEquationScores');
            if (savedScores) {
                scores = JSON.parse(savedScores);
                updateScoreDisplay();
            }
        }

        // Save scores to localStorage
        function saveScores() {
            localStorage.setItem('chemEquationScores', JSON.stringify(scores));
        }

        // Update score display
        function updateScoreDisplay() {
            for (const level of ['simple', 'medium', 'advanced']) {
                document.getElementById(`${level}-solved`).textContent = scores[level].solved;
                document.getElementById(`${level}-assisted`).textContent = scores[level].assisted;
            }
        }

        // Clear scores for a level
        function clearScores(level) {
            scores[level] = { solved: 0, assisted: 0 };
            // Also clear completion status for this level
            const levelEquations = levels[level];
            levelEquations.forEach(eq => {
                delete completionStatus[eq.name];
            });
            saveScores();
            saveCompletionStatus();
            updateScoreDisplay();
            // Reload current equations to reset visual states
            if (currentLevel === level) {
                loadEquations(level);
            }
        }

        // Update score when equation state changes
        function updateScore(level, index, state) {
            const equationKey = `${level}-${index}`;
            const previousState = equationStates[equationKey];
            
            // Only update if state changed and is not incomplete
            if (previousState === state || state === 'incomplete') return;
            
            // Remove from previous state count if it was solved or assisted
            if (previousState && previousState !== 'incomplete') {
                scores[level][previousState]--;
            }
            
            // Add to new state count
            scores[level][state]++;
            equationStates[equationKey] = state;
            
            saveScores();
            updateScoreDisplay();
        }

        const levels = {
            simple: [
                { 
                    name: "Combustion of Methane", 
                    tip: "Balance carbon, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["CH4", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 2, 1, 2],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Natural gas burning releases heat energy used for heating and cooking",
                    wordEquation: {
                        reactants: ["Methane", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Water", 
                    tip: "Balance hydrogen first, followed by oxygen atoms.", 
                    reactants: ["H2", "O2"], 
                    products: ["H2O"], 
                    balanced: [2, 1, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Hydrogen combustion releases large amounts of energy",
                    wordEquation: {
                        reactants: ["Hydrogen", "Oxygen"],
                        products: ["Water"]
                    }
                },
                { 
                    name: "Decomposition of Hydrogen Peroxide", 
                    tip: "Balance oxygen first, then hydrogen atoms.", 
                    reactants: ["H2O2"], 
                    products: ["H2O", "O2"], 
                    balanced: [2, 2, 1],
                    reactionTypes: ["Decomposition"],
                    energyType: "Exothermic",
                    tooltip: "Releases energy slowly; catalysts speed up this reaction",
                    wordEquation: {
                        reactants: ["Hydrogen peroxide"],
                        products: ["Water", "Oxygen"]
                    }
                },
                { 
                    name: "Formation of Sodium Chloride", 
                    tip: "Balance sodium and chlorine atoms directly.", 
                    reactants: ["Na", "Cl2"], 
                    products: ["NaCl"], 
                    balanced: [2, 1, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Table salt formation releases energy; sodium reacts vigorously with chlorine gas",
                    wordEquation: {
                        reactants: ["Sodium", "Chlorine"],
                        products: ["Sodium chloride"]
                    }
                },
                { 
                    name: "Decomposition of Water", 
                    tip: "Balance hydrogen first, then oxygen atoms.", 
                    reactants: ["H2O"], 
                    products: ["H2", "O2"], 
                    balanced: [2, 2, 1],
                    reactionTypes: ["Decomposition"],
                    energyType: "Endothermic",
                    tooltip: "Requires electrical energy to split water molecules",
                    wordEquation: {
                        reactants: ["Water"],
                        products: ["Hydrogen", "Oxygen"]
                    }
                },
                { 
                    name: "Formation of Calcium Oxide", 
                    tip: "Balance calcium first, then oxygen atoms.", 
                    reactants: ["Ca", "O2"], 
                    products: ["CaO"], 
                    balanced: [2, 1, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Quicklime production releases intense heat; used in cement manufacturing",
                    wordEquation: {
                        reactants: ["Calcium", "Oxygen"],
                        products: ["Calcium oxide"]
                    }
                },
                { 
                    name: "Formation of Magnesium Oxide", 
                    tip: "Balance magnesium first, then oxygen atoms.", 
                    reactants: ["Mg", "O2"], 
                    products: ["MgO"], 
                    balanced: [2, 1, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Magnesium burns with brilliant white light; used in flares and fireworks",
                    wordEquation: {
                        reactants: ["Magnesium", "Oxygen"],
                        products: ["Magnesium oxide"]
                    }
                },
                { 
                    name: "Combustion of Hydrogen Sulfide", 
                    tip: "Balance sulfur first, then oxygen, and finally hydrogen atoms.", 
                    reactants: ["H2S", "O2"], 
                    products: ["SO2", "H2O"], 
                    balanced: [2, 3, 2, 2],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Burning hydrogen sulfide releases heat and produces sulfur dioxide",
                    wordEquation: {
                        reactants: ["Hydrogen sulfide", "Oxygen"],
                        products: ["Sulfur dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Nitrogen Dioxide", 
                    tip: "Balance nitrogen first, then oxygen atoms.", 
                    reactants: ["NO", "O2"], 
                    products: ["NO2"], 
                    balanced: [2, 1, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Forms brown gas; major air pollutant from vehicle exhausts",
                    wordEquation: {
                        reactants: ["Nitrogen monoxide", "Oxygen"],
                        products: ["Nitrogen dioxide"]
                    }
                },
                { 
                    name: "Reaction of Hydrogen with Chlorine", 
                    tip: "Balance hydrogen and chlorine atoms directly.", 
                    reactants: ["H2", "Cl2"], 
                    products: ["HCl"], 
                    balanced: [1, 1, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Explosive reaction in sunlight; produces hydrogen chloride gas",
                    wordEquation: {
                        reactants: ["Hydrogen", "Chlorine"],
                        products: ["Hydrogen chloride"]
                    }
                },
                { 
                    name: "Formation of Calcium Hydroxide", 
                    tip: "Balance calcium first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["Ca", "H2O"], 
                    products: ["Ca(OH)2", "H2"], 
                    balanced: [1, 2, 1, 1],
                    reactionTypes: ["Single Displacement"],
                    energyType: "Exothermic",
                    tooltip: "Calcium reacts vigorously with water; produces alkaline solution",
                    wordEquation: {
                        reactants: ["Calcium", "Water"],
                        products: ["Calcium hydroxide", "Hydrogen"]
                    }
                },
                { 
                    name: "Formation of Barium Sulfate", 
                    tip: "Balance barium first, then sulfate and chloride ions.", 
                    reactants: ["BaCl2", "H2SO4"], 
                    products: ["BaSO4", "HCl"], 
                    balanced: [1, 1, 1, 2],
                    reactionTypes: ["Double Displacement", "Precipitation"],
                    energyType: "Exothermic",
                    tooltip: "Forms white precipitate; used in medical X-ray imaging",
                    wordEquation: {
                        reactants: ["Barium chloride", "Sulfuric acid"],
                        products: ["Barium sulfate", "Hydrochloric acid"]
                    }
                },
                { 
                    name: "Formation of Zinc Oxide", 
                    tip: "Balance zinc first, then oxygen atoms.", 
                    reactants: ["Zn", "O2"], 
                    products: ["ZnO"], 
                    balanced: [2, 1, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Zinc burns with bluish-green flame; product used in sunscreen",
                    wordEquation: {
                        reactants: ["Zinc", "Oxygen"],
                        products: ["Zinc oxide"]
                    }
                },
                { 
                    name: "Formation of Sodium Bromide", 
                    tip: "Balance sodium and bromine atoms directly.", 
                    reactants: ["Na", "Br2"], 
                    products: ["NaBr"], 
                    balanced: [2, 1, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Vigorous reaction; sodium bromide used in photography",
                    wordEquation: {
                        reactants: ["Sodium", "Bromine"],
                        products: ["Sodium bromide"]
                    }
                },
                { 
                    name: "Combustion of Ethylene", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C2H4", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 3, 2, 2],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Burns with luminous flame; used in welding and ripening fruits",
                    wordEquation: {
                        reactants: ["Ethylene", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Lead (II) Oxide", 
                    tip: "Balance lead first, then oxygen atoms.", 
                    reactants: ["Pb", "O2"], 
                    products: ["PbO"], 
                    balanced: [2, 1, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Forms yellow powder; historically used in paints and glazes",
                    wordEquation: {
                        reactants: ["Lead", "Oxygen"],
                        products: ["Lead(II) oxide"]
                    }
                },
                { 
                    name: "Formation of Potassium Chloride", 
                    tip: "Balance potassium and chlorine atoms directly.", 
                    reactants: ["K", "Cl2"], 
                    products: ["KCl"], 
                    balanced: [2, 1, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Violent reaction; product used as salt substitute and fertilizer",
                    wordEquation: {
                        reactants: ["Potassium", "Chlorine"],
                        products: ["Potassium chloride"]
                    }
                },
                { 
                    name: "Combustion of Carbon Monoxide", 
                    tip: "Balance carbon first, then oxygen atoms.", 
                    reactants: ["CO", "O2"], 
                    products: ["CO2"], 
                    balanced: [2, 1, 2],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Blue flame; converts toxic CO to less harmful CO2",
                    wordEquation: {
                        reactants: ["Carbon monoxide", "Oxygen"],
                        products: ["Carbon dioxide"]
                    }
                },
                { 
                    name: "Decomposition of Sodium Bicarbonate", 
                    tip: "Balance sodium, then carbon and hydrogen atoms.", 
                    reactants: ["NaHCO3"], 
                    products: ["Na2CO3", "CO2", "H2O"], 
                    balanced: [2, 1, 1, 1],
                    reactionTypes: ["Decomposition"],
                    energyType: "Endothermic",
                    tooltip: "Baking soda decomposes when heated, absorbing energy",
                    wordEquation: {
                        reactants: ["Sodium bicarbonate"],
                        products: ["Sodium carbonate", "Carbon dioxide", "Water"]
                    }
                }
            ],
            medium: [
                { 
                    name: "Combustion of Ethylene Glycol", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C2H6O2", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [2, 5, 4, 6],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Antifreeze combustion; releases significant heat energy",
                    wordEquation: {
                        reactants: ["Ethylene glycol", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Aluminum Bromide", 
                    tip: "Balance aluminum first, then bromine atoms.", 
                    reactants: ["Al", "Br2"], 
                    products: ["AlBr3"], 
                    balanced: [2, 3, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Vigorous reaction producing fumes; used as catalyst in organic chemistry",
                    wordEquation: {
                        reactants: ["Aluminum", "Bromine"],
                        products: ["Aluminum bromide"]
                    }
                },
                { 
                    name: "Combustion of Propane", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C3H8", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 5, 3, 4],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Common fuel for grills and heating; burns with blue flame",
                    wordEquation: {
                        reactants: ["Propane", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                },
                { 
                    name: "Reaction of Iron and Oxygen", 
                    tip: "Balance iron first, then oxygen atoms.", 
                    reactants: ["Fe", "O2"], 
                    products: ["Fe2O3"], 
                    balanced: [4, 3, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Rusting process; slow oxidation that weakens iron structures",
                    wordEquation: {
                        reactants: ["Iron", "Oxygen"],
                        products: ["Iron(III) oxide"]
                    }
                },
                { 
                    name: "Formation of Nitric Acid from Nitrogen Dioxide", 
                    tip: "Balance nitrogen first, then oxygen atoms.", 
                    reactants: ["NO2", "H2O"], 
                    products: ["HNO3", "NO"], 
                    balanced: [3, 1, 2, 1],
                    reactionTypes: ["Disproportionation"],
                    energyType: "Exothermic",
                    tooltip: "Industrial process for nitric acid; important for fertilizer production",
                    wordEquation: {
                        reactants: ["Nitrogen dioxide", "Water"],
                        products: ["Nitric acid", "Nitrogen monoxide"]
                    }
                },
                { 
                    name: "Formation of Sulfur Trioxide", 
                    tip: "Balance sulfur first, then oxygen atoms.", 
                    reactants: ["SO2", "O2"], 
                    products: ["SO3"], 
                    balanced: [2, 1, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Key step in sulfuric acid production; requires catalyst",
                    wordEquation: {
                        reactants: ["Sulfur dioxide", "Oxygen"],
                        products: ["Sulfur trioxide"]
                    }
                },
                { 
                    name: "Combustion of Ethanol", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C2H5OH", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 3, 2, 3],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Alcohol fuel combustion; used in some vehicles and hand sanitizers",
                    wordEquation: {
                        reactants: ["Ethanol", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Iron(III) Chloride", 
                    tip: "Balance iron first, then chlorine atoms.", 
                    reactants: ["Fe", "Cl2"], 
                    products: ["FeCl3"], 
                    balanced: [2, 3, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Iron glows when reacting; product used in water treatment",
                    wordEquation: {
                        reactants: ["Iron", "Chlorine"],
                        products: ["Iron(III) chloride"]
                    }
                },
                { 
                    name: "Decomposition of Calcium Phosphate", 
                    tip: "Balance calcium, phosphorus, and oxygen atoms step-by-step.", 
                    reactants: ["Ca3(PO4)2", "SiO2", "C"], 
                    products: ["P4", "CO", "CaSiO3"], 
                    balanced: [2, 6, 10, 1, 10, 6],
                    reactionTypes: ["Reduction"],
                    energyType: "Endothermic",
                    tooltip: "Industrial phosphorus production; requires very high temperatures",
                    wordEquation: {
                        reactants: ["Calcium phosphate", "Silicon dioxide", "Carbon"],
                        products: ["Phosphorus", "Carbon monoxide", "Calcium silicate"]
                    }
                },
                { 
                    name: "Formation of Lead (II) Sulfate", 
                    tip: "Balance lead first, then sulfate and nitrate ions.", 
                    reactants: ["Pb(NO3)2", "K2SO4"], 
                    products: ["PbSO4", "KNO3"], 
                    balanced: [1, 1, 1, 2],
                    reactionTypes: ["Double Displacement", "Precipitation"],
                    energyType: "Exothermic",
                    tooltip: "Forms white precipitate; demonstrates ionic reactions",
                    wordEquation: {
                        reactants: ["Lead(II) nitrate", "Potassium sulfate"],
                        products: ["Lead(II) sulfate", "Potassium nitrate"]
                    }
                },
                { 
                    name: "Decomposition of Sodium Chlorate", 
                    tip: "Balance sodium, then oxygen atoms.", 
                    reactants: ["NaClO3"], 
                    products: ["NaCl", "O2"], 
                    balanced: [2, 2, 3],
                    reactionTypes: ["Decomposition"],
                    energyType: "Endothermic",
                    tooltip: "Oxygen source in labs; requires heating with catalyst",
                    wordEquation: {
                        reactants: ["Sodium chlorate"],
                        products: ["Sodium chloride", "Oxygen"]
                    }
                },
                { 
                    name: "Formation of Copper(II) Sulfate", 
                    tip: "Balance copper first, then sulfur and oxygen atoms.", 
                    reactants: ["Cu", "H2SO4"], 
                    products: ["CuSO4", "SO2", "H2O"], 
                    balanced: [1, 2, 1, 1, 2],
                    reactionTypes: ["Oxidation-Reduction"],
                    energyType: "Exothermic",
                    tooltip: "Produces blue crystals; used in agriculture and swimming pools",
                    wordEquation: {
                        reactants: ["Copper", "Sulfuric acid"],
                        products: ["Copper(II) sulfate", "Sulfur dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Chromium(III) Oxide", 
                    tip: "Balance chromium first, then oxygen atoms.", 
                    reactants: ["Cr", "O2"], 
                    products: ["Cr2O3"], 
                    balanced: [4, 3, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Forms green pigment; used in paints and ceramics",
                    wordEquation: {
                        reactants: ["Chromium", "Oxygen"],
                        products: ["Chromium(III) oxide"]
                    }
                },
                { 
                    name: "Reaction of Aluminum with Sulfuric Acid", 
                    tip: "Balance aluminum first, then sulfur and oxygen atoms.", 
                    reactants: ["Al", "H2SO4"], 
                    products: ["Al2(SO4)3", "H2"], 
                    balanced: [2, 3, 1, 3],
                    reactionTypes: ["Single Displacement"],
                    energyType: "Exothermic",
                    tooltip: "Produces hydrogen gas; aluminum sulfate used in water purification",
                    wordEquation: {
                        reactants: ["Aluminum", "Sulfuric acid"],
                        products: ["Aluminum sulfate", "Hydrogen"]
                    }
                },
                { 
                    name: "Combustion of Glucose", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C6H12O6", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 6, 6, 6],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Cellular respiration; how our bodies produce energy from sugar",
                    wordEquation: {
                        reactants: ["Glucose", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Silver Nitrate", 
                    tip: "Balance silver first, then nitrogen, oxygen, and hydrogen atoms.", 
                    reactants: ["Ag", "HNO3"], 
                    products: ["AgNO3", "NO2", "H2O"], 
                    balanced: [3, 4, 3, 1, 2],
                    reactionTypes: ["Oxidation-Reduction"],
                    energyType: "Exothermic",
                    tooltip: "Produces brown fumes; silver nitrate used in photography",
                    wordEquation: {
                        reactants: ["Silver", "Nitric acid"],
                        products: ["Silver nitrate", "Nitrogen dioxide", "Water"]
                    }
                },
                { 
                    name: "Reaction of Sodium with Water", 
                    tip: "Balance sodium first, then hydrogen and oxygen atoms.", 
                    reactants: ["Na", "H2O"], 
                    products: ["NaOH", "H2"], 
                    balanced: [2, 2, 2, 1],
                    reactionTypes: ["Single Displacement"],
                    energyType: "Exothermic",
                    tooltip: "Violent reaction; sodium floats and may catch fire",
                    wordEquation: {
                        reactants: ["Sodium", "Water"],
                        products: ["Sodium hydroxide", "Hydrogen"]
                    }
                },
                { 
                    name: "Formation of Copper(II) Nitrate", 
                    tip: "Balance copper first, then nitrogen, oxygen, and hydrogen atoms.", 
                    reactants: ["Cu", "HNO3"], 
                    products: ["Cu(NO3)2", "NO", "H2O"], 
                    balanced: [3, 8, 3, 2, 4],
                    reactionTypes: ["Oxidation-Reduction"],
                    energyType: "Exothermic",
                    tooltip: "Produces blue solution and toxic brown gas",
                    wordEquation: {
                        reactants: ["Copper", "Nitric acid"],
                        products: ["Copper(II) nitrate", "Nitrogen monoxide", "Water"]
                    }
                },
                { 
                    name: "Combustion of Methyl Alcohol", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["CH3OH", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [2, 3, 2, 4],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Burns with pale blue flame; used as fuel and solvent",
                    wordEquation: {
                        reactants: ["Methanol", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                }
            ],
            advanced: [
                { 
                    name: "Combustion of Pentane", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C5H12", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 8, 5, 6],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Component of gasoline; releases energy for vehicle engines",
                    wordEquation: {
                        reactants: ["Pentane", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Potassium Dichromate", 
                    tip: "Balance potassium, then chromium, and finally oxygen atoms.", 
                    reactants: ["K2Cr2O7", "H2SO4", "H2O2"], 
                    products: ["CrO5", "K2SO4", "H2O"], 
                    balanced: [1, 4, 3, 2, 1, 5],
                    reactionTypes: ["Oxidation-Reduction"],
                    energyType: "Exothermic",
                    tooltip: "Forms unstable blue peroxide; strong oxidizing agent",
                    wordEquation: {
                        reactants: ["Potassium dichromate", "Sulfuric acid", "Hydrogen peroxide"],
                        products: ["Chromium peroxide", "Potassium sulfate", "Water"]
                    }
                },
                { 
                    name: "Decomposition of Ammonium Dichromate", 
                    tip: "Balance nitrogen first, then oxygen and hydrogen atoms.", 
                    reactants: ["(NH4)2Cr2O7"], 
                    products: ["Cr2O3", "N2", "H2O"], 
                    balanced: [1, 1, 1, 4],
                    reactionTypes: ["Decomposition", "Oxidation-Reduction"],
                    energyType: "Exothermic",
                    tooltip: "Volcano demonstration; self-sustaining reaction once started",
                    wordEquation: {
                        reactants: ["Ammonium dichromate"],
                        products: ["Chromium(III) oxide", "Nitrogen", "Water"]
                    }
                },
                { 
                    name: "Formation of Lead(II) Iodide", 
                    tip: "Balance lead and iodine atoms directly.", 
                    reactants: ["Pb(NO3)2", "KI"], 
                    products: ["PbI2", "KNO3"], 
                    balanced: [1, 2, 1, 2],
                    reactionTypes: ["Double Displacement", "Precipitation"],
                    energyType: "Exothermic",
                    tooltip: "Golden rain demonstration; forms bright yellow precipitate",
                    wordEquation: {
                        reactants: ["Lead(II) nitrate", "Potassium iodide"],
                        products: ["Lead(II) iodide", "Potassium nitrate"]
                    }
                },
                { 
                    name: "Combustion of Cyclohexane", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C6H12", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 9, 6, 6],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Industrial solvent combustion; used in nylon production",
                    wordEquation: {
                        reactants: ["Cyclohexane", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Calcium Phosphate", 
                    tip: "Balance calcium, then phosphorus, and finally oxygen atoms.", 
                    reactants: ["Ca(OH)2", "H3PO4"], 
                    products: ["Ca3(PO4)2", "H2O"], 
                    balanced: [3, 2, 1, 6],
                    reactionTypes: ["Neutralization"],
                    energyType: "Exothermic",
                    tooltip: "Bone and teeth formation; important biological reaction",
                    wordEquation: {
                        reactants: ["Calcium hydroxide", "Phosphoric acid"],
                        products: ["Calcium phosphate", "Water"]
                    }
                },
                { 
                    name: "Combustion of Glutaric Acid", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C5H8O4", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 5, 5, 4],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Organic acid combustion; used in polymer synthesis",
                    wordEquation: {
                        reactants: ["Glutaric acid", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Sodium Tetraborate", 
                    tip: "Balance sodium, then boron, and finally oxygen atoms.", 
                    reactants: ["Na2B4O7", "HCl"], 
                    products: ["B2O3", "NaCl", "H2O"], 
                    balanced: [1, 7, 2, 2, 5],
                    reactionTypes: ["Acid-Base"],
                    energyType: "Exothermic",
                    tooltip: "Borax reaction; produces boric oxide for glass making",
                    wordEquation: {
                        reactants: ["Sodium tetraborate", "Hydrochloric acid"],
                        products: ["Boron oxide", "Sodium chloride", "Water"]
                    }
                },
                { 
                    name: "Decomposition of Potassium Chlorate", 
                    tip: "Balance potassium first, then oxygen atoms.", 
                    reactants: ["KClO3"], 
                    products: ["KCl", "O2"], 
                    balanced: [2, 2, 3],
                    reactionTypes: ["Decomposition"],
                    energyType: "Endothermic",
                    tooltip: "Oxygen generator; requires heat and catalyst (MnO2)",
                    wordEquation: {
                        reactants: ["Potassium chlorate"],
                        products: ["Potassium chloride", "Oxygen"]
                    }
                },
                { 
                    name: "Formation of Tetraphosphorus Decaoxide", 
                    tip: "Balance phosphorus first, then oxygen atoms.", 
                    reactants: ["P4", "O2"], 
                    products: ["P4O10"], 
                    balanced: [1, 5, 1],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "White phosphorus burns spontaneously in air; desiccant",
                    wordEquation: {
                        reactants: ["Phosphorus", "Oxygen"],
                        products: ["Tetraphosphorus decaoxide"]
                    }
                },
                { 
                    name: "Combustion of Heptane", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C7H16", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [1, 11, 7, 8],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Gasoline component; standard for octane rating",
                    wordEquation: {
                        reactants: ["Heptane", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Ferric Chloride", 
                    tip: "Balance iron first, then chlorine atoms.", 
                    reactants: ["Fe2O3", "HCl"], 
                    products: ["FeCl3", "H2O"], 
                    balanced: [1, 6, 2, 3],
                    reactionTypes: ["Acid-Base"],
                    energyType: "Exothermic",
                    tooltip: "Etching solution for circuit boards; water treatment chemical",
                    wordEquation: {
                        reactants: ["Iron(III) oxide", "Hydrochloric acid"],
                        products: ["Iron(III) chloride", "Water"]
                    }
                },
                { 
                    name: "Decomposition of Mercuric Oxide", 
                    tip: "Balance mercury first, then oxygen atoms.", 
                    reactants: ["HgO"], 
                    products: ["Hg", "O2"], 
                    balanced: [2, 2, 1],
                    reactionTypes: ["Decomposition"],
                    energyType: "Endothermic",
                    tooltip: "Historic oxygen discovery; mercury beads form when heated",
                    wordEquation: {
                        reactants: ["Mercury(II) oxide"],
                        products: ["Mercury", "Oxygen"]
                    }
                },
                { 
                    name: "Combustion of Propanol", 
                    tip: "Balance carbon first, then hydrogen, and finally oxygen atoms.", 
                    reactants: ["C3H8O", "O2"], 
                    products: ["CO2", "H2O"], 
                    balanced: [2, 9, 6, 8],
                    reactionTypes: ["Combustion"],
                    energyType: "Exothermic",
                    tooltip: "Rubbing alcohol combustion; used as fuel additive",
                    wordEquation: {
                        reactants: ["Propanol", "Oxygen"],
                        products: ["Carbon dioxide", "Water"]
                    }
                },
                { 
                    name: "Formation of Sodium Aluminate", 
                    tip: "Balance sodium, then aluminum, then oxygen atoms.", 
                    reactants: ["NaOH", "Al2O3", "H2O"], 
                    products: ["NaAl(OH)4"], 
                    balanced: [2, 1, 3, 2],
                    reactionTypes: ["Acid-Base"],
                    energyType: "Exothermic",
                    tooltip: "Aluminum extraction process; Bayer process step",
                    wordEquation: {
                        reactants: ["Sodium hydroxide", "Aluminum oxide", "Water"],
                        products: ["Sodium aluminate"]
                    }
                },
                { 
                    name: "Formation of Phosphoric Acid", 
                    tip: "Balance phosphorus first, then hydrogen and oxygen atoms.", 
                    reactants: ["P2O5", "H2O"], 
                    products: ["H3PO4"], 
                    balanced: [1, 3, 2],
                    reactionTypes: ["Combination"],
                    energyType: "Exothermic",
                    tooltip: "Vigorous reaction; phosphoric acid used in soft drinks",
                    wordEquation: {
                        reactants: ["Phosphorus pentoxide", "Water"],
                        products: ["Phosphoric acid"]
                    }
                },
                { 
                    name: "Formation of Aluminum Sulfate", 
                    tip: "Balance aluminum first, then sulfate and hydroxide ions.", 
                    reactants: ["Al2(SO4)3", "Ca(OH)2"], 
                    products: ["Al(OH)3", "CaSO4"], 
                    balanced: [1, 3, 2, 3],
                    reactionTypes: ["Double Displacement", "Precipitation"],
                    energyType: "Exothermic",
                    tooltip: "Water treatment process; removes impurities by flocculation",
                    wordEquation: {
                        reactants: ["Aluminum sulfate", "Calcium hydroxide"],
                        products: ["Aluminum hydroxide", "Calcium sulfate"]
                    }
                },
                { 
                    name: "Formation of Sodium Bromate", 
                    tip: "Balance sodium first, then bromine, and finally chlorine atoms.", 
                    reactants: ["NaBr", "NaOCl"], 
                    products: ["NaBrO3", "NaCl"], 
                    balanced: [3, 3, 1, 3],
                    reactionTypes: ["Oxidation-Reduction"],
                    energyType: "Exothermic",
                    tooltip: "Bleach oxidizes bromide; bromate used in bread making",
                    wordEquation: {
                        reactants: ["Sodium bromide", "Sodium hypochlorite"],
                        products: ["Sodium bromate", "Sodium chloride"]
                    }
                },
                { 
                    name: "Formation of Ammonium Phosphate", 
                    tip: "Balance nitrogen, then phosphorus and oxygen atoms.", 
                    reactants: ["H3PO4", "NH3"], 
                    products: ["(NH4)3PO4"], 
                    balanced: [1, 3, 1],
                    reactionTypes: ["Neutralization"],
                    energyType: "Exothermic",
                    tooltip: "Fertilizer production; provides nitrogen and phosphorus",
                    wordEquation: {
                        reactants: ["Phosphoric acid", "Ammonia"],
                        products: ["Ammonium phosphate"]
                    }
                },
                { 
                    name: "Formation of Magnesium Nitrate", 
                    tip: "Balance magnesium first, then nitrogen and oxygen atoms.", 
                    reactants: ["Mg", "HNO3"], 
                    products: ["Mg(NO3)2", "H2"], 
                    balanced: [1, 2, 1, 1],
                    reactionTypes: ["Single Displacement"],
                    energyType: "Exothermic",
                    tooltip: "Produces hydrogen gas; magnesium nitrate used in fertilizers",
                    wordEquation: {
                        reactants: ["Magnesium", "Nitric acid"],
                        products: ["Magnesium nitrate", "Hydrogen"]
                    }
                }
            ]
        };

        const reactionTypeOptions = [
            "",
            "Combination",
            "Decomposition", 
            "Single Displacement",
            "Double Displacement",
            "Neutralization",
            "Precipitation",
            "Combustion",
            "Oxidation-Reduction",
            "Acid-Base",
            "Disproportionation",
            "Reduction",
            "--- Multiple Types ---",
            "Decomposition + Oxidation-Reduction",
            "Double Displacement + Precipitation"
        ];

        let currentLevel = 'simple';
        let currentEquations = [];

        function changeLevel() {
            currentLevel = document.getElementById('level-select').value;
            loadEquations(currentLevel);
        }

        function loadEquations(level) {
            currentLevel = level;
            const selectedEquations = levels[level].sort(() => 0.5 - Math.random()).slice(0, 10);
            currentEquations = selectedEquations;
            const equationContainer = document.getElementById('equations');
            equationContainer.innerHTML = '';  // Clear existing equations

            selectedEquations.forEach((equation, index) => {
                const container = document.createElement('div');
                container.className = 'equation-container pale-red';
                container.id = `equation-${index}`;

                // Check if this equation was previously completed
                const status = completionStatus[equation.name];
                if (status === 'solved') {
                    container.className = 'equation-container sparkly-green';
                } else if (status === 'assisted') {
                    container.className = 'equation-container pale-yellow';
                }

                // Equation header with name
                const equationHeader = document.createElement('div');
                equationHeader.className = 'equation-header';

                // Title section with name and links
                const equationTitle = document.createElement('div');
                equationTitle.className = 'equation-title';

                // Reaction Name Label
                const reactionName = document.createElement('div');
                reactionName.className = status === 'solved' ? 'balanced-name' : 'reaction-name';
                reactionName.innerText = equation.name;
                equationTitle.appendChild(reactionName);

                // External links
                const externalLinks = document.createElement('div');
                externalLinks.className = 'external-links';

                // Google link
                const googleLink = document.createElement('a');
                googleLink.className = 'external-link';
                googleLink.innerText = 'Google';
                googleLink.href = `https://www.google.com/search?q=${encodeURIComponent(equation.name)}`;
                googleLink.target = '_blank';
                googleLink.rel = 'noopener noreferrer';
                externalLinks.appendChild(googleLink);

                // ChatGPT link
                const gptLink = document.createElement('a');
                gptLink.className = 'external-link';
                gptLink.innerText = 'GPT';
                gptLink.href = `https://chat.openai.com/?q=${encodeURIComponent(`Explain technical and interesting aspects of ${equation.name}`)}`;
                gptLink.target = '_blank';
                gptLink.rel = 'noopener noreferrer';
                externalLinks.appendChild(gptLink);

                equationTitle.appendChild(externalLinks);
                equationHeader.appendChild(equationTitle);

                container.appendChild(equationHeader);

                // Equation content (Reactants, Arrow, Products) - directly under title
                const equationContent = document.createElement('div');
                equationContent.className = 'equation-content';

                // Reactants
                const reactants = document.createElement('div');
                reactants.className = 'reactants';
                
                equation.reactants.forEach((element, i) => {
                    const select = createSelect(level, index, i, equation.balanced[i]);
                    reactants.appendChild(select);
                    reactants.appendChild(createColoredCompound(element));
                    if (i < equation.reactants.length - 1) {
                        reactants.appendChild(createPlusSymbol());
                    }
                });

                // Arrow
                const chemArrow = document.createElement('div');
                chemArrow.className = status === 'solved' ? 'arrow green-arrow' : status === 'assisted' ? 'arrow yellow-arrow' : 'arrow red-arrow';
                chemArrow.id = `arrow-${index}`;
                chemArrow.innerHTML = '→';

                // Products
                const products = document.createElement('div');
                products.className = 'products';

                equation.products.forEach((element, i) => {
                    const select = createSelect(level, index, equation.reactants.length + i, equation.balanced[equation.reactants.length + i]);
                    products.appendChild(select);
                    products.appendChild(createColoredCompound(element));
                    if (i < equation.products.length - 1) {
                        products.appendChild(createPlusSymbol());
                    }
                });

                equationContent.appendChild(reactants);
                equationContent.appendChild(chemArrow);
                equationContent.appendChild(products);
                container.appendChild(equationContent);

                // Reaction Type Row
                const reactionTypeRow = document.createElement('div');
                reactionTypeRow.className = 'reaction-type-row';
                
                const typeLabel = document.createElement('label');
                typeLabel.id = `type-label-${index}`;
                typeLabel.innerText = 'Reaction Type:';
                if (status === 'solved' || status === 'assisted') {
                    typeLabel.classList.add(status === 'solved' ? 'correct' : 'solved');
                }
                reactionTypeRow.appendChild(typeLabel);

                const typeSelect = document.createElement('select');
                typeSelect.className = 'reaction-type-select';
                typeSelect.id = `type-select-${index}`;
                typeSelect.onchange = () => checkEquation(level, index);

                reactionTypeOptions.forEach(opt => {
                    const option = document.createElement('option');
                    option.value = opt;
                    option.text = opt;
                    if (opt.startsWith('---')) {
                        option.disabled = true;
                    }
                    typeSelect.appendChild(option);
                });

                reactionTypeRow.appendChild(typeSelect);

                // Add energy type dropdown - now for ALL equations
                const energyLabel = document.createElement('label');
                energyLabel.className = 'energy-label';
                energyLabel.id = `energy-label-${index}`;
                energyLabel.innerText = 'Energy:';
                if (status === 'solved' || status === 'assisted') {
                    energyLabel.classList.add(status === 'solved' ? 'correct' : 'solved');
                }
                reactionTypeRow.appendChild(energyLabel);

                const energySelect = document.createElement('select');
                energySelect.className = 'energy-select';
                energySelect.id = `energy-select-${index}`;
                energySelect.onchange = () => checkEquation(level, index);

                const energyOptions = ['', 'Exothermic', 'Endothermic'];
                energyOptions.forEach(opt => {
                    const option = document.createElement('option');
                    option.value = opt;
                    option.text = opt;
                    energySelect.appendChild(option);
                });

                reactionTypeRow.appendChild(energySelect);

                // Add tooltip if available
                if (equation.tooltip) {
                    const tooltip = document.createElement('span');
                    tooltip.className = 'tooltip';
                    const tooltipIcon = document.createElement('span');
                    tooltipIcon.className = 'tooltip-icon';
                    tooltipIcon.innerText = 'i';
                    const tooltipText = document.createElement('span');
                    tooltipText.className = 'tooltip-text';
                    tooltipText.innerText = equation.tooltip;
                    tooltip.appendChild(tooltipIcon);
                    tooltip.appendChild(tooltipText);
                    reactionTypeRow.appendChild(tooltip);
                }

                container.appendChild(reactionTypeRow);

                // Word Equation Row
                const wordEquationRow = document.createElement('div');
                wordEquationRow.className = 'word-equation-row';
                
                const wordLabel = document.createElement('label');
                wordLabel.id = `word-label-${index}`;
                wordLabel.innerText = 'Word Equation:';
                if (status === 'solved' || status === 'assisted') {
                    wordLabel.classList.add(status === 'solved' ? 'correct' : 'solved');
                }
                wordEquationRow.appendChild(wordLabel);

                const wordEquationContent = document.createElement('div');
                wordEquationContent.className = 'word-equation-content';

                // Create word equation dropdowns
                const allSubstances = [...new Set([
                    ...equation.wordEquation.reactants,
                    ...equation.wordEquation.products,
                    "Water", "Oxygen", "Hydrogen", "Carbon dioxide", "Nitrogen", 
                    "Sodium chloride", "Hydrochloric acid", "Sulfuric acid"
                ])].sort();

                equation.wordEquation.reactants.forEach((_, i) => {
                    const select = createWordSelect(index, 'reactant', i, allSubstances);
                    wordEquationContent.appendChild(select);
                    if (i < equation.wordEquation.reactants.length - 1) {
                        const plus = document.createElement('span');
                        plus.innerHTML = ' + ';
                        wordEquationContent.appendChild(plus);
                    }
                });

                const arrow = document.createElement('span');
                arrow.innerHTML = ' → ';
                arrow.style.fontWeight = 'bold';
                wordEquationContent.appendChild(arrow);

                equation.wordEquation.products.forEach((_, i) => {
                    const select = createWordSelect(index, 'product', i, allSubstances);
                    wordEquationContent.appendChild(select);
                    if (i < equation.wordEquation.products.length - 1) {
                        const plus = document.createElement('span');
                        plus.innerHTML = ' + ';
                        wordEquationContent.appendChild(plus);
                    }
                });

                wordEquationRow.appendChild(wordEquationContent);
                container.appendChild(wordEquationRow);

                // Action Buttons (Hint and Solve) - below word equation
                const equationActions = document.createElement('div');
                equationActions.className = 'equation-actions';

                // Show/Hide Hint Button
                const hintButton = document.createElement('button');
                hintButton.className = 'hint-button';
                hintButton.innerText = 'Show/Hide Hint';
                hintButton.onclick = () => toggleHint(index);
                equationActions.appendChild(hintButton);

                // Solve button
                const solveButton = document.createElement('button');
                solveButton.className = 'solve-button';
                solveButton.innerText = 'Solve';
                solveButton.disabled = true; // Disable solve button by default
                solveButton.onclick = () => solveEquation(level, index, equation);
                solveButton.id = `solve-button-${index}`;
                equationActions.appendChild(solveButton);

                // If previously completed, populate the fields
                if (status) {
                    // Disable solve button for completed equations
                    solveButton.disabled = true;
                    solveButton.setAttribute('data-balanced', 'true');
                    
                    // Set all the values
                    setTimeout(() => {
                        // Set reaction type
                        document.getElementById(`type-select-${index}`).value = equation.reactionTypes[0];
                        
                        // Set energy type if available
                        if (equation.energyType) {
                            document.getElementById(`energy-select-${index}`).value = equation.energyType;
                        }
                        
                        // Set word equation
                        equation.wordEquation.reactants.forEach((word, i) => {
                            document.getElementById(`word-reactant-${index}-${i}`).value = word;
                        });
                        equation.wordEquation.products.forEach((word, i) => {
                            document.getElementById(`word-product-${index}-${i}`).value = word;
                        });
                        
                        // Set coefficients
                        equation.reactants.forEach((_, i) => {
                            document.getElementById(`select-${index}-${i}`).value = equation.balanced[i] === 1 ? "" : equation.balanced[i];
                        });
                        equation.products.forEach((_, i) => {
                            document.getElementById(`select-${index}-${equation.reactants.length + i}`).value = equation.balanced[equation.reactants.length + i] === 1 ? "" : equation.balanced[equation.reactants.length + i];
                        });
                    }, 100);
                }

                container.appendChild(equationActions);

                // Reaction Tip Label
                const reactionTip = document.createElement('div');
                reactionTip.className = 'reaction-tip';
                reactionTip.id = `tip-${index}`;
                reactionTip.innerText = equation.tip;
                container.appendChild(reactionTip);
                
                equationContainer.appendChild(container);
            });
        }

        function createWordSelect(index, type, pos, options) {
            const select = document.createElement('select');
            select.className = 'word-select';
            select.id = `word-${type}-${index}-${pos}`;
            select.onchange = () => checkEquation(document.getElementById('level-select').value, index);

            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.text = '-- Select --';
            select.appendChild(defaultOption);

            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.text = opt;
                select.appendChild(option);
            });

            return select;
        }

        function createSelect(level, index, pos, correctValue) {
            const select = document.createElement('select');
            select.onchange = () => {
                checkEquation(level, index);
                enableSolveButtonWithDelay(index, level);  // Enable solve button after delay
            };
            const options = level === 'advanced' ? ["", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"] : ["", "2", "3", "4", "5", "6"];
            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.text = opt;
                select.appendChild(option);
            });
            select.id = `select-${index}-${pos}`;
            return select;
        }

        function createColoredCompound(compound) {
            const fragment = document.createDocumentFragment();
            const elements = compound.match(/[A-Z][a-z]?\d*/g);  // Regex to separate elements and their counts

            elements.forEach(element => {
                const elementName = element.match(/[A-Z][a-z]?/)[0]; // Extract element symbol (e.g., "Ca")
                const subscript = element.match(/\d+/);  // Extract subscript if any (e.g., "3" in "CO3")
                const span = document.createElement('span');
                span.className = `element ${elementName}`;  // Apply color class
                span.innerHTML = elementName + (subscript ? `<sub>${subscript[0]}</sub>` : '');  // Add subscript if exists
                fragment.appendChild(span);
            });

            return fragment;
        }

        function createPlusSymbol() {
            const plus = document.createElement('span');
            plus.innerHTML = '+';
            plus.style.margin = '0 5px';
            return plus;
        }

        function checkEquation(level, index) {
            const container = document.getElementById(`equation-${index}`);
            const arrow = document.getElementById(`arrow-${index}`);
            const reactionName = container.querySelector('.reaction-name, .balanced-name');
            const solveButton = document.getElementById(`solve-button-${index}`);
            const equation = currentEquations[index];
            
            // Check reaction type
            const typeSelect = document.getElementById(`type-select-${index}`);
            const typeLabel = document.getElementById(`type-label-${index}`);
            const selectedType = typeSelect.value;
            const isTypeCorrect = equation.reactionTypes.includes(selectedType);

            // Check energy type - now always check
            let isEnergyCorrect = true;
            const energySelect = document.getElementById(`energy-select-${index}`);
            const energyLabel = document.getElementById(`energy-label-${index}`);
            const selectedEnergy = energySelect.value;
            
            if (equation.energyType) {
                isEnergyCorrect = selectedEnergy === equation.energyType;
            } else {
                // If no energy type defined, any non-empty selection is incorrect
                isEnergyCorrect = selectedEnergy === '';
            }
            
            // Update energy label color
            if (equation.energyType && isEnergyCorrect && selectedEnergy !== '') {
                energyLabel.classList.add('correct');
                energyLabel.classList.remove('solved');
            } else {
                energyLabel.classList.remove('correct', 'solved');
            }

            // Check word equation
            const wordLabel = document.getElementById(`word-label-${index}`);
            let isWordEquationCorrect = true;
            equation.wordEquation.reactants.forEach((correctWord, i) => {
                const selectedWord = document.getElementById(`word-reactant-${index}-${i}`).value;
                if (selectedWord !== correctWord) isWordEquationCorrect = false;
            });
            equation.wordEquation.products.forEach((correctWord, i) => {
                const selectedWord = document.getElementById(`word-product-${index}-${i}`).value;
                if (selectedWord !== correctWord) isWordEquationCorrect = false;
            });

            // Update label colors based on correctness
            if (isTypeCorrect && selectedType !== '') {
                typeLabel.classList.add('correct');
                typeLabel.classList.remove('solved');
            } else {
                typeLabel.classList.remove('correct', 'solved');
            }

            if (isWordEquationCorrect && 
                document.getElementById(`word-reactant-${index}-0`).value !== '') {
                wordLabel.classList.add('correct');
                wordLabel.classList.remove('solved');
            } else {
                wordLabel.classList.remove('correct', 'solved');
            }

            // Check balancing
            let isBalanced = true;
            equation.reactants.forEach((_, i) => {
                let selectValue = document.getElementById(`select-${index}-${i}`).value;
                if (selectValue === "") selectValue = "1"; // Treat empty as "1"
                if (parseInt(selectValue) !== equation.balanced[i]) isBalanced = false;
            });

            equation.products.forEach((_, i) => {
                let selectValue = document.getElementById(`select-${index}-${equation.reactants.length + i}`).value;
                if (selectValue === "") selectValue = "1"; // Treat empty as "1"
                if (parseInt(selectValue) !== equation.balanced[equation.reactants.length + i]) isBalanced = false;
            });

            // Update display based on completeness
            const energyCheck = equation.energyType ? isEnergyCorrect : selectedEnergy === '';
            const allCorrect = isTypeCorrect && isWordEquationCorrect && isBalanced && energyCheck;
            
            if (allCorrect && selectedType !== '' && 
                document.getElementById(`word-reactant-${index}-0`).value !== '' &&
                (equation.energyType ? selectedEnergy !== '' : true)) {
                container.className = 'equation-container sparkly-green';
                arrow.className = 'arrow green-arrow';
                reactionName.classList.remove('reaction-name');
                reactionName.classList.add('balanced-name');
                solveButton.disabled = true;
                solveButton.classList.remove('enabled');
                solveButton.setAttribute('data-balanced', 'true');
                updateScore(level, index, 'solved');
                // Save completion status
                completionStatus[equation.name] = 'solved';
                saveCompletionStatus();
            } else if (isBalanced) {
                container.className = 'equation-container pale-green';
                arrow.className = 'arrow green-arrow';
                reactionName.classList.remove('reaction-name');
                reactionName.classList.add('balanced-name');
                solveButton.disabled = true;
                solveButton.classList.remove('enabled');
                solveButton.setAttribute('data-balanced', 'true');
                // Only count as solved if all parts are complete
                if (isTypeCorrect && isWordEquationCorrect && energyCheck &&
                    selectedType !== '' && document.getElementById(`word-reactant-${index}-0`).value !== '') {
                    updateScore(level, index, 'solved');
                }
            } else {
                container.className = 'equation-container pale-red';
                arrow.className = 'arrow red-arrow';
                reactionName.classList.remove('balanced-name');
                reactionName.classList.add('reaction-name');
            }
        }

        function enableSolveButtonWithDelay(index, level) {
            const solveButton = document.getElementById(`solve-button-${index}`);
            if (solveButton.classList.contains('enabled') || solveButton.getAttribute('data-balanced') === 'true') return;  // Already enabled or balanced, return

            setTimeout(() => {
                if (solveButton.getAttribute('data-balanced') !== 'true') {  // Only enable if not balanced
                    solveButton.classList.add('enabled');
                    solveButton.disabled = false;  // Enable the button
                }
            }, 10000);  // 10 seconds delay
        }

        function solveEquation(level, index, equation) {
            // Set reaction type
            document.getElementById(`type-select-${index}`).value = equation.reactionTypes[0];

            // Set energy type
            if (equation.energyType) {
                document.getElementById(`energy-select-${index}`).value = equation.energyType;
            } else {
                // If no energy type defined, ensure it's blank
                document.getElementById(`energy-select-${index}`).value = '';
            }

            // Set word equation
            equation.wordEquation.reactants.forEach((word, i) => {
                document.getElementById(`word-reactant-${index}-${i}`).value = word;
            });
            equation.wordEquation.products.forEach((word, i) => {
                document.getElementById(`word-product-${index}-${i}`).value = word;
            });

            // Set coefficients
            equation.reactants.forEach((_, i) => {
                document.getElementById(`select-${index}-${i}`).value = equation.balanced[i] === 1 ? "" : equation.balanced[i]; // Display "1" as ""
            });
            equation.products.forEach((_, i) => {
                document.getElementById(`select-${index}-${equation.reactants.length + i}`).value = equation.balanced[equation.reactants.length + i] === 1 ? "" : equation.balanced[equation.reactants.length + i]; // Display "1" as ""
            });

            const container = document.getElementById(`equation-${index}`);
            const arrow = document.getElementById(`arrow-${index}`);
            const solveButton = document.getElementById(`solve-button-${index}`);
            
            // Update labels to yellow
            const typeLabel = document.getElementById(`type-label-${index}`);
            const wordLabel = document.getElementById(`word-label-${index}`);
            const energyLabel = document.getElementById(`energy-label-${index}`);
            
            typeLabel.classList.remove('correct');
            typeLabel.classList.add('solved');
            wordLabel.classList.remove('correct');
            wordLabel.classList.add('solved');
            
            if (equation.energyType) {
                energyLabel.classList.remove('correct');
                energyLabel.classList.add('solved');
            }
            
            // Check and set the status to yellow
            container.className = 'equation-container pale-yellow';
            arrow.className = 'arrow yellow-arrow';
            solveButton.disabled = true;  // Disable the solve button when used
            solveButton.classList.remove('enabled');  // Remove the enabled style
            solveButton.setAttribute('data-balanced', 'true');  // Mark as balanced
            
            // Update score to assisted
            updateScore(level, index, 'assisted');
            // Save completion status
            completionStatus[equation.name] = 'assisted';
            saveCompletionStatus();
        }

        function refreshPage() {
            window.location.reload();
        }

        function toggleHint(index) {
            const tip = document.getElementById(`tip-${index}`);
            tip.style.display = (tip.style.display === 'none' || tip.style.display === '') ? 'block' : 'none';
        }

        function openModal() {
            document.getElementById('helpModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('helpModal').style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('helpModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Load scores and default level on page load
        window.onload = function() {
            loadScores();
            loadCompletionStatus();
            loadName();
            loadEquations('simple');
        };
    </script>
</body>
</html>