<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VastVocab Manifest Generator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e3c72;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 0.95em;
        }
        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .section h3 {
            color: #2a5298;
            margin-top: 0;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
            margin-bottom: 10px;
        }
        .file-list {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9em;
        }
        .file-item {
            padding: 4px 0;
            color: #333;
        }
        .file-item.error {
            color: #d32f2f;
        }
        .file-item.success {
            color: #388e3c;
        }
        button {
            background: linear-gradient(135deg, #2a5298, #1e3c72);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 82, 152, 0.3);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        button.download {
            background: linear-gradient(135deg, #00a86b, #008855);
        }
        .preview {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .status {
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
            font-weight: 500;
        }
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        .status.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        .status.info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¯ VastVocab Manifest Generator</h1>
        <div class="subtitle">Generates manifest.json from your curriculum JSON files</div>

        <div class="section">
            <h3>Step 1: Enter JSON Filenames</h3>
            <p>List your curriculum JSON files (one per line):</p>
            <textarea id="fileList" rows="12" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-family: monospace;">forces.json
electromagnetism.json
climate-change.json
cell-biology.json
complex-numbers.json
quantitative-chemistry.json
industrial-revolution.json
world-war-2.json</textarea>
        </div>

        <button id="generateBtn">Generate Manifest</button>

        <div id="statusDiv"></div>

        <div class="section" id="resultsSection" style="display: none;">
            <h3>Generated Manifest Preview</h3>
            <div class="preview" id="manifestPreview"></div>
            <button class="download" id="downloadBtn">Download manifest.json</button>
            <button id="copyBtn">Copy to Clipboard</button>
        </div>
    </div>

    <script>
        let generatedManifest = null;

        // Parse curriculum ID into hierarchical components
        function parseId(id, framework) {
            const parts = id.split('-');
            const result = {};

            if (framework === 'vce') {
                // vce-specialist-mathematics-y12-u03-complex-numbers
                // or vce-biology-y11-u01-aos02-cell-biology
                let subjectParts = [];
                let i = 1; // Skip 'vce'
                
                // Collect subject parts until we hit year
                while (i < parts.length && !parts[i].startsWith('y')) {
                    subjectParts.push(parts[i]);
                    i++;
                }
                result.subject = subjectParts.join('-');
                
                // Year (y11, y12)
                if (i < parts.length && parts[i].startsWith('y')) {
                    result.year = 'year-' + parts[i].substring(1);
                    i++;
                }
                
                // Unit (u01, u02, etc)
                if (i < parts.length && parts[i].startsWith('u')) {
                    const unitNum = parts[i].substring(1);
                    result.unit = 'unit-' + unitNum.padStart(2, '0');
                    i++;
                }
                
                // Area of Study (aos01, aos02, etc)
                if (i < parts.length && parts[i].startsWith('aos')) {
                    const aosNum = parts[i].substring(3);
                    result.area = 'area-of-study-' + aosNum.padStart(2, '0');
                    i++;
                }
                
                // Topic (remaining parts)
                result.topic = parts.slice(i).join('-');
                
            } else if (framework === 'hsc') {
                // hsc-physics-y12-m06-electromagnetism
                let subjectParts = [];
                let i = 1; // Skip 'hsc'
                
                while (i < parts.length && !parts[i].startsWith('y')) {
                    subjectParts.push(parts[i]);
                    i++;
                }
                result.subject = subjectParts.join('-');
                
                // Year
                if (i < parts.length && parts[i].startsWith('y')) {
                    result.year = 'year-' + parts[i].substring(1);
                    i++;
                }
                
                // Module
                if (i < parts.length && parts[i].startsWith('m')) {
                    const moduleNum = parts[i].substring(1);
                    result.module = 'module-' + moduleNum.padStart(2, '0');
                    i++;
                }
                
                // Topic
                result.topic = parts.slice(i).join('-');
                
            } else if (framework === 'vic-curriculum') {
                // vic-y78-science-forces
                result.yearBand = 'years-' + parts[1].substring(1, 2) + '-' + parts[1].substring(2);
                result.subject = parts[2];
                result.topic = parts.slice(3).join('-');
                
            } else if (framework === 'australian-curriculum') {
                // aus-y09-geography-climate-change
                result.year = 'year-' + parts[1].substring(1);
                result.subject = parts[2];
                result.topic = parts.slice(3).join('-');
            }

            return result;
        }

        // Format label for display
        function formatLabel(str) {
            if (!str) return '';
            return str.split('-')
                .map(word => {
                    // Handle numbers (remove leading zeros)
                    if (/^\d+$/.test(word)) {
                        return parseInt(word).toString();
                    }
                    return word.charAt(0).toUpperCase() + word.slice(1);
                })
                .join(' ');
        }

        // Create display names
        function createDisplayNames(parsed, framework) {
            const names = {};
            
            if (parsed.subject) names.subjectName = formatLabel(parsed.subject);
            if (parsed.year) names.yearName = formatLabel(parsed.year);
            if (parsed.yearBand) names.yearBandName = formatLabel(parsed.yearBand);
            if (parsed.unit) names.unitName = formatLabel(parsed.unit);
            if (parsed.module) names.moduleName = formatLabel(parsed.module);
            if (parsed.area) {
                const areaLabel = formatLabel(parsed.area);
                names.areaName = areaLabel.replace('Area Of Study', 'AOS');
            }
            if (parsed.topic) names.topicName = formatLabel(parsed.topic);
            
            return names;
        }

        // Build breadcrumb
        function buildBreadcrumb(metadata, parsed, frameworkName) {
            const parts = [frameworkName];
            
            if (parsed.yearBand && parsed.yearBandName) parts.push(parsed.yearBandName);
            else if (parsed.year && parsed.yearName) parts.push(parsed.yearName);
            
            if (parsed.subjectName) parts.push(parsed.subjectName);
            if (parsed.unitName) parts.push(parsed.unitName);
            if (parsed.moduleName) parts.push(parsed.moduleName);
            if (parsed.areaName) parts.push(parsed.areaName);
            if (parsed.topicName) parts.push(parsed.topicName);
            
            return parts.join(' > ');
        }

        async function generateManifest() {
            const fileListText = document.getElementById('fileList').value;
            const files = fileListText.split('\n').map(f => f.trim()).filter(f => f);
            
            if (files.length === 0) {
                showStatus('error', 'Please enter at least one JSON filename');
                return;
            }

            showStatus('info', `Loading ${files.length} curriculum files...`);
            
            const curricula = [];
            const errors = [];

            for (const filename of files) {
                try {
                    const response = await fetch(filename);
                    if (!response.ok) {
                        errors.push(`${filename}: HTTP ${response.status}`);
                        continue;
                    }
                    
                    const data = await response.json();
                    const metadata = data.metadata;
                    
                    if (!metadata || !metadata.id || !metadata.framework) {
                        errors.push(`${filename}: Missing required metadata`);
                        continue;
                    }

                    // Parse the ID into components
                    const parsed = parseId(metadata.id, metadata.framework);
                    
                    // Create display names
                    const displayNames = createDisplayNames(parsed, metadata.framework);
                    
                    // Build entry
                    const entry = {
                        id: metadata.id,
                        framework: metadata.framework,
                        frameworkName: metadata.frameworkName,
                        ...parsed,
                        ...displayNames,
                        path: filename,
                        colors: metadata.colors || ["#1e3c72", "#2a5298", "#00a86b", "#008855"],
                        breadcrumb: metadata.breadcrumb || buildBreadcrumb(metadata, { ...parsed, ...displayNames }, metadata.frameworkName)
                    };
                    
                    curricula.push(entry);
                    
                } catch (error) {
                    errors.push(`${filename}: ${error.message}`);
                }
            }

            if (curricula.length === 0) {
                showStatus('error', `Failed to load any curricula. Errors: ${errors.join(', ')}`);
                return;
            }

            // Create manifest
            generatedManifest = {
                version: "1.0.0",
                generated: new Date().toISOString(),
                curricula: curricula
            };

            // Show results
            const preview = JSON.stringify(generatedManifest, null, 2);
            document.getElementById('manifestPreview').textContent = preview;
            document.getElementById('resultsSection').style.display = 'block';

            let statusMsg = `âœ… Successfully generated manifest with ${curricula.length} curricula`;
            if (errors.length > 0) {
                statusMsg += `\nâš ï¸ ${errors.length} errors: ${errors.join(', ')}`;
            }
            showStatus('success', statusMsg);
        }

        function downloadManifest() {
            if (!generatedManifest) return;
            
            const jsonStr = JSON.stringify(generatedManifest, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'manifest.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('success', 'âœ… Downloaded manifest.json');
        }

        function copyToClipboard() {
            if (!generatedManifest) return;
            
            const jsonStr = JSON.stringify(generatedManifest, null, 2);
            navigator.clipboard.writeText(jsonStr).then(() => {
                showStatus('success', 'âœ… Copied to clipboard');
            }).catch(err => {
                showStatus('error', 'Failed to copy: ' + err.message);
            });
        }

        function showStatus(type, message) {
            const statusDiv = document.getElementById('statusDiv');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
        }

        document.getElementById('generateBtn').addEventListener('click', generateManifest);
        document.getElementById('downloadBtn').addEventListener('click', downloadManifest);
        document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
    </script>
</body>
</html>