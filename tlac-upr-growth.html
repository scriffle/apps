<!DOCTYPE html>
<html lang="en" data-theme="light" data-version="3.0.0">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="TLAC and UPR Growth - Professional development tracking for teachers">
    <title>TLAC and UPR Growth</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,500;9..144,600;9..144,700&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
:root{--color-primary:#b5654a;--color-primary-dark:#8f4a35;--color-primary-light:#d4927a;--color-secondary:#6b8f71;--color-secondary-dark:#4a6b4f;--color-secondary-light:#8fb094;--color-accent:#c9a227;--color-accent-light:#e8d089;--color-upr-primary:#5a8f7a;--color-upr-primary-dark:#3d6b5a;--color-upr-primary-light:#8fc4b0;--color-upr-accent:#7a8f5a;--color-bg:#faf8f5;--color-bg-warm:#f5f0e8;--color-bg-card:#fff;--color-bg-hover:#f0ebe3;--color-bg-active:#e8e0d4;--color-text:#3d3632;--color-text-secondary:#6b635b;--color-text-muted:#9a928a;--color-text-inverse:#faf8f5;--color-border:#e0d8cf;--color-border-light:#ebe5dc;--color-border-focus:var(--color-primary);--color-success:#2e7d32;--color-success-bg:#e8f5e9;--color-progress:#00838f;--color-progress-bg:#e0f7fa;--color-struggling:#e65100;--color-struggling-bg:#fff3e0;--color-warning:#c9a227;--color-warning-bg:#faf5e6;--color-error:#bf5340;--color-error-bg:#fae8e6;--color-info:#5a7f8f;--color-info-bg:#e8f0f2;--space-1:.125rem;--space-2:.25rem;--space-3:.5rem;--space-4:.75rem;--space-5:1rem;--space-6:1.25rem;--space-7:1.5rem;--space-8:2rem;--font-display:'Fraunces',Georgia,serif;--font-body:'Source Sans 3',-apple-system,BlinkMacSystemFont,sans-serif;--text-xs:.7rem;--text-sm:.8rem;--text-base:.9rem;--text-lg:1rem;--text-xl:1.1rem;--text-2xl:1.25rem;--text-3xl:1.5rem;--line-height-tight:1.2;--line-height-normal:1.4;--line-height-relaxed:1.5;--shadow-sm:0 1px 2px rgba(61,54,50,.05);--shadow-md:0 4px 6px rgba(61,54,50,.07),0 2px 4px rgba(61,54,50,.05);--shadow-lg:0 10px 15px rgba(61,54,50,.1),0 4px 6px rgba(61,54,50,.05);--shadow-focus:0 0 0 3px rgba(181,101,74,.3);--radius-sm:4px;--radius-md:8px;--radius-lg:12px;--radius-xl:16px;--transition-fast:.15s ease;--transition-normal:.25s ease;--transition-slow:.35s ease;--cat-1:#b5654a;--cat-2:#6b8f71;--cat-3:#c9a227;--cat-4:#5a7f8f;--cat-5:#8f6b8f;--cat-6:#8f7a5a;--cat-7:#5a8f8f;--upr-cat-1:#5a8f7a;--upr-cat-2:#6b8f8f;--upr-cat-3:#7a8f6b;--upr-cat-4:#8f7a6b;--upr-cat-5:#8f6b7a;--upr-cat-6:#6b6b8f;--upr-cat-7:#7a6b8f;--upr-cat-8:#5a8f7a;--upr-cat-9:#8f8f5a;--upr-cat-10:#6b8f5a}
[data-theme=dark]{--color-primary:#c9845e;--color-primary-dark:#a66b48;--color-primary-light:#e8b8a4;--color-secondary:#7a9e80;--color-secondary-dark:#5a7e60;--color-secondary-light:#b0cfb4;--color-accent:#d4bc6a;--color-accent-light:#f5e8b8;--color-upr-primary:#7ac4a8;--color-upr-primary-dark:#5a9e80;--color-upr-primary-light:#a8e8d0;--color-upr-accent:#9eb87a;--color-bg:#1a1816;--color-bg-warm:#222020;--color-bg-card:#2a2725;--color-bg-hover:#363330;--color-bg-active:#423e3a;--color-text:#f5f0e8;--color-text-secondary:#d4ccc0;--color-text-muted:#9a928a;--color-text-inverse:#1a1816;--color-border:#3d3835;--color-border-light:#4a4440;--color-border-focus:var(--color-primary);--color-success:#66bb6a;--color-success-bg:#1f2a1f;--color-progress:#4dd0e1;--color-progress-bg:#1a2a2d;--color-struggling:#ff9800;--color-struggling-bg:#2a2218;--color-warning:#d4bc6a;--color-warning-bg:#2a2618;--color-error:#c9845e;--color-error-bg:#2a1f1c;--color-info:#7a9eb0;--color-info-bg:#1c2428;--shadow-sm:0 1px 2px rgba(0,0,0,.2);--shadow-md:0 4px 6px rgba(0,0,0,.25),0 2px 4px rgba(0,0,0,.15);--shadow-lg:0 10px 15px rgba(0,0,0,.3),0 4px 6px rgba(0,0,0,.2);--shadow-focus:0 0 0 3px rgba(201,132,94,.4)}
[data-theme=dark] .app-header{background:linear-gradient(135deg,#3d2d25 0%,#2a1f1a 100%)}
[data-theme=dark] .panel-nav-btn{color:#b0a8a0}
[data-theme=dark] .panel-nav-btn:hover{color:#f5f0e8}
[data-theme=dark] .panel-nav-btn[aria-selected=true]{color:#e8c4a8}
[data-theme=dark] .main-panels-nav{background:#1f1d1b;border-bottom-color:#3d3835}
*,::after,::before{box-sizing:border-box;margin:0;padding:0}
html{font-size:16px;scroll-behavior:smooth}
@media (prefers-reduced-motion:reduce){html{scroll-behavior:auto}*,::after,::before{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}
body{font-family:var(--font-body);font-size:var(--text-base);line-height:var(--line-height-normal);color:var(--color-text);background-color:var(--color-bg);min-height:100vh;min-height:100dvh;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
.skip-link{position:absolute;top:-100%;left:var(--space-4);padding:var(--space-3) var(--space-4);background:var(--color-primary);color:var(--color-text-inverse);border-radius:var(--radius-md);text-decoration:none;font-weight:500;z-index:10000;transition:top var(--transition-fast)}
.skip-link:focus{top:var(--space-4);outline:0}
:focus-visible{outline:2px solid var(--color-border-focus);outline-offset:2px}
.app-container{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh}
.app-header{background:linear-gradient(135deg,var(--color-primary-dark) 0%,#6b3a2a 100%);color:#fff;padding:var(--space-3) var(--space-5);position:sticky;top:0;z-index:100;box-shadow:var(--shadow-md)}
.header-content{max-width:1400px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:var(--space-4);flex-wrap:wrap}
.app-title{font-family:var(--font-display);font-size:var(--text-2xl);font-weight:600;letter-spacing:-.02em;display:flex;align-items:center;gap:var(--space-3)}
.app-title-icon{width:28px;height:28px;background:rgba(255,255,255,.2);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:var(--text-base)}
.header-actions{display:flex;align-items:center;gap:var(--space-2)}
.undo-redo-group{display:flex;gap:var(--space-1)}
.font-size-group{display:flex;gap:var(--space-1)}
.undo-btn,.redo-btn,.font-size-btn,.header-actions .settings-btn{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.2);color:var(--color-text-inverse);padding:var(--space-2);border-radius:var(--radius-sm);cursor:pointer;font-size:var(--text-base);transition:all var(--transition-fast);min-width:32px;min-height:32px;display:flex;align-items:center;justify-content:center}
.undo-btn:hover:not(:disabled),.redo-btn:hover:not(:disabled),.font-size-btn:hover,.header-actions .settings-btn:hover{background:rgba(255,255,255,.25)}
.undo-btn:disabled,.redo-btn:disabled,.font-size-btn:disabled{opacity:.4;cursor:not-allowed}
.font-size-btn{font-size:var(--text-xs);font-weight:600;font-family:var(--font-body);padding:var(--space-1) var(--space-2)}
.main-panels-nav{background:var(--color-bg-card);border-bottom:1px solid var(--color-border);padding:0 var(--space-4)}
.panels-nav-content{max-width:1400px;margin:0 auto;display:flex;gap:var(--space-5)}
.panel-nav-btn{background:0 0;border:none;padding:var(--space-3) var(--space-2);font-family:var(--font-display);font-size:var(--text-base);font-weight:500;color:var(--color-text-muted);cursor:pointer;position:relative;transition:color var(--transition-fast);min-height:40px}
.panel-nav-btn:hover{color:var(--color-text)}
.panel-nav-btn[aria-selected=true]{color:var(--color-primary)}
.panel-nav-btn[aria-selected=true]::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--color-primary);border-radius:2px 2px 0 0}
.panel-nav-btn.upr-nav[aria-selected=true]{color:var(--color-upr-primary)}
.panel-nav-btn.upr-nav[aria-selected=true]::after{background:var(--color-upr-primary)}
.panel-nav-btn .panel-icon{margin-right:var(--space-2)}
.main-content{flex:1;max-width:1400px;width:100%;margin:0 auto;padding:var(--space-4)}
.panel-content{display:none}
.panel-content.active{display:block;animation:fadeIn var(--transition-normal)}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.sub-tabs{display:flex;gap:var(--space-1);margin-bottom:var(--space-3);border-bottom:1px solid var(--color-border);overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.sub-tabs::-webkit-scrollbar{display:none}
.sub-tab{background:0 0;border:none;padding:var(--space-2) var(--space-3);font-family:var(--font-body);font-size:var(--text-sm);font-weight:500;color:var(--color-text-secondary);cursor:pointer;white-space:nowrap;position:relative;transition:color var(--transition-fast);min-height:32px}
.sub-tab:hover{color:var(--color-text)}
.sub-tab[aria-selected=true]{color:var(--color-primary)}
.sub-tab[aria-selected=true]::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:2px;background:var(--color-primary)}
.sub-tab.upr-tab[aria-selected=true]{color:var(--color-upr-primary)}
.sub-tab.upr-tab[aria-selected=true]::after{background:var(--color-upr-primary)}
.sub-tab-link{padding:var(--space-2) var(--space-3);font-family:var(--font-body);font-size:var(--text-sm);font-weight:500;color:var(--color-text-muted);text-decoration:none;white-space:nowrap;min-height:32px;display:flex;align-items:center;margin-left:auto;transition:color var(--transition-fast)}
.sub-tab-link:hover{color:var(--color-primary)}
.sub-tab-link.upr-link:hover{color:var(--color-upr-primary)}
.tab-panel{display:none}
.tab-panel.active{display:block;animation:fadeIn var(--transition-normal)}
.card{background:var(--color-bg-card);border:1px solid var(--color-border);border-radius:var(--radius-md);padding:var(--space-4);margin-bottom:var(--space-3);box-shadow:var(--shadow-sm)}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-3);gap:var(--space-2)}
.card-title{font-family:var(--font-display);font-size:var(--text-lg);font-weight:600;color:var(--color-text)}
.card.upr-card{border-left:3px solid var(--color-upr-primary)}
.card.upr-card .card-title{color:var(--color-upr-primary-dark)}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:var(--space-2);padding:var(--space-2) var(--space-3);font-family:var(--font-body);font-size:var(--text-sm);font-weight:500;border-radius:var(--radius-sm);border:none;cursor:pointer;transition:all var(--transition-fast);min-height:32px;text-decoration:none}
.btn-primary{background:var(--color-primary);color:var(--color-text-inverse)}
.btn-primary:hover{background:var(--color-primary-dark)}
.btn-upr{background:var(--color-upr-primary);color:var(--color-text-inverse)}
.btn-upr:hover{background:var(--color-upr-primary-dark)}
.btn-secondary{background:var(--color-bg-warm);color:var(--color-text);border:1px solid var(--color-border)}
.btn-secondary:hover{background:var(--color-bg-hover)}
.btn-sm{padding:var(--space-1) var(--space-2);font-size:var(--text-xs);min-height:26px}
.form-group{margin-bottom:var(--space-3)}
.form-label{display:block;font-size:var(--text-xs);font-weight:500;color:var(--color-text-secondary);margin-bottom:var(--space-1)}
.form-input,.form-textarea,.form-select{width:100%;padding:var(--space-2);font-family:var(--font-body);font-size:var(--text-sm);color:var(--color-text);background:var(--color-bg-card);border:1px solid var(--color-border);border-radius:var(--radius-sm);transition:border-color var(--transition-fast),box-shadow var(--transition-fast);min-height:32px}
.form-input:hover,.form-textarea:hover,.form-select:hover{border-color:var(--color-text-muted)}
.form-input:focus,.form-textarea:focus,.form-select:focus{outline:0;border-color:var(--color-border-focus);box-shadow:var(--shadow-focus)}
.form-textarea{min-height:60px;resize:vertical}
.form-select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b635b' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right var(--space-2) center;padding-right:var(--space-6)}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:var(--space-3)}
.category-section{margin-bottom:var(--space-3)}
.category-header{display:flex;align-items:center;justify-content:space-between;padding:var(--space-3);background:var(--color-bg-warm);border-radius:var(--radius-sm);cursor:pointer;transition:background var(--transition-fast);min-height:40px;border-left:3px solid var(--cat-1)}
.category-header:hover{background:var(--color-bg-hover)}
.category-header[aria-expanded=false]{border-radius:var(--radius-sm)}
.category-header[aria-expanded=true]{border-radius:var(--radius-sm) var(--radius-sm) 0 0}
.category-header-left{display:flex;align-items:center;gap:var(--space-2)}
.category-number{width:22px;height:22px;display:flex;align-items:center;justify-content:center;background:var(--color-bg-card);border-radius:var(--radius-sm);font-size:var(--text-xs);font-weight:600;color:var(--color-text-secondary)}
.category-title{font-family:var(--font-display);font-size:var(--text-base);font-weight:500;color:var(--color-text)}
.category-toggle{font-size:var(--text-base);color:var(--color-text-muted);transition:transform var(--transition-fast)}
.category-header[aria-expanded=true] .category-toggle{transform:rotate(180deg)}
.category-content{display:none;background:var(--color-bg-card);border:1px solid var(--color-border);border-top:none;border-radius:0 0 var(--radius-sm) var(--radius-sm);padding:var(--space-2)}
.category-content.expanded{display:block}
.category-1 .category-header{border-left-color:var(--cat-1)}
.category-2 .category-header{border-left-color:var(--cat-2)}
.category-3 .category-header{border-left-color:var(--cat-3)}
.category-4 .category-header{border-left-color:var(--cat-4)}
.category-5 .category-header{border-left-color:var(--cat-5)}
.category-6 .category-header{border-left-color:var(--cat-6)}
.category-7 .category-header{border-left-color:var(--cat-7)}
.upr-category-1 .category-header{border-left-color:var(--upr-cat-1)}
.upr-category-2 .category-header{border-left-color:var(--upr-cat-2)}
.upr-category-3 .category-header{border-left-color:var(--upr-cat-3)}
.upr-category-4 .category-header{border-left-color:var(--upr-cat-4)}
.upr-category-5 .category-header{border-left-color:var(--upr-cat-5)}
.upr-category-6 .category-header{border-left-color:var(--upr-cat-6)}
.upr-category-7 .category-header{border-left-color:var(--upr-cat-7)}
.upr-category-8 .category-header{border-left-color:var(--upr-cat-8)}
.upr-category-9 .category-header{border-left-color:var(--upr-cat-9)}
.upr-category-10 .category-header{border-left-color:var(--upr-cat-10)}
.technique-item,.practice-item{border:1px solid var(--color-border-light);border-radius:var(--radius-sm);margin-bottom:var(--space-1);overflow:hidden;transition:box-shadow var(--transition-fast)}
.technique-item:hover,.practice-item:hover{box-shadow:var(--shadow-sm)}
.technique-item:last-child,.practice-item:last-child{margin-bottom:0}
.technique-header,.practice-header{display:flex;align-items:center;justify-content:space-between;padding:var(--space-2) var(--space-3);cursor:pointer;transition:background var(--transition-fast);min-height:36px;gap:var(--space-2)}
.technique-header:hover,.practice-header:hover{background:var(--color-bg-hover)}
.technique-info,.practice-info{flex:1;min-width:0}
.technique-name,.practice-name{font-size:var(--text-sm);font-weight:600;color:var(--color-text)}
.technique-number,.practice-number{color:var(--color-text-muted);font-weight:400}
.technique-desc,.practice-desc{font-size:var(--text-xs);color:var(--color-text-secondary);line-height:var(--line-height-tight)}
.technique-controls,.practice-controls{display:flex;align-items:center;gap:var(--space-1);flex-shrink:0}
.technique-toggle,.practice-toggle{color:var(--color-text-muted);transition:transform var(--transition-fast);padding:var(--space-1);font-size:var(--text-sm)}
.technique-header[aria-expanded=true] .technique-toggle,.practice-header[aria-expanded=true] .practice-toggle{transform:rotate(180deg)}
.status-select{padding:var(--space-1) var(--space-2);padding-right:var(--space-5);font-size:var(--text-xs);min-width:120px;min-height:26px;border-radius:var(--radius-sm);font-weight:500}
.status-select.status-use-this-week{background-color:var(--color-info);color:#fff;border-color:var(--color-info)}
.status-select.status-often{background-color:var(--color-success);color:#fff;border-color:var(--color-success)}
.status-select.status-occasionally{background-color:var(--color-progress);color:#fff;border-color:var(--color-progress)}
.status-select.status-not-successful{background-color:var(--color-struggling);color:#fff;border-color:var(--color-struggling)}
.status-select.status-dont-use{background-color:var(--color-text-muted);color:#fff;border-color:var(--color-text-muted)}
.status-select.status-not-yet{background-color:var(--color-warning);color:#3d3632;border-color:var(--color-warning)}
.status-select.status-not-suitable{background-color:var(--color-bg-warm);color:var(--color-text-secondary);border-color:var(--color-border)}
.status-select option[value="use-this-week"]{background-color:var(--color-info);color:#fff}
.status-select option[value="often"]{background-color:var(--color-success);color:#fff}
.status-select option[value="occasionally"]{background-color:var(--color-progress);color:#fff}
.status-select option[value="not-successful"]{background-color:var(--color-struggling);color:#fff}
.status-select option[value="dont-use"]{background-color:var(--color-text-muted);color:#fff}
.status-select option[value="not-yet"]{background-color:var(--color-warning);color:#3d3632}
.status-select option[value="not-suitable"]{background-color:var(--color-bg-warm);color:var(--color-text-secondary)}
.technique-details,.practice-details{display:none;padding:var(--space-3);background:var(--color-bg-warm);border-top:1px solid var(--color-border-light)}
.technique-details.expanded,.practice-details.expanded{display:block}
.detail-section{margin-bottom:var(--space-3)}
.detail-section:last-child{margin-bottom:0}
.detail-label{font-size:var(--text-xs);font-weight:600;color:var(--color-text-secondary);margin-bottom:var(--space-1)}
.resource-links{display:flex;flex-wrap:wrap;gap:var(--space-1)}
.resource-link{display:inline-flex;align-items:center;gap:var(--space-1);padding:var(--space-1) var(--space-2);background:var(--color-bg-card);border:1px solid var(--color-border);border-radius:var(--radius-sm);color:var(--color-primary);text-decoration:none;font-size:var(--text-xs);font-weight:500;transition:all var(--transition-fast);min-height:26px}
.resource-link:hover{background:var(--color-primary);color:var(--color-text-inverse);border-color:var(--color-primary)}
.resource-link.upr-link{color:var(--color-upr-primary)}
.resource-link.upr-link:hover{background:var(--color-upr-primary);color:var(--color-text-inverse);border-color:var(--color-upr-primary)}
.notes-input{margin-bottom:var(--space-2)}
.notes-list{max-height:150px;overflow-y:auto}
.explanation-toggle{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-2);background:var(--color-bg-card);border:1px solid var(--color-border);border-radius:var(--radius-sm);cursor:pointer;font-weight:500;font-size:var(--text-xs);color:var(--color-text);width:100%;text-align:left;transition:background var(--transition-fast);margin-top:var(--space-2);min-height:28px}
.explanation-toggle:hover{background:var(--color-bg-hover)}
.explanation-toggle-icon{transition:transform var(--transition-fast);color:var(--color-text-muted);font-size:var(--text-xs)}
.explanation-toggle[aria-expanded=true] .explanation-toggle-icon{transform:rotate(180deg)}
.explanation-placeholder{opacity:.7;border-style:dashed}
.explanation-placeholder:hover{opacity:1}
.explanation-content{display:none;background:var(--color-bg-card);border:1px solid var(--color-border);border-top:none;border-radius:0 0 var(--radius-sm) var(--radius-sm);padding:var(--space-3);margin-top:-1px}
.explanation-content.expanded{display:block}
.explanation-section{margin-bottom:var(--space-3)}
.explanation-section:last-child{margin-bottom:0}
.explanation-heading{font-family:var(--font-display);font-size:var(--text-sm);font-weight:600;color:var(--color-primary);margin-bottom:var(--space-1);display:flex;align-items:center;gap:var(--space-1)}
.explanation-heading.upr-heading{color:var(--color-upr-primary)}
.explanation-heading-icon{font-size:var(--text-sm)}
.explanation-text{color:var(--color-text);font-size:var(--text-sm);line-height:var(--line-height-normal)}
.explanation-examples{list-style:none;padding:0;margin:0}
.explanation-examples li{position:relative;padding-left:var(--space-4);margin-bottom:var(--space-1);color:var(--color-text);font-size:var(--text-sm);line-height:var(--line-height-normal)}
.explanation-examples li::before{content:'‚Üí';position:absolute;left:0;color:var(--color-secondary);font-weight:600}
.explanation-examples.upr-examples li::before{color:var(--color-upr-primary)}
.explanation-examples li:last-child{margin-bottom:0}
.note-item{background:var(--color-bg-card);border:1px solid var(--color-border-light);border-radius:var(--radius-sm);padding:var(--space-2);margin-bottom:var(--space-1)}
.note-item:last-child{margin-bottom:0}
.note-timestamp{font-size:var(--text-xs);color:var(--color-text-muted)}
.note-text{font-size:var(--text-xs);color:var(--color-text)}
.week-focus-card{background:var(--color-bg-card);border:1px solid var(--color-info);border-radius:var(--radius-sm);margin-bottom:var(--space-2);overflow:hidden}
.week-focus-card.upr-focus-card{border-color:var(--color-upr-primary)}
.week-focus-header{display:flex;align-items:center;justify-content:space-between;padding:var(--space-2) var(--space-3);background:var(--color-info-bg);cursor:pointer;min-height:36px;transition:background var(--transition-fast)}
.week-focus-card.upr-focus-card .week-focus-header{background:rgba(90,143,122,.1)}
.week-focus-header:hover{background:var(--color-bg-hover)}
.week-focus-header-left{display:flex;align-items:center;gap:var(--space-2)}
.week-focus-chevron{font-size:var(--text-sm);color:var(--color-info);transition:transform var(--transition-fast)}
.week-focus-card.upr-focus-card .week-focus-chevron{color:var(--color-upr-primary)}
.week-focus-header[aria-expanded=false] .week-focus-chevron{transform:rotate(-90deg)}
.week-focus-title{font-family:var(--font-display);font-size:var(--text-sm);font-weight:600;color:var(--color-info)}
.week-focus-card.upr-focus-card .week-focus-title{color:var(--color-upr-primary)}
.week-focus-content{display:none;padding:var(--space-3)}
.week-focus-content.expanded{display:block}
.week-focus-explanation{margin-bottom:var(--space-3);padding-bottom:var(--space-3);border-bottom:1px solid var(--color-border-light)}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:var(--space-3)}
.stat-card{background:var(--color-bg-card);border:1px solid var(--color-border);border-radius:var(--radius-sm);padding:var(--space-3)}
.stat-card.upr-stat-card{border-left:3px solid var(--color-upr-primary)}
.stat-card-title{font-family:var(--font-display);font-size:var(--text-sm);font-weight:600;color:var(--color-text);margin-bottom:var(--space-2)}
.stat-row{display:flex;justify-content:space-between;align-items:center;padding:var(--space-1) 0;border-bottom:1px solid var(--color-border-light)}
.stat-row:last-child{border-bottom:none}
.stat-label{color:var(--color-text-secondary);font-size:var(--text-xs)}
.stat-value{font-weight:600;font-size:var(--text-xs);color:var(--color-text)}
.stat-warning{color:var(--color-warning)}
.stat-warning-critical{color:var(--color-error)}
.warning-banner{padding:var(--space-3);border-radius:var(--radius-sm);margin-bottom:var(--space-3);font-size:var(--text-sm);font-weight:500}
.warning-banner.warning-critical{background:var(--color-error-bg);color:var(--color-error);border:1px solid var(--color-error)}
.warning-banner.warning-backup{background:var(--color-warning-bg);color:#8b6914;border:1px solid var(--color-warning)}
.progress-bar{height:6px;background:var(--color-bg-warm);border-radius:3px;overflow:hidden;margin-top:var(--space-2)}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--color-secondary) 0%,var(--color-success) 100%);border-radius:3px;transition:width var(--transition-slow)}
.progress-fill.upr-fill{background:linear-gradient(90deg,var(--color-upr-primary) 0%,var(--color-upr-accent) 100%)}
.empty-state{text-align:center;padding:var(--space-5);color:var(--color-text-muted)}
.empty-state-icon{font-size:32px;margin-bottom:var(--space-2);opacity:.5}
.empty-state-title{font-family:var(--font-display);font-size:var(--text-base);font-weight:600;color:var(--color-text-secondary);margin-bottom:var(--space-1)}
.empty-state-desc{font-size:var(--text-xs);max-width:350px;margin:0 auto}
.toast-container{position:fixed;bottom:var(--space-4);right:var(--space-4);z-index:1000;display:flex;flex-direction:column;gap:var(--space-1)}
.toast{background:var(--color-bg-card);border:1px solid var(--color-border);border-radius:var(--radius-sm);padding:var(--space-2) var(--space-3);box-shadow:var(--shadow-lg);display:flex;align-items:center;gap:var(--space-2);min-width:220px;max-width:320px;animation:slideIn var(--transition-normal)}
@keyframes slideIn{from{opacity:0;transform:translateX(100%)}to{opacity:1;transform:translateX(0)}}
.toast-success{border-left:3px solid var(--color-success)}
.toast-error{border-left:3px solid var(--color-error)}
.toast-warning{border-left:3px solid var(--color-warning)}
.toast-info{border-left:3px solid var(--color-info)}
.toast-message{flex:1;font-size:var(--text-xs)}
.toast-close{background:0 0;border:none;color:var(--color-text-muted);cursor:pointer;padding:var(--space-1);font-size:var(--text-sm)}
.status-bar{position:fixed;bottom:0;left:0;right:0;background:var(--color-bg-card);border-top:1px solid var(--color-border);padding:var(--space-1) var(--space-3);font-size:var(--text-xs);color:var(--color-text-muted);display:flex;justify-content:space-between;align-items:center;z-index:50;min-height:24px}
.status-saved{display:flex;align-items:center;gap:var(--space-2)}
.status-saved::before{content:'‚óè';color:var(--color-success)}
.settings-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:2000}
.settings-overlay.active{display:block}
.settings-panel{position:fixed;top:0;right:-360px;width:340px;max-width:90vw;height:100%;background:var(--color-bg-card);box-shadow:-4px 0 20px rgba(0,0,0,.15);transition:right .25s ease-out;overflow-y:auto;z-index:2001}
.settings-overlay.active .settings-panel{right:0}
.settings-header{display:flex;align-items:center;justify-content:space-between;padding:var(--space-3) var(--space-4);border-bottom:1px solid var(--color-border);position:sticky;top:0;background:var(--color-bg-card);z-index:1}
.settings-title{font-family:var(--font-display);font-size:var(--text-base);font-weight:600;margin:0}
.settings-close-btn{background:0 0;border:none;font-size:var(--text-lg);cursor:pointer;color:var(--color-text-secondary);padding:var(--space-1);border-radius:var(--radius-sm);min-width:32px;min-height:32px;display:flex;align-items:center;justify-content:center}
.settings-close-btn:hover{background:var(--color-bg-warm);color:var(--color-text)}
.settings-content{padding:var(--space-4)}
.settings-section{margin-bottom:var(--space-5)}
.settings-section:last-child{margin-bottom:0}
.settings-section-title{font-size:var(--text-xs);font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:var(--color-text-secondary);margin-bottom:var(--space-3);padding-bottom:var(--space-1);border-bottom:1px solid var(--color-border-light)}
.settings-row{display:flex;align-items:center;justify-content:space-between;padding:var(--space-2) 0}
.settings-row-label{font-size:var(--text-sm);color:var(--color-text)}
.toggle-switch{position:relative;width:44px;height:24px;background:var(--color-border);border-radius:12px;cursor:pointer;transition:background .2s ease}
.toggle-switch.active{background:var(--color-primary)}
.toggle-switch::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;background:#fff;border-radius:50%;transition:transform .2s ease;box-shadow:0 1px 3px rgba(0,0,0,.2)}
.toggle-switch.active::after{transform:translateX(20px)}
.shortcuts-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:2000;align-items:center;justify-content:center}
.shortcuts-overlay.active{display:flex}
.shortcuts-panel{background:var(--color-bg-card);border-radius:var(--radius-md);padding:var(--space-4);max-width:400px;width:90%;max-height:80vh;overflow-y:auto}
.shortcuts-title{font-family:var(--font-display);font-size:var(--text-base);font-weight:600;margin-bottom:var(--space-3)}
.shortcut-row{display:flex;justify-content:space-between;align-items:center;padding:var(--space-1) 0;border-bottom:1px solid var(--color-border-light);font-size:var(--text-xs)}
.shortcut-key{background:var(--color-bg-warm);padding:2px var(--space-2);border-radius:var(--radius-sm);font-family:monospace;font-size:var(--text-xs)}
.email-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:2500;align-items:center;justify-content:center}
.email-modal-overlay.active{display:flex}
.email-modal-content{background:var(--color-bg-card);border-radius:var(--radius-lg);max-width:400px;width:94%;max-height:90vh;overflow:hidden;box-shadow:var(--shadow-lg)}
.email-modal-header{display:flex;justify-content:space-between;align-items:center;padding:var(--space-3) var(--space-4);border-bottom:1px solid var(--color-border)}
.email-modal-header h3{font-family:var(--font-display);font-size:var(--text-lg);font-weight:600;margin:0}
.email-modal-close{background:none;border:none;font-size:var(--text-xl);color:var(--color-text-muted);cursor:pointer;padding:var(--space-1);line-height:1;border-radius:var(--radius-sm)}
.email-modal-close:hover{color:var(--color-text);background:var(--color-bg-hover)}
.email-modal-body{padding:var(--space-4)}
.email-options{display:flex;flex-direction:column;gap:var(--space-2)}
.email-option-btn{display:flex;align-items:center;gap:var(--space-3);text-align:left;padding:var(--space-3)}
.email-option-btn small{font-size:var(--text-xs)}
.welcome-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:3000;align-items:center;justify-content:center}
.welcome-overlay.active{display:flex}
.welcome-panel{background:var(--color-bg-card);border-radius:var(--radius-lg);max-width:600px;width:94%;max-height:90vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:var(--shadow-lg)}
.welcome-header{display:flex;justify-content:space-between;align-items:center;padding:var(--space-4);border-bottom:1px solid var(--color-border)}
.welcome-header h2{font-family:var(--font-display);font-size:var(--text-xl);font-weight:600;color:var(--color-primary);margin:0}
.welcome-close{background:none;border:none;font-size:var(--text-lg);color:var(--color-text-muted);cursor:pointer;padding:var(--space-2);line-height:1;border-radius:var(--radius-sm)}
.welcome-close:hover{color:var(--color-text);background:var(--color-bg-hover)}
.welcome-content{flex:1;overflow-y:auto;padding:var(--space-5)}
.welcome-step{display:none}
.welcome-step.active{display:block}
.welcome-step h3{font-family:var(--font-display);font-size:var(--text-lg);font-weight:600;color:var(--color-text);margin-bottom:var(--space-3)}
.welcome-step p{color:var(--color-text-secondary);margin-bottom:var(--space-3);line-height:var(--line-height-relaxed)}
.welcome-step ul{color:var(--color-text-secondary);margin:var(--space-3) 0;padding-left:var(--space-5)}
.welcome-step li{margin-bottom:var(--space-2)}
.welcome-step .feature-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:var(--space-3);margin:var(--space-4) 0}
.welcome-step .feature-item{background:var(--color-bg-warm);padding:var(--space-3);border-radius:var(--radius-md);text-align:center}
.welcome-step .feature-icon{font-size:var(--text-2xl);margin-bottom:var(--space-2)}
.welcome-step .feature-label{font-size:var(--text-sm);font-weight:500;color:var(--color-text)}
.welcome-step .key-hint{display:inline-block;background:var(--color-bg-active);padding:2px var(--space-2);border-radius:var(--radius-sm);font-family:monospace;font-size:var(--text-xs);margin:0 2px}
.welcome-footer{display:flex;justify-content:space-between;align-items:center;padding:var(--space-4);border-top:1px solid var(--color-border);background:var(--color-bg-warm)}
.welcome-dots{display:flex;gap:var(--space-2)}
.welcome-dot{width:8px;height:8px;border-radius:50%;background:var(--color-border);transition:background var(--transition-fast)}
.welcome-dot.active{background:var(--color-primary)}
.welcome-nav{display:flex;gap:var(--space-2)}
.welcome-nav .btn{min-width:80px}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
@media (max-width:768px){.app-header{padding:var(--space-2) var(--space-3)}.header-content{flex-wrap:wrap}.app-title{font-size:var(--text-base)}.main-content{padding:var(--space-3)}.technique-header,.practice-header{flex-wrap:wrap}.technique-controls,.practice-controls{width:100%;justify-content:space-between;margin-top:var(--space-1)}.status-select{flex:1;min-width:0}.stats-grid{grid-template-columns:1fr}}
@media print{.skip-link,.app-header,.main-panels-nav,.sub-tabs,.settings-btn,.settings-overlay,.undo-redo-group,.btn,.toast-container,.technique-toggle,.practice-toggle,.status-select,.status-bar{display:none!important}body{background:#fff;color:#000;font-size:12pt}.main-content{max-width:none;padding:0}.card,.stat-card,.technique-item,.practice-item,.week-focus-card{break-inside:avoid;border:1px solid #ccc;box-shadow:none}.category-content,.technique-details,.practice-details,.week-focus-content{display:block!important}}
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="app-container">
        <header class="app-header" role="banner">
            <div class="header-content">
                <h1 class="app-title"><span class="app-title-icon" aria-hidden="true">üå±</span>TLAC and UPR Growth</h1>
                <div class="header-actions">
                    <div class="undo-redo-group" role="group" aria-label="Undo and redo actions">
                        <button class="undo-btn" id="undo-btn" aria-label="Undo" title="Undo (Ctrl+Z)" disabled>‚Ü∂</button>
                        <button class="redo-btn" id="redo-btn" aria-label="Redo" title="Redo (Ctrl+Y)" disabled>‚Ü∑</button>
                    </div>
                    <div class="font-size-group" role="group" aria-label="Font size controls">
                        <button class="font-size-btn" id="font-decrease-btn" aria-label="Decrease font size" title="Decrease font size">A‚àí</button>
                        <button class="font-size-btn" id="font-increase-btn" aria-label="Increase font size" title="Increase font size">A+</button>
                    </div>
                    <button class="settings-btn" id="settings-btn" aria-label="Open settings" title="Settings">‚öôÔ∏è</button>
                </div>
            </div>
        </header>
        <nav class="main-panels-nav" role="navigation" aria-label="Main sections">
            <div class="panels-nav-content" role="tablist">
                <button class="panel-nav-btn" role="tab" aria-selected="true" aria-controls="tlac-panel" id="tlac-tab"><span class="panel-icon">üìö</span>TLAC Techniques</button>
                <button class="panel-nav-btn upr-nav" role="tab" aria-selected="false" aria-controls="upr-panel" id="upr-tab"><span class="panel-icon">üíö</span>Unconditional Positive Regard</button>
            </div>
        </nav>
        <main class="main-content" id="main-content" role="main">
            <!-- TLAC Panel -->
            <div class="panel-content active" id="tlac-panel" role="tabpanel" aria-labelledby="tlac-tab">
                <div class="sub-tabs" role="tablist" aria-label="TLAC sections">
                    <button class="sub-tab" role="tab" aria-selected="true" aria-controls="techniques-panel" id="techniques-tab">Techniques</button>
                    <button class="sub-tab" role="tab" aria-selected="false" aria-controls="week-focus-panel" id="week-focus-tab">Week Focus</button>
                    <button class="sub-tab" role="tab" aria-selected="false" aria-controls="dashboard-panel" id="dashboard-tab">Dashboard</button>
                    <button class="sub-tab" role="tab" aria-selected="false" aria-controls="export-panel" id="export-tab">Export & Data</button>
                    <a href="https://teachlikeachampion.org/" target="_blank" rel="noopener noreferrer" class="sub-tab-link">What is TLAC? ‚Üó</a>
                </div>
                <div class="tab-panel active" id="techniques-panel" role="tabpanel" aria-labelledby="techniques-tab">
                    <div id="techniques-container" aria-label="TLAC Techniques"></div>
                    <div class="card" style="margin-top:var(--space-5)">
                        <div class="card-header"><h2 class="card-title">Global Notes</h2></div>
                        <div class="form-group">
                            <label for="global-notes-input" class="form-label">Add overall observations, reflections, and insights</label>
                            <textarea id="global-notes-input" class="form-textarea" placeholder="Share your thoughts on your TLAC journey..."></textarea>
                        </div>
                        <button class="btn btn-primary" id="save-global-note-btn">Save Note</button>
                        <div id="global-notes-list" class="notes-list" style="margin-top:var(--space-4)"></div>
                    </div>
                </div>
                <div class="tab-panel" id="week-focus-panel" role="tabpanel" aria-labelledby="week-focus-tab">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Weekly Focus Techniques</h2>
                            <div><span class="stat-label">Week Started: </span><span id="week-start-date" class="stat-value">‚Äî</span><span class="stat-label" style="margin-left:var(--space-4)">Reset in: </span><span id="week-countdown" class="stat-value">‚Äî</span></div>
                        </div>
                        <div id="week-focus-content"><div class="empty-state"><div class="empty-state-icon">üéØ</div><div class="empty-state-title">No techniques selected</div><p class="empty-state-desc">Select up to 3 techniques from the Techniques tab using "Use this week" status.</p></div></div>
                    </div>
                    <div class="card"><div class="card-header"><h2 class="card-title">Previous Week Focus History</h2></div><div id="week-history-content"><div class="empty-state"><p class="empty-state-desc">No previous week focus history yet.</p></div></div></div>
                </div>
                <div class="tab-panel" id="dashboard-panel" role="tabpanel" aria-labelledby="dashboard-tab">
                    <div class="stats-grid">
                        <div class="stat-card"><h3 class="stat-card-title">Usage Overview</h3><div id="usage-stats"></div></div>
                        <div class="stat-card"><h3 class="stat-card-title">Category Progress</h3><div id="category-progress"></div></div>
                        <div class="stat-card"><h3 class="stat-card-title">Recent Activity</h3><div id="recent-activity"></div></div>
                        <div class="stat-card"><h3 class="stat-card-title">Growth Summary</h3><div id="growth-summary"></div></div>
                    </div>
                </div>
                <div class="tab-panel" id="export-panel" role="tabpanel" aria-labelledby="export-tab">
                    <div class="card">
                        <div class="card-header"><h2 class="card-title">Export for Professional Learning</h2></div>
                        <p style="margin-bottom:var(--space-4);color:var(--color-text-secondary)">Generate reports to demonstrate your growth and share with mentors or supervisors.</p>
                        <div style="display:flex;flex-wrap:wrap;gap:var(--space-3)">
                            <button class="btn btn-primary" id="export-json-btn">üìÑ Export Data (JSON)</button>
                            <button class="btn btn-secondary" id="print-report-btn">üñ®Ô∏è Print Report</button>
                            <button class="btn btn-secondary" id="email-report-btn">‚úâÔ∏è Email Report</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h2 class="card-title">Data Management</h2></div>
                        <div class="form-grid">
                            <div><h4 style="margin-bottom:var(--space-2);font-weight:600">Import Data</h4><p style="font-size:var(--text-sm);color:var(--color-text-secondary);margin-bottom:var(--space-3)">Restore from a previous export</p><input type="file" id="import-file" accept=".json" style="display:none"><button class="btn btn-secondary" id="import-btn">üì• Import from File</button></div>
                            <div><h4 style="margin-bottom:var(--space-2);font-weight:600">Clear All Data</h4><p style="font-size:var(--text-sm);color:var(--color-text-secondary);margin-bottom:var(--space-3)">Start fresh (cannot be undone)</p><button class="btn btn-secondary" id="clear-data-btn" style="color:var(--color-error)">üóëÔ∏è Clear All Data</button></div>
                        </div>
                    </div>
                    <div class="card"><div class="card-header"><h2 class="card-title">Data Summary</h2></div><div id="data-warning-banner" style="display:none"></div><div id="data-summary"></div></div>
                </div>
            </div>
            <!-- UPR Panel -->
            <div class="panel-content" id="upr-panel" role="tabpanel" aria-labelledby="upr-tab">
                <div class="sub-tabs" role="tablist" aria-label="UPR sections">
                    <button class="sub-tab upr-tab" role="tab" aria-selected="true" aria-controls="upr-practices-panel" id="upr-practices-tab">Practices</button>
                    <button class="sub-tab upr-tab" role="tab" aria-selected="false" aria-controls="upr-week-focus-panel" id="upr-week-focus-tab">Week Focus</button>
                    <button class="sub-tab upr-tab" role="tab" aria-selected="false" aria-controls="upr-dashboard-panel" id="upr-dashboard-tab">Dashboard</button>
                    <button class="sub-tab upr-tab" role="tab" aria-selected="false" aria-controls="upr-resources-panel" id="upr-resources-tab">Resources & Standards</button>
                    <button class="sub-tab upr-tab" role="tab" aria-selected="false" aria-controls="upr-export-panel" id="upr-export-tab">Export & Data</button>
                    <a href="https://en.wikipedia.org/wiki/Unconditional_positive_regard" target="_blank" rel="noopener noreferrer" class="sub-tab-link upr-link">What is UPR? ‚Üó</a>
                </div>
                <div class="tab-panel active" id="upr-practices-panel" role="tabpanel" aria-labelledby="upr-practices-tab">
                    <div class="card upr-card" style="margin-bottom:var(--space-4)">
                        <div class="card-header"><h2 class="card-title">üíö Unconditional Positive Regard</h2></div>
                        <p style="color:var(--color-text-secondary);margin-bottom:var(--space-2)"><strong>The core message:</strong> Care for your students isn't something they earn‚Äîit's something you give unconditionally, even when their behaviour tests you.</p>
                        <p style="color:var(--color-text-secondary);font-size:var(--text-sm)">UPR means separating the student from their behaviour, maintaining warmth while enforcing consequences, and communicating that their worth isn't contingent on compliance. Track your growth in these evidence-based practices aligned with Australian Professional Standards for Teachers.</p>
                    </div>
                    <div id="upr-practices-container" aria-label="UPR Practices"></div>
                    <div class="card upr-card" style="margin-top:var(--space-5)">
                        <div class="card-header"><h2 class="card-title">UPR Reflections</h2></div>
                        <div class="form-group"><label for="upr-global-notes-input" class="form-label">Add overall observations about your UPR journey</label><textarea id="upr-global-notes-input" class="form-textarea" placeholder="Reflect on how UPR is changing your classroom relationships..."></textarea></div>
                        <button class="btn btn-upr" id="save-upr-global-note-btn">Save Reflection</button>
                        <div id="upr-global-notes-list" class="notes-list" style="margin-top:var(--space-4)"></div>
                    </div>
                </div>
                <div class="tab-panel" id="upr-week-focus-panel" role="tabpanel" aria-labelledby="upr-week-focus-tab">
                    <div class="card upr-card">
                        <div class="card-header"><h2 class="card-title">Weekly Focus Practices</h2><div><span class="stat-label">Week Started: </span><span id="upr-week-start-date" class="stat-value">‚Äî</span><span class="stat-label" style="margin-left:var(--space-4)">Reset in: </span><span id="upr-week-countdown" class="stat-value">‚Äî</span></div></div>
                        <div id="upr-week-focus-content"><div class="empty-state"><div class="empty-state-icon">üéØ</div><div class="empty-state-title">No practices selected</div><p class="empty-state-desc">Select up to 3 practices from the Practices tab using "Use this week" status.</p></div></div>
                    </div>
                    <div class="card upr-card"><div class="card-header"><h2 class="card-title">Previous Week Focus History</h2></div><div id="upr-week-history-content"><div class="empty-state"><p class="empty-state-desc">No previous week focus history yet.</p></div></div></div>
                </div>
                <div class="tab-panel" id="upr-dashboard-panel" role="tabpanel" aria-labelledby="upr-dashboard-tab">
                    <div class="stats-grid">
                        <div class="stat-card upr-stat-card"><h3 class="stat-card-title">Practice Overview</h3><div id="upr-usage-stats"></div></div>
                        <div class="stat-card upr-stat-card"><h3 class="stat-card-title">Category Progress</h3><div id="upr-category-progress"></div></div>
                        <div class="stat-card upr-stat-card"><h3 class="stat-card-title">Recent Activity</h3><div id="upr-recent-activity"></div></div>
                        <div class="stat-card upr-stat-card"><h3 class="stat-card-title">Growth Summary</h3><div id="upr-growth-summary"></div></div>
                    </div>
                </div>
                <div class="tab-panel" id="upr-resources-panel" role="tabpanel" aria-labelledby="upr-resources-tab">
                    <div class="card upr-card">
                        <div class="card-header"><h2 class="card-title">Australian Professional Standards Alignment</h2></div>
                        <p style="color:var(--color-text-secondary);margin-bottom:var(--space-3)">UPR practices directly address requirements in the Australian Professional Standards for Teachers:</p>
                        <div class="stat-row"><span class="stat-label">Standard 1</span><span class="stat-value">Know students and how they learn</span></div>
                        <div class="stat-row"><span class="stat-label">Standard 4</span><span class="stat-value">Create and maintain supportive environments</span></div>
                        <div class="stat-row"><span class="stat-label">Standard 4.3</span><span class="stat-value">Address discipline fairly and respectfully</span></div>
                        <div class="stat-row"><span class="stat-label">Standard 7</span><span class="stat-value">Communicate effectively with students</span></div>
                    </div>
                    <div class="card upr-card">
                        <div class="card-header"><h2 class="card-title">Key Resources</h2></div>
                        <div class="resource-links" style="flex-wrap:wrap;gap:var(--space-2)">
                            <a href="https://www.berrystreet.org.au/learning-and-resources/berry-street-education-model" class="resource-link upr-link" target="_blank" rel="noopener noreferrer">üè´ Berry Street Education Model</a>
                            <a href="https://education.nsw.gov.au/student-wellbeing/whole-school-approach/wellbeing-framework-for-schools" class="resource-link upr-link" target="_blank" rel="noopener noreferrer">üìã NSW Wellbeing Framework</a>
                            <a href="https://www.education.vic.gov.au/school/teachers/management/improvement/Pages/fiso.aspx" class="resource-link upr-link" target="_blank" rel="noopener noreferrer">üìä Victorian FISO 2.0</a>
                            <a href="https://studentwellbeinghub.edu.au/educators/framework/" class="resource-link upr-link" target="_blank" rel="noopener noreferrer">üá¶üá∫ Australian Student Wellbeing Framework</a>
                        </div>
                    </div>
                    <div class="card upr-card">
                        <div class="card-header"><h2 class="card-title">Evidence Base</h2></div>
                        <p style="color:var(--color-text-secondary);font-size:var(--text-sm)">Research shows teacher effects on students' social and behavioural outcomes (<strong>0.21 standard deviations</strong>) are even larger than effects on academic achievement. Students in Berry Street Education Model classrooms demonstrate learning progress often exceeding two years' growth in one year.</p>
                    </div>
                </div>
                <div class="tab-panel" id="upr-export-panel" role="tabpanel" aria-labelledby="upr-export-tab">
                    <div class="stats-grid">
                        <div class="stat-card upr-stat-card">
                            <h3 class="stat-card-title">Data Summary</h3>
                            <div id="upr-data-warning-banner" style="display:none"></div>
                            <div id="upr-data-summary"></div>
                        </div>
                        <div class="stat-card upr-stat-card">
                            <h3 class="stat-card-title">Export Options</h3>
                            <p style="color:var(--color-text-secondary);font-size:var(--text-sm);margin-bottom:var(--space-3)">Export your TLAC and UPR data for backup or sharing.</p>
                            <div style="display:flex;flex-direction:column;gap:var(--space-2)">
                                <button class="btn btn-upr" id="upr-export-json-btn">üì• Export as JSON</button>
                                <button class="btn btn-secondary" id="upr-print-report-btn">üñ®Ô∏è Print Report</button>
                                <button class="btn btn-secondary" id="upr-email-report-btn">üìß Email Summary</button>
                            </div>
                        </div>
                        <div class="stat-card upr-stat-card">
                            <h3 class="stat-card-title">Import Data</h3>
                            <p style="color:var(--color-text-secondary);font-size:var(--text-sm);margin-bottom:var(--space-3)">Restore from a previous backup.</p>
                            <input type="file" id="upr-import-file" accept=".json" style="display:none">
                            <button class="btn btn-secondary" id="upr-import-btn">üì§ Import JSON File</button>
                        </div>
                        <div class="stat-card upr-stat-card">
                            <h3 class="stat-card-title">Data Management</h3>
                            <p style="color:var(--color-text-secondary);font-size:var(--text-sm);margin-bottom:var(--space-3)">Clear all data to start fresh. This cannot be undone.</p>
                            <button class="btn btn-secondary" id="upr-clear-data-btn" style="color:var(--color-error)">üóëÔ∏è Clear All Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer class="status-bar" role="contentinfo">
            <div class="status-saved" id="save-status">All changes saved</div>
            <div><span id="version-info">v3.0.0</span><span style="margin:0 var(--space-2)">‚Ä¢</span><button style="background:0 0;border:none;color:var(--color-text-muted);cursor:pointer;font-size:inherit" id="shortcuts-btn" aria-label="Show keyboard shortcuts">Keyboard shortcuts (?)</button></div>
        </footer>
    </div>
    <div class="toast-container" id="toast-container" role="alert" aria-live="polite"></div>
    <div class="shortcuts-overlay" id="shortcuts-overlay" role="dialog" aria-modal="true" aria-labelledby="shortcuts-title">
        <div class="shortcuts-panel">
            <h2 class="shortcuts-title" id="shortcuts-title">Keyboard Shortcuts</h2>
            <div class="shortcut-row"><span>Undo</span><span class="shortcut-key">Ctrl/‚åò + Z</span></div>
            <div class="shortcut-row"><span>Redo</span><span class="shortcut-key">Ctrl/‚åò + Y</span></div>
            <div class="shortcut-row"><span>Toggle dark mode</span><span class="shortcut-key">Ctrl/‚åò + D</span></div>
            <div class="shortcut-row"><span>Collapse all</span><span class="shortcut-key">[</span></div>
            <div class="shortcut-row"><span>Expand all</span><span class="shortcut-key">]</span></div>
            <div class="shortcut-row"><span>Show shortcuts</span><span class="shortcut-key">?</span></div>
            <div class="shortcut-row"><span>Close overlay</span><span class="shortcut-key">Escape</span></div>
            <h3 style="font-size:var(--text-sm);margin-top:var(--space-4);margin-bottom:var(--space-2);color:var(--color-text-secondary)">Status Keys (when item expanded or dropdown focused)</h3>
            <div class="shortcut-row"><span>Use this week</span><span class="shortcut-key">1</span></div>
            <div class="shortcut-row"><span>I use often</span><span class="shortcut-key">2</span></div>
            <div class="shortcut-row"><span>I use occasionally</span><span class="shortcut-key">3</span></div>
            <div class="shortcut-row"><span>Not successful yet</span><span class="shortcut-key">4</span></div>
            <div class="shortcut-row"><span>I don't use</span><span class="shortcut-key">5</span></div>
            <div class="shortcut-row"><span>Haven't used yet</span><span class="shortcut-key">6</span></div>
            <div class="shortcut-row"><span>Not suitable</span><span class="shortcut-key">7</span></div>
            <button class="btn btn-secondary" style="margin-top:var(--space-4);width:100%" id="close-shortcuts-btn">Close</button>
        </div>
    </div>
    <div class="settings-overlay" id="settings-overlay" role="dialog" aria-modal="true" aria-labelledby="settings-title">
        <div class="settings-panel">
            <div class="settings-header"><h2 class="settings-title" id="settings-title">Settings</h2><button class="settings-close-btn" id="settings-close-btn" aria-label="Close settings">‚úï</button></div>
            <div class="settings-content">
                <div class="settings-section">
                    <h3 class="settings-section-title">Appearance</h3>
                    <div class="settings-row"><span class="settings-row-label">Dark Mode</span><button class="toggle-switch" id="dark-mode-toggle" role="switch" aria-checked="false" aria-label="Toggle dark mode"></button></div>
                </div>
                <div class="settings-section">
                    <h3 class="settings-section-title">Teacher Profile</h3>
                    <div class="form-group"><label for="teacher-name" class="form-label">Name</label><input type="text" id="teacher-name" class="form-input" placeholder="Your name"></div>
                    <div class="form-group"><label for="years-teaching" class="form-label">Years Teaching</label><input type="number" id="years-teaching" class="form-input" placeholder="e.g., 5" min="0"></div>
                    <div class="form-group"><label for="school-name" class="form-label">School</label><input type="text" id="school-name" class="form-input" placeholder="Your school name"></div>
                    <div class="form-group"><label for="subject-area" class="form-label">Subject Area(s)</label><input type="text" id="subject-area" class="form-input" placeholder="e.g., Mathematics, Science"></div>
                    <div class="form-group"><label for="current-classes" class="form-label">Current Classes</label><textarea id="current-classes" class="form-textarea" placeholder="List your current classes, one per line"></textarea></div>
                    <div class="form-group"><label for="professional-goals" class="form-label">Professional Goals</label><textarea id="professional-goals" class="form-textarea" placeholder="What are your professional development goals?"></textarea></div>
                    <div class="settings-section">
                        <h3 class="settings-section-title">Help</h3>
                        <button class="btn btn-secondary" id="show-welcome-btn" style="width:100%">üìñ Show Welcome Guide</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="welcome-overlay" id="welcome-overlay" role="dialog" aria-modal="true" aria-labelledby="welcome-title">
        <div class="welcome-panel">
            <div class="welcome-header">
                <h2 id="welcome-title">üå± Welcome to TLAC and UPR Growth</h2>
                <button class="welcome-close" id="welcome-close-btn" aria-label="Close welcome guide">‚úï</button>
            </div>
            <div class="welcome-content">
                <div class="welcome-step active" data-step="1">
                    <h3>Your Professional Growth Companion</h3>
                    <p>This app helps you track and develop your teaching practice across two powerful frameworks:</p>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <div class="feature-icon">üìö</div>
                            <div class="feature-label">TLAC Techniques</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">üíö</div>
                            <div class="feature-label">UPR Practices</div>
                        </div>
                    </div>
                    <p>Switch between frameworks using the tabs at the top. Each has its own set of techniques or practices to explore and track.</p>
                </div>
                <div class="welcome-step" data-step="2">
                    <h3>Track Your Progress</h3>
                    <p>For each technique or practice, set your current status using the dropdown menu:</p>
                    <ul>
                        <li><strong>Use this week</strong> ‚Äî Focus on up to 3 items per week</li>
                        <li><strong>I use often</strong> ‚Äî Part of your regular practice</li>
                        <li><strong>I use occasionally</strong> ‚Äî Used sometimes</li>
                        <li><strong>Not successful yet</strong> ‚Äî Tried but still developing</li>
                        <li><strong>Haven't used yet</strong> ‚Äî On your radar</li>
                    </ul>
                    <p>Your choices are saved automatically and persist between sessions.</p>
                </div>
                <div class="welcome-step" data-step="3">
                    <h3>Weekly Focus System</h3>
                    <p>Select up to <strong>3 items</strong> to focus on each week. The Week Focus tab shows:</p>
                    <ul>
                        <li>Your current focus items with planning space</li>
                        <li>Daily reflection notes for each item</li>
                        <li>History of previous weeks</li>
                    </ul>
                    <p>Weeks automatically archive after 7 days, giving you a record of your growth journey.</p>
                </div>
                <div class="welcome-step" data-step="4">
                    <h3>Explore & Learn</h3>
                    <p>Click any item to expand it and see:</p>
                    <ul>
                        <li><strong>What</strong> ‚Äî Clear explanation of the technique</li>
                        <li><strong>Why</strong> ‚Äî The reasoning and research behind it</li>
                        <li><strong>Examples</strong> ‚Äî Practical classroom applications</li>
                        <li><strong>Resources</strong> ‚Äî Links to learn more</li>
                        <li><strong>Notes</strong> ‚Äî Space for your personal reflections</li>
                    </ul>
                </div>
                <div class="welcome-step" data-step="5">
                    <h3>Keyboard Shortcuts</h3>
                    <p>Work faster with keyboard shortcuts:</p>
                    <p>
                        <span class="key-hint">1</span>-<span class="key-hint">7</span> Set status (when item expanded)<br>
                        <span class="key-hint">[</span> Collapse all items<br>
                        <span class="key-hint">]</span> Expand all items<br>
                        <span class="key-hint">?</span> Show all shortcuts<br>
                        <span class="key-hint">Ctrl+Z</span> Undo<br>
                        <span class="key-hint">Ctrl+D</span> Toggle dark mode
                    </p>
                </div>
                <div class="welcome-step" data-step="6">
                    <h3>Export & Reports</h3>
                    <p>Keep track of your progress over time:</p>
                    <ul>
                        <li><strong>Dashboard</strong> ‚Äî Visual overview of your progress</li>
                        <li><strong>Print Report</strong> ‚Äî Comprehensive printable report</li>
                        <li><strong>Export JSON</strong> ‚Äî Backup your data</li>
                        <li><strong>Email Summary</strong> ‚Äî Share your progress</li>
                    </ul>
                    <p>Access these from the Export & Data tab, or use Settings <span class="key-hint">‚öôÔ∏è</span> to customise your experience.</p>
                    <p style="margin-top:var(--space-4);font-weight:500;color:var(--color-primary)">You're ready to go! Happy growing. üå±</p>
                </div>
            </div>
            <div class="welcome-footer">
                <div class="welcome-dots">
                    <div class="welcome-dot active" data-dot="1"></div>
                    <div class="welcome-dot" data-dot="2"></div>
                    <div class="welcome-dot" data-dot="3"></div>
                    <div class="welcome-dot" data-dot="4"></div>
                    <div class="welcome-dot" data-dot="5"></div>
                    <div class="welcome-dot" data-dot="6"></div>
                </div>
                <div class="welcome-nav">
                    <button class="btn btn-secondary" id="welcome-prev-btn" disabled>Back</button>
                    <button class="btn btn-primary" id="welcome-next-btn">Next</button>
                </div>
            </div>
        </div>
    </div>
    <script>
'use strict';

// Complete TLAC Data - All 52 techniques preserved
const TLAC_DATA = {
"Checking for Understanding": [
{ id: 1, name: "Reject Self-Report", description: "Move beyond student self-assessment to verify understanding through objective measures", explanation: { what: "Instead of asking 'Does everyone understand?' or 'Any questions?', use objective methods to verify actual comprehension.", why: "Self-report is unreliable because students may be embarrassed to admit confusion or may genuinely believe they understand when they don't.", examples: ["Replace 'Got it?' with 'Show me on your whiteboard how you would solve step one.'", "Instead of 'Any questions?', say 'Turn to your partner and explain why we multiply before we add.'", "Use exit tickets with specific problems rather than asking 'Did today's lesson make sense?'"] } },
{ id: 2, name: "Targeted Questioning", description: "Ask specific questions to check understanding of key concepts", explanation: { what: "Design questions that directly assess whether students understand the most important concepts or critical steps in a process.", why: "Random or vague questions may not reveal gaps in understanding. Targeted questions identify exactly where confusion exists.", examples: ["After teaching photosynthesis: 'Where does the plant get the carbon atoms that end up in glucose?'", "During maths: 'Why did I put the remainder here and not there?'", "In English: 'What word in line 3 tells us the narrator is unreliable?'"] } },
{ id: 3, name: "Standardize the Format", description: "Use consistent formats for student responses to make assessment efficient", explanation: { what: "Create predictable, consistent ways for students to show their work or answers.", why: "When formats are standardised, you can scan the room quickly and accurately.", examples: ["Always have students write answers in the same corner of their whiteboard", "Use consistent hand signals: thumbs up = agree, flat hand = unsure, thumbs down = disagree", "Require all written responses to follow the same sentence starter"] } },
{ id: 4, name: "Active Observation", description: "Systematically observe student work and behavior during independent practice", explanation: { what: "Circulate the room with purpose during independent work, looking at specific things in student work.", why: "Passive circulation misses crucial data. Active observation means you know exactly which students are struggling.", examples: ["Create a checklist: 'I'm looking for whether students are setting up the equation correctly'", "Use a seating chart to mark which students have made error X vs error Y", "Stand in one spot and scan all books before moving"] } },
{ id: 5, name: "Show Me", description: "Have students display their understanding through visual signals or written work", explanation: { what: "Ask all students to simultaneously display their answer or thinking so you can see everyone's understanding at once.", why: "When one student answers aloud, you only check one student. 'Show Me' reveals the whole class's understanding in seconds.", examples: ["'Write your answer on your whiteboard. 3, 2, 1, show me!'", "'Show me with your fingers: how many syllables in this word?'", "'Hold up A, B, C, or D for your answer'"] } },
{ id: 6, name: "Affirmative Checking", description: "Use positive sampling to verify that students are meeting expectations", explanation: { what: "Strategically check specific students who serve as indicators for the whole class.", why: "You can't check every student every time. Affirmative checking uses sampling strategically.", examples: ["Identify 3-4 'indicator students' who typically represent different ability levels", "After re-teaching, specifically check the student who was confused earlier", "Use Cold Call on a middle-ability student"] } }
],
"Academic Ethos": [
{ id: 7, name: "Plan for Error", description: "Anticipate common mistakes and plan how to address them", explanation: { what: "Before teaching, identify the mistakes students are most likely to make and prepare specific responses.", why: "Errors are predictable. Planning for them means you can address them quickly and effectively.", examples: ["Before teaching fractions: prepare an example showing why 1/2 + 1/3 ‚â† 2/5", "Prepare a list of the top 3 errors for each lesson with scripted corrections", "Create an 'error anticipation' section in your lesson plan"] } },
{ id: 8, name: "Culture of Error", description: "Create an environment where mistakes are valued as learning opportunities", explanation: { what: "Build a classroom culture where errors are expected, respected, and inspected.", why: "Students who fear making mistakes won't take risks. When errors are valued, students engage more deeply.", examples: ["'Thank you for that mistake‚Äîthis is exactly what I was hoping someone would do'", "Post a sign: 'Mistakes are proof that you are trying'", "Start error analysis with: 'This is a really smart mistake because...'"] } },
{ id: 9, name: "Excavate Error", description: "Dig into errors to understand and address root causes", explanation: { what: "When a student makes an error, investigate it. Ask questions to understand the thinking behind the mistake.", why: "Surface corrections don't fix deep misunderstandings.", examples: ["'Tell me how you got that answer. Walk me through your thinking.'", "'What made you choose to multiply there?'", "After finding the root cause: 'Ah, so you thought X meant Y. Let me show you why...'"] } },
{ id: 10, name: "Own and Track", description: "Students track their own progress and take ownership of learning", explanation: { what: "Give students tools and systems to monitor their own learning progress.", why: "When students track their own data, they take ownership of their learning.", examples: ["Students maintain a 'mastery tracker'", "After each quiz: 'Circle the questions you got wrong and write which skill each one tested'", "Weekly reflection: 'What's one thing you've improved at?'"] } },
{ id: 11, name: "No Opt Out", description: "Ensure all students answer correctly before moving on", explanation: { what: "When a student can't answer, return to them after the correct answer is given.", why: "Allowing students to 'opt out' teaches them that not trying is acceptable.", examples: ["'Listen to James's answer, then I'll come back to you.'", "'That's not quite right. Listen to how Priya explains it, then you'll try again.'", "Provide a cue then return: 'Now put it in your own words.'"] } },
{ id: 12, name: "Right is Right", description: "Set and defend a high standard for correctness", explanation: { what: "Accept only completely correct answers. Don't round up partially correct responses.", why: "Accepting 'close enough' teaches students that almost right is good enough.", examples: ["'You're on the right track. What specific word describes someone extremely sad and without hope?'", "'That's partially correct. Now add the second part.'", "'Say it again using complete sentences with the vocabulary word.'"] } },
{ id: 13, name: "Stretch It", description: "Extend learning with challenging follow-up questions", explanation: { what: "When a student answers correctly, push their thinking further with follow-up questions.", why: "Correct answers are opportunities to go deeper.", examples: ["'Good. Now why do you think the author chose that word?'", "'Correct. Now apply that same principle to this harder example.'", "'Right. Can you think of an exception to that rule?'"] } },
{ id: 14, name: "Format Matters", description: "Require complete sentences and proper academic language", explanation: { what: "Insist that students answer in complete sentences using proper grammatical format.", why: "How students express ideas matters as much as the ideas themselves.", examples: ["'In a complete sentence, starting with \"The character...\"'", "'Now stand up and say it loud and proud for everyone.'", "'Say that again using the vocabulary word \"photosynthesis\"'"] } },
{ id: 15, name: "Without Apology", description: "Teach content without apology or dilution", explanation: { what: "Present challenging content with enthusiasm and confidence.", why: "When teachers apologise for content, students learn it's okay to disengage.", examples: ["Instead of 'This is really hard': 'This is challenging, and I know you're up for it.'", "Instead of 'I know Shakespeare is boring': 'Shakespeare's language is like a puzzle'", "'This is the kind of problem university students work on.'"] } }
],
"Ratio": [
{ id: 16, name: "Think Ratio", description: "Maximize the cognitive work students do versus teacher", explanation: { what: "Consciously shift the cognitive load from teacher to students.", why: "Learning happens through thinking, not listening.", examples: ["Instead of explaining why B is correct, ask: 'Explain why A, C, and D are wrong.'", "Replace 'Let me show you how' with 'Try it first'", "After asking a question, resist the urge to fill the silence"] } },
{ id: 17, name: "Wait Time", description: "Provide thinking time after posing questions", explanation: { what: "After asking a question, pause for 3-5 seconds before calling on anyone.", why: "Without wait time, the same quick students always answer.", examples: ["'I'll wait until I see everyone's got an idea.'", "Use a visual cue: hold up a 'thinking' hand signal", "'Take 10 seconds to think before anyone speaks.'"] } },
{ id: 18, name: "Cold Call", description: "Call on students regardless of hand-raising", explanation: { what: "Call on students whether or not they have raised their hands, with warmth and support.", why: "When only volunteers answer, most students disengage.", examples: ["'What's the next step, Aisha?' (said warmly)", "Name first to prepare them: 'James... what pattern do you notice?'", "'I'm going to cold call in 10 seconds. Everyone be ready.'"] } },
{ id: 19, name: "Call and Response", description: "Use whole-class choral response for key points", explanation: { what: "Cue the whole class to respond in unison to reinforce key information.", why: "Call and Response keeps energy high and allows every student to participate.", examples: ["'When I say \"mitochondria\", you say \"powerhouse of the cell\".'", "'Everyone, what's 7 times 8?'", "Use a consistent signal: raised hand means 'everyone responds together'"] } },
{ id: 20, name: "Break It Down", description: "Simplify complex tasks into manageable steps", explanation: { what: "When a student struggles, break the question into smaller, scaffolded steps.", why: "Breaking it down maintains high expectations while providing support.", examples: ["'First, what do we know about the numerator?'", "'Let's start smaller: what's the character feeling in line 1?'", "'What's the first step we always do with equations like this?'"] } },
{ id: 21, name: "Ratio Through Writing", description: "Increase student thinking through written responses", explanation: { what: "Use writing as a tool to increase think ratio.", why: "Writing forces every student to process their thoughts.", examples: ["'Take 90 seconds to write your initial answer and one reason.'", "'Jot down two questions you have about this passage.'", "Use 'Stop and Jot' moments throughout the lesson"] } },
{ id: 22, name: "Ratio Through Discussion", description: "Structure discussions to maximize student participation", explanation: { what: "Design discussions where students do most of the talking, responding to each other.", why: "Student-to-student discussion multiplies participation.", examples: ["'Respond directly to what Priya said. Do you agree?'", "'Add on to Marcus's idea or challenge it with evidence.'", "'Each person must speak once before anyone speaks twice.'"] } },
{ id: 23, name: "Turn and Talk", description: "Brief paired discussions to process information", explanation: { what: "Pause instruction for students to discuss with a partner for 30-90 seconds.", why: "Turn and Talk transforms passive listeners into active participants.", examples: ["'Turn and tell your partner: what's the most important word?'", "'Partner A, explain the first step. Partner B, explain the second.'", "'Do you agree with Marcus? Why or why not?'"] } }
],
"Behavior and Culture": [
{ id: 24, name: "Radar/Be Seen Looking", description: "Demonstrate awareness of all classroom activity", explanation: { what: "Continuously scan the room and make it visible that you're watching.", why: "Students who know they're being watched are more likely to stay on task.", examples: ["Stand at the back or side of the room to see all screens/papers", "While helping one student, keep your head up scanning the room", "Make brief eye contact with off-task students"] } },
{ id: 25, name: "Make Compliance Visible", description: "Ensure compliance is observable to maintain standards", explanation: { what: "Design instructions so you can clearly see whether students are following them.", why: "When compliance is invisible, students can fake engagement.", examples: ["'Point to the paragraph we're reading' instead of 'Follow along'", "'Pencils in the air when you've finished the first problem'", "'Track me with your eyes'"] } },
{ id: 26, name: "Least Invasive Intervention", description: "Correct behavior with minimal disruption to learning", explanation: { what: "Use the smallest, least disruptive intervention possible to correct behavior.", why: "Big interventions disrupt learning for everyone.", examples: ["Non-verbal: Make eye contact, gesture to sit down", "Proximity: Move near the off-task student while continuing to teach", "Anonymous: 'I need everyone's eyes on me'"] } },
{ id: 27, name: "Firm, Calm Finesse", description: "Address behavior with quiet confidence and respect", explanation: { what: "When addressing behavior, speak calmly and privately where possible.", why: "Calm authority is more effective than visible frustration.", examples: ["Speak quietly near the student rather than across the room", "'I need you to start writing now. Thank you.' (then walk away)", "Lower your voice: 'I'll wait.'"] } },
{ id: 28, name: "Art of the Consequence", description: "Apply consequences consistently and instructionally", explanation: { what: "Deliver consequences calmly, consistently, and without negotiation.", why: "Inconsistent consequences teach students that rules are negotiable.", examples: ["'You chose not to complete the work in class, so you'll complete it at lunch.'", "Deliver consequences privately, not publicly", "Never threaten consequences you won't follow through on"] } },
{ id: 29, name: "What to Do", description: "Give specific, concrete, observable directions", explanation: { what: "Tell students exactly what to do, not what to stop doing.", why: "Vague directions are hard to follow. Specific directions make expectations crystal clear.", examples: ["Instead of 'Stop talking': 'Voices off, eyes on me, hands still.'", "Instead of 'Get ready': 'Pencil in hand, book open to page 42, eyes on the board.'", "'Sit with your back against the chair and your feet on the floor.'"] } },
{ id: 30, name: "Strong Voice", description: "Project authority through tone and body language", explanation: { what: "Use formal register, economy of language, and confident body language.", why: "How you speak matters as much as what you say.", examples: ["Stand still and square when giving important directions", "Use fewer words: 'Books out. Page 12. Now.'", "Don't end directions with 'Okay?' or 'Alright?'"] } },
{ id: 31, name: "Positive Framing", description: "Frame corrections positively and build momentum", explanation: { what: "Describe the positive behavior you want to see rather than the negative.", why: "Positive framing keeps energy up and focuses attention on success.", examples: ["'Thank you, Row 2, for being ready' instead of 'Row 3 isn't ready'", "'I see pencils moving' instead of 'Some people haven't started'", "'Show me you're ready by tracking me'"] } },
{ id: 32, name: "Precise Praise", description: "Offer specific, genuine praise for effort and achievement", explanation: { what: "Make praise specific by naming exactly what the student did well.", why: "Vague praise feels empty. Precise praise reinforces what you want to see more of.", examples: ["'I like how you used evidence from paragraph 3 to support your argument.'", "'You tried three different strategies before you found one that worked.'", "'Your thesis statement is clear and arguable.'"] } },
{ id: 33, name: "Warm/Strict", description: "Be both caring and exacting simultaneously", explanation: { what: "Combine high expectations with genuine warmth.", why: "Students need to know you care AND that you won't accept less than their best.", examples: ["'I'm asking you to redo this because I know you can do better.'", "After a consequence: 'We're good. I'm glad you're here.'", "'I love having you in my class. That's why I'm pushing you.'"] } },
{ id: 34, name: "Emotional Constancy", description: "Maintain steady emotional tone regardless of student behavior", explanation: { what: "Keep your emotional response steady whether students are exceeding or falling short.", why: "Emotional constancy creates a predictable, safe environment.", examples: ["Same calm tone when correcting as when praising", "When a student is defiant: pause, breathe, respond calmly", "After a difficult moment: quickly return to your normal teaching tone"] } },
{ id: 35, name: "Joy Factor", description: "Celebrate learning and create joyful classroom moments", explanation: { what: "Intentionally build moments of joy, celebration, and fun into your classroom.", why: "Joy makes hard work sustainable. Your enthusiasm is infectious.", examples: ["Class celebration when everyone passes a quiz", "Show genuine excitement when a student has a breakthrough", "Find moments of wonder in your content: 'Isn't it amazing that...'"] } }
],
"Building Student Motivation and Trust": [
{ id: 36, name: "Habits of Attention", description: "Teach and reinforce habits of focused attention", explanation: { what: "Explicitly teach students what attention looks like and consistently reinforce those habits.", why: "Attention is a skill that can be taught, not just demanded.", examples: ["Teach 'SLANT': Sit up, Listen, Ask questions, Nod, Track the speaker", "'When I'm talking, your eyes track me.'", "Practice attention transitions: 'Eyes on your paper... and now eyes on me.'"] } },
{ id: 37, name: "Threshold", description: "Meet students at the door to establish tone", explanation: { what: "Stand at the door and greet each student individually as they enter.", why: "The first moments of class set the tone for everything that follows.", examples: ["Greet each student by name with a handshake or fist bump", "'Good to see you, Marcus. I noticed your hard work yesterday.'", "Use Threshold to reset: 'Before you come in, take a breath.'"] } },
{ id: 38, name: "Change the Pace", description: "Vary activities and pace to maintain engagement", explanation: { what: "Intentionally vary the type, length, and pace of activities.", why: "Attention naturally wanes during long, unchanging activities.", examples: ["Plan activities in 10-15 minute segments maximum", "Alternate: direct instruction ‚Üí partner work ‚Üí writing ‚Üí discussion", "When energy dips: 'Stand up, stretch, now turn and tell your partner...'"] } },
{ id: 39, name: "Brighten the Lines", description: "Make transitions between activities crisp and clear", explanation: { what: "Make the boundaries between activities sharp and visible.", why: "Fuzzy transitions waste time and lose engagement.", examples: ["'3-2-1 and... STOP. Pencils down, eyes up.'", "Use a consistent sound or signal for transitions", "'In 10 seconds, you'll be in your groups with materials out. Go!'"] } },
{ id: 40, name: "All Hands", description: "Use gestures and movement to maintain engagement", explanation: { what: "Use hand signals, gestures, and physical movements to keep students engaged.", why: "Physical engagement activates different parts of the brain.", examples: ["'Show me thumbs up if you agree, thumbs down if you disagree'", "'Mime the action while I read this passage'", "'Point to the part of the diagram I'm describing'"] } },
{ id: 41, name: "Work the Clock", description: "Use time limits to create productive urgency", explanation: { what: "Give explicit, tight time limits for tasks and count down visibly.", why: "Time limits focus attention and create healthy pressure.", examples: ["'You have 90 seconds. Go!'", "'In 30 seconds, I'll be cold calling someone.'", "Count down the last 10 seconds aloud"] } },
{ id: 42, name: "Every Minute Matters", description: "Maximize instructional time and eliminate downtime", explanation: { what: "Treat time as precious. Eliminate dead time.", why: "Lost minutes add up to lost lessons.", examples: ["Start the Do Now before the bell finishes ringing", "Have early finishers always know what to do next", "Use 'while you wait' activities during transitions"] } }
],
"Lesson Structures": [
{ id: 43, name: "Board = Paper", description: "Model note-taking by having board match student papers", explanation: { what: "Whatever students write should match exactly what's on the board.", why: "Students often don't know how to take notes effectively.", examples: ["Use the same graphic organiser on the board that students have", "'Write this in the box on the left side‚Äîjust like on the board'", "Leave the same blank spaces on your board notes"] } },
{ id: 44, name: "Double Plan", description: "Plan both what you'll teach and what students will do", explanation: { what: "Plan two parallel tracks: what you do AND what students do.", why: "Lessons often focus only on what the teacher does.", examples: ["Create a two-column lesson plan: 'Teacher does...' | 'Students do...'", "For 'Teacher explains X', add 'Students annotate or signal understanding'", "Check each 5-minute segment: 'What is every student DOING?'"] } },
{ id: 45, name: "Do Now", description: "Start class with brief independent work", explanation: { what: "Begin every lesson with a short, focused task students complete as they enter.", why: "Do Now creates productive urgency from the first moment.", examples: ["'Your Do Now is on the board. Begin before the bell.'", "'3 questions on last night's reading. You have 4 minutes.'", "'What do you already know about X? List 3 things.'"] } },
{ id: 46, name: "Exit Ticket", description: "End class with brief assessment of learning", explanation: { what: "End each lesson with a quick, targeted assessment students complete independently.", why: "Exit Tickets provide daily data on student understanding.", examples: ["'Answer these 3 questions before you leave. Hand it to me at the door.'", "1 question targeting the day's key learning", "Review Exit Tickets before the next lesson"] } },
{ id: 47, name: "Retrieval Practice", description: "Regular practice recalling information from memory", explanation: { what: "Regularly require students to recall previously learned information from memory.", why: "Retrieval strengthens memory more than re-reading.", examples: ["'Close your books. Write everything you remember about photosynthesis.'", "Weekly 'Flashback Friday' quiz on content from previous weeks", "'Tell your partner three things we learned in Chapter 4‚Äîno notes!'"] } },
{ id: 48, name: "Go Conceptual", description: "Move from procedural to conceptual understanding", explanation: { what: "Push beyond 'how' to 'why'. Once students can perform a procedure, ask why it works.", why: "Students who understand why something works can adapt and apply knowledge flexibly.", examples: ["'Why does this method work? What would happen if...?'", "'Explain to your partner why Step 2 comes before Step 3.'", "'When might this rule NOT apply? Why?'"] } }
],
"Procedures and Routines": [
{ id: 49, name: "Strategic Investment", description: "Invest time in teaching important procedures thoroughly", explanation: { what: "Invest significant time upfront teaching your most important procedures.", why: "Time spent teaching procedures early saves far more time later.", examples: ["Spend the first week practising entry routine until it takes under 60 seconds", "'Today we're going to practise how to transition to group work.'", "Model exactly what you want: 'Watch me show you...'"] } },
{ id: 50, name: "Do It Again", description: "Practice procedures until they meet expectations", explanation: { what: "When a procedure isn't executed properly, have students redo it.", why: "Letting poor execution slide teaches students that cutting corners is acceptable.", examples: ["'That transition took 2 minutes. Let's try again and hit 45 seconds.'", "'I noticed voices during the lineup. Let's go back and try again silently.'", "'Good effort, but we can be sharper. One more time.'"] } },
{ id: 51, name: "Engineer Efficiency", description: "Design procedures for maximum efficiency", explanation: { what: "Analyse your routines to eliminate wasted time and movement.", why: "Poorly designed procedures waste minutes every day.", examples: ["Place materials where students can grab them without bottlenecks", "Assign specific roles: 'Materials manager collects papers'", "Design traffic flow: 'Row 1 gets materials from the front, Row 2 from the back'"] } },
{ id: 52, name: "Procedure and Routine", description: "Establish clear, consistent classroom procedures", explanation: { what: "Create explicit procedures for every recurring activity.", why: "When students know exactly what to do, they can focus on learning.", examples: ["Document every procedure: 'When you finish early: 1) Check your work 2) Read...'", "Create a procedures handbook students can reference", "'When you need the bathroom: sign out, take the pass, sign back in.'"] } }
]
};

// UPR Data - Unconditional Positive Regard Practices
const UPR_DATA = {
"Daily Classroom Practices": [
{ id: 1, name: "Greeting Every Student by Name", description: "Acknowledge each student individually as they enter your space", explanation: { what: "Stand at your classroom door and personally greet each student as they arrive‚Äîusing their name, making eye contact, and offering a brief positive acknowledgment. This isn't a casual 'hi everyone' but a deliberate, individual moment of recognition for each young person.", why: "For many students, your greeting may be the first positive adult interaction of their day. Using a student's name signals 'I see you, I know you, you matter here.' Research shows that positive teacher-student relationships are among the strongest predictors of student engagement and achievement. The threshold is a daily opportunity to communicate unconditional welcome before any behaviour has occurred.", examples: ["'Good morning, Jayden. Good to see you.'", "'Hey Sarah, I noticed you finished that assignment‚Äînice work getting it in.'", "'Marcus, welcome back. We missed you yesterday.'", "A smile, eye contact, and a fist bump for students who prefer less verbal interaction", "Adjusting your greeting style to match individual students‚Äîsome want chat, others want quick acknowledgment"] } },
{ id: 2, name: "Positive Pre-Correction", description: "State expectations positively before behaviour occurs", explanation: { what: "Before transitions, activities, or moments where behaviour challenges typically arise, proactively state what you want to see rather than waiting to correct what you don't want. Frame instructions as expectations for success, not warnings against failure.", why: "Pre-correction communicates trust‚Äîyou're assuming students will meet expectations rather than assuming they'll fail. It also gives students clear information about what success looks like before they have a chance to get it wrong. This preserves dignity by eliminating the need for public correction and reduces the shame cycle that damages relationships.", examples: ["Before group work: 'In your groups, I'll see one person speaking at a time and everyone's eyes on whoever is sharing.'", "Before a transition: 'When I say go, you'll walk to your tables, take out your books, and begin the Do Now silently.'", "Before a challenging student arrives: 'Amir, when you come in today, put your bag in the corner and start on the board work‚ÄîI'll check in with you in two minutes.'", "Before returning tests: 'When you get your paper, look at your feedback quietly. If you're disappointed, that's okay‚Äîkeep it private and we'll talk after class.'"] } },
{ id: 3, name: "2x10 Relationship Building", description: "Two minutes of personal conversation for ten consecutive days with a challenging student", explanation: { what: "Select a student you find difficult to connect with. For ten consecutive school days, spend two minutes in personal conversation with them‚Äînot about behaviour, academics, or anything school-related. Talk about their interests, their life, what matters to them. Listen more than you speak.", why: "The students who challenge us most are often the students who need connection most‚Äîand who have learned to push adults away before adults can reject them. The 2x10 strategy breaks this cycle by proving you'll show up consistently regardless of their behaviour. Two minutes feels brief, but over ten days it accumulates into twenty minutes of undivided positive attention‚Äîoften more than these students receive from any adult. The consistency matters as much as the content.", examples: ["'I heard you're into basketball‚Äîwho's your team?'", "'What did you get up to on the weekend?'", "'I saw you drawing before class‚Äîcan you tell me about it?'", "Sitting with them at lunch for a few minutes", "Walking with them between classes asking about their music or games", "Remembering details from previous conversations: 'How did your sister's birthday party go?'"] } },
{ id: 4, name: "Noticing and Naming Strengths", description: "Explicitly identify and verbalise student strengths you observe", explanation: { what: "Actively look for what students do well‚Äînot just academically, but socially, creatively, practically‚Äîand tell them specifically what you've noticed. This goes beyond generic praise ('Good job!') to specific observation ('I noticed you helped Tran find the right page without being asked. That's real kindness.'). Name the strength, not just the action.", why: "Students who struggle behaviourally often develop identities built around what they can't do and what they get wrong. They hear corrections far more than affirmations. When you name a strength, you offer them a different story about who they are. This is particularly powerful for students who don't see themselves as capable or good‚Äîyour observation becomes evidence they can't easily dismiss. Naming the quality (patience, persistence, creativity, kindness) helps students build a vocabulary for their own character.", examples: ["'You stuck with that problem even when it was frustrating. That's persistence‚Äîit's going to serve you well.'", "'I noticed you waited your turn even though you were excited. That took self-control.'", "'You have a really good eye for detail‚Äîyou spotted the error no one else saw.'", "'The way you explained that to your partner was really clear. You're good at breaking things down.'", "'I saw you check on Mia when she looked upset. You notice when people need support.'", "Writing a brief strength-based note on a student's work rather than only corrections"] } },
{ id: 5, name: "Assumption of Positive Intent", description: "Default to believing students are doing their best with current capacity", explanation: { what: "When behaviour occurs that frustrates or confuses you, start from the assumption that the student is doing the best they can with the skills, knowledge, and emotional regulation they currently have. Approach with curiosity ('Help me understand what happened') rather than accusation ('Why did you do that?'). This doesn't mean accepting harmful behaviour‚Äîit means seeking to understand before you judge.", why: "Most challenging behaviour makes sense when you understand the context. What looks like defiance might be confusion. What looks like laziness might be overwhelm. What looks like aggression might be fear. When we assume negative intent, students feel accused and become defensive‚Äîthe conversation becomes about proving innocence rather than solving problems. Assuming positive intent protects the relationship and opens the door to understanding. It also models the grace we want students to extend to others.", examples: ["Instead of 'Why aren't you working?' try 'What's getting in the way of starting?'", "Instead of 'You're not listening' try 'I notice you're looking away‚Äîwhat's on your mind?'", "Instead of 'Stop being rude' try 'That came out harshly. Is something bothering you today?'", "When a student hasn't done homework: 'What happened with the homework?' rather than 'Why didn't you do it?'", "Privately checking in: 'That's not like you. Is everything okay?'", "Reminding yourself: 'This student is not giving me a hard time‚Äîthey are having a hard time.'"] } },
{ id: 6, name: "Fresh Start Each Day", description: "Release yesterday's difficulties and greet students without residue", explanation: { what: "Make a deliberate choice each morning to greet every student‚Äîespecially those you had conflict with yesterday‚Äîwithout carrying frustration, disappointment, or wariness from previous incidents. This doesn't mean pretending nothing happened or abandoning follow-through on consequences. It means your warmth and welcome are not conditional on their recent behaviour. Your face, voice, and body communicate: 'Yesterday was yesterday. Today you're welcome here.'", why: "Students who frequently get into trouble often expect adults to hold grudges. They brace for hostility, keep their guard up, and sometimes provoke conflict early to 'get it over with.' When you offer a genuine fresh start, you disrupt this pattern. You prove that your regard for them isn't something they can lose through bad behaviour. This is the heart of unconditional positive regard‚Äîthe 'unconditional' part. It also gives students permission to try again without the weight of accumulated shame.", examples: ["Greeting a student warmly the morning after a difficult phone call home", "'Morning, Josh. Good to see you.' (Same tone as every other student, even after yesterday's incident)", "Seeking out a student you had conflict with: 'Hey, I'm glad you're here today.'", "Avoiding 'the look' or heavy sighs when a challenging student enters", "Not mentioning yesterday's behaviour unless the student brings it up or follow-through is needed", "Checking your own body language at the door: Am I tensing up? Am I ready to welcome this student?", "If follow-through is needed: 'We do need to sort out yesterday, but first‚Äîgood morning. How are you?'"] } }
],
"Boundary Setting with Warmth": [
{ id: 7, name: "Separating Behaviour from Identity", description: "Address what students do, not who they are", explanation: { what: "When addressing behaviour, focus your language on the specific action rather than making statements about the student's character or worth. 'That comment was hurtful' rather than 'You're mean.' 'You made a choice to leave your seat' rather than 'You never follow instructions.' The student did something‚Äîthey are not something. This distinction is subtle in language but profound in impact.", why: "When we label students ('You're lazy', 'You're a troublemaker', 'You're disrespectful'), they internalise these as identities. Labels feel permanent and total‚Äîif I am lazy, what's the point of trying? But actions are changeable. A student can choose differently next time. This distinction also relates to shame versus guilt: guilt says 'I did something bad' and motivates repair; shame says 'I am bad' and leads to withdrawal, defensiveness, or aggression. We want students to feel appropriate guilt about harmful actions while never doubting their fundamental worth as people.", examples: ["Instead of 'You're being rude': 'That comment landed as rude. I don't think that's what you intended.'", "Instead of 'You're lazy': 'I haven't seen you start yet. What's getting in the way?'", "Instead of 'You're always disrupting': 'You've called out three times this lesson. That's not like the focus I've seen from you before.'", "Instead of 'Don't be a bully': 'That behaviour is bullying. I know you can treat people better than that.'", "'The behaviour I saw was dishonest' rather than 'You're a liar'", "'You made a choice that hurt someone' rather than 'You're a mean person'"] } },
{ id: 8, name: "Private Conversations for Corrections", description: "Move behavioural discussions away from peer audiences", explanation: { what: "Whenever possible, address behavioural issues privately rather than publicly. This might mean walking over to a student's desk and speaking quietly, asking them to step outside for a moment, waiting until after class, or using a private signal you've established. The goal is to remove the audience so the conversation can be honest and the student doesn't need to save face.", why: "Public correction puts students in an impossible position. They must either submit in front of peers (which feels humiliating) or resist to maintain social standing (which escalates the situation). Either way, shame enters the equation and the relationship is damaged. Private conversation removes this dynamic entirely. It also communicates respect‚Äîyou're treating them the way you'd want to be treated if someone needed to address your behaviour. Students often respond completely differently when peers aren't watching.", examples: ["Walking over to a student's desk and crouching down to speak quietly at their level", "'Can I borrow you in the hallway for thirty seconds?'", "A private signal (tap on desk, Post-it note) that means 'See me after class'", "Positioning yourself beside the student rather than in front of them, both facing the same direction", "Waiting until others are working before addressing an individual: 'While everyone's getting started, I want to check in with you about something.'", "Using proximity and a quiet voice rather than calling across the room", "If you must address behaviour publicly, keep it brief and factual, then follow up privately: 'We'll talk about this after class.'"] } },
{ id: 9, name: "Care AND Accountability", description: "Communicate that caring about someone includes holding expectations", explanation: { what: "Reject the false choice between caring about students and holding them accountable. True unconditional positive regard includes both‚Äî'I care about you AND this behaviour needs to change.' The word 'AND' is crucial. Not 'but' (which erases what came before), not 'so' (which makes care conditional on compliance). AND holds both truths simultaneously: you matter, and what you did matters.", why: "Students often experience adults as either warm-but-permissive or strict-but-cold. Warm-but-permissive feels nice but communicates low expectations‚Äî'I don't think you can do better.' Strict-but-cold might achieve compliance but damages relationship and often breeds resentment. When students experience care AND accountability together, they receive a powerful message: 'I believe you are capable of better, and I'm not giving up on you.' This is what high expectations with high support actually looks like. Letting students off the hook isn't kindness‚Äîit's abandonment.", examples: ["'I care about you, and that's exactly why I'm not going to let this slide.'", "'You know I think you're great‚Äîand we need to sort out what happened today.'", "'I'm on your side, and I need you to redo this work to the standard I know you can reach.'", "'This consequence stands because I believe you can learn from it. I'll be here when you're ready to move forward.'", "'I'm not angry with you‚ÄîI'm disappointed because I know what you're capable of.'", "After a consequence: 'We're good. This doesn't change how I see you. Let's have a better day tomorrow.'", "'I will never give up on you. And I will never stop expecting your best.'"] } },
{ id: 10, name: "Calm, Low-Volume Redirections", description: "Use proximity and quiet voice rather than volume and distance", explanation: { what: "When redirecting behaviour, move towards the student rather than projecting your voice across the room. Speak at low volume‚Äîsometimes almost a whisper. Keep your body language open and non-threatening. Use fewer words, not more. The quieter and calmer you are, the more students have to attend to you, and the less the situation escalates.", why: "Volume triggers the threat response in students' nervous systems. When an adult raises their voice, students perceive danger and shift into fight, flight, or freeze‚Äînone of which lead to learning or behaviour change. Calm communicates safety: 'This is not a crisis. We can handle this together.' Your regulated presence helps dysregulated students borrow your calm. Proximity also makes the conversation semi-private, even in a full classroom. And paradoxically, a quiet voice commands more attention than a loud one‚Äîstudents must stop and focus to hear you.", examples: ["Walking slowly towards the student while continuing to teach, then quietly redirecting", "Crouching beside their desk so you're at eye level, speaking just above a whisper", "'Eyes on your work' (said quietly at their shoulder, not announced to the room)", "Using fewer words as tension rises, not more‚Äî'Pencil down. Thank you.'", "Pausing and waiting in silence rather than repeating instructions more loudly", "If you feel your own frustration rising, lowering your voice deliberately to regulate yourself", "Standing still and speaking slowly when students are escalating‚Äîyour stillness is calming", "'I can see you're upset. I'm going to give you a minute, then we'll figure this out together.' (said quietly, then walking away to give space)"] } },
{ id: 11, name: "Offering Limited Choices", description: "Provide agency within boundaries rather than ultimatums", explanation: { what: "Instead of issuing commands or ultimatums ('Do this now or else'), offer students a choice between two acceptable options. Both options should be genuinely acceptable to you and should move the student toward the desired outcome. The choice is real, but the boundaries are clear. 'Would you like to complete this at your desk or at the back table?' Both options involve completing the work‚Äîthe student chooses where.", why: "Ultimatums trigger power struggles. When a student feels cornered with no options, their only way to maintain dignity is to refuse. Offering choices preserves their sense of autonomy and control‚Äîsomething that matters deeply to all humans, especially adolescents, and especially those who feel powerless in other areas of their lives. Choices also shift the dynamic: instead of you versus them, it becomes them making a decision. If they choose poorly, the consequence flows from their choice, not from your power. This builds internal locus of control over time.", examples: ["'You can finish this now or at lunch‚Äîwhich works better for you?'", "'Would you like to take a break in the room or step outside for a minute?'", "'You can sit here and work quietly, or move to the back table if you need more space. Your call.'", "'I need you to put the phone away. Would you like to put it in your bag or on my desk?'", "'You can apologise now or write a note‚Äîwhich feels more comfortable?'", "'We need to have this conversation. Would you prefer now or at the end of class?'", "Avoiding false choices: don't offer options you're not actually willing to accept", "Keeping your tone neutral‚Äîchoices offered through gritted teeth aren't really choices"] } },
{ id: 12, name: "Following Through Without Anger", description: "Deliver consequences as information, not punishment", explanation: { what: "When consequences are necessary, deliver them calmly, consistently, and without emotional charge. Your tone should communicate 'This is what happens next' rather than 'I'm going to make you pay.' The consequence is information about how the world works, not a weapon wielded in frustration. Follow through every time, without negotiation, but also without hostility.", why: "When consequences are delivered with anger, students experience them as revenge‚Äîas proof that you're against them. This damages the relationship and often escalates the situation. But when consequences are delivered calmly and matter-of-factly, students can focus on the consequence itself and what they might do differently, rather than on your emotional state. Consistency matters enormously: if you only follow through when you're angry, students learn that the real rule is 'don't make the teacher angry' rather than the stated expectation. Calm, predictable follow-through builds trust‚Äîstudents know where they stand.", examples: ["'You've chosen not to complete the work here, so you'll be completing it at lunch. I'll see you then.' (said neutrally, then moving on)", "'That's the second call-out. You know the agreement‚Äîtake five in the hallway and come back when you're ready.'", "Delivering the consequence, then immediately returning to teaching‚Äîno lecture, no lingering", "If a student protests: 'I understand you're frustrated. The consequence stands. We can talk about it after class.'", "Avoiding 'I told you so' or 'You brought this on yourself'", "Checking your own emotional state: if you're angry, delay the consequence conversation if possible", "Following through on small things so you rarely need to escalate to big things", "After the consequence: 'We're good. Tomorrow's a new day.'"] } }
],
"Trauma-Informed Responses": [
{ id: 13, name: "Recognising Survival Responses", description: "Identify fight, flight, freeze and fawn as protective mechanisms", explanation: { what: "Learn to recognise the four primary stress responses in students: Fight (aggression, defiance, arguing, intimidation), Flight (avoidance, escape, distraction, running away), Freeze (shutting down, going blank, inability to respond, dissociation), and Fawn (people-pleasing, over-compliance, excessive apologies, giving in). Understand that these are automatic nervous system responses, not conscious choices. The student isn't choosing to be difficult‚Äîtheir body is trying to protect them from perceived threat.", why: "When we see a student's behaviour as deliberate defiance or manipulation, we respond with frustration or punishment. When we see it as a survival response, we respond with curiosity and support. This shift in perception changes everything. A student in fight mode isn't 'being aggressive'‚Äîtheir nervous system has detected danger and is preparing to defend. A student in freeze isn't 'ignoring you'‚Äîthey're neurologically overwhelmed and literally cannot respond normally. Once you can name what you're seeing, you can respond appropriately: reduce threat, increase safety, and wait for the nervous system to calm before expecting learning or compliance.", examples: ["Fight: A student who argues with every instruction, gets in your face, or seems to want conflict", "Flight: A student who constantly asks to go to the bathroom, puts their head down, or 'disappears' into distraction", "Freeze: A student who goes blank when called on, can't answer even simple questions, or seems 'not there'", "Fawn: A student who agrees to everything, apologises constantly, or seems desperate to please you", "Noticing when a student's response seems disproportionate to the situation‚Äîa sign their nervous system may be reacting to something else", "Saying to yourself: 'This is a stress response, not a choice' before you respond", "Recognising that the same student may show different responses on different days"] } },
{ id: 14, name: "Regulation Before Expectation", description: "Help students reach calm before addressing behaviour or learning", explanation: { what: "When a student is dysregulated‚Äîemotionally flooded, shut down, or in survival mode‚Äîpause your agenda. Don't try to teach them, reason with them, extract an apology, or process the incident. First, help them return to a regulated state. Only when their nervous system has calmed can they access their thinking brain. Regulation might take seconds or might take the whole lesson. It's not wasted time‚Äîit's essential groundwork.", why: "The brain's architecture makes this non-negotiable. When the amygdala (threat detection) is activated, the prefrontal cortex (reasoning, learning, impulse control) goes offline. Trying to reason with a dysregulated student is like trying to have a conversation with someone who's drowning‚Äîfirst you have to get them to shore. Expecting compliance, learning, or reflection from a dysregulated student will fail and will add to their stress. Meeting them where they are‚Äî'I can see you're not okay right now. Let's sort that first'‚Äîcommunicates that their wellbeing matters more than your lesson plan.", examples: ["'I can see something's up. You don't have to talk about it‚Äîjust take a few minutes.'", "Offering water, a quiet space, or a simple sensory tool (stress ball, fidget)", "Reducing demands: 'Don't worry about the worksheet. Just sit with us for now.'", "Giving time without pressure: 'I'll check back in five minutes.'", "Using minimal language‚Äîa dysregulated brain can't process long sentences", "Co-regulating through your own calm presence (slow movements, soft voice, relaxed posture)", "Not mentioning the behaviour until they're calm: 'We can talk about what happened later. Right now, let's just get you settled.'", "Accepting that regulation might be the only goal for this lesson‚Äîand that's okay"] } },
{ id: 15, name: "Predictability and Safety Signals", description: "Create consistent routines that signal physical and emotional safety", explanation: { what: "Establish clear, consistent routines and structures so students always know what to expect. Use the same signals, the same language, the same sequence of events. Make your classroom a place where surprises are rare and safety cues are constant. This includes physical consistency (seating arrangements, where materials are kept) and interpersonal consistency (how you greet students, how you handle mistakes, how you respond to conflict).", why: "For students who have experienced trauma or chronic stress, unpredictability itself is threatening. Their nervous systems are calibrated for danger, constantly scanning for threat. In chaotic or unpredictable environments, they can never relax. When your classroom is predictable, their nervous system gets repeated evidence: 'This place is safe. This adult is safe. I can let my guard down.' Over time, this consistency literally rewires their stress response. Predictability isn't boring‚Äîit's a gift of safety.", examples: ["Starting each lesson the same way: greeting, settling activity, clear transition to learning", "Using the same language for common instructions: 'Voices off, eyes on me'", "Having a visible schedule so students know what's coming", "Warning before transitions: 'In two minutes, we'll be packing up'", "Consistent consequences‚Äîsame behaviour leads to same response, every time", "Keeping your emotional tone steady‚Äîstudents shouldn't have to guess which version of you they'll get today", "Explaining any changes in advance: 'Tomorrow we'll have a different timetable because...'", "Creating rituals: weekly check-ins, Friday reflections, predictable celebrations"] } },
{ id: 16, name: "Avoiding Shame-Based Language", description: "Eliminate words and tones that trigger shame responses", explanation: { what: "Audit your language for words, phrases, and tones that induce shame‚Äîthe painful feeling that something is wrong with me, not just my behaviour. Shame language often involves 'you always', 'you never', character labels ('lazy', 'disrespectful', 'naughty'), public call-outs, sarcasm, sighing, eye-rolling, and comparisons to other students. Replace these with specific, behaviour-focused language delivered privately and without contempt.", why: "Shame is toxic to learning and relationship. Unlike guilt ('I did something bad'), shame says 'I am bad'‚Äîand there's no path forward from that. Students who feel shame don't become motivated to improve; they shut down, act out, or withdraw. Shame also damages trust: if you shame me, you're not safe. Many students, particularly those with trauma histories, already carry deep shame. Adding to it doesn't correct behaviour‚Äîit confirms their worst beliefs about themselves and severs connection.", examples: ["Instead of 'You always do this': 'This is the second time today. What's going on?'", "Instead of sighing heavily: taking a neutral breath before responding", "Instead of 'I'm disappointed in you': 'I'm disappointed in this choice‚ÄîI know you can do better'", "Instead of 'Why can't you be more like...': never comparing students to each other", "Eliminating sarcasm completely‚Äîit's veiled contempt and students feel it", "Watching your non-verbal communication: tone, facial expressions, body language", "Never using 'naughty' or 'bad' to describe students or their behaviour", "Avoiding rhetorical questions like 'What were you thinking?' or 'What's wrong with you?'"] } },
{ id: 17, name: "Understanding Trauma Triggers", description: "Recognise that reactions may connect to experiences outside school", explanation: { what: "Accept that you may never know what a student has experienced, but recognise that intense or disproportionate reactions often signal that something in the present has activated a memory or feeling from the past. A raised voice might remind them of violence at home. Being singled out might echo past humiliation. A perceived rejection might tap into abandonment. You don't need to know the details to respond with care‚Äîjust hold the possibility that there's more beneath the surface.", why: "When we judge behaviour only by what we see in front of us, we miss the iceberg beneath. A student who explodes at a minor correction isn't 'overreacting'‚Äîthey're reacting to everything, past and present, that the moment has activated. Understanding this doesn't excuse harmful behaviour, but it changes how we respond. Instead of 'What's wrong with you?', we think 'What happened to you?' This shift moves us from punishment to support, from judgement to curiosity.", examples: ["Noticing when a reaction seems 'too big' for the situation and getting curious rather than frustrated", "Being cautious with common triggers: raised voices, sudden changes, perceived criticism, physical proximity, feeling trapped, being singled out", "Recognising that anniversaries, holidays, and family events can activate trauma", "Not asking 'Why are you acting like this?' but saying 'Something's clearly bothering you. You don't have to tell me, but I'm here.'", "Avoiding restraint or cornering students, which can trigger panic in those with trauma histories", "Being patient when a student can't explain their own reaction‚Äîthey often genuinely don't know", "After an incident, wondering aloud: 'I noticed that got really intense for you. Is there anything I should know about what makes this classroom feel safer?'", "Consulting with counsellors or wellbeing staff when you notice patterns you don't understand"] } },
{ id: 18, name: "Co-Regulation Strategies", description: "Use your own calm nervous system to help regulate students", explanation: { what: "Recognise that your nervous system affects your students' nervous systems. When you are calm, grounded, and regulated, you offer students a template their bodies can mirror. This is co-regulation: your regulated state helps bring down their activation. Practically, this means managing your own stress response, using calm body language, slowing your speech and movements, and staying present rather than reactive.", why: "Humans are wired for social regulation‚Äîwe literally catch each other's emotional states. This is why a calm person can soothe a distressed child, and why one anxious adult can make a whole room tense. For students who struggle to regulate themselves (often due to early experiences where no one helped them learn to regulate), your calm is not just modelling‚Äîit's medicine. They borrow your regulation until they can develop their own. This is one of the most powerful tools you have, and it costs nothing except your own self-awareness.", examples: ["Taking a slow breath before responding to challenging behaviour‚Äîstudents unconsciously mirror your breathing", "Lowering and slowing your voice when a student is escalating", "Relaxing your shoulders and uncrossing your arms‚Äîopen body language signals safety", "Sitting down or crouching rather than standing over a dysregulated student", "Speaking less, not more, when things are tense‚Äîyour calm silence is regulating", "Moving slowly and predictably‚Äîsudden movements can spike stress", "Staying physically present without crowding: 'I'm going to sit over here. I'm not going anywhere.'", "Checking in with yourself: 'Am I regulated right now? If not, I need to regulate myself before I can help this student.'", "Accepting that if you're dysregulated, you'll make things worse‚Äîstepping back is sometimes the best intervention"] } }
],
"Restorative Practices": [
{ id: 19, name: "Restorative Conversations", description: "Structured dialogue focused on harm, responsibility and repair", explanation: { what: "When harm has occurred, use a structured conversation that focuses on three things: What happened? Who was affected and how? What needs to happen to make things right? This replaces the traditional approach of interrogating, blaming, and punishing. The conversation is curious rather than accusatory, and its goal is understanding and repair rather than establishing guilt and delivering consequences.", why: "Punitive approaches ask 'What rule was broken and what punishment is deserved?' Restorative approaches ask 'Who was harmed and what do they need?' This shift matters because punishment often leaves everyone worse off‚Äîthe harmed person doesn't feel heard, the person who caused harm doesn't develop empathy or skills, and the relationship remains damaged. Restorative conversations build accountability that comes from understanding impact, not fear of punishment. Students who genuinely understand how their actions affected others are more likely to change than students who simply want to avoid getting caught.", examples: ["'I want to understand what happened. Can you walk me through it from your perspective?'", "'Who do you think was affected by what happened? How do you think they felt?'", "'What were you thinking at the time? What are you thinking now?'", "'What do you think needs to happen to make this right?'", "'Is there anything you need from me or anyone else to help you move forward?'", "Bringing together the person harmed and the person who caused harm (when appropriate and both are willing)", "Avoiding 'Why did you do that?' (feels accusatory) in favour of 'Help me understand what was going on for you'", "Ending with a clear agreement about next steps, not just an apology"] } },
{ id: 20, name: "Affective Statements", description: "Express impact using 'I felt... when...' language", explanation: { what: "Use statements that express how behaviour affected you or others, focusing on feelings and impact rather than judgement and blame. The structure is simple: 'I felt [emotion] when [specific behaviour] because [impact].' For example: 'I felt frustrated when the conversation continued because I had to stop teaching and I worry we're losing learning time.' This is vulnerable and human, not authoritarian.", why: "Affective statements work because they give students information about impact without attacking their character. 'You're being disrespectful' triggers defensiveness. 'I felt disrespected when you spoke over me' gives the same information but invites empathy rather than resistance. When we share our genuine emotional experience, we model vulnerability and treat students as capable of caring about others' feelings. Many students, particularly those who've experienced trauma, have learned to tune out commands but respond to authentic human connection.", examples: ["'I felt worried when you didn't come to class because I didn't know if you were okay.'", "'I felt disappointed when the work wasn't handed in because I was looking forward to seeing what you'd create.'", "'I felt hurt when I heard that comment because it seemed like you didn't value what I was trying to teach.'", "'I notice I'm feeling frustrated right now, and I think it's because I've asked three times and it feels like I'm not being heard.'", "Teaching students to use affective statements with each other: 'Tell Marcus how you felt when that happened.'", "Avoiding exaggeration‚Äîyour statements need to be genuine to be effective", "Following up with curiosity: 'I felt concerned when you threw your book. Can you help me understand what was going on?'"] } },
{ id: 21, name: "Collaborative Problem-Solving", description: "Work with students to find solutions rather than imposing them", explanation: { what: "When a problem recurs or a conflict needs resolution, work with the student to identify the underlying issue and generate solutions together‚Äîrather than diagnosing the problem yourself and imposing your solution. This involves three steps: empathise (understand the student's concern), define the problem (share your concern too), and invite solutions (brainstorm together). The student's voice is central throughout.", why: "Imposed solutions rarely stick because students haven't bought in. They comply when watched and revert when unsupervised. But when students help create the solution, they own it‚Äîthey're invested in making it work. Collaborative problem-solving also treats students as capable thinkers whose perspectives matter. Often, students have insights into their own behaviour that we lack. A student who keeps arriving late might reveal a reason (bullying on the way, caring for siblings) that changes everything. And the process itself teaches problem-solving skills students will use throughout life.", examples: ["'I've noticed you're struggling to get started on writing tasks. What's getting in the way from your perspective?'", "'So you find it hard when there's too much noise. I need everyone to hear instructions. What could we try that works for both of us?'", "'What do you think would help you remember to bring your materials?'", "Generating multiple options together before evaluating any of them", "Letting the student choose from options you've brainstormed together", "'Let's try this for a week and check in. If it's not working, we'll problem-solve again.'", "Avoiding 'Have you tried...?' (which is just disguised advice) in favour of 'What ideas do you have?'", "When students say 'I don't know': 'If you did know, what might you say?' or 'Take a guess‚Äîthere's no wrong answer here.'"] } },
{ id: 22, name: "Reintegration After Incidents", description: "Actively welcome students back into the community after consequences", explanation: { what: "After a student has experienced a consequence‚Äîwhether time out, suspension, a difficult conversation, or any separation from the community‚Äîdeliberately and warmly welcome them back. Don't make them earn their way back or prove they've changed. The welcome is unconditional: 'We're glad you're here.' Reintegration is an active process, not just the absence of continued punishment.", why: "Many students expect to return to hostility, judgement, or cold shoulders after an incident. They brace for rejection, and sometimes act out pre-emptively to 'get it over with.' When you actively welcome them back, you disrupt this cycle. You prove that consequences are temporary but belonging is permanent. This is unconditional positive regard in action: your membership in this community doesn't depend on your behaviour. Reintegration also prevents the shame spiral‚Äîwhen students feel cast out, they often identify with the outcast role and behave accordingly.", examples: ["Greeting them at the door when they return: 'Good to see you. We missed you.'", "'Yesterday was tough. Today's a new day. I'm glad you're back.'", "Assigning them a meaningful role on their first day back‚Äîshowing you trust them", "Checking in privately: 'How are you feeling about being back? Anything you need from me?'", "Ensuring other students don't reference the incident: 'We've dealt with that. Now we move forward.'", "Avoiding any 'walking on eggshells' behaviour that signals lingering distrust", "If a relationship was damaged: 'I want you to know we're okay. That incident doesn't change how I see you.'", "Resisting the urge to remind them of the consequence or extract promises of better behaviour"] } },
{ id: 23, name: "Community Circles", description: "Regular whole-class practices that build connection and address issues", explanation: { what: "Regularly gather your class in a circle for structured conversation. Circles can be used proactively (building connection, checking in, celebrating) or reactively (addressing class issues, processing difficult events). The circle format‚Äîeveryone visible, no one at the head‚Äîcommunicates equality and shared ownership. A talking piece ensures one voice at a time and equal opportunity to speak. Questions move around the circle sequentially.", why: "Circles build the relational foundation that makes everything else possible. When students feel connected to each other and to you, behaviour improves, engagement increases, and conflicts are easier to resolve. Circles also develop skills: listening without interrupting, speaking authentically, considering others' perspectives. For students who feel invisible or marginal, circles guarantee them a voice. And when issues arise, circles allow the community to address them together rather than relying solely on teacher authority.", examples: ["Weekly check-in circle: 'Share one word for how you're feeling and one thing you're looking forward to.'", "Using a talking piece (object passed around) to manage turn-taking", "Circle agreements: listen with respect, speak from the heart, say only what you're comfortable sharing, what's said here stays here", "Community-building questions: 'What's something people might be surprised to learn about you?'", "Problem-solving circles: 'We've had some issues with group work lately. What's making it hard? What could help?'", "Celebration circles: 'Name someone in this class who helped you this week.'", "Keeping circles short (10-15 minutes) and frequent rather than long and rare", "Participating yourself‚Äîsitting in the circle and sharing when it's your turn"] } },
{ id: 24, name: "Making Amends vs Punishment", description: "Focus on repairing harm rather than inflicting proportional suffering", explanation: { what: "When harm has been done, shift the focus from 'What punishment is deserved?' to 'How can this be made right?' Making amends means taking action to repair the damage‚Äîapologising, fixing what was broken, restoring what was taken, or doing something positive for the person or community harmed. The amends should be connected to the harm and agreed upon collaboratively, not imposed arbitrarily.", why: "Punishment is based on the idea that suffering balances suffering‚Äîif you caused pain, you should feel pain. But this rarely leads to genuine change or repair. The person harmed doesn't feel better; the person who caused harm feels resentful, not remorseful. Making amends, by contrast, is forward-looking and constructive. It gives the person who caused harm an opportunity to do something positive‚Äîtransforming them from 'the one who hurt' to 'the one who made it right.' This builds agency, responsibility, and self-respect. It also gives the harmed person something meaningful.", examples: ["'How do you think you could make this right with Jess?'", "'The mess affected everyone who uses this space. What could you do to contribute to the community?'", "Helping repair or replace something that was damaged", "Writing a genuine letter of apology (not a forced, formulaic one)", "Doing a kind act for the person harmed‚Äîof the harmed person's choosing", "'Rather than detention, I'd like you to help the Year 7s at lunch this week. I think you'd be good at it.'", "Ensuring the amends is proportionate and achievable‚Äînot so large it becomes punitive", "Framing amends as opportunity, not punishment: 'This is a chance to show who you really are.'", "Checking with the harmed person: 'What would help you feel like this has been addressed?'"] } }
],
"Cultural Responsiveness": [
{ id: 25, name: "Acknowledging Cultural Strengths", description: "Recognise and value the assets students bring from their backgrounds", explanation: { what: "Actively identify and name the strengths, knowledge, and skills students bring from their cultural backgrounds and home lives. This includes linguistic abilities (multilingualism is an asset, not a deficit), family and community knowledge, cultural practices and values, resilience developed through navigating multiple worlds, and perspectives that enrich classroom learning. Make these strengths visible and valued in your curriculum and daily interactions.", why: "Many students from minority or marginalised backgrounds receive constant messages‚Äîsometimes subtle, sometimes explicit‚Äîthat their culture, language, and family are deficient. School often positions middle-class white Australian culture as the norm against which others are measured. When you acknowledge cultural strengths, you counter these messages. You tell students: 'What you bring is valuable here.' This builds identity and belonging, which are foundations for engagement and learning. It also enriches your classroom‚Äîdiversity of perspective benefits everyone.", examples: ["'You speak three languages? That's an incredible skill. Your brain is doing things monolingual brains can't do.'", "Asking students to share cultural knowledge: 'Amir, can you tell us about Ramadan and what it means to your family?'", "Referencing diverse examples in curriculum: scientists, authors, historical figures from many backgrounds", "Displaying student work that reflects their cultural identity", "Learning and correctly pronouncing students' names‚Äînames carry cultural significance", "Inviting family members to share expertise or traditions with the class", "Noticing strengths developed through challenge: 'You're so good at adapting to different situations‚Äîthat's a real skill.'", "Avoiding surprise when students from certain backgrounds excel: 'Of course you can do this‚ÄîI expect great things from you.'"] } },
{ id: 26, name: "Avoiding Deficit Framing", description: "Describe differences without implying deficiency", explanation: { what: "Examine your language and thinking for deficit framing‚Äîdescribing students, families, or communities in terms of what they lack rather than what they have. Deficit language sounds like: 'low socioeconomic background', 'broken home', 'limited English', 'disadvantaged', 'at-risk', 'doesn't have books at home', 'parents don't value education.' Replace this with asset-based or neutral framing that acknowledges difference without implying inferiority.", why: "Deficit framing shapes expectations, and expectations shape outcomes. When we see students through a lens of lack, we lower expectations, offer watered-down curriculum, and interpret behaviour negatively. Students internalise these messages about themselves and their families. The research is clear: teacher expectations significantly affect student achievement. Asset-based framing doesn't mean ignoring challenges or pretending inequality doesn't exist‚Äîit means refusing to reduce students to their challenges and maintaining high expectations for everyone.", examples: ["Instead of 'low SES background': 'students from working-class families' or simply don't mention it unless relevant", "Instead of 'limited English': 'emergent bilingual' or 'learning English as an additional language'", "Instead of 'single parent family': 'their family' (structure is often irrelevant)", "Instead of 'they don't have books at home': 'they have rich oral storytelling traditions at home'", "Catching yourself when you're about to attribute struggle to background rather than instruction", "Avoiding 'these kids' as a way of grouping students from particular backgrounds", "Questioning assumptions: 'Am I expecting less from this student because of their background?'", "Talking about what students can do, not just what they can't do yet"] } },
{ id: 27, name: "Culturally Safe Communication", description: "Adapt communication styles to respect cultural norms", explanation: { what: "Recognise that communication norms vary across cultures and adapt your style accordingly. This includes: eye contact (direct eye contact is disrespectful in some cultures), wait time (some cultures expect longer pauses before responding), physical proximity, tone and volume, directness versus indirectness, and the role of silence. Learn about the communication norms of the cultures represented in your classroom and avoid penalising students for culturally appropriate behaviour.", why: "When we judge all students by dominant-culture communication norms, we inadvertently punish cultural difference. A student who looks down when being spoken to may be showing respect, not defiance. A student who doesn't answer immediately may be thinking carefully, not disengaged. A student who speaks loudly may be communicating enthusiasm, not aggression. Cultural safety means students don't have to abandon their cultural identity to succeed in your classroom.", examples: ["Learning about eye contact norms: in many Aboriginal, Torres Strait Islander, Asian, and African cultures, direct eye contact with authority figures is disrespectful", "Extending wait time for students from cultures that value thoughtful pauses", "Not interpreting silence as lack of engagement‚Äîin some cultures, silence is respectful listening", "Being aware that 'speaking up' in front of the whole class may be culturally uncomfortable for some students", "Offering multiple ways to participate: written, small group, one-on-one, not just public speaking", "Avoiding singling out students to represent their culture: 'What do Aboriginal people think about...?'", "Checking your interpretations: asking students privately about their communication preferences", "Being patient with indirectness‚Äîsome cultures consider direct requests rude"] } },
{ id: 28, name: "Family Partnership Approaches", description: "Engage families as experts on their children", explanation: { what: "Approach families as partners and experts, not as problems to manage or recipients of professional wisdom. Families know their children better than you do. Communicate with warmth and respect, lead with positives, seek their input and expertise, and adapt your approach to their needs (timing, language, format). This is especially important for families from cultures where school authority may be intimidating or where past experiences with institutions have been negative.", why: "When families feel judged, blamed, or dismissed, they disengage‚Äîand students lose a critical support. When families feel respected and included, they become powerful allies in their child's education. For students, seeing their teacher value their family communicates: 'Your world is valued here.' Many families, particularly from refugee, Aboriginal, or working-class backgrounds, have had negative experiences with schools and may distrust teachers. You have to earn trust through consistent respect and genuine partnership.", examples: ["Leading every communication with something positive: 'I want to start by telling you what I appreciate about Jayden...'", "Asking for family input: 'What works at home when he's struggling? What should I know about him?'", "Making contact before problems arise‚Äîbuilding relationship first", "Offering flexibility: meetings at different times, phone calls instead of in-person, written communication in home language where possible", "Using interpreters properly‚Äîspeaking to the family, not the interpreter", "Avoiding education jargon that excludes families without tertiary education", "Home visits (where culturally appropriate and welcomed) to understand context", "Never blaming families for student behaviour or difficulties: 'We're on the same team here. How can we work together?'"] } },
{ id: 29, name: "Recognising Bias in Expectations", description: "Examine whether expectations differ based on student background", explanation: { what: "Honestly examine whether you hold, communicate, or act on different expectations for students from different backgrounds. Bias is often unconscious‚Äîwe may genuinely believe we treat everyone the same while our behaviour tells a different story. Look at patterns: Who do you call on? Who do you praise? Who do you correct? Who gets the benefit of the doubt? Who gets the challenging extension work? Whose behaviour gets interpreted as a problem?", why: "Research consistently shows that teachers hold lower expectations for students from minority backgrounds, lower socioeconomic backgrounds, and those with disabilities‚Äîand that these expectations affect student outcomes. Students pick up on expectations through a thousand micro-messages. They know when a teacher has given up on them, even if it's never said aloud. Examining your own bias isn't about guilt‚Äîit's about ensuring every student gets the expectations and opportunities they deserve.", examples: ["Tracking who you call on over a week‚Äîis it equitable?", "Noticing whether you praise effort for some students and intelligence for others", "Asking yourself: 'Would I interpret this behaviour the same way if it came from a different student?'", "Checking whether your 'challenging' students are disproportionately from particular backgrounds", "Examining your seating plan: where are students from different backgrounds physically positioned?", "Looking at referrals and consequences: are they equitable across groups?", "Seeking feedback from colleagues or students about potential blind spots", "Assuming capability first: 'Every student in my room can achieve at high levels' as a starting belief"] } },
{ id: 30, name: "Inclusive Classroom Environment", description: "Ensure physical and social environment reflects all students", explanation: { what: "Audit your classroom environment‚Äîboth physical and social‚Äîto ensure it reflects and welcomes all students. Physical environment includes: posters, books, displays, resources, music, decorations. Social environment includes: whose voices are heard, whose stories are told, which examples are used in teaching, which achievements are celebrated. Students should see themselves reflected in your classroom, not feel like visitors in someone else's space.", why: "Environment communicates belonging. When a student walks into a room full of white faces on the walls, examples from white Australian experience, and texts by white authors, they receive a message: this space wasn't designed for you. When they see their culture, their people, their experiences represented, they receive a different message: you belong here. Inclusive environment isn't about tokenism‚Äîa single poster of a brown face. It's about genuine representation woven throughout every aspect of your classroom.", examples: ["Books and texts by authors from diverse backgrounds‚Äînot as 'diversity unit' but as normal curriculum", "Posters showing scientists, mathematicians, artists, leaders from many cultures and backgrounds", "Acknowledging Country and integrating Aboriginal and Torres Strait Islander perspectives genuinely", "Music from various cultures playing as students enter", "Examples and word problems that feature diverse names, family structures, and cultural contexts", "Celebrating diverse holidays and events‚Äînot just Christian/Western ones", "Reviewing resources for stereotyping or underrepresentation", "Asking students: 'Do you see yourself represented in our classroom? What's missing?'", "Ensuring LGBTQI+ students see themselves reflected too‚Äîrainbow flags, inclusive language, diverse family representations"] } }
],
"Language Strategies": [
{ id: 31, name: "I-Statements Instead of You-Accusations", description: "Own your experience rather than attributing intent to students", explanation: { what: "When addressing behaviour, speak from your own experience rather than making accusations about the student's intentions or character. 'I' statements follow the pattern: 'I feel/notice/need [your experience] when [specific behaviour].' Compare 'You're not listening' (accusation) with 'I notice I'm having to repeat myself' (observation). Compare 'You're being disruptive' (label) with 'I'm finding it hard to teach when there's side conversation' (impact on you).", why: "Accusations trigger defensiveness. When we say 'You did X', students hear an attack and prepare to defend themselves‚Äîthe conversation becomes about whether they're guilty rather than about solving the problem. 'I' statements are harder to argue with because they describe your experience, which is simply true. They also model emotional literacy and vulnerability. Perhaps most importantly, they avoid the trap of assuming intent. We rarely know why a student did something; we only know what we observed and how it affected us.", examples: ["Instead of 'You're ignoring me': 'I notice you're looking away while I'm talking, and I'm not sure you're hearing the instructions.'", "Instead of 'You're always late': 'I feel concerned when you arrive after the lesson has started because you miss important information.'", "Instead of 'Stop talking': 'I need quiet right now so everyone can focus.'", "Instead of 'You're being rude': 'I felt hurt by that comment.'", "Instead of 'Why are you doing that?': 'I'm confused about what's happening. Can you help me understand?'", "'I'm getting frustrated' rather than 'You're frustrating me'‚Äîowning your emotion fully", "Following up with curiosity: 'I've shared how I'm experiencing this. What's going on for you?'"] } },
{ id: 32, name: "Describing Behaviour Not Character", description: "Name actions specifically without labelling the person", explanation: { what: "When giving feedback or addressing issues, describe the specific observable behaviour rather than making generalised statements about who the student is. 'You called out three times during the lesson' rather than 'You're always disruptive.' 'That comment was unkind' rather than 'You're mean.' Behaviour is what happened; character is who someone is. Keep your language at the level of behaviour.", why: "Labels stick. When we tell students who they are ('You're lazy', 'You're a troublemaker', 'You're so smart'), they internalise these as fixed identities. Negative labels become self-fulfilling prophecies; even positive labels can create pressure and fixed mindset. But behaviour is specific, temporary, and changeable. A student who called out three times today can make a different choice tomorrow. A student who 'is disruptive' has no path forward. Specific behavioural descriptions also give students actionable information‚Äîthey know exactly what to change.", examples: ["Instead of 'You're disorganised': 'I notice you didn't have your materials today. What happened?'", "Instead of 'You're a bully': 'What you did to Marcus at lunch‚Äîpushing him and taking his food‚Äîthat's bullying behaviour.'", "Instead of 'You're so clever': 'You used a really creative strategy to solve that problem.'", "Instead of 'Good girl': 'Thank you for waiting patiently.'", "Instead of 'You're lazy': 'I haven't seen you start the task yet. What's getting in the way?'", "Being specific about time: 'Today you...' rather than 'You always...'", "When praising: describe what they did, not what they are", "When correcting: describe what you saw, not what it means about them"] } },
{ id: 33, name: "Future-Focused Language", description: "Emphasise what can happen next rather than dwelling on failures", explanation: { what: "Shift your language from backward-looking (what went wrong, who's to blame, what the punishment will be) to forward-looking (what happens next, what we can do differently, what success will look like). After addressing an issue, move quickly to 'So, moving forward...' rather than rehashing the failure. When students are stuck, talk about next steps rather than why they're stuck.", why: "Dwelling on failures rarely motivates improvement‚Äîit usually generates shame, defensiveness, or hopelessness. Students can't change the past; they can only influence the future. Future-focused language communicates optimism: there is a path forward, you can do this differently, I believe in your capacity to improve. It also keeps the relationship intact‚Äîwe're not adversaries investigating wrongdoing but allies planning for success. For students who've experienced repeated failure, future-focus offers hope.", examples: ["After an incident: 'Okay, that happened. What's your plan for handling it differently next time?'", "'Let's focus on what we can do now' rather than 'Why didn't you do this earlier?'", "'Tomorrow, I'd like to see you...' rather than 'Yesterday, you didn't...'", "'What would it look like if this went well?' rather than 'What went wrong?'", "'You haven't got it yet. Let's figure out what will help.' rather than 'You got it wrong.'", "When a student fails a test: 'What's your plan for the retake?' rather than extended discussion of what they did wrong", "Ending difficult conversations with next steps: 'So tomorrow, we're going to...'", "'What do you need from me to be successful?' rather than 'Why aren't you successful?'"] } },
{ id: 34, name: "Acknowledging Effort Over Outcome", description: "Praise the process and persistence, not just results", explanation: { what: "When giving positive feedback, focus on what students did‚Äîthe effort, strategies, persistence, improvement, and choices they made‚Äîrather than on fixed traits or outcomes alone. 'You kept trying different approaches until you found one that worked' rather than 'You got the right answer.' 'I can see how much work you put into this' rather than 'You're so smart.' Process praise builds motivation; trait praise can undermine it.", why: "Research by Carol Dweck and others shows that praising fixed traits ('You're smart') actually reduces motivation and resilience. Students praised for being smart become afraid of challenges that might reveal they're not smart. They give up faster when things get hard. But students praised for effort and strategy learn that success comes from work, which is controllable. They persist longer, embrace challenges, and view failure as information rather than identity. For students who struggle academically, effort praise is especially crucial‚Äîit's something they can always give, regardless of where they're starting from.", examples: ["'You didn't give up, even when it got really hard. That persistence will take you far.'", "'I noticed you tried three different strategies before you found one that worked. That's what good problem-solvers do.'", "'This is so much more detailed than your last draft. You've really developed your ideas.'", "'You asked for help when you were stuck. That takes courage and it's a smart strategy.'", "Instead of 'You're a great writer': 'You put a lot of thought into your word choices here.'", "Instead of 'Perfect score!': 'Your preparation really paid off.'", "Noticing recovery from mistakes: 'I saw you catch your own error and fix it. That's self-monitoring.'", "Praising struggle: 'This is hard for you, and you're still trying. That's the most important thing.'"] } },
{ id: 35, name: "Avoiding Sarcasm and Public Shaming", description: "Eliminate humour that comes at student expense", explanation: { what: "Completely eliminate sarcasm, mockery, and any humour that comes at students' expense from your interactions. This includes 'playful' teasing, rhetorical questions designed to embarrass ('Were you born in a barn?'), reading out poor work, pointing out mistakes publicly, using a student as a negative example, or any comment that gets a laugh from the class at one student's expense. If you're tempted to be sarcastic, say nothing instead.", why: "Sarcasm is veiled contempt‚Äîit communicates hostility while maintaining deniability ('I was just joking'). Students feel the hostility even when they can't name it. It's particularly damaging because it's confusing: the words might be 'praise' but the tone communicates criticism. For students with trauma or rejection sensitivity, sarcasm is deeply wounding. Public shaming‚Äîeven subtle forms‚Äîdamages both the individual and your relationship with the whole class, who learn that you might humiliate them too. The brief moment of laughter or compliance is never worth the relational cost.", examples: ["Catching yourself before sarcastic responses and simply stating what you need instead", "Instead of 'Oh, nice of you to join us' when a student is late: 'Grab a seat and check the board for instructions.'", "Instead of 'Do I need to repeat myself for the hundredth time?': 'I'm going to say that again.'", "Never using a student's mistake as a teaching example without their permission", "Avoiding rhetorical questions like 'What were you thinking?' or 'Was that a good choice?'", "If you slip into sarcasm, apologise genuinely: 'That came out sarcastic. I'm sorry. What I meant was...'", "Being especially careful with students who seem to 'take' teasing well‚Äîthey may be masking hurt", "Remembering that your humour should bring students in, never single anyone out"] } },
{ id: 36, name: "The Power of Yet", description: "Add 'yet' to limitations to communicate growth mindset", explanation: { what: "When students express fixed beliefs about their abilities ('I can't do this', 'I'm not good at maths', 'I don't understand'), add the word 'yet' to reframe limitation as temporary. 'You can't do this yet.' 'You don't understand yet.' This tiny word shifts the statement from a fixed conclusion to a point on a journey. Teach students to add 'yet' to their own self-talk.", why: "The word 'yet' encodes a growth mindset in a single syllable. It communicates: this is hard now, but you're capable of learning; where you are today is not where you'll be tomorrow; struggle is part of the process, not evidence of inability. For students who've internalised beliefs about their own limitations, 'yet' offers a different story. It's particularly powerful because it doesn't dismiss their current struggle‚Äîit acknowledges the difficulty while insisting on future possibility.", examples: ["Student: 'I can't do fractions.' Teacher: 'You can't do fractions yet.'", "Student: 'I don't get it.' Teacher: 'You don't get it yet. Let's try another approach.'", "Student: 'I'm bad at writing.' Teacher: 'You're still developing as a writer. You're not where you want to be yet.'", "'You haven't mastered this yet. And that's okay‚Äîthat's why we're practising.'", "Posting 'The Power of Yet' visually in your classroom", "Teaching students to catch each other: 'You mean you can't do it yet!'", "'Yet' works for behaviour too: 'You haven't learned to manage your frustration yet. We'll keep working on it.'", "Modelling it yourself: 'I haven't figured out the best way to explain this yet. Let me try again.'"] } }
],
"Relationship Repair": [
{ id: 37, name: "The 5:1 Positive Interaction Ratio", description: "Maintain five positive interactions for every correction", explanation: { what: "Aim for at least five positive interactions with each student for every one correction or negative interaction. Positive interactions include: greetings, praise, encouragement, showing interest, smiling, humour, acknowledgment, noticing their presence, asking about their lives, and affirming their contributions. Track this intentionally for students you find challenging‚Äîthey're often the ones with the worst ratios.", why: "Research on relationships (originally in marriages, but applicable to all relationships) shows that a 5:1 ratio of positive to negative interactions is necessary for a relationship to feel good and remain stable. Below this ratio, the relationship feels negative overall, even if there's some warmth. For students who receive frequent corrections, your relationship can quickly become deficit-based‚Äîthey experience you primarily as someone who tells them what they're doing wrong. The 5:1 ratio ensures corrections land in a context of care.", examples: ["Before correcting, ask yourself: 'Have I had five positive interactions with this student recently?'", "Starting each day with a positive greeting to students you often correct", "Finding something genuine to praise before raising a concern: 'I appreciate how quickly you got started. I need you to also...'", "Making deposits before withdrawals: building relational credit before you need to spend it", "Tracking your interactions with challenging students‚Äîyou may be surprised how negative the ratio is", "Positive interactions don't need to be elaborate: a smile, a nod, 'good to see you'", "Ending lessons with positive closure, especially after difficult moments: 'Thanks for your effort today.'", "Remembering that neutral is not positive‚Äîyou need active warmth, not just absence of criticism"] } },
{ id: 38, name: "Checking In After Consequences", description: "Reconnect with students after difficult moments", explanation: { what: "After a student has experienced a consequence, had a difficult conversation with you, or been through a challenging moment, deliberately check in with them to restore the relationship. This isn't about rehashing what happened‚Äîit's about communicating that the relationship is still intact. A brief check-in: 'How are you going? Are we okay?' goes a long way.", why: "Consequences and difficult conversations can leave students feeling that you're against them, that they've damaged the relationship, or that you're holding a grudge. Without intentional repair, some students will carry shame and resentment that poisons future interactions. Checking in communicates: the consequence happened, it's done, and I still care about you. It gives students permission to move forward rather than staying stuck in shame. It also models that relationships can survive rupture‚Äîa lesson many students have never learned.", examples: ["After a detention or time-out: 'I wanted to check in. How are you feeling about everything?'", "Later the same day after a difficult conversation: 'Hey, I know this morning was tough. We're good, yeah?'", "The next morning after a serious incident: 'I'm glad you're here. I wanted you to know that yesterday doesn't change how I see you.'", "A brief private word: 'Just checking‚Äîare we okay? Do you have any questions about what happened?'", "Noticing if a student seems to be avoiding you after an incident and gently re-approaching", "Not waiting for them to come to you‚Äîyou're the adult, you initiate repair", "Keeping check-ins brief and warm‚Äîthis isn't another conversation about the incident", "If they're not ready to talk: 'That's okay. I just wanted you to know I'm here when you are.'"] } },
{ id: 39, name: "Acknowledging Your Own Mistakes", description: "Model accountability by admitting when you get it wrong", explanation: { what: "When you make a mistake‚Äîmisjudge a situation, speak harshly, make an unfair decision, forget a promise, get something wrong‚Äîacknowledge it openly and apologise genuinely. Don't make excuses, minimise, or become defensive. A simple, direct acknowledgment: 'I got that wrong. I'm sorry.' This applies to mistakes with individual students and with the whole class.", why: "When adults refuse to admit mistakes, students learn that power means never having to say sorry. When you model accountability, you teach that everyone makes mistakes and everyone can repair them. This is especially powerful for students who are frequently told to apologise but rarely see adults do the same. Your apology also restores trust‚Äîstudents know you're honest with them, not just performing authority. And it gives permission for students to acknowledge their own mistakes without catastrophic shame.", examples: ["'I snapped at you earlier, and that wasn't fair. I was stressed, but that's not your fault. I'm sorry.'", "'I made a mistake on that problem. Thanks for catching it‚ÄîI'm still learning too.'", "'I said I'd have these marked, and I didn't. I apologise. I'll have them tomorrow.'", "'Looking back, I don't think I handled that situation well. I should have listened before reacting.'", "'I was wrong about what happened. I'm sorry I jumped to conclusions.'", "Apologising to the whole class when appropriate: 'I was short with everyone this morning. That was about me, not you. Let's reset.'", "Following through on what you said you'd do differently", "Avoiding 'I'm sorry you feel that way' (non-apology) in favour of 'I'm sorry I did that'"] } },
{ id: 40, name: "We're Good Closure", description: "Explicitly signal that the relationship is intact after conflict", explanation: { what: "After a conflict, consequence, or difficult conversation, explicitly close the loop by telling the student the relationship is okay. Don't assume they know‚Äîsay it out loud. 'We're good.' 'This doesn't change anything between us.' 'We're okay‚ÄîI'm not holding onto this.' The words matter because many students have learned that conflict means rejection or lasting rupture.", why: "Many students, especially those with trauma or insecure attachment, live in fear that any conflict will end the relationship. They may have experienced caregivers who withdrew love after conflict, or who held grudges indefinitely. Without explicit closure, these students carry anxiety about where they stand with you. 'We're good' is a simple phrase that provides enormous relief. It allows them to stop ruminating, stop bracing for rejection, and return their energy to learning and connection.", examples: ["At the end of a difficult conversation: 'Okay, that's done. We're good.'", "'I know that was hard. But it doesn't change how I feel about you. We're okay.'", "'That consequence happened; now it's over. Clean slate.'", "A fist bump or handshake to physically seal the closure (if appropriate for the student)", "'I'm not holding onto this. Are you? ... Good. Then let's move forward.'", "If tension seems to linger: 'I want to be clear‚Äîwe're okay. I'm not upset with you.'", "Normalising repair: 'This stuff happens. We deal with it and move on. That's how relationships work.'", "Being genuine‚Äîonly say 'we're good' when you mean it; if you need more time, say so honestly"] } },
{ id: 41, name: "Re-establishing Trust", description: "Take deliberate steps to rebuild connection after ruptures", explanation: { what: "When a significant rupture has occurred‚Äîa major incident, a period of disconnection, a betrayal of trust in either direction‚Äîtake intentional steps to rebuild the relationship. This goes beyond a single apology or check-in to a sustained effort to restore connection. It might involve increased positive interactions, finding new ways to connect, addressing underlying issues, or simply showing up consistently over time.", why: "Some ruptures require more than 'we're good' to heal. When trust has been significantly damaged‚Äîwhether through a serious incident, accumulated small injuries, or a prolonged period of negative interactions‚Äîrepair requires sustained attention. Students need to see, over time, that you mean what you say and that the relationship really is safe again. This is especially true for students whose trust has been broken by other adults. They'll test whether you're different, and your consistent presence is the answer.", examples: ["After a major incident: increasing your positive interactions deliberately for several weeks", "Finding a new way to connect: 'I noticed you're into basketball. I'd love to hear about it.'", "Checking in more frequently: 'I just wanted to see how you're going. I'm glad you're here.'", "If you've been harsh over time: 'I've been thinking about how I've been with you lately. I haven't been fair, and I want to do better.'", "Sharing something small about yourself to rebuild connection", "Showing up consistently: same warmth, same expectations, every day‚Äîespecially when they test you", "Having a reset conversation: 'I feel like things have been off between us. I'd like to start fresh. What do you need from me?'", "Understanding that trust is rebuilt in small moments over time, not in one big gesture"] } },
{ id: 42, name: "Consistent Follow-Through", description: "Build trust through predictable responses over time", explanation: { what: "Build trust by being utterly predictable in your responses. When you say you'll do something, do it. When you say there'll be a consequence, follow through. When you say you're there for them, show up. Consistency applies to both positive and negative: keep your promises, maintain your boundaries, and respond the same way today as you did yesterday. Your word is your bond.", why: "For many students, adults have been inconsistent‚Äîmaking promises they don't keep, threatening consequences that don't happen, being warm one day and cold the next. This inconsistency teaches students that adults can't be trusted and that the world is unpredictable. When you are consistent, you become a safe anchor. Students learn that you mean what you say, which makes your words more powerful‚Äîboth your praise and your corrections. Consistency is love made visible through reliability.", examples: ["If you say 'I'll mark these by Friday', mark them by Friday‚Äîor explain and apologise", "If you say 'Next time, there'll be a consequence', there's a consequence next time", "Responding the same way to the same behaviour, regardless of your mood or the student", "Showing up the same way every day: same greeting, same warmth, same expectations", "Not making promises you can't keep: 'I'll try to...' rather than 'I will...' if you're uncertain", "Not threatening consequences you won't enforce‚Äîbetter to promise less and deliver", "Being consistent across students: same standards for everyone", "When you can't follow through due to circumstances, acknowledging it: 'I said we'd do X, and we can't. I'm sorry.'"] } }
],
"Teacher Wellbeing": [
{ id: 43, name: "Managing Emotional Labour", description: "Recognise the energy required to maintain unconditional regard" },
{ id: 44, name: "Recognising Compassion Fatigue", description: "Notice signs that caring capacity is depleted" },
{ id: 45, name: "Setting Professional Boundaries", description: "Define sustainable limits on emotional investment" },
{ id: 46, name: "Seeking Collegial Support", description: "Use peer relationships to process difficult experiences" },
{ id: 47, name: "Self-Compassion Practices", description: "Extend to yourself the same grace you offer students" },
{ id: 48, name: "Knowing When to Step Back", description: "Recognise when you need space to regulate before responding" }
],
"Common Pitfalls to Avoid": [
{ id: 49, name: "Confusing UPR with Permissiveness", description: "Understand that unconditional regard includes boundaries" },
{ id: 50, name: "Accepting Harmful Behaviour", description: "Distinguish between accepting the person and accepting actions" },
{ id: 51, name: "Burnout from Over-Giving", description: "Recognise unsustainable patterns of emotional output" },
{ id: 52, name: "Inconsistent Application", description: "Apply regard equally across all students regardless of behaviour" },
{ id: 53, name: "Performative vs Genuine Regard", description: "Ensure care is authentic rather than performed compliance" },
{ id: 54, name: "Neglecting Accountability", description: "Remember that true care includes holding high expectations" }
],
"Professional Standards Alignment": [
{ id: 55, name: "APST 1.1: Physical, Social, Emotional Development", description: "Demonstrate knowledge of how students develop and learn" },
{ id: 56, name: "APST 4.1: Creating Supportive Environments", description: "Establish classroom environments that are safe and supportive" },
{ id: 57, name: "APST 4.3: Managing Behaviour Fairly", description: "Manage challenging behaviour through positive approaches" },
{ id: 58, name: "APST 7.3: Parent/Carer Communication", description: "Engage effectively with families about student wellbeing" },
{ id: 59, name: "Documenting UPR for Accreditation", description: "Record evidence of relational practices for professional standards" }
]
};

const STATUS_OPTIONS = [
{ value: 'use-this-week', label: 'Use this week', color: 'info', key: '1' },
{ value: 'often', label: 'I use this often', color: 'success', key: '2' },
{ value: 'occasionally', label: 'I use this occasionally', color: 'progress', key: '3' },
{ value: 'not-successful', label: 'Not successful yet', color: 'struggling', key: '4' },
{ value: 'dont-use', label: "I don't use this", color: 'muted', key: '5' },
{ value: 'not-yet', label: "I haven't used this yet", color: 'warning', key: '6' },
{ value: 'not-suitable', label: 'This does not suit me', color: 'neutral', key: '7' }
];

const STORAGE_KEY = 'tlacGrowthData';
const DATA_VERSION = 2; // Increment when schema changes
const MAX_UNDO_HISTORY = 100;
const MAX_WEEK_FOCUS = 3;
const TOTAL_TECHNIQUES = Object.values(TLAC_DATA).flat().length;
const TOTAL_UPR_PRACTICES = 59;
const WEEK_DURATION_DAYS = 7;
const STORAGE_WARNING_THRESHOLD = 0.8; // Warn at 80% of quota
const BACKUP_REMINDER_DAYS = 14; // Remind to backup every 2 weeks

// App State
let appState = {
    version: DATA_VERSION,
    profile: { name: '', yearsTeaching: '', schoolName: '', subjectArea: '', currentClasses: '', professionalGoals: '' },
    techniques: {},
    uprPractices: {},
    weekFocus: { techniques: [], startDate: null, notes: {}, plans: {}, history: [] },
    uprWeekFocus: { practices: [], startDate: null, notes: {}, plans: {}, history: [] },
    globalNotes: [],
    uprGlobalNotes: [],
    theme: 'light',
    fontSize: 16,
    lastSaved: null,
    lastExported: null
};

let undoStack = [];
let redoStack = [];

// ========== STORAGE ==========

// Deep merge utility - preserves nested structures
function deepMerge(target, source) {
    const result = { ...target };
    for (const key of Object.keys(source)) {
        if (source[key] === null || source[key] === undefined) {
            continue; // Don't overwrite with null/undefined
        }
        if (Array.isArray(source[key])) {
            result[key] = [...source[key]]; // Arrays are replaced, not merged
        } else if (typeof source[key] === 'object' && typeof target[key] === 'object' && !Array.isArray(target[key])) {
            result[key] = deepMerge(target[key], source[key]);
        } else {
            result[key] = source[key];
        }
    }
    return result;
}

// Validate imported/loaded data structure
function validateDataStructure(data) {
    const errors = [];
    
    // Check required top-level fields exist
    const requiredFields = ['profile', 'techniques', 'uprPractices', 'weekFocus', 'uprWeekFocus', 'globalNotes', 'uprGlobalNotes'];
    for (const field of requiredFields) {
        if (data[field] === undefined) {
            errors.push(`Missing required field: ${field}`);
        }
    }
    
    // Validate profile structure
    if (data.profile && typeof data.profile !== 'object') {
        errors.push('Profile must be an object');
    }
    
    // Validate techniques structure
    if (data.techniques) {
        if (typeof data.techniques !== 'object') {
            errors.push('Techniques must be an object');
        } else {
            for (const [id, tech] of Object.entries(data.techniques)) {
                if (tech && typeof tech === 'object') {
                    if (tech.notes && !Array.isArray(tech.notes)) {
                        errors.push(`Technique ${id} notes must be an array`);
                    }
                }
            }
        }
    }
    
    // Validate UPR practices structure
    if (data.uprPractices) {
        if (typeof data.uprPractices !== 'object') {
            errors.push('UPR Practices must be an object');
        } else {
            for (const [id, practice] of Object.entries(data.uprPractices)) {
                if (practice && typeof practice === 'object') {
                    if (practice.notes && !Array.isArray(practice.notes)) {
                        errors.push(`Practice ${id} notes must be an array`);
                    }
                }
            }
        }
    }
    
    // Validate weekFocus structure
    if (data.weekFocus) {
        if (typeof data.weekFocus !== 'object') {
            errors.push('Week focus must be an object');
        } else {
            if (data.weekFocus.techniques && !Array.isArray(data.weekFocus.techniques)) {
                errors.push('Week focus techniques must be an array');
            }
            if (data.weekFocus.history && !Array.isArray(data.weekFocus.history)) {
                errors.push('Week focus history must be an array');
            }
        }
    }
    
    // Validate uprWeekFocus structure
    if (data.uprWeekFocus) {
        if (typeof data.uprWeekFocus !== 'object') {
            errors.push('UPR week focus must be an object');
        } else {
            if (data.uprWeekFocus.practices && !Array.isArray(data.uprWeekFocus.practices)) {
                errors.push('UPR week focus practices must be an array');
            }
            if (data.uprWeekFocus.history && !Array.isArray(data.uprWeekFocus.history)) {
                errors.push('UPR week focus history must be an array');
            }
        }
    }
    
    // Validate global notes
    if (data.globalNotes && !Array.isArray(data.globalNotes)) {
        errors.push('Global notes must be an array');
    }
    if (data.uprGlobalNotes && !Array.isArray(data.uprGlobalNotes)) {
        errors.push('UPR global notes must be an array');
    }
    
    return { valid: errors.length === 0, errors };
}

// Migrate data from older versions
function migrateData(data) {
    const originalVersion = data.version || 1;
    let migrated = { ...data };
    
    // Migration from version 1 (no version field) to version 2
    if (!data.version || data.version < 2) {
        // Add version field
        migrated.version = 2;
        
        // Add lastExported field if missing
        if (migrated.lastExported === undefined) {
            migrated.lastExported = null;
        }
        
        // Ensure all techniques have proper structure
        if (migrated.techniques) {
            for (const id of Object.keys(migrated.techniques)) {
                if (!migrated.techniques[id].notes) {
                    migrated.techniques[id].notes = [];
                }
                if (!migrated.techniques[id].status) {
                    migrated.techniques[id].status = 'not-yet';
                }
            }
        }
        
        // Ensure all UPR practices have proper structure
        if (migrated.uprPractices) {
            for (const id of Object.keys(migrated.uprPractices)) {
                if (!migrated.uprPractices[id].notes) {
                    migrated.uprPractices[id].notes = [];
                }
                if (!migrated.uprPractices[id].status) {
                    migrated.uprPractices[id].status = 'not-yet';
                }
            }
        }
        
        // Ensure weekFocus has all required properties
        if (migrated.weekFocus) {
            migrated.weekFocus = {
                techniques: migrated.weekFocus.techniques || [],
                startDate: migrated.weekFocus.startDate || null,
                notes: migrated.weekFocus.notes || {},
                plans: migrated.weekFocus.plans || {},
                history: migrated.weekFocus.history || []
            };
        }
        
        // Ensure uprWeekFocus has all required properties
        if (migrated.uprWeekFocus) {
            migrated.uprWeekFocus = {
                practices: migrated.uprWeekFocus.practices || [],
                startDate: migrated.uprWeekFocus.startDate || null,
                notes: migrated.uprWeekFocus.notes || {},
                plans: migrated.uprWeekFocus.plans || {},
                history: migrated.uprWeekFocus.history || []
            };
        }
        
        console.log(`Migrated data from version ${originalVersion} to version 2`);
    }
    
    // Future migrations would go here:
    // if (migrated.version < 3) { ... migrated.version = 3; }
    
    return migrated;
}

// Check storage quota and return status
function checkStorageQuota() {
    try {
        const dataSize = JSON.stringify(appState).length;
        
        // Estimate available localStorage (typically 5-10MB, we'll assume 5MB conservatively)
        let totalSpace = 5 * 1024 * 1024; // 5MB default
        let usedSpace = 0;
        
        // Calculate total localStorage usage
        for (let key in localStorage) {
            if (localStorage.hasOwnProperty(key)) {
                usedSpace += localStorage.getItem(key).length * 2; // UTF-16 = 2 bytes per char
            }
        }
        
        const percentUsed = usedSpace / totalSpace;
        const ourDataSize = dataSize * 2; // UTF-16
        const ourPercent = ourDataSize / totalSpace;
        
        return {
            dataSize: dataSize,
            dataSizeKB: (dataSize / 1024).toFixed(1),
            usedSpace: usedSpace,
            usedSpaceMB: (usedSpace / (1024 * 1024)).toFixed(2),
            totalSpaceMB: (totalSpace / (1024 * 1024)).toFixed(0),
            percentUsed: percentUsed,
            isWarning: percentUsed >= STORAGE_WARNING_THRESHOLD,
            isCritical: percentUsed >= 0.95
        };
    } catch (e) {
        return { error: true, message: e.message };
    }
}

// Check if backup reminder should be shown
function shouldShowBackupReminder() {
    if (!appState.lastExported) {
        // If never exported and has some data, suggest backup
        const hasData = Object.keys(appState.techniques).some(id => 
            appState.techniques[id].status !== 'not-yet' || 
            (appState.techniques[id].notes && appState.techniques[id].notes.length > 0)
        ) || appState.globalNotes.length > 0;
        return hasData;
    }
    
    const daysSinceExport = (new Date() - new Date(appState.lastExported)) / (1000 * 60 * 60 * 24);
    return daysSinceExport >= BACKUP_REMINDER_DAYS;
}

// Get backup status info
function getBackupStatus() {
    if (!appState.lastExported) {
        return { needsBackup: shouldShowBackupReminder(), message: 'Never backed up', daysSince: null };
    }
    
    const daysSince = Math.floor((new Date() - new Date(appState.lastExported)) / (1000 * 60 * 60 * 24));
    const needsBackup = daysSince >= BACKUP_REMINDER_DAYS;
    
    let message;
    if (daysSince === 0) {
        message = 'Backed up today';
    } else if (daysSince === 1) {
        message = 'Backed up yesterday';
    } else {
        message = `Backed up ${daysSince} days ago`;
    }
    
    return { needsBackup, message, daysSince };
}

function saveData() {
    appState.lastSaved = new Date().toISOString();
    appState.version = DATA_VERSION;
    
    try {
        const dataStr = JSON.stringify(appState);
        localStorage.setItem(STORAGE_KEY, dataStr);
        updateSaveStatus();
        
        // Check quota after save
        const quota = checkStorageQuota();
        if (quota.isCritical) {
            showToast('‚ö†Ô∏è Storage nearly full! Please export your data as backup.', 'error');
        } else if (quota.isWarning) {
            showToast('Storage space getting low. Consider exporting a backup.', 'warning');
        }
    } catch (e) {
        if (e.name === 'QuotaExceededError' || e.code === 22) {
            showToast('‚ùå Storage full! Export your data immediately to avoid data loss.', 'error');
            // Attempt to show export dialog
            setTimeout(() => {
                if (confirm('Storage is full. Would you like to export your data now to prevent data loss?')) {
                    exportData();
                }
            }, 100);
        } else {
            console.error('Failed to save:', e);
            showToast('Failed to save data. Please export a backup.', 'error');
        }
    }
}

function loadData() {
    let loadedSuccessfully = false;
    let dataCorrupted = false;
    
    try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            let parsed;
            try {
                parsed = JSON.parse(saved);
            } catch (parseError) {
                console.error('Data corruption detected - JSON parse failed:', parseError);
                dataCorrupted = true;
                throw parseError;
            }
            
            // Validate structure
            const validation = validateDataStructure(parsed);
            if (!validation.valid) {
                console.warn('Data validation warnings:', validation.errors);
                // Continue anyway - we'll try to recover what we can
            }
            
            // Migrate if needed
            const migrated = migrateData(parsed);
            
            // Deep merge with defaults to ensure all fields exist
            appState = deepMerge(appState, migrated);
            
            if (appState.theme) applyTheme(appState.theme);
            if (appState.fontSize) applyFontSize(appState.fontSize);
            
            loadedSuccessfully = true;
        }
    } catch (e) {
        console.error('Failed to load:', e);
        
        if (dataCorrupted) {
            // Offer to export corrupted data for recovery attempt
            setTimeout(() => {
                const corrupted = localStorage.getItem(STORAGE_KEY);
                if (corrupted && confirm('Your saved data appears to be corrupted. Would you like to download the raw data for potential recovery? You will start fresh after this.')) {
                    const blob = new Blob([corrupted], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `tlac-corrupted-data-${new Date().toISOString().split('T')[0]}.txt`;
                    link.click();
                    URL.revokeObjectURL(url);
                }
            }, 500);
        }
    }
    
    initTechniques();
    initUprPractices();
    checkWeekReset();
    checkUprWeekReset();
    
    // Show backup reminder if needed (after a short delay to not overwhelm on load)
    setTimeout(() => {
        if (loadedSuccessfully && shouldShowBackupReminder()) {
            const backup = getBackupStatus();
            showToast(`üì¶ ${backup.message}. Consider exporting a backup.`, 'info');
        }
    }, 2000);
}

function initTechniques() {
    Object.values(TLAC_DATA).flat().forEach(tech => {
        if (!appState.techniques[tech.id]) {
            appState.techniques[tech.id] = { status: 'not-yet', notes: [] };
        }
    });
}

function initUprPractices() {
    Object.values(UPR_DATA).flat().forEach(practice => {
        if (!appState.uprPractices[practice.id]) {
            appState.uprPractices[practice.id] = { status: 'not-yet', notes: [] };
        }
    });
}

function updateSaveStatus() {
    const el = document.getElementById('save-status');
    if (el && appState.lastSaved) {
        el.textContent = 'All changes saved';
    }
}

// ========== UNDO/REDO ==========
function pushUndoState() {
    undoStack.push(JSON.stringify(appState));
    if (undoStack.length > MAX_UNDO_HISTORY) undoStack.shift();
    redoStack = [];
    updateUndoRedoButtons();
}

function undo() {
    if (undoStack.length === 0) return;
    redoStack.push(JSON.stringify(appState));
    appState = JSON.parse(undoStack.pop());
    saveData();
    renderAll();
    showToast('Undone', 'info');
    updateUndoRedoButtons();
}

function redo() {
    if (redoStack.length === 0) return;
    undoStack.push(JSON.stringify(appState));
    appState = JSON.parse(redoStack.pop());
    saveData();
    renderAll();
    showToast('Redone', 'info');
    updateUndoRedoButtons();
}

function updateUndoRedoButtons() {
    document.getElementById('undo-btn').disabled = undoStack.length === 0;
    document.getElementById('redo-btn').disabled = redoStack.length === 0;
}

// ========== THEME ==========
function applyTheme(theme) {
    appState.theme = theme;
    document.documentElement.setAttribute('data-theme', theme);
    const toggle = document.getElementById('dark-mode-toggle');
    if (toggle) {
        toggle.classList.toggle('active', theme === 'dark');
        toggle.setAttribute('aria-checked', theme === 'dark');
    }
}

function toggleTheme() {
    applyTheme(appState.theme === 'dark' ? 'light' : 'dark');
    saveData();
}

// ========== FONT SIZE ==========
function applyFontSize(size) {
    appState.fontSize = size;
    document.documentElement.style.fontSize = size + 'px';
}

function increaseFontSize() {
    if (appState.fontSize < 22) {
        applyFontSize(appState.fontSize + 1);
        saveData();
        updateFontButtons();
    }
}

function decreaseFontSize() {
    if (appState.fontSize > 12) {
        applyFontSize(appState.fontSize - 1);
        saveData();
        updateFontButtons();
    }
}

function updateFontButtons() {
    document.getElementById('font-increase-btn').disabled = appState.fontSize >= 22;
    document.getElementById('font-decrease-btn').disabled = appState.fontSize <= 12;
}

// ========== SETTINGS ==========
function openSettings() {
    document.getElementById('settings-overlay').classList.add('active');
    renderProfile();
}

function closeSettings() {
    document.getElementById('settings-overlay').classList.remove('active');
    saveProfile();
}

function setupSettingsAutoSave() {
    const inputs = document.querySelectorAll('.settings-content input, .settings-content textarea');
    inputs.forEach(input => {
        input.addEventListener('change', saveProfile);
    });
}

// ========== WEEK FOCUS (TLAC) ==========
function checkWeekReset() {
    if (!appState.weekFocus.startDate) return;
    const start = new Date(appState.weekFocus.startDate);
    const now = new Date();
    const daysPassed = Math.floor((now - start) / (1000 * 60 * 60 * 24));
    if (daysPassed >= WEEK_DURATION_DAYS) {
        archiveWeekFocus();
    }
}

function archiveWeekFocus() {
    if (appState.weekFocus.techniques.length > 0) {
        appState.weekFocus.history.push({
            techniques: [...appState.weekFocus.techniques],
            startDate: appState.weekFocus.startDate,
            endDate: new Date().toISOString(),
            notes: { ...appState.weekFocus.notes },
            plans: { ...appState.weekFocus.plans }
        });
    }
    appState.weekFocus.techniques.forEach(techId => {
        if (appState.techniques[techId]) {
            appState.techniques[techId].status = 'occasionally';
        }
    });
    appState.weekFocus = { techniques: [], startDate: null, notes: {}, plans: {}, history: appState.weekFocus.history };
    saveData();
}

function addToWeekFocus(techId) {
    if (appState.weekFocus.techniques.length >= MAX_WEEK_FOCUS) {
        showToast(`Maximum ${MAX_WEEK_FOCUS} techniques per week`, 'warning');
        return false;
    }
    if (!appState.weekFocus.startDate) {
        appState.weekFocus.startDate = new Date().toISOString();
    }
    if (!appState.weekFocus.techniques.includes(techId)) {
        appState.weekFocus.techniques.push(techId);
    }
    return true;
}

function removeFromWeekFocus(techId) {
    appState.weekFocus.techniques = appState.weekFocus.techniques.filter(id => id !== techId);
    if (appState.techniques[techId]) {
        appState.techniques[techId].status = 'not-yet';
    }
}

// ========== WEEK FOCUS (UPR) ==========
function checkUprWeekReset() {
    if (!appState.uprWeekFocus.startDate) return;
    const start = new Date(appState.uprWeekFocus.startDate);
    const now = new Date();
    const daysPassed = Math.floor((now - start) / (1000 * 60 * 60 * 24));
    if (daysPassed >= WEEK_DURATION_DAYS) {
        archiveUprWeekFocus();
    }
}

function archiveUprWeekFocus() {
    if (appState.uprWeekFocus.practices.length > 0) {
        appState.uprWeekFocus.history.push({
            practices: [...appState.uprWeekFocus.practices],
            startDate: appState.uprWeekFocus.startDate,
            endDate: new Date().toISOString(),
            notes: { ...appState.uprWeekFocus.notes },
            plans: { ...appState.uprWeekFocus.plans }
        });
    }
    appState.uprWeekFocus.practices.forEach(practiceId => {
        if (appState.uprPractices[practiceId]) {
            appState.uprPractices[practiceId].status = 'occasionally';
        }
    });
    appState.uprWeekFocus = { practices: [], startDate: null, notes: {}, plans: {}, history: appState.uprWeekFocus.history };
    saveData();
}

function addToUprWeekFocus(practiceId) {
    if (appState.uprWeekFocus.practices.length >= MAX_WEEK_FOCUS) {
        showToast(`Maximum ${MAX_WEEK_FOCUS} practices per week`, 'warning');
        return false;
    }
    if (!appState.uprWeekFocus.startDate) {
        appState.uprWeekFocus.startDate = new Date().toISOString();
    }
    if (!appState.uprWeekFocus.practices.includes(practiceId)) {
        appState.uprWeekFocus.practices.push(practiceId);
    }
    return true;
}

function removeFromUprWeekFocus(practiceId) {
    appState.uprWeekFocus.practices = appState.uprWeekFocus.practices.filter(id => id !== practiceId);
    if (appState.uprPractices[practiceId]) {
        appState.uprPractices[practiceId].status = 'not-yet';
    }
}

// ========== UI STATE ==========
function captureUIState() {
    const state = { expandedCategories: [], expandedTechniques: [], expandedExplanations: [], expandedWeekFocus: [] };
    document.querySelectorAll('.category-header[aria-expanded="true"]').forEach(h => {
        state.expandedCategories.push(h.id);
    });
    document.querySelectorAll('.technique-header[aria-expanded="true"], .practice-header[aria-expanded="true"]').forEach(h => {
        state.expandedTechniques.push(h.id);
    });
    document.querySelectorAll('.explanation-toggle[aria-expanded="true"]').forEach(t => {
        state.expandedExplanations.push(t.id);
    });
    document.querySelectorAll('.week-focus-toggle[aria-expanded="true"]').forEach(h => {
        state.expandedWeekFocus.push(h.getAttribute('aria-controls'));
    });
    return state;
}

function restoreUIState(state) {
    state.expandedCategories.forEach(id => {
        const header = document.getElementById(id);
        if (header) {
            header.setAttribute('aria-expanded', 'true');
            const content = document.getElementById(header.getAttribute('aria-controls'));
            if (content) content.classList.add('expanded');
        }
    });
    state.expandedTechniques.forEach(id => {
        const header = document.getElementById(id);
        if (header) {
            header.setAttribute('aria-expanded', 'true');
            const content = document.getElementById(header.getAttribute('aria-controls'));
            if (content) content.classList.add('expanded');
        }
    });
    state.expandedExplanations.forEach(id => {
        const toggle = document.getElementById(id);
        if (toggle) {
            toggle.setAttribute('aria-expanded', 'true');
            const content = toggle.nextElementSibling;
            if (content) content.classList.add('expanded');
        }
    });
    state.expandedWeekFocus.forEach(contentId => {
        const content = document.getElementById(contentId);
        if (content) {
            content.classList.add('expanded');
            const header = document.querySelector(`[aria-controls="${contentId}"]`);
            if (header) header.setAttribute('aria-expanded', 'true');
        }
    });
}

function collapseAll() {
    document.querySelectorAll('.category-header, .technique-header, .practice-header').forEach(h => {
        h.setAttribute('aria-expanded', 'false');
    });
    document.querySelectorAll('.category-content, .technique-details, .practice-details').forEach(c => {
        c.classList.remove('expanded');
    });
    showToast('All collapsed', 'info');
}

function expandAll() {
    document.querySelectorAll('.category-header, .technique-header, .practice-header').forEach(h => {
        h.setAttribute('aria-expanded', 'true');
    });
    document.querySelectorAll('.category-content, .technique-details, .practice-details').forEach(c => {
        c.classList.add('expanded');
    });
    showToast('All expanded', 'info');
}

// ========== RENDERING ==========
function renderAll(preserveState = false) {
    const uiState = preserveState ? captureUIState() : null;
    renderTechniques();
    renderWeekFocus();
    renderDashboard();
    renderProfile();
    renderGlobalNotes();
    renderDataSummary();
    renderUprPractices();
    renderUprWeekFocus();
    renderUprDashboard();
    renderUprGlobalNotes();
    updateUndoRedoButtons();
    if (uiState) restoreUIState(uiState);
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function renderExplanationHtml(item, prefix, isUpr = false) {
    const explanationId = `explanation-${prefix}`;
    const contentId = `explanation-content-${prefix}`;
    const headingClass = isUpr ? 'explanation-heading upr-heading' : 'explanation-heading';
    const examplesClass = isUpr ? 'explanation-examples upr-examples' : 'explanation-examples';
    
    if (!item.explanation) {
        return `<button class="explanation-toggle explanation-placeholder" id="${explanationId}" aria-expanded="false" aria-controls="${contentId}" disabled>
            <span class="explanation-toggle-icon">‚ñº</span>
            <span>Explanation coming soon...</span>
        </button>
        <div class="explanation-content" id="${contentId}"></div>`;
    }
    
    const { what, why, examples } = item.explanation;
    return `
        <button class="explanation-toggle" id="${explanationId}" aria-expanded="false" aria-controls="${contentId}">
            <span class="explanation-toggle-icon">‚ñº</span>
            <span>What, Why & Examples</span>
        </button>
        <div class="explanation-content" id="${contentId}">
            <div class="explanation-section">
                <div class="${headingClass}"><span class="explanation-heading-icon">üìñ</span> What</div>
                <p class="explanation-text">${escapeHtml(what)}</p>
            </div>
            <div class="explanation-section">
                <div class="${headingClass}"><span class="explanation-heading-icon">üí°</span> Why</div>
                <p class="explanation-text">${escapeHtml(why)}</p>
            </div>
            <div class="explanation-section">
                <div class="${headingClass}"><span class="explanation-heading-icon">‚ú®</span> Examples</div>
                <ul class="${examplesClass}">
                    ${examples.map(ex => `<li>${escapeHtml(ex)}</li>`).join('')}
                </ul>
            </div>
        </div>`;
}

function renderTechniques() {
    const container = document.getElementById('techniques-container');
    container.innerHTML = '';
    let categoryIndex = 0;
    
    Object.entries(TLAC_DATA).forEach(([category, techniques]) => {
        categoryIndex++;
        const section = document.createElement('section');
        section.className = `category-section category-${categoryIndex}`;
        const headerId = `category-${categoryIndex}-heading`;
        const contentId = `category-${categoryIndex}-content`;
        
        section.innerHTML = `
            <button class="category-header" aria-expanded="false" aria-controls="${contentId}" id="${headerId}">
                <div class="category-header-left">
                    <span class="category-number">${categoryIndex}</span>
                    <h2 class="category-title">${category}</h2>
                </div>
                <span class="category-toggle">‚ñº</span>
            </button>
            <div class="category-content" id="${contentId}">
                ${techniques.map(tech => renderTechniqueItem(tech)).join('')}
            </div>`;
        container.appendChild(section);
    });
    
    setupTechniqueListeners(container);
}

function renderTechniqueItem(tech) {
    const data = appState.techniques[tech.id] || { status: 'not-yet', notes: [] };
    const headerId = `tech-${tech.id}-heading`;
    const detailsId = `tech-${tech.id}-details`;
    const weekFocusCount = appState.weekFocus.techniques.length;
    const isWeekFocus = data.status === 'use-this-week';
    const canAddWeekFocus = isWeekFocus || weekFocusCount < MAX_WEEK_FOCUS;
    
    const notesHtml = (data.notes || []).map(note => `
        <div class="note-item">
            <div class="note-timestamp">${new Date(note.timestamp).toLocaleString()}</div>
            <div class="note-text">${escapeHtml(note.text)}</div>
        </div>`).join('');
    
    const explanationHtml = renderExplanationHtml(tech, `tech-${tech.id}`, false);
    
    return `
        <div class="technique-item">
            <div class="technique-header" aria-expanded="false" aria-controls="${detailsId}" id="${headerId}">
                <div class="technique-info">
                    <div class="technique-name"><span class="technique-number">${tech.id}.</span> ${escapeHtml(tech.name)}</div>
                    <div class="technique-desc">${escapeHtml(tech.description)}</div>
                </div>
                <div class="technique-controls">
                    <select class="form-select status-select status-${data.status}" data-tech-id="${tech.id}">
                        ${STATUS_OPTIONS.map(opt => `
                            <option value="${opt.value}" ${data.status === opt.value ? 'selected' : ''} ${opt.value === 'use-this-week' && !canAddWeekFocus ? 'disabled' : ''}>
                                ${opt.key}. ${opt.label}
                            </option>`).join('')}
                    </select>
                    <span class="technique-toggle">‚ñº</span>
                </div>
            </div>
            <div class="technique-details" id="${detailsId}">
                <div class="detail-section">
                    <div class="detail-label">Resources</div>
                    <div class="resource-links">
                        <a href="https://www.google.com/search?q=teachlikeachampion.org+${encodeURIComponent(tech.name)}" class="resource-link" target="_blank" rel="noopener noreferrer">üîç Google Search</a>
                        <a href="https://www.youtube.com/results?search_query=teachlikeachampion+${encodeURIComponent(tech.name)}" class="resource-link" target="_blank" rel="noopener noreferrer">‚ñ∂Ô∏è YouTube</a>
                        <a href="https://chat.openai.com/?q=${encodeURIComponent('Please explain the Teach Like a Champion technique "' + tech.name + '" in actionable terms')}" class="resource-link" target="_blank" rel="noopener noreferrer">üí¨ ChatGPT</a>
                    </div>
                    ${explanationHtml}
                </div>
                <div class="detail-section">
                    <div class="detail-label">Personal Notes</div>
                    <div class="notes-input">
                        <textarea class="form-textarea" id="note-input-${tech.id}" placeholder="Share your experiences..." rows="2"></textarea>
                    </div>
                    <button class="btn btn-primary btn-sm save-note-btn" data-tech-id="${tech.id}">Add Note</button>
                    <div class="notes-list" style="margin-top:var(--space-3)">${notesHtml || '<p style="color:var(--color-text-muted);font-size:var(--text-sm)">No notes yet</p>'}</div>
                </div>
                <div style="margin-top:var(--space-3);padding-top:var(--space-2);border-top:1px solid var(--color-border-light);font-size:var(--text-xs);color:var(--color-text-muted)">üí° Press 1-7 to quickly set status</div>
            </div>
        </div>`;
}

function setupTechniqueListeners(container) {
    container.querySelectorAll('.category-header').forEach(header => {
        header.addEventListener('click', () => {
            const expanded = header.getAttribute('aria-expanded') === 'true';
            header.setAttribute('aria-expanded', !expanded);
            header.nextElementSibling.classList.toggle('expanded', !expanded);
        });
    });
    
    container.querySelectorAll('.technique-header').forEach(header => {
        header.addEventListener('click', (e) => {
            if (e.target.closest('.status-select')) return;
            const expanded = header.getAttribute('aria-expanded') === 'true';
            header.setAttribute('aria-expanded', !expanded);
            header.nextElementSibling.classList.toggle('expanded', !expanded);
        });
    });
    
    container.querySelectorAll('.status-select').forEach(select => {
        select.addEventListener('change', (e) => {
            handleStatusChange(parseInt(e.target.dataset.techId), e.target.value);
        });
    });
    
    container.querySelectorAll('.save-note-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const techId = parseInt(btn.dataset.techId);
            const input = document.getElementById(`note-input-${techId}`);
            saveTechniqueNote(techId, input.value);
            input.value = '';
        });
    });
    
    container.querySelectorAll('.explanation-toggle:not(:disabled)').forEach(toggle => {
        toggle.addEventListener('click', (e) => {
            e.stopPropagation();
            const expanded = toggle.getAttribute('aria-expanded') === 'true';
            toggle.setAttribute('aria-expanded', !expanded);
            toggle.nextElementSibling.classList.toggle('expanded', !expanded);
        });
    });
}

function handleStatusChange(techId, newStatus) {
    pushUndoState();
    const previousStatus = appState.techniques[techId].status;
    
    if (newStatus === 'use-this-week') {
        if (!addToWeekFocus(techId)) {
            renderTechniques();
            return;
        }
    } else if (previousStatus === 'use-this-week') {
        removeFromWeekFocus(techId);
    }
    
    appState.techniques[techId].status = newStatus;
    saveData();
    renderAll(true);
    showToast('Status updated', 'success');
}

function saveTechniqueNote(techId, text) {
    if (!text.trim()) return;
    pushUndoState();
    if (!appState.techniques[techId].notes) appState.techniques[techId].notes = [];
    appState.techniques[techId].notes.unshift({ text: text.trim(), timestamp: new Date().toISOString() });
    saveData();
    const uiState = captureUIState();
    renderTechniques();
    restoreUIState(uiState);
    showToast('Note saved', 'success');
}

function renderWeekFocus() {
    const container = document.getElementById('week-focus-content');
    const weekTechs = appState.weekFocus.techniques;
    
    if (appState.weekFocus.startDate) {
        const startDate = new Date(appState.weekFocus.startDate);
        document.getElementById('week-start-date').textContent = startDate.toLocaleDateString();
        const daysPassed = Math.floor((new Date() - startDate) / (1000 * 60 * 60 * 24));
        document.getElementById('week-countdown').textContent = `${Math.max(0, WEEK_DURATION_DAYS - daysPassed)} days`;
    } else {
        document.getElementById('week-start-date').textContent = '‚Äî';
        document.getElementById('week-countdown').textContent = '‚Äî';
    }
    
    if (weekTechs.length === 0) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üéØ</div><div class="empty-state-title">No techniques selected</div><p class="empty-state-desc">Select up to 3 techniques from the Techniques tab using "Use this week" status.</p></div>`;
        renderWeekHistory();
        return;
    }
    
    container.innerHTML = weekTechs.map(techId => {
        const tech = Object.values(TLAC_DATA).flat().find(t => t.id === parseInt(techId));
        if (!tech) return '';
        const plan = appState.weekFocus.plans[techId] || '';
        const notes = appState.weekFocus.notes[techId] || [];
        const contentId = `week-focus-content-${techId}`;
        const explanationHtml = renderExplanationHtml(tech, `week-${techId}`, false);
        
        return `
            <div class="week-focus-card">
                <div class="week-focus-header week-focus-toggle" data-tech-id="${techId}" aria-expanded="true" aria-controls="${contentId}">
                    <div class="week-focus-header-left">
                        <span class="week-focus-chevron">‚ñº</span>
                        <div class="week-focus-title">${tech.name}</div>
                    </div>
                    <button class="btn btn-sm btn-secondary remove-week-focus-btn" data-tech-id="${techId}">Remove</button>
                </div>
                <div class="week-focus-content expanded" id="${contentId}">
                    <div class="week-focus-explanation">${explanationHtml}</div>
                    <div class="form-group">
                        <label class="form-label">Implementation Plan</label>
                        <textarea class="form-textarea week-plan-textarea" data-tech-id="${techId}" rows="3">${escapeHtml(plan)}</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Progress Notes</label>
                        <textarea class="form-textarea week-note-input" data-tech-id="${techId}" placeholder="Add notes..." rows="2"></textarea>
                        <button class="btn btn-primary btn-sm add-week-note-btn" data-tech-id="${techId}" style="margin-top:var(--space-2)">Add Note</button>
                    </div>
                    <div class="notes-list">${notes.map(note => `<div class="note-item"><div class="note-timestamp">${new Date(note.timestamp).toLocaleString()}</div><div class="note-text">${escapeHtml(note.text)}</div></div>`).join('')}</div>
                </div>
            </div>`;
    }).join('');
    
    setupWeekFocusListeners(container);
    renderWeekHistory();
}

function setupWeekFocusListeners(container) {
    container.querySelectorAll('.week-focus-toggle').forEach(header => {
        header.addEventListener('click', (e) => {
            if (e.target.closest('.remove-week-focus-btn')) return;
            const expanded = header.getAttribute('aria-expanded') === 'true';
            header.setAttribute('aria-expanded', !expanded);
            document.getElementById(header.getAttribute('aria-controls')).classList.toggle('expanded', !expanded);
        });
    });
    
    container.querySelectorAll('.explanation-toggle:not(:disabled)').forEach(toggle => {
        toggle.addEventListener('click', (e) => {
            e.stopPropagation();
            const expanded = toggle.getAttribute('aria-expanded') === 'true';
            toggle.setAttribute('aria-expanded', !expanded);
            toggle.nextElementSibling.classList.toggle('expanded', !expanded);
        });
    });
    
    container.querySelectorAll('.remove-week-focus-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            pushUndoState();
            removeFromWeekFocus(parseInt(btn.dataset.techId));
            saveData();
            renderAll(true);
            showToast('Removed from week focus', 'info');
        });
    });
    
    container.querySelectorAll('.week-plan-textarea').forEach(textarea => {
        textarea.addEventListener('change', () => {
            appState.weekFocus.plans[textarea.dataset.techId] = textarea.value;
            saveData();
        });
    });
    
    container.querySelectorAll('.add-week-note-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const techId = btn.dataset.techId;
            const input = container.querySelector(`.week-note-input[data-tech-id="${techId}"]`);
            if (input.value.trim()) {
                pushUndoState();
                if (!appState.weekFocus.notes[techId]) appState.weekFocus.notes[techId] = [];
                appState.weekFocus.notes[techId].unshift({ text: input.value.trim(), timestamp: new Date().toISOString() });
                input.value = '';
                saveData();
                const uiState = captureUIState();
                renderWeekFocus();
                restoreUIState(uiState);
                showToast('Note added', 'success');
            }
        });
    });
}

function renderWeekHistory() {
    const container = document.getElementById('week-history-content');
    const history = appState.weekFocus.history;
    
    if (history.length === 0) {
        container.innerHTML = `<div class="empty-state"><p class="empty-state-desc">No previous week focus history yet.</p></div>`;
        return;
    }
    
    container.innerHTML = history.slice().reverse().map(week => {
        const startDate = new Date(week.startDate).toLocaleDateString();
        const endDate = new Date(week.endDate).toLocaleDateString();
        return `<div class="card" style="margin-bottom:var(--space-3)"><strong>Week of ${startDate} ‚Äì ${endDate}</strong><ul style="margin-top:var(--space-2);padding-left:var(--space-4)">${week.techniques.map(techId => {
            const tech = Object.values(TLAC_DATA).flat().find(t => t.id === parseInt(techId));
            const noteCount = (week.notes[techId] || []).length;
            return `<li>${tech ? tech.name : 'Unknown'} (${noteCount} notes)</li>`;
        }).join('')}</ul></div>`;
    }).join('');
}

// ========== UPR RENDERING ==========
function renderUprPractices() {
    const container = document.getElementById('upr-practices-container');
    
    if (Object.keys(UPR_DATA).length === 0) {
        container.innerHTML = `<div class="empty-state" style="padding:var(--space-6)"><div class="empty-state-icon">üöß</div><div class="empty-state-title">UPR Practices Coming Soon</div><p class="empty-state-desc">The UPR practices framework is ready and will be populated with evidence-based practices aligned with Australian Professional Standards for Teachers.</p></div>`;
        return;
    }
    
    container.innerHTML = '';
    let categoryIndex = 0;
    
    Object.entries(UPR_DATA).forEach(([category, practices]) => {
        categoryIndex++;
        const section = document.createElement('section');
        section.className = `category-section upr-category-${categoryIndex}`;
        const headerId = `upr-category-${categoryIndex}-heading`;
        const contentId = `upr-category-${categoryIndex}-content`;
        
        section.innerHTML = `
            <button class="category-header" aria-expanded="false" aria-controls="${contentId}" id="${headerId}">
                <div class="category-header-left">
                    <span class="category-number">${categoryIndex}</span>
                    <h2 class="category-title">${category}</h2>
                </div>
                <span class="category-toggle">‚ñº</span>
            </button>
            <div class="category-content" id="${contentId}">
                ${practices.map(practice => renderUprPracticeItem(practice, categoryIndex)).join('')}
            </div>`;
        container.appendChild(section);
    });
    
    setupUprPracticeListeners(container);
}

function renderUprPracticeItem(practice, categoryIndex) {
    const data = appState.uprPractices[practice.id] || { status: 'not-yet', notes: [] };
    const headerId = `upr-practice-${practice.id}-heading`;
    const detailsId = `upr-practice-${practice.id}-details`;
    const weekFocusCount = appState.uprWeekFocus.practices.length;
    const isWeekFocus = data.status === 'use-this-week';
    const canAddWeekFocus = isWeekFocus || weekFocusCount < MAX_WEEK_FOCUS;
    
    const notesHtml = (data.notes || []).map(note => `
        <div class="note-item">
            <div class="note-timestamp">${new Date(note.timestamp).toLocaleString()}</div>
            <div class="note-text">${escapeHtml(note.text)}</div>
        </div>`).join('');
    
    const explanationHtml = renderExplanationHtml(practice, `upr-${practice.id}`, true);
    
    return `
        <div class="practice-item">
            <div class="practice-header" aria-expanded="false" aria-controls="${detailsId}" id="${headerId}">
                <div class="practice-info">
                    <div class="practice-name"><span class="practice-number">${practice.id}.</span> ${escapeHtml(practice.name)}</div>
                    <div class="practice-desc">${escapeHtml(practice.description)}</div>
                </div>
                <div class="practice-controls">
                    <select class="form-select status-select status-${data.status}" data-practice-id="${practice.id}">
                        ${STATUS_OPTIONS.map(opt => `
                            <option value="${opt.value}" ${data.status === opt.value ? 'selected' : ''} ${opt.value === 'use-this-week' && !canAddWeekFocus ? 'disabled' : ''}>
                                ${opt.key}. ${opt.label}
                            </option>`).join('')}
                    </select>
                    <span class="practice-toggle">‚ñº</span>
                </div>
            </div>
            <div class="practice-details" id="${detailsId}">
                <div class="detail-section">
                    <div class="detail-label">Resources</div>
                    <div class="resource-links">
                        <a href="https://www.google.com/search?q=unconditional+positive+regard+classroom+${encodeURIComponent(practice.name)}" class="resource-link upr-link" target="_blank" rel="noopener noreferrer">üîç Google Search</a>
                        <a href="https://www.berrystreet.org.au/learning-and-resources/berry-street-education-model" class="resource-link upr-link" target="_blank" rel="noopener noreferrer">üè´ Berry Street</a>
                        <a href="https://chat.openai.com/?q=${encodeURIComponent('Please explain the Unconditional Positive Regard practice "' + practice.name + '" for classroom teachers in actionable terms')}" class="resource-link upr-link" target="_blank" rel="noopener noreferrer">üí¨ ChatGPT</a>
                    </div>
                    ${explanationHtml}
                </div>
                <div class="detail-section">
                    <div class="detail-label">Personal Reflections</div>
                    <div class="notes-input">
                        <textarea class="form-textarea" id="upr-note-input-${practice.id}" placeholder="Reflect on how this practice is affecting your classroom relationships..." rows="2"></textarea>
                    </div>
                    <button class="btn btn-upr btn-sm save-upr-note-btn" data-practice-id="${practice.id}">Add Note</button>
                    <div class="notes-list" style="margin-top:var(--space-3)">${notesHtml || '<p style="color:var(--color-text-muted);font-size:var(--text-sm)">No notes yet</p>'}</div>
                </div>
                <div style="margin-top:var(--space-3);padding-top:var(--space-2);border-top:1px solid var(--color-border-light);font-size:var(--text-xs);color:var(--color-text-muted)">üí° Press 1-7 to quickly set status</div>
            </div>
        </div>`;
}

function setupUprPracticeListeners(container) {
    container.querySelectorAll('.category-header').forEach(header => {
        header.addEventListener('click', () => {
            const expanded = header.getAttribute('aria-expanded') === 'true';
            header.setAttribute('aria-expanded', !expanded);
            header.nextElementSibling.classList.toggle('expanded', !expanded);
        });
    });
    
    container.querySelectorAll('.practice-header').forEach(header => {
        header.addEventListener('click', (e) => {
            if (e.target.closest('.status-select')) return;
            const expanded = header.getAttribute('aria-expanded') === 'true';
            header.setAttribute('aria-expanded', !expanded);
            header.nextElementSibling.classList.toggle('expanded', !expanded);
        });
    });
    
    container.querySelectorAll('.status-select').forEach(select => {
        select.addEventListener('change', (e) => {
            handleUprStatusChange(parseInt(e.target.dataset.practiceId), e.target.value);
        });
    });
    
    container.querySelectorAll('.save-upr-note-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const practiceId = parseInt(btn.dataset.practiceId);
            const input = document.getElementById(`upr-note-input-${practiceId}`);
            saveUprPracticeNote(practiceId, input.value);
            input.value = '';
        });
    });
    
    container.querySelectorAll('.explanation-toggle:not(:disabled)').forEach(toggle => {
        toggle.addEventListener('click', (e) => {
            e.stopPropagation();
            const expanded = toggle.getAttribute('aria-expanded') === 'true';
            toggle.setAttribute('aria-expanded', !expanded);
            toggle.nextElementSibling.classList.toggle('expanded', !expanded);
        });
    });
}

function handleUprStatusChange(practiceId, newStatus) {
    pushUndoState();
    const previousStatus = appState.uprPractices[practiceId]?.status;
    
    if (newStatus === 'use-this-week') {
        if (!addToUprWeekFocus(practiceId)) {
            renderUprPractices();
            return;
        }
    } else if (previousStatus === 'use-this-week') {
        removeFromUprWeekFocus(practiceId);
    }
    
    if (!appState.uprPractices[practiceId]) {
        appState.uprPractices[practiceId] = { status: newStatus, notes: [] };
    } else {
        appState.uprPractices[practiceId].status = newStatus;
    }
    
    saveData();
    renderAll(true);
    showToast('Status updated', 'success');
}

function saveUprPracticeNote(practiceId, text) {
    if (!text.trim()) return;
    pushUndoState();
    if (!appState.uprPractices[practiceId]) {
        appState.uprPractices[practiceId] = { status: 'not-yet', notes: [] };
    }
    if (!appState.uprPractices[practiceId].notes) appState.uprPractices[practiceId].notes = [];
    appState.uprPractices[practiceId].notes.unshift({ text: text.trim(), timestamp: new Date().toISOString() });
    saveData();
    const uiState = captureUIState();
    renderUprPractices();
    restoreUIState(uiState);
    showToast('Note saved', 'success');
}

function renderUprWeekFocus() {
    const container = document.getElementById('upr-week-focus-content');
    const weekPractices = appState.uprWeekFocus.practices;
    
    if (appState.uprWeekFocus.startDate) {
        const startDate = new Date(appState.uprWeekFocus.startDate);
        document.getElementById('upr-week-start-date').textContent = startDate.toLocaleDateString();
        const daysPassed = Math.floor((new Date() - startDate) / (1000 * 60 * 60 * 24));
        document.getElementById('upr-week-countdown').textContent = `${Math.max(0, WEEK_DURATION_DAYS - daysPassed)} days`;
    } else {
        document.getElementById('upr-week-start-date').textContent = '‚Äî';
        document.getElementById('upr-week-countdown').textContent = '‚Äî';
    }
    
    if (weekPractices.length === 0) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üéØ</div><div class="empty-state-title">No practices selected</div><p class="empty-state-desc">Select up to 3 practices from the Practices tab using "Use this week" status.</p></div>`;
        renderUprWeekHistory();
        return;
    }
    
    container.innerHTML = weekPractices.map(practiceId => {
        const practice = Object.values(UPR_DATA).flat().find(p => p.id === parseInt(practiceId));
        if (!practice) return '';
        const plan = appState.uprWeekFocus.plans[practiceId] || '';
        const notes = appState.uprWeekFocus.notes[practiceId] || [];
        const contentId = `upr-week-focus-content-${practiceId}`;
        const explanationHtml = renderExplanationHtml(practice, `upr-week-${practiceId}`, true);
        
        return `
            <div class="week-focus-card upr-focus-card">
                <div class="week-focus-header week-focus-toggle" data-practice-id="${practiceId}" aria-expanded="true" aria-controls="${contentId}">
                    <div class="week-focus-header-left">
                        <span class="week-focus-chevron">‚ñº</span>
                        <div class="week-focus-title">${practice.name}</div>
                    </div>
                    <button class="btn btn-sm btn-secondary remove-upr-week-focus-btn" data-practice-id="${practiceId}">Remove</button>
                </div>
                <div class="week-focus-content expanded" id="${contentId}">
                    <div class="week-focus-explanation">${explanationHtml}</div>
                    <div class="form-group">
                        <label class="form-label">Implementation Plan</label>
                        <textarea class="form-textarea upr-week-plan-textarea" data-practice-id="${practiceId}" rows="3">${escapeHtml(plan)}</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Progress Notes</label>
                        <textarea class="form-textarea upr-week-note-input" data-practice-id="${practiceId}" placeholder="Reflect on your experience..." rows="2"></textarea>
                        <button class="btn btn-upr btn-sm add-upr-week-note-btn" data-practice-id="${practiceId}" style="margin-top:var(--space-2)">Add Note</button>
                    </div>
                    <div class="notes-list">${notes.map(note => `<div class="note-item"><div class="note-timestamp">${new Date(note.timestamp).toLocaleString()}</div><div class="note-text">${escapeHtml(note.text)}</div></div>`).join('')}</div>
                </div>
            </div>`;
    }).join('');
    
    setupUprWeekFocusListeners(container);
    renderUprWeekHistory();
}

function setupUprWeekFocusListeners(container) {
    container.querySelectorAll('.week-focus-toggle').forEach(header => {
        header.addEventListener('click', (e) => {
            if (e.target.closest('.remove-upr-week-focus-btn')) return;
            const expanded = header.getAttribute('aria-expanded') === 'true';
            header.setAttribute('aria-expanded', !expanded);
            document.getElementById(header.getAttribute('aria-controls')).classList.toggle('expanded', !expanded);
        });
    });
    
    container.querySelectorAll('.explanation-toggle:not(:disabled)').forEach(toggle => {
        toggle.addEventListener('click', (e) => {
            e.stopPropagation();
            const expanded = toggle.getAttribute('aria-expanded') === 'true';
            toggle.setAttribute('aria-expanded', !expanded);
            toggle.nextElementSibling.classList.toggle('expanded', !expanded);
        });
    });
    
    container.querySelectorAll('.remove-upr-week-focus-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            pushUndoState();
            removeFromUprWeekFocus(parseInt(btn.dataset.practiceId));
            saveData();
            renderAll(true);
            showToast('Removed from week focus', 'info');
        });
    });
    
    container.querySelectorAll('.upr-week-plan-textarea').forEach(textarea => {
        textarea.addEventListener('change', () => {
            appState.uprWeekFocus.plans[textarea.dataset.practiceId] = textarea.value;
            saveData();
        });
    });
    
    container.querySelectorAll('.add-upr-week-note-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const practiceId = btn.dataset.practiceId;
            const input = container.querySelector(`.upr-week-note-input[data-practice-id="${practiceId}"]`);
            if (input.value.trim()) {
                pushUndoState();
                if (!appState.uprWeekFocus.notes[practiceId]) appState.uprWeekFocus.notes[practiceId] = [];
                appState.uprWeekFocus.notes[practiceId].unshift({ text: input.value.trim(), timestamp: new Date().toISOString() });
                input.value = '';
                saveData();
                const uiState = captureUIState();
                renderUprWeekFocus();
                restoreUIState(uiState);
                showToast('Note added', 'success');
            }
        });
    });
}

function renderUprWeekHistory() {
    const container = document.getElementById('upr-week-history-content');
    const history = appState.uprWeekFocus.history;
    
    if (history.length === 0) {
        container.innerHTML = `<div class="empty-state"><p class="empty-state-desc">No previous week focus history yet.</p></div>`;
        return;
    }
    
    container.innerHTML = history.slice().reverse().map(week => {
        const startDate = new Date(week.startDate).toLocaleDateString();
        const endDate = new Date(week.endDate).toLocaleDateString();
        return `<div class="card upr-card" style="margin-bottom:var(--space-3)"><strong>Week of ${startDate} ‚Äì ${endDate}</strong><ul style="margin-top:var(--space-2);padding-left:var(--space-4)">${week.practices.map(practiceId => {
            const practice = Object.values(UPR_DATA).flat().find(p => p.id === parseInt(practiceId));
            const noteCount = (week.notes[practiceId] || []).length;
            return `<li>${practice ? practice.name : 'Unknown'} (${noteCount} notes)</li>`;
        }).join('')}</ul></div>`;
    }).join('');
}

// ========== DASHBOARDS ==========
function renderDashboard() {
    const stats = calculateStats();
    
    document.getElementById('usage-stats').innerHTML = `
        <div class="stat-row"><span class="stat-label">This Week Focus</span><span class="stat-value" style="color:var(--color-info)">${stats.weekFocus}/${MAX_WEEK_FOCUS}</span></div>
        <div class="stat-row"><span class="stat-label">Used Often</span><span class="stat-value" style="color:var(--color-success)">${stats.often}</span></div>
        <div class="stat-row"><span class="stat-label">Used Occasionally</span><span class="stat-value" style="color:var(--color-progress)">${stats.occasionally}</span></div>
        <div class="stat-row"><span class="stat-label">Not Successful Yet</span><span class="stat-value" style="color:var(--color-struggling)">${stats.notSuccessful}</span></div>
        <div class="stat-row"><span class="stat-label">Not Used Yet</span><span class="stat-value" style="color:var(--color-warning)">${stats.notYet}</span></div>
        <div class="stat-row"><span class="stat-label">Not Suitable</span><span class="stat-value">${stats.notSuitable}</span></div>
        <div class="progress-bar"><div class="progress-fill" style="width:${stats.implementationRate}%"></div></div>
        <p style="text-align:center;margin-top:var(--space-2);font-size:var(--text-sm);color:var(--color-text-secondary)">Implementation Rate: ${stats.implementationRate}%</p>`;
    
    let categoryHtml = '';
    Object.entries(TLAC_DATA).forEach(([category, techniques]) => {
        const implemented = techniques.filter(t => {
            const status = appState.techniques[t.id]?.status;
            return status === 'often' || status === 'occasionally' || status === 'use-this-week';
        }).length;
        const percentage = Math.round((implemented / techniques.length) * 100);
        categoryHtml += `<div class="stat-row"><span class="stat-label">${category}</span><span class="stat-value">${implemented}/${techniques.length}</span></div><div class="progress-bar" style="margin-bottom:var(--space-3)"><div class="progress-fill" style="width:${percentage}%"></div></div>`;
    });
    document.getElementById('category-progress').innerHTML = categoryHtml;
    
    const recentNotes = getAllNotes().slice(0, 5);
    document.getElementById('recent-activity').innerHTML = recentNotes.length > 0
        ? recentNotes.map(note => `<div class="note-item"><div class="note-timestamp">${new Date(note.timestamp).toLocaleString()} ‚Äì ${note.source}</div><div class="note-text">${escapeHtml(note.text.substring(0, 100))}${note.text.length > 100 ? '...' : ''}</div></div>`).join('')
        : '<p style="color:var(--color-text-muted)">No recent activity</p>';
    
    document.getElementById('growth-summary').innerHTML = `
        <div class="stat-row"><span class="stat-label">Total Techniques</span><span class="stat-value">${TOTAL_TECHNIQUES}</span></div>
        <div class="stat-row"><span class="stat-label">Actively Using</span><span class="stat-value">${stats.often + stats.occasionally + stats.weekFocus}</span></div>
        <div class="stat-row"><span class="stat-label">Total Notes</span><span class="stat-value">${stats.totalNotes}</span></div>
        <div class="stat-row"><span class="stat-label">Weeks Tracked</span><span class="stat-value">${appState.weekFocus.history.length + (appState.weekFocus.techniques.length > 0 ? 1 : 0)}</span></div>`;
}

function calculateStats() {
    const counts = { often: 0, occasionally: 0, notSuccessful: 0, notYet: 0, notSuitable: 0, dontUse: 0, weekFocus: 0 };
    let totalNotes = appState.globalNotes.length;
    
    Object.values(appState.techniques).forEach(tech => {
        switch (tech.status) {
            case 'often': counts.often++; break;
            case 'occasionally': counts.occasionally++; break;
            case 'not-successful': counts.notSuccessful++; break;
            case 'not-yet': counts.notYet++; break;
            case 'not-suitable': counts.notSuitable++; break;
            case 'dont-use': counts.dontUse++; break;
            case 'use-this-week': counts.weekFocus++; break;
        }
        totalNotes += (tech.notes || []).length;
    });
    
    const implemented = counts.often + counts.occasionally + counts.weekFocus;
    const implementationRate = Math.round((implemented / TOTAL_TECHNIQUES) * 100);
    
    return { ...counts, totalNotes, implementationRate };
}

function getAllNotes() {
    const notes = [];
    appState.globalNotes.forEach(note => notes.push({ ...note, source: 'Global' }));
    Object.entries(appState.techniques).forEach(([id, data]) => {
        const tech = Object.values(TLAC_DATA).flat().find(t => t.id === parseInt(id));
        (data.notes || []).forEach(note => notes.push({ ...note, source: tech ? tech.name : 'Unknown' }));
    });
    return notes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
}

function renderUprDashboard() {
    const stats = calculateUprStats();
    
    document.getElementById('upr-usage-stats').innerHTML = `
        <div class="stat-row"><span class="stat-label">This Week Focus</span><span class="stat-value" style="color:var(--color-upr-primary)">${stats.weekFocus}/${MAX_WEEK_FOCUS}</span></div>
        <div class="stat-row"><span class="stat-label">Used Often</span><span class="stat-value" style="color:var(--color-success)">${stats.often}</span></div>
        <div class="stat-row"><span class="stat-label">Used Occasionally</span><span class="stat-value" style="color:var(--color-progress)">${stats.occasionally}</span></div>
        <div class="stat-row"><span class="stat-label">Not Successful Yet</span><span class="stat-value" style="color:var(--color-struggling)">${stats.notSuccessful}</span></div>
        <div class="stat-row"><span class="stat-label">Not Used Yet</span><span class="stat-value" style="color:var(--color-warning)">${stats.notYet}</span></div>
        <div class="progress-bar"><div class="progress-fill upr-fill" style="width:${stats.implementationRate}%"></div></div>
        <p style="text-align:center;margin-top:var(--space-2);font-size:var(--text-sm);color:var(--color-text-secondary)">Implementation Rate: ${stats.implementationRate}%</p>`;
    
    let categoryHtml = '';
    if (Object.keys(UPR_DATA).length > 0) {
        Object.entries(UPR_DATA).forEach(([category, practices]) => {
            const implemented = practices.filter(p => {
                const status = appState.uprPractices[p.id]?.status;
                return status === 'often' || status === 'occasionally' || status === 'use-this-week';
            }).length;
            const percentage = Math.round((implemented / practices.length) * 100);
            categoryHtml += `<div class="stat-row"><span class="stat-label">${category}</span><span class="stat-value">${implemented}/${practices.length}</span></div><div class="progress-bar" style="margin-bottom:var(--space-3)"><div class="progress-fill upr-fill" style="width:${percentage}%"></div></div>`;
        });
    } else {
        categoryHtml = '<p style="color:var(--color-text-muted);font-size:var(--text-sm)">Categories will appear when UPR practices are populated.</p>';
    }
    document.getElementById('upr-category-progress').innerHTML = categoryHtml;
    
    const recentNotes = getAllUprNotes().slice(0, 5);
    document.getElementById('upr-recent-activity').innerHTML = recentNotes.length > 0
        ? recentNotes.map(note => `<div class="note-item"><div class="note-timestamp">${new Date(note.timestamp).toLocaleString()} ‚Äì ${note.source}</div><div class="note-text">${escapeHtml(note.text.substring(0, 100))}${note.text.length > 100 ? '...' : ''}</div></div>`).join('')
        : '<p style="color:var(--color-text-muted)">No recent activity</p>';
    
    document.getElementById('upr-growth-summary').innerHTML = `
        <div class="stat-row"><span class="stat-label">Total Practices</span><span class="stat-value">${TOTAL_UPR_PRACTICES || 'Coming soon'}</span></div>
        <div class="stat-row"><span class="stat-label">Actively Using</span><span class="stat-value">${stats.often + stats.occasionally + stats.weekFocus}</span></div>
        <div class="stat-row"><span class="stat-label">Total Notes</span><span class="stat-value">${stats.totalNotes}</span></div>
        <div class="stat-row"><span class="stat-label">Weeks Tracked</span><span class="stat-value">${appState.uprWeekFocus.history.length + (appState.uprWeekFocus.practices.length > 0 ? 1 : 0)}</span></div>`;
}

function calculateUprStats() {
    const counts = { often: 0, occasionally: 0, notSuccessful: 0, notYet: 0, notSuitable: 0, dontUse: 0, weekFocus: 0 };
    let totalNotes = appState.uprGlobalNotes.length;
    
    Object.values(appState.uprPractices).forEach(practice => {
        switch (practice.status) {
            case 'often': counts.often++; break;
            case 'occasionally': counts.occasionally++; break;
            case 'not-successful': counts.notSuccessful++; break;
            case 'not-yet': counts.notYet++; break;
            case 'not-suitable': counts.notSuitable++; break;
            case 'dont-use': counts.dontUse++; break;
            case 'use-this-week': counts.weekFocus++; break;
        }
        totalNotes += (practice.notes || []).length;
    });
    
    const implemented = counts.often + counts.occasionally + counts.weekFocus;
    const total = TOTAL_UPR_PRACTICES || 1;
    const implementationRate = Math.round((implemented / total) * 100);
    
    return { ...counts, totalNotes, implementationRate };
}

function getAllUprNotes() {
    const notes = [];
    appState.uprGlobalNotes.forEach(note => notes.push({ ...note, source: 'UPR Global' }));
    Object.entries(appState.uprPractices).forEach(([id, data]) => {
        const practice = Object.values(UPR_DATA).flat().find(p => p.id === parseInt(id));
        (data.notes || []).forEach(note => notes.push({ ...note, source: practice ? practice.name : 'Unknown' }));
    });
    return notes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
}

// ========== PROFILE & NOTES ==========
function renderProfile() {
    document.getElementById('teacher-name').value = appState.profile.name || '';
    document.getElementById('years-teaching').value = appState.profile.yearsTeaching || '';
    document.getElementById('school-name').value = appState.profile.schoolName || '';
    document.getElementById('subject-area').value = appState.profile.subjectArea || '';
    document.getElementById('current-classes').value = appState.profile.currentClasses || '';
    document.getElementById('professional-goals').value = appState.profile.professionalGoals || '';
}

function saveProfile() {
    pushUndoState();
    appState.profile = {
        name: document.getElementById('teacher-name').value,
        yearsTeaching: document.getElementById('years-teaching').value,
        schoolName: document.getElementById('school-name').value,
        subjectArea: document.getElementById('subject-area').value,
        currentClasses: document.getElementById('current-classes').value,
        professionalGoals: document.getElementById('professional-goals').value
    };
    saveData();
}

function renderGlobalNotes() {
    const container = document.getElementById('global-notes-list');
    container.innerHTML = appState.globalNotes.length > 0
        ? appState.globalNotes.map(note => `<div class="note-item"><div class="note-timestamp">${new Date(note.timestamp).toLocaleString()}</div><div class="note-text">${escapeHtml(note.text)}</div></div>`).join('')
        : '<p style="color:var(--color-text-muted)">No global notes yet</p>';
}

function saveGlobalNote() {
    const input = document.getElementById('global-notes-input');
    const text = input.value.trim();
    if (!text) return;
    pushUndoState();
    appState.globalNotes.unshift({ text, timestamp: new Date().toISOString() });
    input.value = '';
    saveData();
    renderGlobalNotes();
    showToast('Note saved', 'success');
}

function renderUprGlobalNotes() {
    const container = document.getElementById('upr-global-notes-list');
    container.innerHTML = appState.uprGlobalNotes.length > 0
        ? appState.uprGlobalNotes.map(note => `<div class="note-item"><div class="note-timestamp">${new Date(note.timestamp).toLocaleString()}</div><div class="note-text">${escapeHtml(note.text)}</div></div>`).join('')
        : '<p style="color:var(--color-text-muted)">No UPR reflections yet</p>';
}

function saveUprGlobalNote() {
    const input = document.getElementById('upr-global-notes-input');
    const text = input.value.trim();
    if (!text) return;
    pushUndoState();
    appState.uprGlobalNotes.unshift({ text, timestamp: new Date().toISOString() });
    input.value = '';
    saveData();
    renderUprGlobalNotes();
    showToast('Reflection saved', 'success');
}

function renderDataSummary() {
    const stats = calculateStats();
    const uprStats = calculateUprStats();
    const quota = checkStorageQuota();
    const backup = getBackupStatus();
    
    // Storage status indicator
    let storageStatus = 'üü¢';
    let storageClass = 'stat-value';
    if (quota.isCritical) {
        storageStatus = 'üî¥';
        storageClass = 'stat-value stat-warning-critical';
    } else if (quota.isWarning) {
        storageStatus = 'üü°';
        storageClass = 'stat-value stat-warning';
    }
    
    // Backup status indicator
    let backupStatus = 'üü¢';
    let backupClass = 'stat-value';
    if (backup.needsBackup) {
        backupStatus = backup.daysSince === null ? 'üü°' : (backup.daysSince > 30 ? 'üî¥' : 'üü°');
        backupClass = backup.daysSince > 30 ? 'stat-value stat-warning-critical' : 'stat-value stat-warning';
    }
    
    document.getElementById('data-summary').innerHTML = `
        <div class="stat-row"><span class="stat-label">Teacher</span><span class="stat-value">${appState.profile.name || 'Not set'}</span></div>
        <div class="stat-row"><span class="stat-label">TLAC Techniques Tracked</span><span class="stat-value">${Object.keys(appState.techniques).length}/${TOTAL_TECHNIQUES}</span></div>
        <div class="stat-row"><span class="stat-label">UPR Practices Tracked</span><span class="stat-value">${Object.keys(appState.uprPractices).length}/${TOTAL_UPR_PRACTICES || 0}</span></div>
        <div class="stat-row"><span class="stat-label">Total Notes</span><span class="stat-value">${stats.totalNotes + uprStats.totalNotes}</span></div>
        <div class="stat-row"><span class="stat-label">Data Size</span><span class="${storageClass}">${storageStatus} ${quota.dataSizeKB} KB</span></div>
        <div class="stat-row"><span class="stat-label">Storage Used</span><span class="${storageClass}">${quota.usedSpaceMB} / ~${quota.totalSpaceMB} MB (${(quota.percentUsed * 100).toFixed(0)}%)</span></div>
        <div class="stat-row"><span class="stat-label">Last Saved</span><span class="stat-value">${appState.lastSaved ? new Date(appState.lastSaved).toLocaleString() : 'Never'}</span></div>
        <div class="stat-row"><span class="stat-label">Last Backup</span><span class="${backupClass}">${backupStatus} ${backup.message}</span></div>
        <div class="stat-row"><span class="stat-label">Data Version</span><span class="stat-value">v${appState.version || 1}</span></div>`;
    
    // Show warning banner if needed
    const warningContainer = document.getElementById('data-warning-banner');
    if (warningContainer) {
        if (quota.isCritical) {
            warningContainer.innerHTML = `<div class="warning-banner warning-critical">‚ö†Ô∏è Storage is nearly full! Export your data now to prevent data loss.</div>`;
            warningContainer.style.display = 'block';
        } else if (backup.needsBackup && backup.daysSince > 30) {
            warningContainer.innerHTML = `<div class="warning-banner warning-backup">üì¶ You haven't backed up in over a month. Consider exporting your data.</div>`;
            warningContainer.style.display = 'block';
        } else {
            warningContainer.style.display = 'none';
        }
    }
}

function renderUprDataSummary() {
    const stats = calculateStats();
    const uprStats = calculateUprStats();
    const quota = checkStorageQuota();
    const backup = getBackupStatus();
    
    // Storage status indicator
    let storageStatus = 'üü¢';
    let storageClass = 'stat-value';
    if (quota.isCritical) {
        storageStatus = 'üî¥';
        storageClass = 'stat-value stat-warning-critical';
    } else if (quota.isWarning) {
        storageStatus = 'üü°';
        storageClass = 'stat-value stat-warning';
    }
    
    // Backup status indicator
    let backupStatus = 'üü¢';
    let backupClass = 'stat-value';
    if (backup.needsBackup) {
        backupStatus = backup.daysSince === null ? 'üü°' : (backup.daysSince > 30 ? 'üî¥' : 'üü°');
        backupClass = backup.daysSince > 30 ? 'stat-value stat-warning-critical' : 'stat-value stat-warning';
    }
    
    document.getElementById('upr-data-summary').innerHTML = `
        <div class="stat-row"><span class="stat-label">Teacher</span><span class="stat-value">${appState.profile.name || 'Not set'}</span></div>
        <div class="stat-row"><span class="stat-label">TLAC Techniques Tracked</span><span class="stat-value">${Object.keys(appState.techniques).length}/${TOTAL_TECHNIQUES}</span></div>
        <div class="stat-row"><span class="stat-label">UPR Practices Tracked</span><span class="stat-value">${Object.keys(appState.uprPractices).length}/${TOTAL_UPR_PRACTICES || 0}</span></div>
        <div class="stat-row"><span class="stat-label">Total Notes</span><span class="stat-value">${stats.totalNotes + uprStats.totalNotes}</span></div>
        <div class="stat-row"><span class="stat-label">Data Size</span><span class="${storageClass}">${storageStatus} ${quota.dataSizeKB} KB</span></div>
        <div class="stat-row"><span class="stat-label">Storage Used</span><span class="${storageClass}">${quota.usedSpaceMB} / ~${quota.totalSpaceMB} MB (${(quota.percentUsed * 100).toFixed(0)}%)</span></div>
        <div class="stat-row"><span class="stat-label">Last Saved</span><span class="stat-value">${appState.lastSaved ? new Date(appState.lastSaved).toLocaleString() : 'Never'}</span></div>
        <div class="stat-row"><span class="stat-label">Last Backup</span><span class="${backupClass}">${backupStatus} ${backup.message}</span></div>
        <div class="stat-row"><span class="stat-label">Data Version</span><span class="stat-value">v${appState.version || 1}</span></div>`;
    
    // Show warning banner if needed
    const warningContainer = document.getElementById('upr-data-warning-banner');
    if (warningContainer) {
        if (quota.isCritical) {
            warningContainer.innerHTML = `<div class="warning-banner warning-critical">‚ö†Ô∏è Storage is nearly full! Export your data now to prevent data loss.</div>`;
            warningContainer.style.display = 'block';
        } else if (backup.needsBackup && backup.daysSince > 30) {
            warningContainer.innerHTML = `<div class="warning-banner warning-backup">üì¶ You haven't backed up in over a month. Consider exporting your data.</div>`;
            warningContainer.style.display = 'block';
        } else {
            warningContainer.style.display = 'none';
        }
    }
}

// ========== EXPORT & IMPORT ==========

// Generate simple checksum for data integrity verification
function generateChecksum(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // Convert to 32bit integer
    }
    return Math.abs(hash).toString(16);
}

function exportData() {
    // Create export wrapper with metadata
    const exportPayload = {
        _exportMeta: {
            version: DATA_VERSION,
            exportedAt: new Date().toISOString(),
            appName: 'TLAC and UPR Growth',
            teacherName: appState.profile.name || 'Unknown'
        },
        data: appState
    };
    
    // Generate checksum of the data portion
    const dataStr = JSON.stringify(appState);
    exportPayload._exportMeta.checksum = generateChecksum(dataStr);
    exportPayload._exportMeta.dataSize = dataStr.length;
    
    const exportStr = JSON.stringify(exportPayload, null, 2);
    const blob = new Blob([exportStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    const teacherName = appState.profile.name ? appState.profile.name.replace(/\s+/g, '-').toLowerCase() : 'teacher';
    const date = new Date().toISOString().split('T')[0];
    link.download = `tlac-growth-${teacherName}-${date}.json`;
    link.click();
    URL.revokeObjectURL(url);
    
    // Update lastExported timestamp
    appState.lastExported = new Date().toISOString();
    saveData();
    
    showToast('Data exported successfully', 'success');
}

function importData(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const fileContent = JSON.parse(e.target.result);
            
            let importedData;
            let isNewFormat = false;
            
            // Check if this is the new format with _exportMeta wrapper
            if (fileContent._exportMeta && fileContent.data) {
                isNewFormat = true;
                const meta = fileContent._exportMeta;
                
                // Verify checksum if present
                if (meta.checksum) {
                    const dataStr = JSON.stringify(fileContent.data);
                    const calculatedChecksum = generateChecksum(dataStr);
                    if (calculatedChecksum !== meta.checksum) {
                        if (!confirm('‚ö†Ô∏è Data integrity check failed. The file may be corrupted or modified. Import anyway?')) {
                            showToast('Import cancelled', 'info');
                            event.target.value = '';
                            return;
                        }
                    }
                }
                
                // Version compatibility check
                if (meta.version && meta.version > DATA_VERSION) {
                    if (!confirm(`This file was created with a newer version of the app (v${meta.version}). Some data may not be compatible. Continue?`)) {
                        showToast('Import cancelled', 'info');
                        event.target.value = '';
                        return;
                    }
                }
                
                importedData = fileContent.data;
                
                // Show import info
                const exportDate = meta.exportedAt ? new Date(meta.exportedAt).toLocaleDateString() : 'Unknown';
                console.log(`Importing data exported on ${exportDate} from ${meta.teacherName || 'Unknown teacher'}`);
            } else {
                // Old format - direct appState object
                importedData = fileContent;
                console.log('Importing legacy format file (pre-v2)');
            }
            
            // Validate the data structure
            const validation = validateDataStructure(importedData);
            if (!validation.valid) {
                const errorList = validation.errors.slice(0, 3).join('\n‚Ä¢ ');
                if (!confirm(`‚ö†Ô∏è Some data validation issues detected:\n‚Ä¢ ${errorList}\n\nThe import will attempt to recover what it can. Continue?`)) {
                    showToast('Import cancelled', 'info');
                    event.target.value = '';
                    return;
                }
            }
            
            // Migrate data if needed
            const migratedData = migrateData(importedData);
            
            // Offer merge vs replace option if user has existing data
            const hasExistingData = Object.keys(appState.techniques).some(id => 
                appState.techniques[id].status !== 'not-yet' || 
                (appState.techniques[id].notes && appState.techniques[id].notes.length > 0)
            ) || appState.globalNotes.length > 0;
            
            let mergeMode = 'replace';
            if (hasExistingData) {
                const choice = confirm('You have existing data.\n\nClick OK to REPLACE all data with the imported file.\nClick Cancel to MERGE (keep your existing notes, add imported ones).');
                mergeMode = choice ? 'replace' : 'merge';
            }
            
            pushUndoState();
            
            if (mergeMode === 'replace') {
                // Deep merge with defaults to ensure structure, then overwrite with imported
                appState = deepMerge(appState, migratedData);
            } else {
                // Merge mode - combine notes and keep newer statuses
                const merged = deepMerge(appState, {});
                
                // Merge techniques
                for (const [id, importedTech] of Object.entries(migratedData.techniques || {})) {
                    if (!merged.techniques[id]) {
                        merged.techniques[id] = importedTech;
                    } else {
                        // Keep existing status if it's more "advanced" than imported
                        const statusPriority = { 'often': 5, 'occasionally': 4, 'use-this-week': 3, 'not-successful': 2, 'not-yet': 1, 'dont-use': 0, 'not-suitable': 0 };
                        const existingPriority = statusPriority[merged.techniques[id].status] || 0;
                        const importedPriority = statusPriority[importedTech.status] || 0;
                        
                        if (importedPriority > existingPriority) {
                            merged.techniques[id].status = importedTech.status;
                        }
                        
                        // Merge notes, avoiding duplicates by timestamp
                        const existingTimestamps = new Set((merged.techniques[id].notes || []).map(n => n.timestamp));
                        for (const note of (importedTech.notes || [])) {
                            if (!existingTimestamps.has(note.timestamp)) {
                                merged.techniques[id].notes.push(note);
                            }
                        }
                        // Sort notes by timestamp descending
                        merged.techniques[id].notes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    }
                }
                
                // Merge UPR practices (same logic)
                for (const [id, importedPractice] of Object.entries(migratedData.uprPractices || {})) {
                    if (!merged.uprPractices[id]) {
                        merged.uprPractices[id] = importedPractice;
                    } else {
                        const statusPriority = { 'often': 5, 'occasionally': 4, 'use-this-week': 3, 'not-successful': 2, 'not-yet': 1, 'dont-use': 0, 'not-suitable': 0 };
                        const existingPriority = statusPriority[merged.uprPractices[id].status] || 0;
                        const importedPriority = statusPriority[importedPractice.status] || 0;
                        
                        if (importedPriority > existingPriority) {
                            merged.uprPractices[id].status = importedPractice.status;
                        }
                        
                        const existingTimestamps = new Set((merged.uprPractices[id].notes || []).map(n => n.timestamp));
                        for (const note of (importedPractice.notes || [])) {
                            if (!existingTimestamps.has(note.timestamp)) {
                                merged.uprPractices[id].notes.push(note);
                            }
                        }
                        merged.uprPractices[id].notes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    }
                }
                
                // Merge global notes
                const existingGlobalTimestamps = new Set(merged.globalNotes.map(n => n.timestamp));
                for (const note of (migratedData.globalNotes || [])) {
                    if (!existingGlobalTimestamps.has(note.timestamp)) {
                        merged.globalNotes.push(note);
                    }
                }
                merged.globalNotes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                // Merge UPR global notes
                const existingUprGlobalTimestamps = new Set(merged.uprGlobalNotes.map(n => n.timestamp));
                for (const note of (migratedData.uprGlobalNotes || [])) {
                    if (!existingUprGlobalTimestamps.has(note.timestamp)) {
                        merged.uprGlobalNotes.push(note);
                    }
                }
                merged.uprGlobalNotes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                // Merge week focus history
                const existingHistoryDates = new Set(merged.weekFocus.history.map(h => h.startDate));
                for (const week of (migratedData.weekFocus?.history || [])) {
                    if (!existingHistoryDates.has(week.startDate)) {
                        merged.weekFocus.history.push(week);
                    }
                }
                merged.weekFocus.history.sort((a, b) => new Date(b.startDate) - new Date(a.startDate));
                
                // Merge UPR week focus history
                const existingUprHistoryDates = new Set(merged.uprWeekFocus.history.map(h => h.startDate));
                for (const week of (migratedData.uprWeekFocus?.history || [])) {
                    if (!existingUprHistoryDates.has(week.startDate)) {
                        merged.uprWeekFocus.history.push(week);
                    }
                }
                merged.uprWeekFocus.history.sort((a, b) => new Date(b.startDate) - new Date(a.startDate));
                
                // Update profile only if imported has more data
                if (migratedData.profile) {
                    for (const [key, value] of Object.entries(migratedData.profile)) {
                        if (value && (!merged.profile[key] || merged.profile[key] === '')) {
                            merged.profile[key] = value;
                        }
                    }
                }
                
                appState = merged;
            }
            
            saveData();
            renderAll();
            showToast(`Data ${mergeMode === 'merge' ? 'merged' : 'imported'} successfully`, 'success');
            
        } catch (error) {
            console.error('Import error:', error);
            showToast('Invalid file format. Please select a valid backup file.', 'error');
        }
        event.target.value = '';
    };
    
    reader.onerror = () => {
        showToast('Failed to read file', 'error');
        event.target.value = '';
    };
    
    reader.readAsText(file);
}

function clearAllData() {
    if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
        if (confirm('This is your last chance. All data will be permanently deleted. Continue?')) {
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    }
}

function printReport() {
    const stats = calculateStats();
    const uprStats = calculateUprStats();
    const now = new Date();
    
    // Generate comprehensive report HTML
    let reportHtml = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Professional Growth Report - ${appState.profile.name || 'Teacher'}</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 11pt; line-height: 1.4; color: #333; max-width: 210mm; margin: 0 auto; padding: 15mm; }
        h1 { font-size: 20pt; color: #8f4a35; margin-bottom: 5mm; border-bottom: 2px solid #8f4a35; padding-bottom: 3mm; }
        h2 { font-size: 14pt; color: #4a6b4f; margin: 8mm 0 4mm 0; border-bottom: 1px solid #ccc; padding-bottom: 2mm; }
        h3 { font-size: 12pt; color: #5a7f8f; margin: 5mm 0 2mm 0; }
        h4 { font-size: 11pt; color: #666; margin: 3mm 0 1mm 0; }
        .header-meta { color: #666; font-size: 10pt; margin-bottom: 8mm; }
        .profile-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 3mm; margin-bottom: 5mm; }
        .profile-item { background: #f9f9f9; padding: 2mm 3mm; border-radius: 2mm; }
        .profile-label { font-weight: 600; color: #666; font-size: 9pt; }
        .profile-value { color: #333; }
        .stats-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 3mm; margin: 4mm 0; }
        .stat-box { background: #f5f5f5; padding: 3mm; border-radius: 2mm; text-align: center; }
        .stat-number { font-size: 16pt; font-weight: 700; color: #8f4a35; }
        .stat-label { font-size: 8pt; color: #666; }
        .category-section { margin: 5mm 0; page-break-inside: avoid; }
        .category-title { background: #f0f0f0; padding: 2mm 3mm; font-weight: 600; margin-bottom: 2mm; border-left: 3px solid #8f4a35; }
        .category-title.upr { border-left-color: #5a8f7a; }
        .technique-item, .practice-item { padding: 2mm 0; border-bottom: 1px dotted #ddd; }
        .technique-item:last-child, .practice-item:last-child { border-bottom: none; }
        .item-header { display: flex; justify-content: space-between; align-items: baseline; }
        .item-name { font-weight: 500; }
        .item-status { font-size: 9pt; padding: 1mm 2mm; border-radius: 2mm; }
        .status-often { background: #c8e6c9; color: #1b5e20; }
        .status-occasionally { background: #b2ebf2; color: #006064; }
        .status-not-successful { background: #ffe0b2; color: #e65100; }
        .status-use-this-week { background: #bbdefb; color: #0d47a1; }
        .status-not-yet { background: #fff3cd; color: #856404; }
        .status-dont-use { background: #e9ecef; color: #6c757d; }
        .status-not-suitable { background: #f8f9fa; color: #6c757d; }
        .item-desc { font-size: 9pt; color: #666; margin-top: 1mm; }
        .item-notes { margin-top: 2mm; padding-left: 3mm; border-left: 2px solid #eee; }
        .note-entry { font-size: 9pt; margin: 1mm 0; }
        .note-date { color: #999; font-size: 8pt; }
        .note-text { color: #555; }
        .week-focus-section { background: #f9f9f9; padding: 3mm; border-radius: 2mm; margin: 3mm 0; }
        .week-focus-title { font-weight: 600; color: #5a7f8f; }
        .week-dates { font-size: 9pt; color: #666; }
        .global-notes-section { margin: 5mm 0; }
        .footer { margin-top: 10mm; padding-top: 5mm; border-top: 1px solid #ccc; font-size: 9pt; color: #666; text-align: center; }
        .page-break { page-break-before: always; }
        .progress-bar { height: 4mm; background: #e9ecef; border-radius: 2mm; overflow: hidden; margin: 2mm 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #8f4a35, #b5654a); }
        .progress-fill.upr { background: linear-gradient(90deg, #3d6b5a, #5a8f7a); }
        @media print {
            body { padding: 10mm; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body>
    <h1>üå± Professional Growth Report</h1>
    <div class="header-meta">
        Generated: ${now.toLocaleDateString()} at ${now.toLocaleTimeString()}<br>
        Report Period: Ongoing professional development tracking
    </div>

    <h2>üë§ Teacher Profile</h2>
    <div class="profile-grid">
        <div class="profile-item"><span class="profile-label">Name:</span> <span class="profile-value">${appState.profile.name || 'Not specified'}</span></div>
        <div class="profile-item"><span class="profile-label">School:</span> <span class="profile-value">${appState.profile.schoolName || 'Not specified'}</span></div>
        <div class="profile-item"><span class="profile-label">Years Teaching:</span> <span class="profile-value">${appState.profile.yearsTeaching || 'Not specified'}</span></div>
        <div class="profile-item"><span class="profile-label">Subject Area:</span> <span class="profile-value">${appState.profile.subjectArea || 'Not specified'}</span></div>
    </div>
    ${appState.profile.currentClasses ? `<div class="profile-item"><span class="profile-label">Current Classes:</span> <span class="profile-value">${appState.profile.currentClasses}</span></div>` : ''}
    ${appState.profile.professionalGoals ? `<div class="profile-item"><span class="profile-label">Professional Goals:</span> <span class="profile-value">${appState.profile.professionalGoals}</span></div>` : ''}

    <h2>üìä Summary Statistics</h2>
    <h3>TLAC Techniques (${TOTAL_TECHNIQUES} total)</h3>
    <div class="stats-grid">
        <div class="stat-box"><div class="stat-number">${stats.often}</div><div class="stat-label">Used Often</div></div>
        <div class="stat-box"><div class="stat-number">${stats.occasionally}</div><div class="stat-label">Used Occasionally</div></div>
        <div class="stat-box"><div class="stat-number">${stats.weekFocus}</div><div class="stat-label">This Week Focus</div></div>
        <div class="stat-box"><div class="stat-number">${stats.notSuccessful}</div><div class="stat-label">Not Successful Yet</div></div>
        <div class="stat-box"><div class="stat-number">${stats.notYet}</div><div class="stat-label">Not Yet Used</div></div>
    </div>
    <div class="progress-bar"><div class="progress-fill" style="width: ${stats.implementationRate}%"></div></div>
    <p style="text-align:center;font-size:9pt;color:#666;">TLAC Implementation Rate: <strong>${stats.implementationRate}%</strong></p>

    <h3>UPR Practices (${TOTAL_UPR_PRACTICES} total)</h3>
    <div class="stats-grid">
        <div class="stat-box"><div class="stat-number">${uprStats.often}</div><div class="stat-label">Used Often</div></div>
        <div class="stat-box"><div class="stat-number">${uprStats.occasionally}</div><div class="stat-label">Used Occasionally</div></div>
        <div class="stat-box"><div class="stat-number">${uprStats.weekFocus}</div><div class="stat-label">This Week Focus</div></div>
        <div class="stat-box"><div class="stat-number">${uprStats.notSuccessful}</div><div class="stat-label">Not Successful Yet</div></div>
        <div class="stat-box"><div class="stat-number">${uprStats.notYet}</div><div class="stat-label">Not Yet Used</div></div>
    </div>
    <div class="progress-bar"><div class="progress-fill upr" style="width: ${uprStats.implementationRate}%"></div></div>
    <p style="text-align:center;font-size:9pt;color:#666;">UPR Implementation Rate: <strong>${uprStats.implementationRate}%</strong></p>

    <h2>üéØ Current Week Focus</h2>`;
    
    // TLAC Week Focus
    if (appState.weekFocus.techniques.length > 0) {
        reportHtml += `
    <div class="week-focus-section">
        <div class="week-focus-title">TLAC Techniques This Week</div>
        <div class="week-dates">Started: ${appState.weekFocus.startDate ? new Date(appState.weekFocus.startDate).toLocaleDateString() : 'N/A'}</div>
        <ul>`;
        appState.weekFocus.techniques.forEach(techId => {
            const tech = Object.values(TLAC_DATA).flat().find(t => t.id === parseInt(techId));
            if (tech) {
                reportHtml += `<li><strong>${tech.name}</strong>`;
                if (appState.weekFocus.plans[techId]) {
                    reportHtml += `<br><em>Plan:</em> ${escapeHtml(appState.weekFocus.plans[techId])}`;
                }
                if (appState.weekFocus.notes[techId] && appState.weekFocus.notes[techId].length > 0) {
                    reportHtml += `<br><em>Notes:</em>`;
                    appState.weekFocus.notes[techId].forEach(note => {
                        reportHtml += `<br>‚Ä¢ ${escapeHtml(note.text)} <span class="note-date">(${new Date(note.timestamp).toLocaleDateString()})</span>`;
                    });
                }
                reportHtml += `</li>`;
            }
        });
        reportHtml += `</ul></div>`;
    } else {
        reportHtml += `<p style="color:#666;font-style:italic;">No TLAC techniques selected for this week.</p>`;
    }
    
    // UPR Week Focus
    if (appState.uprWeekFocus.practices.length > 0) {
        reportHtml += `
    <div class="week-focus-section">
        <div class="week-focus-title">UPR Practices This Week</div>
        <div class="week-dates">Started: ${appState.uprWeekFocus.startDate ? new Date(appState.uprWeekFocus.startDate).toLocaleDateString() : 'N/A'}</div>
        <ul>`;
        appState.uprWeekFocus.practices.forEach(practiceId => {
            const practice = Object.values(UPR_DATA).flat().find(p => p.id === parseInt(practiceId));
            if (practice) {
                reportHtml += `<li><strong>${practice.name}</strong>`;
                if (appState.uprWeekFocus.plans[practiceId]) {
                    reportHtml += `<br><em>Plan:</em> ${escapeHtml(appState.uprWeekFocus.plans[practiceId])}`;
                }
                if (appState.uprWeekFocus.notes[practiceId] && appState.uprWeekFocus.notes[practiceId].length > 0) {
                    reportHtml += `<br><em>Notes:</em>`;
                    appState.uprWeekFocus.notes[practiceId].forEach(note => {
                        reportHtml += `<br>‚Ä¢ ${escapeHtml(note.text)} <span class="note-date">(${new Date(note.timestamp).toLocaleDateString()})</span>`;
                    });
                }
                reportHtml += `</li>`;
            }
        });
        reportHtml += `</ul></div>`;
    } else {
        reportHtml += `<p style="color:#666;font-style:italic;">No UPR practices selected for this week.</p>`;
    }

    // TLAC Techniques Detail
    reportHtml += `<div class="page-break"></div><h2>üìö TLAC Techniques - Complete Status</h2>`;
    
    Object.entries(TLAC_DATA).forEach(([category, techniques]) => {
        const catStats = techniques.reduce((acc, t) => {
            const status = appState.techniques[t.id]?.status || 'not-yet';
            acc[status] = (acc[status] || 0) + 1;
            return acc;
        }, {});
        
        reportHtml += `
    <div class="category-section">
        <div class="category-title">${category} (${techniques.length} techniques)</div>`;
        
        techniques.forEach(tech => {
            const data = appState.techniques[tech.id] || { status: 'not-yet', notes: [] };
            const statusLabels = { 'often': 'Used Often', 'occasionally': 'Used Occasionally', 'not-successful': 'Not Successful Yet', 'use-this-week': 'This Week', 'not-yet': 'Not Yet', 'dont-use': "Don't Use", 'not-suitable': 'Not Suitable' };
            
            reportHtml += `
        <div class="technique-item">
            <div class="item-header">
                <span class="item-name">${tech.id}. ${tech.name}</span>
                <span class="item-status status-${data.status}">${statusLabels[data.status] || data.status}</span>
            </div>
            <div class="item-desc">${tech.description}</div>`;
            
            if (data.notes && data.notes.length > 0) {
                reportHtml += `<div class="item-notes"><strong>Personal Notes:</strong>`;
                data.notes.forEach(note => {
                    reportHtml += `<div class="note-entry"><span class="note-date">${new Date(note.timestamp).toLocaleDateString()}:</span> <span class="note-text">${escapeHtml(note.text)}</span></div>`;
                });
                reportHtml += `</div>`;
            }
            reportHtml += `</div>`;
        });
        reportHtml += `</div>`;
    });

    // UPR Practices Detail
    reportHtml += `<div class="page-break"></div><h2>üíö UPR Practices - Complete Status</h2>`;
    
    Object.entries(UPR_DATA).forEach(([category, practices]) => {
        reportHtml += `
    <div class="category-section">
        <div class="category-title upr">${category} (${practices.length} practices)</div>`;
        
        practices.forEach(practice => {
            const data = appState.uprPractices[practice.id] || { status: 'not-yet', notes: [] };
            const statusLabels = { 'often': 'Used Often', 'occasionally': 'Used Occasionally', 'not-successful': 'Not Successful Yet', 'use-this-week': 'This Week', 'not-yet': 'Not Yet', 'dont-use': "Don't Use", 'not-suitable': 'Not Suitable' };
            
            reportHtml += `
        <div class="practice-item">
            <div class="item-header">
                <span class="item-name">${practice.id}. ${practice.name}</span>
                <span class="item-status status-${data.status}">${statusLabels[data.status] || data.status}</span>
            </div>
            <div class="item-desc">${practice.description}</div>`;
            
            if (data.notes && data.notes.length > 0) {
                reportHtml += `<div class="item-notes"><strong>Personal Reflections:</strong>`;
                data.notes.forEach(note => {
                    reportHtml += `<div class="note-entry"><span class="note-date">${new Date(note.timestamp).toLocaleDateString()}:</span> <span class="note-text">${escapeHtml(note.text)}</span></div>`;
                });
                reportHtml += `</div>`;
            }
            reportHtml += `</div>`;
        });
        reportHtml += `</div>`;
    });

    // Global Notes
    reportHtml += `<div class="page-break"></div><h2>üìù Global Notes & Reflections</h2>`;
    
    if (appState.globalNotes.length > 0) {
        reportHtml += `<h3>TLAC Global Notes</h3><div class="global-notes-section">`;
        appState.globalNotes.forEach(note => {
            reportHtml += `<div class="note-entry"><span class="note-date">${new Date(note.timestamp).toLocaleDateString()}:</span> <span class="note-text">${escapeHtml(note.text)}</span></div>`;
        });
        reportHtml += `</div>`;
    } else {
        reportHtml += `<p style="color:#666;font-style:italic;">No TLAC global notes recorded.</p>`;
    }
    
    if (appState.uprGlobalNotes.length > 0) {
        reportHtml += `<h3>UPR Reflections</h3><div class="global-notes-section">`;
        appState.uprGlobalNotes.forEach(note => {
            reportHtml += `<div class="note-entry"><span class="note-date">${new Date(note.timestamp).toLocaleDateString()}:</span> <span class="note-text">${escapeHtml(note.text)}</span></div>`;
        });
        reportHtml += `</div>`;
    } else {
        reportHtml += `<p style="color:#666;font-style:italic;">No UPR reflections recorded.</p>`;
    }

    // Week Focus History
    if (appState.weekFocus.history.length > 0 || appState.uprWeekFocus.history.length > 0) {
        reportHtml += `<h2>üìÖ Week Focus History</h2>`;
        
        if (appState.weekFocus.history.length > 0) {
            reportHtml += `<h3>TLAC Week History</h3>`;
            appState.weekFocus.history.slice().reverse().forEach(week => {
                reportHtml += `<div class="week-focus-section">
                    <div class="week-dates">${new Date(week.startDate).toLocaleDateString()} ‚Äì ${new Date(week.endDate).toLocaleDateString()}</div>
                    <ul>`;
                week.techniques.forEach(techId => {
                    const tech = Object.values(TLAC_DATA).flat().find(t => t.id === parseInt(techId));
                    if (tech) {
                        reportHtml += `<li>${tech.name}`;
                        const noteCount = (week.notes[techId] || []).length;
                        if (noteCount > 0) reportHtml += ` (${noteCount} notes)`;
                        reportHtml += `</li>`;
                    }
                });
                reportHtml += `</ul></div>`;
            });
        }
        
        if (appState.uprWeekFocus.history.length > 0) {
            reportHtml += `<h3>UPR Week History</h3>`;
            appState.uprWeekFocus.history.slice().reverse().forEach(week => {
                reportHtml += `<div class="week-focus-section">
                    <div class="week-dates">${new Date(week.startDate).toLocaleDateString()} ‚Äì ${new Date(week.endDate).toLocaleDateString()}</div>
                    <ul>`;
                week.practices.forEach(practiceId => {
                    const practice = Object.values(UPR_DATA).flat().find(p => p.id === parseInt(practiceId));
                    if (practice) {
                        reportHtml += `<li>${practice.name}`;
                        const noteCount = (week.notes[practiceId] || []).length;
                        if (noteCount > 0) reportHtml += ` (${noteCount} notes)`;
                        reportHtml += `</li>`;
                    }
                });
                reportHtml += `</ul></div>`;
            });
        }
    }

    reportHtml += `
    <div class="footer">
        <p><strong>TLAC and UPR Growth</strong> - Professional Development Tracking for Teachers</p>
        <p>Report generated on ${now.toLocaleDateString()} at ${now.toLocaleTimeString()}</p>
        <p>TLAC: Teach Like a Champion by Doug Lemov | UPR: Unconditional Positive Regard</p>
    </div>
</body>
</html>`;

    // Open in new window and print
    const printWindow = window.open('', '_blank');
    printWindow.document.write(reportHtml);
    printWindow.document.close();
    printWindow.onload = function() {
        printWindow.print();
    };
}

function emailReport() {
    // Show options modal for email type
    showEmailOptionsModal();
}

function showEmailOptionsModal() {
    // Create modal if it doesn't exist
    let modal = document.getElementById('email-options-modal');
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'email-options-modal';
        modal.className = 'email-modal-overlay';
        modal.innerHTML = `
            <div class="email-modal-content">
                <div class="email-modal-header">
                    <h3>üìß Email Report</h3>
                    <button class="email-modal-close" aria-label="Close">&times;</button>
                </div>
                <div class="email-modal-body">
                    <p style="margin-bottom:var(--space-3);color:var(--color-text-secondary);font-size:var(--text-sm)">Choose the level of detail for your email report:</p>
                    <div class="email-options">
                        <button class="btn btn-primary email-option-btn" data-type="brief">
                            <span style="font-size:1.2em">üìã</span>
                            <div>
                                <strong>Brief Summary</strong>
                                <small style="display:block;font-weight:normal;opacity:0.8">Stats + this week's focus only</small>
                            </div>
                        </button>
                        <button class="btn btn-secondary email-option-btn" data-type="detailed">
                            <span style="font-size:1.2em">üìÑ</span>
                            <div>
                                <strong>Detailed Report</strong>
                                <small style="display:block;font-weight:normal;opacity:0.8">Includes recent notes & mastered items</small>
                            </div>
                        </button>
                        <button class="btn btn-secondary email-option-btn" data-type="clipboard">
                            <span style="font-size:1.2em">üìé</span>
                            <div>
                                <strong>Copy to Clipboard</strong>
                                <small style="display:block;font-weight:normal;opacity:0.8">For long reports or manual pasting</small>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        // Add event listeners
        modal.querySelector('.email-modal-close').addEventListener('click', () => closeEmailModal());
        modal.addEventListener('click', (e) => { if (e.target === modal) closeEmailModal(); });
        modal.querySelectorAll('.email-option-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const type = btn.dataset.type;
                closeEmailModal();
                if (type === 'clipboard') {
                    copyReportToClipboard('detailed');
                } else {
                    sendEmailReport(type);
                }
            });
        });
    }
    
    modal.classList.add('active');
}

function closeEmailModal() {
    const modal = document.getElementById('email-options-modal');
    if (modal) modal.classList.remove('active');
}

function generateEmailBody(type = 'brief') {
    const stats = calculateStats();
    const uprStats = calculateUprStats();
    const now = new Date();
    
    let body = `PROFESSIONAL GROWTH REPORT
${type === 'brief' ? 'Weekly Summary' : 'Detailed Report'}
Generated: ${now.toLocaleDateString()}
`;

    // Profile section - compact
    if (appState.profile.name) {
        body += `\nTeacher: ${appState.profile.name}`;
        if (appState.profile.schoolName) body += ` | ${appState.profile.schoolName}`;
        body += '\n';
    }

    // Stats summary - compact format
    body += `
PROGRESS SNAPSHOT
-----------------
TLAC: ${stats.often} mastered, ${stats.occasionally} developing, ${stats.weekFocus} this week (${stats.implementationRate}% implementation)
UPR: ${uprStats.often} mastered, ${uprStats.occasionally} developing, ${uprStats.weekFocus} this week (${uprStats.implementationRate}% implementation)
`;

    // Current week focus - always included
    body += `\nTHIS WEEK'S FOCUS\n-----------------`;
    
    if (appState.weekFocus.techniques.length > 0) {
        body += `\nTLAC Techniques:`;
        appState.weekFocus.techniques.forEach(techId => {
            const tech = Object.values(TLAC_DATA).flat().find(t => t.id === parseInt(techId));
            if (tech) {
                body += `\n‚Ä¢ ${tech.name}`;
                if (appState.weekFocus.plans[techId]) {
                    body += ` ‚Äî Plan: ${appState.weekFocus.plans[techId].substring(0, 100)}${appState.weekFocus.plans[techId].length > 100 ? '...' : ''}`;
                }
            }
        });
    } else {
        body += `\nNo TLAC techniques selected.`;
    }
    
    if (appState.uprWeekFocus.practices.length > 0) {
        body += `\n\nUPR Practices:`;
        appState.uprWeekFocus.practices.forEach(practiceId => {
            const practice = Object.values(UPR_DATA).flat().find(p => p.id === parseInt(practiceId));
            if (practice) {
                body += `\n‚Ä¢ ${practice.name}`;
                if (appState.uprWeekFocus.plans[practiceId]) {
                    body += ` ‚Äî Plan: ${appState.uprWeekFocus.plans[practiceId].substring(0, 100)}${appState.uprWeekFocus.plans[practiceId].length > 100 ? '...' : ''}`;
                }
            }
        });
    } else {
        body += `\n\nNo UPR practices selected.`;
    }

    // Detailed sections - only if detailed type requested
    if (type === 'detailed') {
        // Mastered techniques/practices
        const oftenTechniques = Object.entries(appState.techniques).filter(([id, data]) => data.status === 'often');
        const oftenPractices = Object.entries(appState.uprPractices).filter(([id, data]) => data.status === 'often');
        
        if (oftenTechniques.length > 0 || oftenPractices.length > 0) {
            body += `\n\nMASTERED SKILLS\n---------------`;
            
            if (oftenTechniques.length > 0) {
                body += `\nTLAC (${oftenTechniques.length}): `;
                body += oftenTechniques.map(([id]) => {
                    const tech = Object.values(TLAC_DATA).flat().find(t => t.id === parseInt(id));
                    return tech ? tech.name : '';
                }).filter(Boolean).join(', ');
            }
            
            if (oftenPractices.length > 0) {
                body += `\nUPR (${oftenPractices.length}): `;
                body += oftenPractices.map(([id]) => {
                    const practice = Object.values(UPR_DATA).flat().find(p => p.id === parseInt(id));
                    return practice ? practice.name : '';
                }).filter(Boolean).join(', ');
            }
        }

        // Recent notes - limit to 5 for email
        const allNotes = getAllNotes().concat(getAllUprNotes())
            .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
            .slice(0, 5);
        
        if (allNotes.length > 0) {
            body += `\n\nRECENT REFLECTIONS\n------------------`;
            allNotes.forEach(note => {
                const truncatedText = note.text.length > 150 ? note.text.substring(0, 150) + '...' : note.text;
                body += `\n\n[${new Date(note.timestamp).toLocaleDateString()}] ${note.source}:\n${truncatedText}`;
            });
        }
        
        // Areas for growth
        const strugglingTech = Object.entries(appState.techniques).filter(([id, data]) => data.status === 'not-successful');
        const strugglingPractices = Object.entries(appState.uprPractices).filter(([id, data]) => data.status === 'not-successful');
        
        if (strugglingTech.length > 0 || strugglingPractices.length > 0) {
            body += `\n\nAREAS FOR GROWTH\n----------------`;
            
            if (strugglingTech.length > 0) {
                body += `\nTLAC: `;
                body += strugglingTech.slice(0, 5).map(([id]) => {
                    const tech = Object.values(TLAC_DATA).flat().find(t => t.id === parseInt(id));
                    return tech ? tech.name : '';
                }).filter(Boolean).join(', ');
                if (strugglingTech.length > 5) body += ` (+${strugglingTech.length - 5} more)`;
            }
            
            if (strugglingPractices.length > 0) {
                body += `\nUPR: `;
                body += strugglingPractices.slice(0, 5).map(([id]) => {
                    const practice = Object.values(UPR_DATA).flat().find(p => p.id === parseInt(id));
                    return practice ? practice.name : '';
                }).filter(Boolean).join(', ');
                if (strugglingPractices.length > 5) body += ` (+${strugglingPractices.length - 5} more)`;
            }
        }
    }

    // Footer
    body += `\n\n‚Äî\nGenerated by TLAC & UPR Growth Tracker`;

    return body;
}

function sendEmailReport(type) {
    const stats = calculateStats();
    const now = new Date();
    const subject = `Growth Report - ${appState.profile.name || 'Teacher'} - ${now.toLocaleDateString()}`;
    const body = generateEmailBody(type);
    
    // Check URL length - mailto: URLs have limits (typically 2000-8000 chars depending on browser/client)
    const encodedBody = encodeURIComponent(body);
    const encodedSubject = encodeURIComponent(subject);
    const mailtoUrl = `mailto:?subject=${encodedSubject}&body=${encodedBody}`;
    
    const URL_LIMIT = 1800; // Conservative limit to be safe across browsers
    
    if (mailtoUrl.length > URL_LIMIT) {
        // Too long for mailto - offer clipboard alternative
        showToast('Report too long for email link. Copying to clipboard instead...', 'info');
        setTimeout(() => copyReportToClipboard(type), 500);
        return;
    }
    
    // Open mailto link
    window.location.href = mailtoUrl;
    showToast('Opening email client...', 'success');
}

function copyReportToClipboard(type) {
    const body = generateEmailBody(type);
    
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(body).then(() => {
            showCopySuccessModal(body.length);
        }).catch(err => {
            console.error('Clipboard write failed:', err);
            showCopyFallbackModal(body);
        });
    } else {
        // Fallback for older browsers
        showCopyFallbackModal(body);
    }
}

function showCopySuccessModal(charCount) {
    showToast(`‚úÖ Report copied to clipboard! (${charCount} characters)`, 'success');
    
    // Show helpful follow-up modal
    let modal = document.getElementById('copy-success-modal');
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'copy-success-modal';
        modal.className = 'email-modal-overlay';
        modal.innerHTML = `
            <div class="email-modal-content">
                <div class="email-modal-header">
                    <h3>‚úÖ Copied to Clipboard!</h3>
                    <button class="email-modal-close" aria-label="Close">&times;</button>
                </div>
                <div class="email-modal-body" style="text-align:center;">
                    <p style="font-size:var(--text-lg);margin-bottom:var(--space-3)">Your report is ready to paste</p>
                    <p style="color:var(--color-text-secondary);font-size:var(--text-sm);margin-bottom:var(--space-4)">
                        Open your email app and paste (Ctrl+V or Cmd+V) into the message body.
                    </p>
                    <button class="btn btn-primary" id="copy-success-close-btn">Got it!</button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        modal.querySelector('.email-modal-close').addEventListener('click', () => modal.classList.remove('active'));
        modal.querySelector('#copy-success-close-btn').addEventListener('click', () => modal.classList.remove('active'));
        modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('active'); });
    }
    
    modal.classList.add('active');
}

function showCopyFallbackModal(text) {
    // For browsers without clipboard API, show a textarea to copy from
    let modal = document.getElementById('copy-fallback-modal');
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'copy-fallback-modal';
        modal.className = 'email-modal-overlay';
        modal.innerHTML = `
            <div class="email-modal-content" style="max-width:500px;">
                <div class="email-modal-header">
                    <h3>üìã Copy Report</h3>
                    <button class="email-modal-close" aria-label="Close">&times;</button>
                </div>
                <div class="email-modal-body">
                    <p style="color:var(--color-text-secondary);font-size:var(--text-sm);margin-bottom:var(--space-3)">
                        Select all text below (Ctrl+A) and copy (Ctrl+C):
                    </p>
                    <textarea id="copy-fallback-textarea" readonly style="width:100%;height:200px;font-family:monospace;font-size:var(--text-xs);padding:var(--space-2);border:1px solid var(--color-border);border-radius:var(--radius-sm);resize:vertical;"></textarea>
                    <div style="margin-top:var(--space-3);display:flex;gap:var(--space-2);">
                        <button class="btn btn-primary" id="select-all-btn">Select All</button>
                        <button class="btn btn-secondary" id="copy-fallback-close-btn">Done</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        modal.querySelector('.email-modal-close').addEventListener('click', () => modal.classList.remove('active'));
        modal.querySelector('#copy-fallback-close-btn').addEventListener('click', () => modal.classList.remove('active'));
        modal.querySelector('#select-all-btn').addEventListener('click', () => {
            const textarea = modal.querySelector('#copy-fallback-textarea');
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile
        });
        modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('active'); });
    }
    
    modal.querySelector('#copy-fallback-textarea').value = text;
    modal.classList.add('active');
    
    // Auto-select the text
    setTimeout(() => {
        const textarea = modal.querySelector('#copy-fallback-textarea');
        textarea.focus();
        textarea.select();
    }, 100);
}

// ========== TOAST ==========
function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.innerHTML = `<span class="toast-message">${escapeHtml(message)}</span><button class="toast-close">√ó</button>`;
    container.appendChild(toast);
    toast.querySelector('.toast-close').addEventListener('click', () => toast.remove());
    setTimeout(() => toast.remove(), 4000);
}

// ========== TAB NAVIGATION ==========
function setupTabNavigation() {
    // Main panel tabs
    const panelBtns = document.querySelectorAll('.panel-nav-btn');
    const panels = document.querySelectorAll('.panel-content');
    
    panelBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            panelBtns.forEach(b => b.setAttribute('aria-selected', 'false'));
            panels.forEach(p => p.classList.remove('active'));
            btn.setAttribute('aria-selected', 'true');
            document.getElementById(btn.getAttribute('aria-controls')).classList.add('active');
        });
    });
    
    // TLAC Sub-tabs
    const tlacSubTabs = document.querySelectorAll('#tlac-panel .sub-tab');
    const tlacTabPanels = document.querySelectorAll('#tlac-panel .tab-panel');
    
    tlacSubTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tlacSubTabs.forEach(t => t.setAttribute('aria-selected', 'false'));
            tlacTabPanels.forEach(p => p.classList.remove('active'));
            tab.setAttribute('aria-selected', 'true');
            document.getElementById(tab.getAttribute('aria-controls')).classList.add('active');
            const panelId = tab.getAttribute('aria-controls');
            if (panelId === 'dashboard-panel') renderDashboard();
            else if (panelId === 'week-focus-panel') renderWeekFocus();
            else if (panelId === 'export-panel') renderDataSummary();
        });
    });
    
    // UPR Sub-tabs
    const uprSubTabs = document.querySelectorAll('#upr-panel .sub-tab');
    const uprTabPanels = document.querySelectorAll('#upr-panel .tab-panel');
    
    uprSubTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            uprSubTabs.forEach(t => t.setAttribute('aria-selected', 'false'));
            uprTabPanels.forEach(p => p.classList.remove('active'));
            tab.setAttribute('aria-selected', 'true');
            document.getElementById(tab.getAttribute('aria-controls')).classList.add('active');
            const panelId = tab.getAttribute('aria-controls');
            if (panelId === 'upr-dashboard-panel') renderUprDashboard();
            else if (panelId === 'upr-week-focus-panel') renderUprWeekFocus();
            else if (panelId === 'upr-export-panel') renderUprDataSummary();
        });
    });
}

// ========== KEYBOARD SHORTCUTS ==========
function setupKeyboardShortcuts() {
    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
    
    document.addEventListener('keydown', (e) => {
        const ctrlKey = isMac ? e.metaKey : e.ctrlKey;
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
            if (e.key !== 'Escape') return;
        }
        
        // Number keys 1-7 for status selection
        if (e.key >= '1' && e.key <= '7' && !ctrlKey && !e.altKey && !e.metaKey) {
            const keyNum = parseInt(e.key);
            const statusOption = STATUS_OPTIONS[keyNum - 1];
            if (!statusOption) return;
            
            // Check if a select is focused
            if (e.target.classList.contains('status-select')) {
                e.preventDefault();
                const select = e.target;
                const option = select.querySelector(`option[value="${statusOption.value}"]`);
                if (option && !option.disabled) {
                    select.value = statusOption.value;
                    select.dispatchEvent(new Event('change', { bubbles: true }));
                }
                return;
            }
            
            // Check if an item is expanded - find its select
            const expandedTechHeader = document.querySelector('.technique-header[aria-expanded="true"]');
            const expandedPracticeHeader = document.querySelector('.practice-header[aria-expanded="true"]');
            
            if (expandedTechHeader) {
                e.preventDefault();
                const select = expandedTechHeader.querySelector('.status-select');
                if (select) {
                    const option = select.querySelector(`option[value="${statusOption.value}"]`);
                    if (option && !option.disabled) {
                        select.value = statusOption.value;
                        select.dispatchEvent(new Event('change', { bubbles: true }));
                    }
                }
                return;
            }
            
            if (expandedPracticeHeader) {
                e.preventDefault();
                const select = expandedPracticeHeader.querySelector('.status-select');
                if (select) {
                    const option = select.querySelector(`option[value="${statusOption.value}"]`);
                    if (option && !option.disabled) {
                        select.value = statusOption.value;
                        select.dispatchEvent(new Event('change', { bubbles: true }));
                    }
                }
                return;
            }
        }
        
        if (ctrlKey && e.key === 'z' && !e.shiftKey) { e.preventDefault(); undo(); }
        if (ctrlKey && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) { e.preventDefault(); redo(); }
        if (ctrlKey && e.key === 'd') { e.preventDefault(); toggleTheme(); }
        if (e.key === '[' && !ctrlKey) { e.preventDefault(); collapseAll(); }
        if (e.key === ']' && !ctrlKey) { e.preventDefault(); expandAll(); }
        if (e.key === '?' && !e.ctrlKey && !e.metaKey) {
            document.getElementById('shortcuts-overlay').classList.toggle('active');
        }
        if (e.key === 'Escape') {
            document.getElementById('shortcuts-overlay').classList.remove('active');
            document.getElementById('welcome-overlay').classList.remove('active');
            closeSettings();
        }
        // Arrow keys and Enter for welcome overlay
        if (document.getElementById('welcome-overlay').classList.contains('active')) {
            if (e.key === 'ArrowRight' || e.key === 'ArrowDown' || e.key === 'Enter') { e.preventDefault(); welcomeNext(); }
            if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') { e.preventDefault(); welcomePrev(); }
        }
    });
}

// ========== WELCOME OVERLAY ==========
let welcomeStep = 1;
const totalWelcomeSteps = 6;

function showWelcome() {
    welcomeStep = 1;
    updateWelcomeStep();
    document.getElementById('welcome-overlay').classList.add('active');
}

function hideWelcome() {
    document.getElementById('welcome-overlay').classList.remove('active');
    localStorage.setItem('tlacGrowthWelcomeSeen', 'true');
}

function updateWelcomeStep() {
    document.querySelectorAll('.welcome-step').forEach(step => {
        step.classList.toggle('active', parseInt(step.dataset.step) === welcomeStep);
    });
    document.querySelectorAll('.welcome-dot').forEach(dot => {
        dot.classList.toggle('active', parseInt(dot.dataset.dot) === welcomeStep);
    });
    document.getElementById('welcome-prev-btn').disabled = welcomeStep === 1;
    const nextBtn = document.getElementById('welcome-next-btn');
    if (welcomeStep === totalWelcomeSteps) {
        nextBtn.textContent = 'Get Started';
        nextBtn.classList.remove('btn-primary');
        nextBtn.classList.add('btn-primary');
    } else {
        nextBtn.textContent = 'Next';
    }
}

function welcomeNext() {
    if (welcomeStep < totalWelcomeSteps) {
        welcomeStep++;
        updateWelcomeStep();
    } else {
        hideWelcome();
    }
}

function welcomePrev() {
    if (welcomeStep > 1) {
        welcomeStep--;
        updateWelcomeStep();
    }
}

function setupWelcome() {
    document.getElementById('welcome-close-btn').addEventListener('click', hideWelcome);
    document.getElementById('welcome-next-btn').addEventListener('click', welcomeNext);
    document.getElementById('welcome-prev-btn').addEventListener('click', welcomePrev);
    document.getElementById('show-welcome-btn').addEventListener('click', () => {
        closeSettings();
        showWelcome();
    });
    document.getElementById('welcome-overlay').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) hideWelcome();
    });
    document.querySelectorAll('.welcome-dot').forEach(dot => {
        dot.addEventListener('click', () => {
            welcomeStep = parseInt(dot.dataset.dot);
            updateWelcomeStep();
        });
        dot.style.cursor = 'pointer';
    });
    
    // Check for first run
    if (!localStorage.getItem('tlacGrowthWelcomeSeen')) {
        setTimeout(showWelcome, 500);
    }
}

// ========== INITIALIZATION ==========
function init() {
    loadData();
    setupTabNavigation();
    setupKeyboardShortcuts();
    setupSettingsAutoSave();
    setupWelcome();
    renderAll();
    
    // TLAC Event listeners
    document.getElementById('undo-btn').addEventListener('click', undo);
    document.getElementById('redo-btn').addEventListener('click', redo);
    document.getElementById('save-global-note-btn').addEventListener('click', saveGlobalNote);
    document.getElementById('export-json-btn').addEventListener('click', exportData);
    document.getElementById('print-report-btn').addEventListener('click', printReport);
    document.getElementById('email-report-btn').addEventListener('click', emailReport);
    document.getElementById('import-btn').addEventListener('click', () => document.getElementById('import-file').click());
    document.getElementById('import-file').addEventListener('change', importData);
    document.getElementById('clear-data-btn').addEventListener('click', clearAllData);
    
    // UPR Event listeners
    document.getElementById('save-upr-global-note-btn').addEventListener('click', saveUprGlobalNote);
    document.getElementById('upr-export-json-btn').addEventListener('click', exportData);
    document.getElementById('upr-print-report-btn').addEventListener('click', printReport);
    document.getElementById('upr-email-report-btn').addEventListener('click', emailReport);
    document.getElementById('upr-import-btn').addEventListener('click', () => document.getElementById('upr-import-file').click());
    document.getElementById('upr-import-file').addEventListener('change', importData);
    document.getElementById('upr-clear-data-btn').addEventListener('click', clearAllData);
    
    // Shortcuts panel
    document.getElementById('shortcuts-btn').addEventListener('click', () => document.getElementById('shortcuts-overlay').classList.add('active'));
    document.getElementById('close-shortcuts-btn').addEventListener('click', () => document.getElementById('shortcuts-overlay').classList.remove('active'));
    document.getElementById('shortcuts-overlay').addEventListener('click', (e) => { if (e.target === e.currentTarget) e.currentTarget.classList.remove('active'); });
    
    // Settings panel
    document.getElementById('settings-btn').addEventListener('click', openSettings);
    document.getElementById('settings-close-btn').addEventListener('click', closeSettings);
    document.getElementById('settings-overlay').addEventListener('click', (e) => { if (e.target === e.currentTarget) closeSettings(); });
    document.getElementById('dark-mode-toggle').addEventListener('click', toggleTheme);
    
    // Font size controls
    document.getElementById('font-increase-btn').addEventListener('click', increaseFontSize);
    document.getElementById('font-decrease-btn').addEventListener('click', decreaseFontSize);
    updateFontButtons();
    
    // System theme preference
    if (window.matchMedia && !appState.lastSaved) {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            applyTheme('dark');
        }
    }
    
    // Auto-save indicator update
    setInterval(updateSaveStatus, 60000);
}

document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
