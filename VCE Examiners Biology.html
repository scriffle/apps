<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCE Biology Examiner's Advice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --dark-green: #1B4332;
            --medium-green: #2D6A4F;
            --light-green: #52B788;
            --pale-green: #D8F3DC;
            --white: #ffffff;
            --light-gray: #F8FFF8;
            --success: #52B788;
            --warning: #FFC107;
            --error: #C44536;
            --neutral: #6C757D;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--dark-green) 0%, var(--medium-green) 100%);
            color: var(--dark-green);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        header {
            background: var(--white);
            padding: 1.5rem;
            border-bottom: 3px solid var(--light-green);
            margin-bottom: 1rem;
            border-radius: 8px 8px 0 0;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-green);
        }

        .student-info {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-top: 1rem;
        }

        .student-info label {
            font-size: 0.9rem;
            color: var(--medium-green);
            font-weight: 500;
        }

        .student-info input {
            flex: 1;
            max-width: 300px;
            padding: 0.5rem;
            background: var(--light-gray);
            border: 1px solid var(--light-green);
            color: var(--dark-green);
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .student-info input::placeholder {
            color: var(--neutral);
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            background: var(--white);
            padding: 0.5rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .tab {
            flex: 1;
            padding: 0.75rem;
            background: var(--light-gray);
            border: 1px solid transparent;
            color: var(--medium-green);
            cursor: pointer;
            text-align: center;
            border-radius: 4px;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .tab:hover {
            background: var(--pale-green);
            border-color: var(--light-green);
        }

        .tab.active {
            background: var(--light-green);
            color: var(--white);
            border-color: var(--medium-green);
        }

        .tab-content {
            display: none;
            background: var(--white);
            padding: 1.5rem;
            border-radius: 4px;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        .category-select {
            margin-bottom: 1rem;
        }

        .category-select select {
            width: 100%;
            padding: 0.75rem;
            background: var(--light-gray);
            border: 1px solid var(--light-green);
            color: var(--dark-green);
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            font-weight: 500;
        }

        .progress-bar {
            background: var(--pale-green);
            height: 24px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1rem;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--medium-green), var(--light-green));
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .progress-text {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--dark-green);
        }

        .question-card {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 8px;
            border: 2px solid transparent;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }

        .question-card.active {
            border-color: var(--light-green);
            box-shadow: 0 0 20px rgba(82, 183, 136, 0.3);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: var(--medium-green);
            font-weight: 500;
        }

        .question-text {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
            color: var(--dark-green);
        }

        .answer-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .answer-btn {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--light-green);
            background: var(--white);
            color: var(--dark-green);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .answer-btn:hover:not(:disabled) {
            background: var(--pale-green);
            border-color: var(--medium-green);
            transform: translateY(-2px);
        }

        .answer-btn:active {
            transform: translateY(0);
        }

        .answer-btn.selected {
            background: var(--light-green);
            border-color: var(--medium-green);
            color: var(--white);
        }

        .answer-btn.correct {
            background: var(--success);
            border-color: var(--success);
            color: var(--white);
        }

        .answer-btn.incorrect {
            background: var(--error);
            border-color: var(--error);
            color: var(--white);
        }

        .answer-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .feedback {
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1rem;
            display: none;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: var(--pale-green);
            border-left: 4px solid var(--success);
        }

        .feedback.incorrect {
            background: #FFE8E8;
            border-left: 4px solid var(--error);
        }

        .feedback-header {
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .study-tip {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(0,0,0,0.1);
            font-style: italic;
            font-size: 0.9rem;
        }

        .status-indicator {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-unanswered {
            background: var(--light-gray);
            color: var(--neutral);
        }

        .status-correct {
            background: var(--pale-green);
            color: var(--success);
        }

        .status-incorrect {
            background: #FFE8E8;
            color: var(--error);
        }

        .navigation {
            display: flex;
            gap: 0.5rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 0.75rem 1.5rem;
            background: var(--light-gray);
            border: 1px solid var(--light-green);
            color: var(--dark-green);
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: var(--light-green);
            color: var(--white);
        }

        .nav-btn.primary {
            background: var(--light-green);
            color: var(--white);
        }

        .nav-btn.primary:hover {
            background: var(--medium-green);
        }

        .category-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .category-card {
            background: var(--light-gray);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--light-green);
        }

        .category-card h3 {
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            color: var(--dark-green);
            font-weight: 600;
        }

        .category-card .stats {
            font-size: 0.85rem;
            color: var(--medium-green);
        }

        .mastery-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .mastery-card {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }

        .mastery-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .mastery-card.mastered .mastery-number {
            color: var(--success);
        }

        .mastery-card.partial .mastery-number {
            color: var(--warning);
        }

        .mastery-card.needs-work .mastery-number {
            color: var(--error);
        }

        .mastery-card.not-attempted .mastery-number {
            color: var(--neutral);
        }

        .mastery-label {
            font-size: 0.85rem;
            color: var(--medium-green);
            font-weight: 500;
        }

        .concept-list {
            margin-top: 1rem;
        }

        .concept-item {
            background: var(--light-gray);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 4px solid var(--neutral);
        }

        .concept-item.mastered {
            border-left-color: var(--success);
        }

        .concept-item.partial {
            border-left-color: var(--warning);
        }

        .concept-item.needs-work {
            border-left-color: var(--error);
        }

        .concept-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .concept-title {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--dark-green);
        }

        .concept-details {
            font-size: 0.85rem;
            color: var(--medium-green);
            line-height: 1.6;
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: var(--light-gray);
            border: 1px solid var(--light-green);
            color: var(--dark-green);
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            background: var(--pale-green);
        }

        .filter-btn.active {
            background: var(--light-green);
            color: var(--white);
        }

        .utility-section {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .utility-section h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--dark-green);
            font-weight: 600;
        }

        .utility-buttons {
            display: grid;
            gap: 0.75rem;
        }

        .utility-btn {
            padding: 1rem;
            background: var(--white);
            border: 1px solid var(--light-green);
            color: var(--dark-green);
            cursor: pointer;
            border-radius: 4px;
            text-align: left;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .utility-btn:hover {
            background: var(--pale-green);
            border-color: var(--medium-green);
        }

        .utility-btn.warning {
            border-color: var(--error);
            color: var(--error);
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            background: var(--white);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--pale-green);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--medium-green);
            margin-bottom: 0.25rem;
            font-weight: 500;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-green);
        }

        .keyboard-hint {
            text-align: center;
            font-size: 0.8rem;
            color: var(--neutral);
            margin-top: 1rem;
            padding: 0.5rem;
            background: var(--light-gray);
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }

            header {
                padding: 1rem;
            }

            h1 {
                font-size: 1.2rem;
            }

            .question-text {
                font-size: 1rem;
            }

            .answer-buttons {
                flex-direction: column;
            }

            .navigation {
                justify-content: center;
            }

            .nav-btn {
                flex: 1;
                min-width: 120px;
            }

            .mastery-overview {
                grid-template-columns: 1fr 1fr;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(27, 67, 50, 0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 100%;
            border: 2px solid var(--light-green);
        }

        .modal-header {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--dark-green);
            font-weight: 600;
        }

        .modal-body {
            margin-bottom: 1.5rem;
            line-height: 1.6;
            color: var(--medium-green);
        }

        .modal-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--light-green);
            background: var(--light-gray);
            color: var(--dark-green);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .modal-btn:hover {
            background: var(--pale-green);
        }

        .modal-btn.primary {
            background: var(--light-green);
            color: var(--white);
        }

        .modal-btn.primary:hover {
            background: var(--medium-green);
        }
    </style>
</head>
<body>
    <header>
        <h1>VCE Biology Examiner's Advice</h1>
        <div class="student-info">
            <label for="studentName">Student Name:</label>
            <input type="text" id="studentName" placeholder="Enter your name">
        </div>
    </header>

    <div class="container">
        <div class="tabs">
            <div class="tab active" data-tab="questions">Questions</div>
            <div class="tab" data-tab="feedback">Feedback</div>
            <div class="tab" data-tab="utility">Utility</div>
        </div>

        <!-- Questions Tab -->
        <div class="tab-content active" id="questions-tab">
            <div class="category-select">
                <select id="categorySelect">
                    <option value="0">Exam Technique & Presentation</option>
                    <option value="1">Mathematical & Calculation Skills</option>
                    <option value="2">Graph & Data Analysis Skills</option>
                    <option value="3">Conceptual Understanding</option>
                    <option value="4">Common Misconceptions</option>
                    <option value="5">Problem-Solving Strategies</option>
                </select>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
                <div class="progress-text" id="progressText">0/0 (0%)</div>
            </div>

            <div id="questionContainer"></div>

            <div class="navigation">
                <button class="nav-btn" id="prevBtn">← Previous</button>
                <button class="nav-btn" id="skipBtn">Skip</button>
                <button class="nav-btn primary" id="nextBtn">Next →</button>
            </div>

            <div class="keyboard-hint">
                Keyboard shortcuts: T (True) | F (False) | ← → (Navigate)
            </div>

            <div class="category-summary" id="categorySummary"></div>
        </div>

        <!-- Feedback Tab -->
        <div class="tab-content" id="feedback-tab">
            <div class="progress-bar">
                <div class="progress-fill" id="overallProgressFill"></div>
                <div class="progress-text" id="overallProgressText">0/70 (0%)</div>
            </div>

            <div class="mastery-overview">
                <div class="mastery-card mastered">
                    <div class="mastery-number" id="masteredCount">0</div>
                    <div class="mastery-label">Mastered (2/2)</div>
                </div>
                <div class="mastery-card partial">
                    <div class="mastery-number" id="partialCount">0</div>
                    <div class="mastery-label">Partial (1/2)</div>
                </div>
                <div class="mastery-card needs-work">
                    <div class="mastery-number" id="needsWorkCount">0</div>
                    <div class="mastery-label">Needs Work (0/2)</div>
                </div>
                <div class="mastery-card not-attempted">
                    <div class="mastery-number" id="notAttemptedCount">35</div>
                    <div class="mastery-label">Not Attempted</div>
                </div>
            </div>

            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="mastered">Mastered</button>
                <button class="filter-btn" data-filter="partial">Partial</button>
                <button class="filter-btn" data-filter="needs-work">Needs Work</button>
                <button class="filter-btn" data-filter="not-attempted">Not Attempted</button>
            </div>

            <div class="concept-list" id="conceptList"></div>
        </div>

        <!-- Utility Tab -->
        <div class="tab-content" id="utility-tab">
            <div class="utility-section">
                <h3>Session Management</h3>
                <div class="utility-buttons">
                    <button class="utility-btn" id="saveBtn">💾 Save Progress</button>
                    <button class="utility-btn" id="exportBtn">📊 Export Results</button>
                    <button class="utility-btn" id="emailBtn">📧 Email to Teacher</button>
                    <button class="utility-btn warning" id="resetBtn">⚠️ Reset All Progress</button>
                </div>
            </div>

            <div class="utility-section">
                <h3>Statistics</h3>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-label">Questions Answered</div>
                        <div class="stat-value" id="statAnswered">0/70</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Accuracy Rate</div>
                        <div class="stat-value" id="statAccuracy">0%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Current Category</div>
                        <div class="stat-value" id="statCategory">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Last Session</div>
                        <div class="stat-value" id="statLastSession">-</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader">Confirm Action</div>
            <div class="modal-body" id="modalBody">Are you sure?</div>
            <div class="modal-buttons">
                <button class="modal-btn" id="modalCancel">Cancel</button>
                <button class="modal-btn primary" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // Question Database - Biology questions from examiner reports
        const questionDatabase = {
            categories: [
                {
                    name: "Exam Technique & Presentation",
                    concepts: [
                        {
                            id: 'ET001',
                            title: "Use pen not pencil in Section B",
                            questions: [
                                {
                                    text: "When answering Section B questions, it is acceptable to use a faint pencil as long as your handwriting is neat.",
                                    answer: false,
                                    explanation: "Examiners assess scanned images, and pencil often does not scan well. Students are strongly advised to use an ink pen for all Section B responses to ensure answers are clearly visible to assessors.",
                                    studyTip: "Bring a reliable pen to the exam and avoid pencil for written responses."
                                },
                                {
                                    text: "If you must use pencil in Section B, it should be high quality to ensure it scans properly.",
                                    answer: true,
                                    explanation: "While pen is strongly recommended, if pencil is used it must be of suitable quality to scan well. However, pen remains the best choice for Section B.",
                                    studyTip: "Pen is always preferable to pencil for scanned examinations."
                                }
                            ]
                        },
                        {
                            id: 'ET002',
                            title: "Use mark allocation as guide",
                            questions: [
                                {
                                    text: "The number of marks allocated to a question indicates how many separate points you should make in your answer.",
                                    answer: true,
                                    explanation: "The mark allocation guides the level of detail required. A 3-mark question typically requires three distinct points or a well-developed explanation with multiple components.",
                                    studyTip: "Use mark allocations to gauge response length and detail needed."
                                },
                                {
                                    text: "For a 2-mark question, one detailed sentence is usually sufficient.",
                                    answer: false,
                                    explanation: "Two marks generally means you need two distinct points or aspects. One sentence is rarely sufficient for 2 marks unless it contains multiple required elements.",
                                    studyTip: "Count the marks and ensure you provide that many distinct pieces of information."
                                }
                            ]
                        },
                        {
                            id: 'ET003',
                            title: "Indicate when using extra space",
                            questions: [
                                {
                                    text: "If you need more space for an answer, you should write 'see additional space' and continue at the back of the booklet.",
                                    answer: true,
                                    explanation: "You must clearly indicate when continuing in the additional space section so assessors know to look there for the rest of your response.",
                                    studyTip: "Always indicate clearly if your answer continues elsewhere."
                                },
                                {
                                    text: "The number of lines provided under a question is a good guide to the expected length of response.",
                                    answer: true,
                                    explanation: "The space provided gives an indication of how much you should write, though handwriting size varies between students.",
                                    studyTip: "Use the space provided as a guide, but focus on answering completely."
                                }
                            ]
                        },
                        {
                            id: 'ET004',
                            title: "Use reading time effectively",
                            questions: [
                                {
                                    text: "Using reading time to identify key requirements and plan Section B answers is an effective exam strategy.",
                                    answer: true,
                                    explanation: "Reading time should be used strategically to assess questions, identify what is required, and mentally plan responses.",
                                    studyTip: "Use reading time to scan all Section B questions and plan your approach."
                                },
                                {
                                    text: "During reading time, you should start writing your answers for Section B questions.",
                                    answer: false,
                                    explanation: "Writing is not permitted during reading time. You can only read and think during this period.",
                                    studyTip: "Reading time equals read and plan only. No writing allowed."
                                }
                            ]
                        },
                        {
                            id: 'ET005',
                            title: "Tailor responses to specific questions",
                            questions: [
                                {
                                    text: "If you copy information directly from your notes sheet without adapting it to the specific question, you will likely receive full marks.",
                                    answer: false,
                                    explanation: "Examiners recognize memorized responses that do not address the specific question. You must adapt knowledge to the context.",
                                    studyTip: "Use your knowledge flexibly - adapt it to the specific question context."
                                },
                                {
                                    text: "Responses should be specifically tailored to the context and requirements of each question.",
                                    answer: true,
                                    explanation: "Questions are designed to assess your ability to apply knowledge to specific situations, not just recall facts.",
                                    studyTip: "Always ask: does my answer specifically address this question?"
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "Mathematical & Calculation Skills",
                    concepts: [
                        {
                            id: 'MC001',
                            title: "Show working for multi-mark calculations",
                            questions: [
                                {
                                    text: "In calculation questions worth more than one mark, you only need to show the final answer to receive full marks.",
                                    answer: false,
                                    explanation: "For multi-mark calculations, you must show your working. Marks are awarded for demonstrated understanding through the steps, not just the final answer.",
                                    studyTip: "Always show your working for calculations - marks are for the process, not just the answer."
                                },
                                {
                                    text: "Showing your working in calculations helps you earn partial marks even if your final answer is incorrect.",
                                    answer: true,
                                    explanation: "Examiners can award marks for correct method and steps even if an error leads to an incorrect final answer. Working demonstrates your understanding.",
                                    studyTip: "Clear working protects you from losing all marks due to one error."
                                }
                            ]
                        },
                        {
                            id: 'MC002',
                            title: "Include units with answers",
                            questions: [
                                {
                                    text: "When a question specifies units in the answer box, you must express your answer in those units.",
                                    answer: true,
                                    explanation: "If units are provided in the answer space, your numerical value must be in those units. Converting incorrectly or ignoring this loses marks.",
                                    studyTip: "Check the units required and convert your answer if necessary."
                                },
                                {
                                    text: "You should always include units with your final answer, even if they are not provided in the answer space.",
                                    answer: true,
                                    explanation: "Units are an essential part of scientific answers. Always include them to show complete understanding, unless already printed in the answer space.",
                                    studyTip: "Make including units in answers an automatic habit."
                                }
                            ]
                        },
                        {
                            id: 'MC003',
                            title: "Use scientific notation appropriately",
                            questions: [
                                {
                                    text: "Scientific notation should be used for very large or very small numbers to maintain precision.",
                                    answer: true,
                                    explanation: "Scientific notation (e.g., 3.2 × 10⁻⁶) is the appropriate way to express very large or small values and prevents errors with zeros.",
                                    studyTip: "Practice converting between standard and scientific notation."
                                },
                                {
                                    text: "When converting units, checking that your final answer makes sense is an important step.",
                                    answer: true,
                                    explanation: "A sense-check helps catch conversion errors. For example, converting metres to kilometres should give a smaller number.",
                                    studyTip: "After calculations, ask yourself: does this answer make sense?"
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "Graph & Data Analysis Skills",
                    concepts: [
                        {
                            id: 'GD001',
                            title: "Lines of best fit consider all points",
                            questions: [
                                {
                                    text: "A line of best fit should always pass through the first and last data points on a graph.",
                                    answer: false,
                                    explanation: "This is a common error. A line of best fit should consider ALL data points and minimize the overall distance to all points, not just connect the endpoints.",
                                    studyTip: "Your line of best fit should have roughly equal numbers of points above and below it."
                                },
                                {
                                    text: "When drawing a line of best fit, you should consider all data points to find the line that best represents the trend.",
                                    answer: true,
                                    explanation: "Every data point matters when determining the line that best represents the overall trend in the data.",
                                    studyTip: "Practice drawing lines of best fit by balancing points above and below."
                                }
                            ]
                        },
                        {
                            id: 'GD002',
                            title: "Use ruler to read graphs accurately",
                            questions: [
                                {
                                    text: "Using a ruler to read values from graphs helps ensure accuracy when transferring data.",
                                    answer: true,
                                    explanation: "A ruler is allowed in all exams and helps you read values accurately from graphs, especially when precision matters.",
                                    studyTip: "Bring a clear ruler to every exam to help read graphs accurately."
                                },
                                {
                                    text: "When reading a graph, estimating values by eye is usually sufficient for exam purposes.",
                                    answer: false,
                                    explanation: "Visual estimation can lead to errors. Using a ruler or edge to read values accurately is essential, especially when values determine your subsequent analysis.",
                                    studyTip: "Always use a ruler to read values from graphs precisely."
                                }
                            ]
                        },
                        {
                            id: 'GD003',
                            title: "Calculate gradients from line points",
                            questions: [
                                {
                                    text: "When calculating the gradient of a line, you should select two points that are on the line and far apart.",
                                    answer: true,
                                    explanation: "Choosing points far apart on the line reduces percentage error and gives a more accurate gradient. Both points must actually be on the line.",
                                    studyTip: "Show your chosen points clearly on the graph and use their coordinates in your calculation."
                                },
                                {
                                    text: "When finding a gradient, you can use any two data points from the original data table.",
                                    answer: false,
                                    explanation: "You must use points that lie on your line of best fit, not original data points. The gradient represents the trend, not individual measurements.",
                                    studyTip: "Always select points that are clearly on the line you have drawn."
                                }
                            ]
                        },
                        {
                            id: 'GD004',
                            title: "Label graphs with units",
                            questions: [
                                {
                                    text: "When plotting a graph, the axes scales do not need to be evenly spaced as long as all points fit.",
                                    answer: false,
                                    explanation: "Axes must have even, regular spacing. Uneven scales distort the data and make the graph misleading.",
                                    studyTip: "Always use evenly spaced scales on both axes."
                                },
                                {
                                    text: "When constructing a graph, both axes must be clearly labelled with units.",
                                    answer: true,
                                    explanation: "Clear labels with units are essential. Without them, the graph is meaningless and you will lose marks.",
                                    studyTip: "Check every graph you draw: labels, units, even scales."
                                }
                            ]
                        },
                        {
                            id: 'GD005',
                            title: "Support trends with specific data",
                            questions: [
                                {
                                    text: "When describing a trend in data, it is sufficient to say 'the value increased' without reference to specific data points.",
                                    answer: false,
                                    explanation: "You should support your description with specific values (e.g., 'increased from 2.5 to 3.5') to demonstrate careful analysis.",
                                    studyTip: "Back up trend descriptions with actual values from the data."
                                },
                                {
                                    text: "Describing trends should include specific values and what they represent in context.",
                                    answer: true,
                                    explanation: "Strong analysis combines the trend description with specific data and explains what it means for the investigation.",
                                    studyTip: "Trend plus specific values plus meaning in context equals strong analysis."
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "Conceptual Understanding",
                    concepts: [
                        {
                            id: 'CU001',
                            title: "Glycolysis occurs in cytosol",
                            questions: [
                                {
                                    text: "Glycolysis occurs inside the mitochondria along with the other stages of cellular respiration.",
                                    answer: false,
                                    explanation: "Glycolysis occurs in the cytosol (outside the mitochondria). Only the Krebs cycle and electron transport chain occur within the mitochondria.",
                                    studyTip: "Remember the locations: cytosol (glycolysis), matrix (Krebs), cristae (ETC)."
                                },
                                {
                                    text: "A cell without mitochondria could still produce ATP through glycolysis.",
                                    answer: true,
                                    explanation: "Glycolysis occurs in the cytosol and produces 2 ATP without requiring mitochondria. This is why some cells (like red blood cells) lack mitochondria but still function.",
                                    studyTip: "Glycolysis is the only ATP-producing stage that does not require mitochondria."
                                }
                            ]
                        },
                        {
                            id: 'CU002',
                            title: "Electron transport chain location",
                            questions: [
                                {
                                    text: "The electron transport chain occurs on the outer mitochondrial membrane.",
                                    answer: false,
                                    explanation: "The electron transport chain occurs on the inner mitochondrial membrane (cristae), not the outer membrane. This is where most ATP is produced.",
                                    studyTip: "Inner membrane (cristae) equals high ATP production. Outer membrane equals no ATP production."
                                },
                                {
                                    text: "The mitochondrial matrix is where the Krebs cycle occurs, producing 2 ATP.",
                                    answer: true,
                                    explanation: "The Krebs cycle takes place in the matrix (inner space) of the mitochondria and directly produces 2 ATP molecules.",
                                    studyTip: "Matrix equals Krebs cycle equals 2 ATP. Cristae equals ETC equals 26-28 ATP."
                                }
                            ]
                        },
                        {
                            id: 'CU003',
                            title: "Light-dependent stage requires light",
                            questions: [
                                {
                                    text: "The light-dependent stage of photosynthesis can occur in the dark if NADPH and ATP are provided.",
                                    answer: false,
                                    explanation: "The light-dependent stage requires light energy to split water and cannot occur without light, regardless of available NADPH and ATP.",
                                    studyTip: "Light-dependent equals requires light. Light-independent equals uses products from light-dependent stage."
                                },
                                {
                                    text: "The light-independent stage occurs in the stroma and does not directly require light.",
                                    answer: true,
                                    explanation: "The Calvin cycle (light-independent stage) occurs in the stroma and uses NADPH and ATP from the light-dependent stage, but does not directly need light.",
                                    studyTip: "Stroma equals light-independent stage equals uses NADPH and ATP."
                                }
                            ]
                        },
                        {
                            id: 'CU004',
                            title: "Rubisco binds both CO₂ and O₂",
                            questions: [
                                {
                                    text: "Rubisco can only bind to carbon dioxide, which is why photorespiration does not occur at low temperatures.",
                                    answer: false,
                                    explanation: "Rubisco can bind to both carbon dioxide and oxygen. Photorespiration is less common at low temperatures because CO₂ is more likely to bind than O₂.",
                                    studyTip: "Rubisco is 'confused' - it can bind to both CO₂ and O₂."
                                },
                                {
                                    text: "Photorespiration occurs when Rubisco binds to oxygen instead of carbon dioxide.",
                                    answer: true,
                                    explanation: "When Rubisco binds to O₂ rather than CO₂, photorespiration results, which wastes energy and reduces photosynthetic efficiency.",
                                    studyTip: "Higher temperature equals more O₂ binding equals more photorespiration."
                                }
                            ]
                        },
                        {
                            id: 'CU005',
                            title: "Natural killer cells are innate",
                            questions: [
                                {
                                    text: "Natural killer cells and cytotoxic T cells both destroy infected cells directly, but natural killer cells are part of the adaptive immune system.",
                                    answer: false,
                                    explanation: "Natural killer cells are part of the innate immune system (non-specific, early response), while cytotoxic T cells are part of the adaptive immune system (specific, later response).",
                                    studyTip: "NK cells equal innate equal early equal non-specific. Cytotoxic T cells equal adaptive equal later equal specific."
                                },
                                {
                                    text: "Both natural killer cells and cytotoxic T cells recognize infected cells displaying antigens on MHC-I markers and induce apoptosis.",
                                    answer: true,
                                    explanation: "Both cell types target infected cells displaying antigens on MHC-I and cause cell death, though they differ in their specificity and timing.",
                                    studyTip: "Both kill infected cells via MHC-I recognition, but differ in specificity."
                                }
                            ]
                        },
                        {
                            id: 'CU006',
                            title: "Dendritic cells present antigens",
                            questions: [
                                {
                                    text: "Neutrophils commonly act as antigen-presenting cells by displaying antigens on MHC Class II markers.",
                                    answer: false,
                                    explanation: "Neutrophils do not commonly present antigens. Dendritic cells, macrophages, and B cells are the professional antigen-presenting cells with MHC Class II markers.",
                                    studyTip: "Professional APCs with MHC-II: dendritic cells, macrophages, B cells (not neutrophils)."
                                },
                                {
                                    text: "Dendritic cells are phagocytes that present antigens on MHC Class II markers to activate T helper cells.",
                                    answer: true,
                                    explanation: "Dendritic cells phagocytose pathogens, then travel to lymph nodes where they present antigens on MHC-II to helper T cells, initiating the adaptive response.",
                                    studyTip: "Dendritic cells are the key link between innate and adaptive immunity."
                                }
                            ]
                        },
                        {
                            id: 'CU007',
                            title: "Antibodies tag, not kill",
                            questions: [
                                {
                                    text: "Antibodies directly kill pathogens by attaching to them and destroying their cell membranes.",
                                    answer: false,
                                    explanation: "Antibodies do not directly kill pathogens. They bind to antigens and tag them for destruction (opsonization), neutralize them, or cause agglutination.",
                                    studyTip: "Antibodies tag and neutralize - they do not directly kill."
                                },
                                {
                                    text: "Antibodies bind to antigens, leading to agglutination, neutralization, or opsonization.",
                                    answer: true,
                                    explanation: "These are the main mechanisms by which antibodies help eliminate pathogens by making them more visible to immune cells or preventing their function.",
                                    studyTip: "Remember the three main antibody mechanisms: agglutination, neutralization, opsonization."
                                }
                            ]
                        },
                        {
                            id: 'CU008',
                            title: "Operons are prokaryotic only",
                            questions: [
                                {
                                    text: "In eukaryotic cells, both prokaryotic operons and CRISPR-Cas9 systems are used for gene regulation.",
                                    answer: false,
                                    explanation: "Eukaryotic cells do not have operons (which are prokaryotic structures). CRISPR-Cas9 can be adapted for use in eukaryotes, but operons are prokaryotic only.",
                                    studyTip: "Operons equal prokaryotes only. Eukaryotes have different gene regulation."
                                },
                                {
                                    text: "Eukaryotic genes have promoter and terminator sequences, but do not have operator regions like prokaryotic operons.",
                                    answer: true,
                                    explanation: "Operator regions are specific to prokaryotic operons. Eukaryotic genes use different regulatory mechanisms.",
                                    studyTip: "Operator equals prokaryotic only. Eukaryotic gene structure is different."
                                }
                            ]
                        },
                        {
                            id: 'CU009',
                            title: "sgRNA must be complementary",
                            questions: [
                                {
                                    text: "In CRISPR-Cas9 gene editing, the single guide RNA (sgRNA) must be complementary to the target gene sequence.",
                                    answer: true,
                                    explanation: "The sgRNA is designed to be complementary to the specific DNA sequence you want to edit, allowing it to guide Cas9 to the correct location.",
                                    studyTip: "sgRNA complementarity is crucial for targeting the correct gene."
                                },
                                {
                                    text: "Cas9 endonuclease binds to the PAM sequence, which is part of the CRISPR array in bacteria.",
                                    answer: false,
                                    explanation: "The PAM (Protospacer Adjacent Motif) sequence is adjacent to the target DNA, not part of the CRISPR array. Cas9 must recognize the PAM to cut DNA.",
                                    studyTip: "PAM is next to the target DNA, not in the CRISPR array."
                                }
                            ]
                        },
                        {
                            id: 'CU010',
                            title: "tRNA role in translation",
                            questions: [
                                {
                                    text: "tRNA molecules carry specific amino acids to the ribosome, where their anticodons pair with complementary mRNA codons.",
                                    answer: true,
                                    explanation: "This describes the key role of tRNA in translation - carrying amino acids and using anticodon-codon pairing to ensure correct sequence.",
                                    studyTip: "tRNA equals amino acid delivery plus codon recognition via anticodon."
                                },
                                {
                                    text: "Proteins are transcribed from DNA in the nucleus and then translated in the cytoplasm.",
                                    answer: false,
                                    explanation: "Genes (DNA) are transcribed into mRNA, not proteins. The mRNA is then translated into proteins. DNA and genes are transcribed; proteins are translated.",
                                    studyTip: "Transcription makes mRNA. Translation makes proteins. Know the difference."
                                }
                            ]
                        },
                        {
                            id: 'CU011',
                            title: "C4 plants use bundle sheath cells",
                            questions: [
                                {
                                    text: "C4 plants fix carbon dioxide in mesophyll cells, just like C3 plants.",
                                    answer: false,
                                    explanation: "C4 plants fix CO₂ in bundle sheath cells, not mesophyll cells. This is a key difference from C3 plants and reduces photorespiration.",
                                    studyTip: "C3 equals mesophyll. C4 equals bundle sheath. This is a crucial distinction."
                                },
                                {
                                    text: "C4 plants are better adapted to high temperatures because they experience less photorespiration than C3 plants.",
                                    answer: true,
                                    explanation: "The bundle sheath cell arrangement in C4 plants means CO₂ concentration is higher where Rubisco operates, reducing oxygen competition and photorespiration.",
                                    studyTip: "C4 plants equals less photorespiration equals better in hot conditions."
                                }
                            ]
                        },
                        {
                            id: 'CU012',
                            title: "Antigenic drift versus shift",
                            questions: [
                                {
                                    text: "Antigenic drift involves major sudden changes to viral surface antigens through reassortment.",
                                    answer: false,
                                    explanation: "That describes antigenic shift, not drift. Antigenic drift involves gradual small changes through point mutations.",
                                    studyTip: "Drift equals gradual small changes. Shift equals sudden major changes."
                                },
                                {
                                    text: "Antigenic drift results in gradual changes to viral antigens that may reduce the effectiveness of previous immunity.",
                                    answer: true,
                                    explanation: "Small accumulated mutations in antigenic drift can mean previous antibodies are less effective, requiring updated vaccines.",
                                    studyTip: "Drift requires vaccine updates. Shift can create pandemic-causing strains."
                                }
                            ]
                        },
                        {
                            id: 'CU013',
                            title: "Genetic drift is random",
                            questions: [
                                {
                                    text: "Genetic drift and natural selection both involve random changes in allele frequencies.",
                                    answer: false,
                                    explanation: "Natural selection is non-random - advantageous alleles increase in frequency. Genetic drift is random and more pronounced in small populations.",
                                    studyTip: "Drift equals random chance. Selection equals non-random advantage."
                                },
                                {
                                    text: "Genetic drift causes random changes in allele frequency and has greater effect in smaller populations.",
                                    answer: true,
                                    explanation: "In small populations, chance events can significantly alter allele frequencies. In large populations, chance effects are diluted.",
                                    studyTip: "Small population equals bigger drift effect. Large population equals drift minimized."
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "Common Misconceptions",
                    concepts: [
                        {
                            id: 'CM001',
                            title: "Enzymes lower activation energy",
                            questions: [
                                {
                                    text: "Enzymes provide energy to speed up chemical reactions in cells.",
                                    answer: false,
                                    explanation: "Enzymes do not provide energy. They lower the activation energy required for a reaction, making it easier for the reaction to proceed.",
                                    studyTip: "Enzymes lower activation energy; they do not provide energy."
                                },
                                {
                                    text: "Enzymes lower the activation energy required for a chemical reaction to occur.",
                                    answer: true,
                                    explanation: "This is exactly what enzymes do - they reduce the energy barrier (activation energy) so reactions can proceed more easily at body temperature.",
                                    studyTip: "Enzymes are catalysts that lower activation energy."
                                }
                            ]
                        },
                        {
                            id: 'CM002',
                            title: "Evolution through natural selection",
                            questions: [
                                {
                                    text: "When environments change, organisms adapt during their lifetime and pass these adaptations to offspring.",
                                    answer: false,
                                    explanation: "This is Lamarckian thinking and is incorrect. Evolution occurs through natural selection of existing genetic variation, not through acquired characteristics.",
                                    studyTip: "Evolution equals natural selection of random variation, not acquired adaptations."
                                },
                                {
                                    text: "Natural selection favors individuals with advantageous alleles, increasing their frequency in future generations.",
                                    answer: true,
                                    explanation: "This is the correct explanation of natural selection - existing beneficial variations are selected for, not acquired during life.",
                                    studyTip: "Natural selection acts on existing variation, not acquired traits."
                                }
                            ]
                        },
                        {
                            id: 'CM003',
                            title: "Mitochondria produce ATP",
                            questions: [
                                {
                                    text: "Mitochondria provide ATP to cells as an energy source.",
                                    answer: false,
                                    explanation: "This phrasing is problematic. Mitochondria produce ATP through cellular respiration - they do not simply 'provide' it as if it is stored there.",
                                    studyTip: "Mitochondria produce ATP through cellular respiration - be precise."
                                },
                                {
                                    text: "Mitochondria produce ATP through the process of cellular respiration.",
                                    answer: true,
                                    explanation: "This is the accurate description - mitochondria are the site where cellular respiration produces ATP from glucose and oxygen.",
                                    studyTip: "Use precise language: mitochondria produce ATP through cellular respiration."
                                }
                            ]
                        },
                        {
                            id: 'CM004',
                            title: "T cells target infected cells",
                            questions: [
                                {
                                    text: "Immune cells destroy pathogens directly by targeting and killing the bacteria or viruses.",
                                    answer: false,
                                    explanation: "This oversimplifies. While phagocytes do engulf pathogens, cytotoxic T cells and NK cells kill infected host cells, not pathogens directly.",
                                    studyTip: "Phagocytes engulf pathogens. T cells kill infected cells. Know the difference."
                                },
                                {
                                    text: "Cytotoxic T cells recognize and induce apoptosis in infected host cells, not pathogens directly.",
                                    answer: true,
                                    explanation: "Cytotoxic T cells target infected host cells displaying foreign antigens on MHC-I markers, causing those cells to undergo apoptosis.",
                                    studyTip: "T cells target infected cells, not free pathogens."
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "Problem-Solving Strategies",
                    concepts: [
                        {
                            id: 'PS001',
                            title: "Compare means show similarities and differences",
                            questions: [
                                {
                                    text: "When a question asks you to 'compare', you only need to describe both items separately without identifying similarities or differences.",
                                    answer: false,
                                    explanation: "'Compare' requires you to identify similarities and differences, not just describe each item. You must make explicit comparisons.",
                                    studyTip: "Compare equals identify similarities AND differences explicitly."
                                },
                                {
                                    text: "When comparing two processes, you should address both items and highlight how they are similar or different.",
                                    answer: true,
                                    explanation: "A good comparison requires you to reference both items and make their relationships clear through identifying similarities, differences, or both.",
                                    studyTip: "Always mention both items when comparing and state the relationship."
                                }
                            ]
                        },
                        {
                            id: 'PS002',
                            title: "Explain means add reasoning",
                            questions: [
                                {
                                    text: "When asked to 'explain', repeating information from the question stem demonstrates your understanding.",
                                    answer: false,
                                    explanation: "Merely restating the question shows nothing. You must add biological knowledge, mechanisms, or reasoning beyond what is given.",
                                    studyTip: "Explain equals add new information showing why or how something happens."
                                },
                                {
                                    text: "To properly explain a concept, you should describe the mechanisms or reasoning that make it work.",
                                    answer: true,
                                    explanation: "Explanations require you to demonstrate understanding by describing how or why something happens, including relevant biological processes.",
                                    studyTip: "Ask yourself: does my explanation show how or why it works?"
                                }
                            ]
                        },
                        {
                            id: 'PS003',
                            title: "Use specific data values",
                            questions: [
                                {
                                    text: "When analyzing data from a graph, stating specific values and what they represent is more effective than general descriptions.",
                                    answer: true,
                                    explanation: "Specific data with context (e.g., '3.5 average likelihood out of 5') is far more convincing than vague statements like 'the value was higher'.",
                                    studyTip: "Always include specific values and explain what they mean in context."
                                },
                                {
                                    text: "Saying 'the graph shows a value of 3.5' is sufficient analysis without needing to explain what 3.5 represents.",
                                    answer: false,
                                    explanation: "The number alone is meaningless. You must explain what it represents (e.g., '3.5 average likelihood out of 5' or '3.5 mg/g chlorophyll content').",
                                    studyTip: "Always interpret numbers - what do they mean in the context of the question?"
                                }
                            ]
                        },
                        {
                            id: 'PS004',
                            title: "Address all parts of questions",
                            questions: [
                                {
                                    text: "When questions have multiple parts (e.g., 'describe X and explain Y'), addressing only the second part is sufficient if your answer is detailed.",
                                    answer: false,
                                    explanation: "You must address all parts of multi-part questions. Examiners check specifically for each component and award marks accordingly.",
                                    studyTip: "Highlight or underline each part of multi-part questions before answering."
                                },
                                {
                                    text: "Using dot points can help ensure you address all components of a multi-part question.",
                                    answer: true,
                                    explanation: "Dot points help organize your thoughts and ensure you cover each required element. This format is acceptable in biology exams.",
                                    studyTip: "Consider using dot points for complex questions with multiple requirements."
                                }
                            ]
                        },
                        {
                            id: 'PS005',
                            title: "Use process of elimination",
                            questions: [
                                {
                                    text: "When you encounter unfamiliar terminology in a multiple choice question, you should guess randomly.",
                                    answer: false,
                                    explanation: "Use elimination strategy - rule out options you know are wrong. Often you can determine the correct answer by process of elimination.",
                                    studyTip: "Eliminate obviously wrong answers first, then choose from remaining options."
                                },
                                {
                                    text: "Process of elimination is an effective strategy when you encounter unfamiliar terms in multiple choice questions.",
                                    answer: true,
                                    explanation: "Even if you do not recognize all terms, you can often eliminate wrong answers using related knowledge, increasing your odds considerably.",
                                    studyTip: "Trust your knowledge - eliminate wrong answers even if you do not know every term."
                                }
                            ]
                        }
                    ]
                }
            ]
        };

        // Application state management
        let appState = {
            studentName: '',
            currentCategory: 0,
            currentQuestionIndex: 0,
            responses: {},
            filter: 'all',
            lastSaved: null
        };

        function init() {
            loadState();
            setupEventListeners();
            updateAllDisplays();
        }

        function updateAllDisplays() {
            renderCurrentQuestion();
            updateProgress();
            renderCategorySummary();
            updateFeedbackTab();
            updateUtilityStats();
        }

        function loadState() {
            const saved = localStorage.getItem('vceBiologyState');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    appState = { ...appState, ...parsed };
                    document.getElementById('studentName').value = appState.studentName || '';
                    document.getElementById('categorySelect').value = appState.currentCategory;
                } catch (e) {
                    console.error('Error loading state:', e);
                }
            }
        }

        function saveState() {
            appState.lastSaved = new Date().toISOString();
            localStorage.setItem('vceBiologyState', JSON.stringify(appState));
        }

        function setupEventListeners() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchTab(tab.dataset.tab);
                });
            });

            document.getElementById('categorySelect').addEventListener('change', (e) => {
                appState.currentCategory = parseInt(e.target.value);
                appState.currentQuestionIndex = 0;
                updateAllDisplays();
                saveState();
            });

            document.getElementById('studentName').addEventListener('change', (e) => {
                appState.studentName = e.target.value;
                saveState();
            });

            document.getElementById('prevBtn').addEventListener('click', () => navigateQuestion(-1));
            document.getElementById('nextBtn').addEventListener('click', () => navigateQuestion(1));
            document.getElementById('skipBtn').addEventListener('click', () => navigateQuestion(1));

            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT') return;
                
                switch(e.key.toLowerCase()) {
                    case 't':
                        answerQuestion(true);
                        break;
                    case 'f':
                        answerQuestion(false);
                        break;
                    case 'arrowleft':
                        navigateQuestion(-1);
                        break;
                    case 'arrowright':
                        navigateQuestion(1);
                        break;
                }
            });

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    appState.filter = btn.dataset.filter;
                    updateFeedbackTab();
                });
            });

            document.getElementById('saveBtn').addEventListener('click', () => {
                saveState();
                showModal('Progress Saved', 'Your progress has been saved successfully.');
            });

            document.getElementById('exportBtn').addEventListener('click', exportResults);
            document.getElementById('emailBtn').addEventListener('click', emailResults);
            document.getElementById('resetBtn').addEventListener('click', () => {
                showModal('Reset All Progress', 'This will delete all your responses. Are you sure?', true, resetProgress);
            });

            document.getElementById('modalCancel').addEventListener('click', hideModal);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');

            if (tabName === 'feedback') {
                updateFeedbackTab();
            } else if (tabName === 'utility') {
                updateUtilityStats();
            }
        }

        function getCategoryQuestions() {
            const category = questionDatabase.categories[appState.currentCategory];
            if (!category || !category.concepts) return [];
            
            const questions = [];
            category.concepts.forEach((concept) => {
                concept.questions.forEach((question, qIndex) => {
                    questions.push({
                        conceptId: concept.id,
                        questionIndex: qIndex,
                        question: question,
                        concept: concept
                    });
                });
            });
            return questions;
        }

        function renderCurrentQuestion() {
            const questions = getCategoryQuestions();
            if (questions.length === 0) return;

            const currentQ = questions[appState.currentQuestionIndex];
            const responseKey = `${appState.currentCategory}-${currentQ.conceptId}-${currentQ.questionIndex}`;
            const response = appState.responses[responseKey];

            const html = `
                <div class="question-card active">
                    <div class="question-header">
                        <span>Question ${appState.currentQuestionIndex + 1}/${questions.length}</span>
                        <span class="status-indicator ${response ? (response.correct ? 'status-correct' : 'status-incorrect') : 'status-unanswered'}">
                            ${response ? (response.correct ? 'Correct' : 'Incorrect') : 'Unanswered'}
                        </span>
                    </div>
                    <div class="question-text">${currentQ.question.text}</div>
                    <div class="answer-buttons">
                        <button class="answer-btn ${response && response.answer === true ? (response.correct ? 'correct' : 'incorrect') : ''}" 
                                onclick="answerQuestion(true)" ${response ? 'disabled' : ''}>
                            TRUE
                        </button>
                        <button class="answer-btn ${response && response.answer === false ? (response.correct ? 'correct' : 'incorrect') : ''}" 
                                onclick="answerQuestion(false)" ${response ? 'disabled' : ''}>
                            FALSE
                        </button>
                    </div>
                    ${response ? `
                        <div class="feedback show ${response.correct ? 'correct' : 'incorrect'}">
                            <div class="feedback-header">${response.correct ? 'Correct' : 'Incorrect'}</div>
                            <div>${currentQ.question.explanation}</div>
                            <div class="study-tip">Study Tip: ${currentQ.question.studyTip}</div>
                        </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('questionContainer').innerHTML = html;
        }

        function answerQuestion(answer) {
            const questions = getCategoryQuestions();
            if (questions.length === 0) return;
            
            const currentQ = questions[appState.currentQuestionIndex];
            const responseKey = `${appState.currentCategory}-${currentQ.conceptId}-${currentQ.questionIndex}`;

            if (appState.responses[responseKey]) return;

            const correct = answer === currentQ.question.answer;
            
            appState.responses[responseKey] = {
                answer: answer,
                correct: correct,
                timestamp: new Date().toISOString()
            };

            saveState();
            updateAllDisplays();
        }

        function navigateQuestion(direction) {
            const questions = getCategoryQuestions();
            appState.currentQuestionIndex += direction;
            
            if (appState.currentQuestionIndex < 0) {
                appState.currentQuestionIndex = 0;
            } else if (appState.currentQuestionIndex >= questions.length) {
                appState.currentQuestionIndex = questions.length - 1;
            }

            renderCurrentQuestion();
            updateProgress();
            saveState();
        }

        function updateProgress() {
            const questions = getCategoryQuestions();
            if (questions.length === 0) return;

            let answered = 0;
            questions.forEach((q) => {
                const key = `${appState.currentCategory}-${q.conceptId}-${q.questionIndex}`;
                if (appState.responses[key]) answered++;
            });

            const percentage = Math.round((answered / questions.length) * 100);
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${answered}/${questions.length} (${percentage}%)`;
        }

        function renderCategorySummary() {
            const html = questionDatabase.categories.map((category, index) => {
                const totalQuestions = category.concepts.reduce((sum, c) => sum + c.questions.length, 0);
                let answered = 0;
                
                category.concepts.forEach((concept) => {
                    concept.questions.forEach((q, qIndex) => {
                        const key = `${index}-${concept.id}-${qIndex}`;
                        if (appState.responses[key]) answered++;
                    });
                });

                const percentage = Math.round((answered / totalQuestions) * 100);

                return `
                    <div class="category-card">
                        <h3>${category.name}</h3>
                        <div class="stats">
                            ${answered}/${totalQuestions} answered (${percentage}%)
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('categorySummary').innerHTML = html;
        }

        function updateFeedbackTab() {
            const conceptMastery = {};
            
            questionDatabase.categories.forEach((category, catIndex) => {
                category.concepts.forEach((concept) => {
                    const key = `${catIndex}-${concept.id}`;
                    conceptMastery[key] = {
                        concept: concept,
                        categoryName: category.name,
                        categoryIndex: catIndex,
                        responses: []
                    };

                    concept.questions.forEach((q, qIndex) => {
                        const responseKey = `${catIndex}-${concept.id}-${qIndex}`;
                        const response = appState.responses[responseKey];
                        conceptMastery[key].responses.push(response);
                    });
                });
            });

            let mastered = 0, partial = 0, needsWork = 0, notAttempted = 0;

            Object.values(conceptMastery).forEach(cm => {
                const answered = cm.responses.filter(r => r !== undefined);
                const correct = answered.filter(r => r && r.correct);

                if (answered.length === 0) {
                    notAttempted++;
                } else if (answered.length === 2 && correct.length === 2) {
                    mastered++;
                } else if (correct.length > 0) {
                    partial++;
                } else {
                    needsWork++;
                }
            });

            document.getElementById('masteredCount').textContent = mastered;
            document.getElementById('partialCount').textContent = partial;
            document.getElementById('needsWorkCount').textContent = needsWork;
            document.getElementById('notAttemptedCount').textContent = notAttempted;

            const totalAnswered = Object.keys(appState.responses).length;
            const totalQuestions = Object.keys(conceptMastery).length * 2;
            const overallPercentage = Math.round((totalAnswered / totalQuestions) * 100);
            
            document.getElementById('overallProgressFill').style.width = overallPercentage + '%';
            document.getElementById('overallProgressText').textContent = `${totalAnswered}/${totalQuestions} (${overallPercentage}%)`;

            renderConceptList(conceptMastery);
        }

        function renderConceptList(conceptMastery) {
            const filtered = Object.entries(conceptMastery).filter(([key, cm]) => {
                const answered = cm.responses.filter(r => r !== undefined);
                const correct = answered.filter(r => r && r.correct);

                if (appState.filter === 'all') return true;
                if (appState.filter === 'mastered') return answered.length === 2 && correct.length === 2;
                if (appState.filter === 'partial') return answered.length > 0 && correct.length > 0 && correct.length < 2;
                if (appState.filter === 'needs-work') return answered.length > 0 && correct.length === 0;
                if (appState.filter === 'not-attempted') return answered.length === 0;
                return false;
            });

            const html = filtered.map(([key, cm]) => {
                const answered = cm.responses.filter(r => r !== undefined);
                const correct = answered.filter(r => r && r.correct);

                let status = 'not-attempted';
                let statusText = 'Not Attempted';
                
                if (answered.length === 2 && correct.length === 2) {
                    status = 'mastered';
                    statusText = 'Mastered (2/2)';
                } else if (correct.length > 0) {
                    status = 'partial';
                    statusText = `Partial (${correct.length}/2)`;
                } else if (answered.length > 0) {
                    status = 'needs-work';
                    statusText = 'Needs Work (0/2)';
                }

                return `
                    <div class="concept-item ${status}">
                        <div class="concept-header">
                            <span class="concept-title">${cm.concept.title}</span>
                            <span>${statusText}</span>
                        </div>
                        <div class="concept-details">
                            Category: ${cm.categoryName}<br>
                            ${cm.responses.map((r, i) => 
                                r ? `Question ${i + 1}: ${r.correct ? 'Correct ✓' : 'Incorrect ✗'}` : `Question ${i + 1}: Not attempted`
                            ).join('<br>')}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('conceptList').innerHTML = html || '<p style="text-align: center; color: var(--neutral); padding: 2rem;">No concepts match this filter.</p>';
        }

        function updateUtilityStats() {
            const totalAnswered = Object.keys(appState.responses).length;
            const correct = Object.values(appState.responses).filter(r => r && r.correct).length;
            const accuracy = totalAnswered > 0 ? Math.round((correct / totalAnswered) * 100) : 0;

            document.getElementById('statAnswered').textContent = `${totalAnswered}/70`;
            document.getElementById('statAccuracy').textContent = `${accuracy}%`;
            document.getElementById('statCategory').textContent = questionDatabase.categories[appState.currentCategory].name.split(' ')[0];
            document.getElementById('statLastSession').textContent = appState.lastSaved ? new Date(appState.lastSaved).toLocaleString() : 'Never';
        }

        function exportResults() {
            const results = generateResultsText();
            const blob = new Blob([results], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `VCE_Biology_Results_${appState.studentName || 'Student'}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function emailResults() {
            const results = generateResultsText();
            const subject = encodeURIComponent(`VCE Biology Progress - ${appState.studentName || 'Student'}`);
            const body = encodeURIComponent(results);
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }

        function generateResultsText() {
            const totalAnswered = Object.keys(appState.responses).length;
            const correct = Object.values(appState.responses).filter(r => r && r.correct).length;
            const accuracy = totalAnswered > 0 ? Math.round((correct / totalAnswered) * 100) : 0;

            let text = `VCE Biology Examiner's Advice - Progress Report\n`;
            text += `Student: ${appState.studentName || 'Not provided'}\n`;
            text += `Date: ${new Date().toLocaleString()}\n\n`;
            text += `Overall Progress: ${totalAnswered}/70 (${Math.round((totalAnswered/70)*100)}%)\n`;
            text += `Accuracy: ${accuracy}%\n\n`;

            text += `Category Breakdown:\n`;
            questionDatabase.categories.forEach((category, index) => {
                const categoryQuestions = category.concepts.reduce((sum, c) => sum + c.questions.length, 0);
                let categoryAnswered = 0;
                
                category.concepts.forEach((concept) => {
                    concept.questions.forEach((q, qIndex) => {
                        const key = `${index}-${concept.id}-${qIndex}`;
                        if (appState.responses[key]) categoryAnswered++;
                    });
                });

                text += `- ${category.name}: ${categoryAnswered}/${categoryQuestions}\n`;
            });

            return text;
        }

        function resetProgress() {
            appState.responses = {};
            appState.currentQuestionIndex = 0;
            saveState();
            updateAllDisplays();
            hideModal();
        }

        function showModal(header, body, showConfirm = false, confirmCallback = null) {
            document.getElementById('modalHeader').textContent = header;
            document.getElementById('modalBody').textContent = body;
            document.getElementById('modal').classList.add('show');

            if (showConfirm) {
                document.getElementById('modalConfirm').style.display = 'block';
                document.getElementById('modalConfirm').onclick = () => {
                    if (confirmCallback) confirmCallback();
                    hideModal();
                };
            } else {
                document.getElementById('modalConfirm').style.display = 'none';
            }
        }

        function hideModal() {
            document.getElementById('modal').classList.remove('show');
        }

        window.answerQuestion = answerQuestion;

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>